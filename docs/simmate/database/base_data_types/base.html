<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 10.0.1"/>
    <title>simmate.database.base_data_types.base API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../base_data_types.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simmate.database.base_data_types</a>

<a href="https://github.com/jacksund/simmate">            <img src="https://github.com/jacksund/simmate/blob/main/logo/simmate.svg?raw=true" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#SearchResults">SearchResults</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SearchResults.to_dataframe">to_dataframe</a>
                        </li>
                        <li>
                                <a class="function" href="#SearchResults.to_toolkit">to_toolkit</a>
                        </li>
                        <li>
                                <a class="function" href="#SearchResults.to_archive">to_archive</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DatabaseTable">DatabaseTable</a>
                            <ul class="memberlist">
                        <li>
                                <a class="class" href="#DatabaseTable.Meta">DatabaseTable.Meta</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#DatabaseTable.Meta.__init__">Meta</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#DatabaseTable.Meta.abstract">abstract</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="variable" href="#DatabaseTable.base_info">base_info</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.source">source</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatabaseTable.source_doi">source_doi</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatabaseTable.remote_archive_link">remote_archive_link</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.objects">objects</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.show_columns">show_columns</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.create_subclass">create_subclass</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.from_toolkit">from_toolkit</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.load_archive">load_archive</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.load_remote_archive">load_remote_archive</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/database/base_data_types/base.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../simmate.html">simmate</a><wbr>.<a href="./../../database.html">database</a><wbr>.<a href="./../base_data_types.html">base_data_types</a><wbr>.base    </h1>

                        <div class="docstring"><p>This module defines the lowest-level classes for database tables and their
search results.</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module defines the lowest-level classes for database tables and their</span>
<span class="sd">search results.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">urllib</span>

<span class="kn">import</span> <span class="nn">yaml</span>

<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>  <span class="c1"># , transaction</span>
<span class="kn">from</span> <span class="nn">django_pandas.io</span> <span class="kn">import</span> <span class="n">read_frame</span>
<span class="kn">from</span> <span class="nn">django.utils.timezone</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="c1"># This line does NOTHING but rename a module. I have this because I want to use</span>
<span class="c1"># &quot;table_column.CharField(...)&quot; instead of models.CharField(...) in my Models.</span>
<span class="c1"># This let&#39;s beginners read my higher level classes and instantly understand what</span>
<span class="c1"># each thing represents -- without them needing to understand</span>
<span class="c1"># that Django Model == Database Table. Experts may find this annoying, so I&#39;m</span>
<span class="c1"># sorry :(</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span> <span class="k">as</span> <span class="n">table_column</span>


<span class="k">class</span> <span class="nc">SearchResults</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">QuerySet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class adds some extra methods to the results returned from a database</span>
<span class="sd">    search. For example, if you searched all Structures and wanted to convert</span>
<span class="sd">    these to a pandas dataframe or even a list of pymatgen structures, you can</span>
<span class="sd">    now do...</span>

<span class="sd">    ``` python</span>
<span class="sd">    # for a list of database objects (django models)</span>
<span class="sd">    search_results = Structures.objects.all()</span>

<span class="sd">    # for a pandas dataframe (which is like an Excel table)</span>
<span class="sd">    dataframe = search_results.to_dataframe()</span>

<span class="sd">    # for a list of pymatgen structure objects</span>
<span class="sd">    structures = search_results.to_toolkit()</span>
<span class="sd">    ```</span>

<span class="sd">    All other functionality is inherited from</span>
<span class="sd">    [Django QuerySets](https://docs.djangoproject.com/en/4.0/ref/models/querysets/).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fieldnames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">datetime_index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a Pandas DataFrame of the search results</span>

<span class="sd">        This method is coppied from django_pandas&#39;</span>
<span class="sd">        [manager.py](https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py)</span>

<span class="sd">        Paramaters</span>
<span class="sd">        -----------</span>
<span class="sd">        - `fieldnames`:</span>
<span class="sd">            The model field names(columns) to utilise in creating the DataFrame.</span>
<span class="sd">            You can span a relationships in the usual Django ORM way by using</span>
<span class="sd">            the foreign key field name separated by double underscores and refer</span>
<span class="sd">            to a field in a related model.</span>
<span class="sd">        - `index`:</span>
<span class="sd">            specify the field to use  for the index. If the index field is not</span>
<span class="sd">            in fieldnames it will be appended. This is mandatory for timeseries.</span>
<span class="sd">        - `verbose`:</span>
<span class="sd">            If  this is `True` then populate the DataFrame with the human</span>
<span class="sd">            readable versions for foreign key fields else use the actual values</span>
<span class="sd">            set in the model</span>
<span class="sd">        - `coerce_float`:</span>
<span class="sd">            Attempt to convert values to non-string, non-numeric objects (like</span>
<span class="sd">            decimal.Decimal) to floating point.</span>
<span class="sd">        - `datetime_index`: bool</span>
<span class="sd">            specify whether index should be converted to a DateTimeIndex.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># BUG: read_frame runs a NEW query, so it may be a different length from</span>
        <span class="c1"># the original queryset.</span>
        <span class="c1"># See https://github.com/chrisdev/django-pandas/issues/138 for issue</span>
        <span class="k">return</span> <span class="n">read_frame</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">index_col</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
            <span class="n">datetime_index</span><span class="o">=</span><span class="n">datetime_index</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_toolkit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts your SearchResults to a list of pymatgen objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This method will only be for structures and other classes that</span>
        <span class="c1"># support this method. So we make sure the model has supports it first.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;to_toolkit&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;This database table does not have a to_toolkit method implemented&quot;</span>
            <span class="p">)</span>

        <span class="c1"># now we can iterate through the queryset and return the converted</span>
        <span class="c1"># pymatgen objects as a list</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">to_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a compressed zip file using the table&#39;s base_info attribute.</span>
<span class="sd">        Underneath, the file is written in a csv format.</span>

<span class="sd">        This is useful for small making archive files and reloading fixtures</span>
<span class="sd">        to a separate database.</span>

<span class="sd">        This method is attached to the table manager for scenarios to allow</span>
<span class="sd">        queryset filtering before dumping data.</span>

<span class="sd">        To load this database dump into a new database, use the class&#39;s</span>
<span class="sd">        `from_archive` method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>

<span class="sd">        - `filename`:</span>
<span class="sd">            The filename to write the zip file to. By defualt, None will make</span>
<span class="sd">            a filename named MyExampleTableName-2022-01-25.zip, where the date</span>
<span class="sd">            will be the current day (for versioning).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Generate the file name if one wasn&#39;t given.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># This is automatically the name of the table plus the date, where</span>
            <span class="c1"># the date is for versioning. For example...</span>
            <span class="c1">#   MyExampleTable-2022-01-25</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
            <span class="n">filename_base</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>

        <span class="c1"># Turn the filename into the full path. We do this because we only</span>
        <span class="c1"># want to</span>
        <span class="c1"># filename = os.path.abspath(filename)</span>
        <span class="c1"># os.path.dirname(filename)</span>

        <span class="c1"># grab the base_information, and if ID is not present, add it</span>
        <span class="n">base_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">base_info</span>
        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_info</span><span class="p">:</span>
            <span class="n">base_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="c1"># We want to load the entire table, but only grab the fields that</span>
        <span class="c1"># are in base_info.</span>
        <span class="n">base_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="o">*</span><span class="n">base_info</span><span class="p">)</span>

        <span class="c1"># now convert these objects to a pandas dataframe, again using just</span>
        <span class="c1"># the base_info columns</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">base_objs</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">fieldnames</span><span class="o">=</span><span class="n">base_info</span><span class="p">)</span>

        <span class="c1"># Write the data to a csv file</span>
        <span class="c1"># OPTIMIZE: is there a better format that pandas can write to?</span>
        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># now convert the dump file to a compressed zip. In the complex, os</span>
        <span class="c1"># functions below we are just grabbing the filename without the</span>
        <span class="c1"># zip ending. We are also grabbing the directory that the csv is</span>
        <span class="c1"># located in</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>
            <span class="n">base_name</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">),</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="n">root_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)),</span>
            <span class="n">base_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># we can now delete the csv file</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>

    <span class="c1"># EXPERIMENTAL</span>
    <span class="c1"># from prefect import Client</span>
    <span class="c1"># from prefect.utilities.graphql import with_args</span>
    <span class="c1"># def get_prefect_fields(self, fields):</span>
    <span class="c1">#     # This is only every used for Calculations! I have it here instead of making</span>
    <span class="c1">#     # whole new Manager subclass for simplicity.</span>
    <span class="c1">#     # Make sure we have a calculation by seeing if it has prefect_flow_run_id</span>
    <span class="c1">#     # field attached to the model</span>
    <span class="c1">#     if not hasattr(self.model, &quot;prefect_flow_run_id&quot;):</span>
    <span class="c1">#         raise Exception(&quot;get_prefect_fields() should only be used on Calculations!&quot;)</span>
    <span class="c1">#     # grab all the ids in the queryset</span>
    <span class="c1">#     ids = list(self.values_list(&quot;prefect_flow_run_id&quot;, flat=True).all())</span>
    <span class="c1">#     # now for all of the ids in this queryset, grab the corresponding info</span>
    <span class="c1">#     query = {</span>
    <span class="c1">#         &quot;query&quot;: {</span>
    <span class="c1">#             with_args(</span>
    <span class="c1">#                 &quot;flow_run&quot;,</span>
    <span class="c1">#                 {</span>
    <span class="c1">#                     &quot;where&quot;: {</span>
    <span class="c1">#                         &quot;id&quot;: {&quot;_in&quot;: ids},</span>
    <span class="c1">#                     },</span>
    <span class="c1">#                 },</span>
    <span class="c1">#             ): fields,</span>
    <span class="c1">#         }</span>
    <span class="c1">#     }</span>
    <span class="c1">#     client = Client()</span>
    <span class="c1">#     result = client.graphql(query)</span>
    <span class="c1">#     return result</span>


<span class="c1"># Copied this line from...</span>
<span class="c1"># https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py</span>
<span class="n">DatabaseTableManager</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">from_queryset</span><span class="p">(</span><span class="n">SearchResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DatabaseTable</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The base class for defining a table in the Simmate database. All tables and</span>
<span class="sd">    mixins inherit from this class.</span>

<span class="sd">    Usage is identical to</span>
<span class="sd">    [Models in Django](https://docs.djangoproject.com/en/4.0/#the-model-layer)</span>
<span class="sd">    where this class only adds extra methods for convenience.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">base_info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The base information for this database table and only these fields are stored</span>
<span class="sd">    when the `to_archive` method is used. Using the columns in this list, all </span>
<span class="sd">    other columns for this table can be calculated, so the columns in this list </span>
<span class="sd">    are effectively the &quot;raw data&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">JSONField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt; Note, this field is highly experimental at the moment and subject to</span>
<span class="sd">    change.</span>
<span class="sd">    </span>
<span class="sd">    This column indicated the data came from, and it could be a number of things,</span>
<span class="sd">    including...</span>
<span class="sd">     - a third party id</span>
<span class="sd">     - a structure from a different Simmate datbase table</span>
<span class="sd">     - a transformation of another structure</span>
<span class="sd">     - a creation method</span>
<span class="sd">     - a custom submission by the user</span>
<span class="sd">    </span>
<span class="sd">    By default, this is a JSON field to account for all scenarios, but some</span>
<span class="sd">    tables (such as those in `simmate.database.third_parties`) this is value</span>
<span class="sd">    should be the same for ALL entries in the table and therefore the column is</span>
<span class="sd">    overwritten as an attribute.</span>
<span class="sd">    </span>
<span class="sd">    For other tables where this is not a constant, here are some examples of</span>
<span class="sd">    values used in this column:</span>
<span class="sd">    </span>
<span class="sd">    ``` python</span>
<span class="sd">    # from a thirdparty database or separate table</span>
<span class="sd">    source = {</span>
<span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
<span class="sd">        &quot;id&quot;: &quot;mp-123&quot;,</span>
<span class="sd">    }</span>
<span class="sd">    </span>
<span class="sd">    # from a random structure creator</span>
<span class="sd">    source = {&quot;method&quot;: &quot;PyXtalStructure&quot;}</span>
<span class="sd">    </span>
<span class="sd">    # from a templated structure creator (e.g. substituition or prototypes)</span>
<span class="sd">    source = {</span>
<span class="sd">        &quot;method&quot;: &quot;PrototypeStructure&quot;,</span>
<span class="sd">        &quot;table&quot;: &quot;AFLOWPrototypes&quot;,</span>
<span class="sd">        &quot;id&quot;: 123,</span>
<span class="sd">    }</span>
<span class="sd">    </span>
<span class="sd">    # from a transformation</span>
<span class="sd">    source = {</span>
<span class="sd">        &quot;method&quot;: &quot;MirrorMutation&quot;,</span>
<span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
<span class="sd">        &quot;id&quot;: &quot;mp-123&quot;,</span>
<span class="sd">    }</span>
<span class="sd">    </span>
<span class="sd">    # from a multi-structure transformation</span>
<span class="sd">    source = {</span>
<span class="sd">        &quot;method&quot;: &quot;HereditaryMutation&quot;,</span>
<span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
<span class="sd">        &quot;ids&quot;: [&quot;mp-123&quot;, &quot;mp-321&quot;],</span>
<span class="sd">    }</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source_doi</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Source paper that must be referenced if this data is used. If this is None,</span>
<span class="sd">    please refer to the `source` attribute for further details on what to </span>
<span class="sd">    reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The URL that is used to download the archive and then populate this table.</span>
<span class="sd">    Many tables, such as those in `simmate.database.third_parties`, have</span>
<span class="sd">    pre-existing data that you can download and load into your local database,</span>
<span class="sd">    so if this attribute is set, you can use the `load_remote_archive` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># I override the default manager with the one we define above, which has</span>
    <span class="c1"># extra methods useful for our querysets.</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">DatabaseTableManager</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Accesses all of the rows in this datatable and initiates a SearchResults</span>
<span class="sd">    object. Using this, you can perform complex filtering and conversions on</span>
<span class="sd">    data from this table.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">show_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints a list of all the column names for this table and indicates which</span>
<span class="sd">        columns are related to other tables. This is primarily used to help users</span>
<span class="sd">        interactively view what data is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Iterate through and grab the columns</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (relation to </span><span class="si">{</span><span class="n">column</span><span class="o">.</span><span class="n">related_model</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">is_relation</span>
            <span class="k">else</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="c1"># Then use yaml to make the printout pretty (no quotes and separate lines)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclass</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">new_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is useful for dynamically creating a subclass DatabaseTable</span>
<span class="sd">        from some abstract class.</span>

<span class="sd">        Let&#39;s take an example where we inherit from a Structure table. The two</span>
<span class="sd">        ways we create a NewTable below are exactly the same:</span>

<span class="sd">        ``` python</span>
<span class="sd">        # Normal way to create a child class</span>
<span class="sd">        NewTable(Structure):</span>
<span class="sd">            new_field1 = table_column.FloatField()</span>
<span class="sd">            new_field2 = table_column.FloatField()</span>

<span class="sd">        # How this method makes the same child class</span>
<span class="sd">        NewTable = Structure.create_subclass(</span>
<span class="sd">            name=&quot;NewTable&quot;,</span>
<span class="sd">            module=__name__, # required for serialization</span>
<span class="sd">            new_field1 = table_column.FloatField()</span>
<span class="sd">            new_field2 = table_column.FloatField()</span>
<span class="sd">            # app_label --&gt; typically not required bc the parent class sets this</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">        While this might seem silly, it helps us avoid a bunch of boilerplate</span>
<span class="sd">        code when we need to redefine a bunch of relationships in every single</span>
<span class="sd">        child class (and always in the same way). A great example of it&#39;s utility</span>
<span class="sd">        is in `simmate.calculators.vasp.database.relaxation`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># because we update values below, we make sure we are editting a</span>
        <span class="c1"># copy of the dictionary</span>
        <span class="n">new_columns</span> <span class="o">=</span> <span class="n">new_columns</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># BUG: I&#39;m honestly not sure what this does, but it works...</span>
        <span class="c1"># https://stackoverflow.com/questions/27112816/</span>
        <span class="c1"># For a more robust way of setting the Meta class, see my code in</span>
        <span class="c1"># simmate.website.workflows.utilities</span>
        <span class="n">new_columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="n">module</span><span class="p">,</span>
                <span class="s2">&quot;Meta&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;app_label&quot;</span><span class="p">:</span> <span class="n">app_label</span><span class="p">}</span> <span class="k">if</span> <span class="n">app_label</span> <span class="k">else</span> <span class="p">{},</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># TODO: make it so I don&#39;t have to specify the module, but it is automatically</span>
        <span class="c1"># detected from where the class is created. This would remove boilerplate code.</span>
        <span class="c1"># A good start to this is here:</span>
        <span class="c1">#   https://stackoverflow.com/questions/59912684/</span>
        <span class="c1"># sys._getframe(1).f_globals[&quot;__name__&quot;]  &lt;-- grabs where this function is called</span>
        <span class="c1"># but doesn&#39;t work for multiple levels of inheritance. For example, this fails for</span>
        <span class="c1"># the Relaxation subclasses because the create_subclasses method calls</span>
        <span class="c1"># create_subclass -- therefore we&#39;d need _getframe(3) instead of 1...</span>

        <span class="c1"># Now we dynamically create a new class that inherits from this main</span>
        <span class="c1"># one and also adds the new columns to it.</span>
        <span class="n">NewClass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="n">new_columns</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NewClass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_toolkit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given fundamental &quot;base_info&quot; and toolkit objects, this method will populate</span>
<span class="sd">        all relevant columns.</span>

<span class="sd">        If the table is made up of multiple mix-ins, this method iterates through</span>
<span class="sd">        each of the `_from_toolkit` methods of those mixins and combines the results.</span>
<span class="sd">        Therefore, you must view this method for each mix-ins to determine which</span>
<span class="sd">        kwargs must be passed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `as_dict` :</span>
<span class="sd">            Whether to return the populated data as a dictionary or to initialize</span>
<span class="sd">            it as a database object. Defaults to False.</span>
<span class="sd">        - `**kwargs` :</span>
<span class="sd">            All fields required in order to initialize the database entry. For</span>
<span class="sd">            example, a Structure table would require a toolkit structure, while</span>
<span class="sd">            a Thermodynamics table would require an energy.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a dictionary if as_dict is True; and a database object if as_dict is False</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Grab a list of all parent classes</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># As we go through the parent classes below, we will identify the mixins</span>
        <span class="c1"># and populate data using those classes. All of this is fed in to our</span>
        <span class="c1"># main class at the end of the function. We keep this running dictionary</span>
        <span class="c1"># as we go.</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># TODO: How should I best handle passing extra kwargs to the final class</span>
        <span class="c1"># initialization? For example, I would want to pass `energy` but I wouldn&#39;t</span>
        <span class="c1"># want to pass the toolkit structure object. I may update this line in</span>
        <span class="c1"># the future to remove python objects. For now, I only remove structure</span>
        <span class="c1"># and migration_hop because I know that it is a toolkit object -- not</span>
        <span class="c1"># a database column.</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;band_structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;density_of_states&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>

            <span class="c1"># Skip the parent class if it doesn&#39;t directly inherit from the</span>
            <span class="c1"># DatabaseTable class. We do this because we want the fundamental</span>
            <span class="c1"># mixins that come with Simmate (such as Structure, Forces, Thermodynamics).</span>
            <span class="c1"># We also skip the classes that don&#39;t have a _from_toolkit method defined.</span>
            <span class="c1"># Right now, this is just the Calculation class that&#39;s skipped with this</span>
            <span class="c1"># condition.</span>
            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">__base__</span> <span class="o">!=</span> <span class="n">DatabaseTable</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;_from_toolkit&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Grab the input arguments for the _from_toolkit method. This will</span>
            <span class="c1"># give a list back like... [&#39;cls&#39;, &#39;structure&#39;, &#39;as_dict&#39;]. We</span>
            <span class="c1"># don&#39;t consider as_dict or cls, so we remove those too</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;as_dict&quot;</span><span class="p">)</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;cls&quot;</span><span class="p">)</span>

            <span class="c1"># Now inputs is current of list of keys that we need. Next, we go</span>
            <span class="c1"># through our kwargs and see if we have any of these keys, and if so,</span>
            <span class="c1"># grab them.</span>
            <span class="n">matching_inputs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">key</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="c1"># We now pass these inputs to the _from_toolkit. If we&#39;re missing</span>
            <span class="c1"># a required input, this will raise an error here. We only</span>
            <span class="c1"># want the expanded input, so we request a dictionary, not object.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">matching_inputs</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Now add this mixin&#39;s data to our collective dictionary</span>
            <span class="n">all_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
        <span class="c1"># return the dictionary</span>
        <span class="k">return</span> <span class="n">all_data</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">all_data</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_confirm_override</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A utility to make sure the user wants to load new data into their table</span>
<span class="sd">        and (if they are using sqlite) that they are aware of the risks of</span>
<span class="sd">        parallelizing their loading.</span>

<span class="sd">        This utility should not be called directly, as it is used within</span>
<span class="sd">        load_archive and load_remote_archive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first check if the table has data in it already. We raise errors</span>
        <span class="c1"># to stop the user from doing unneccessary and potentiall destructive</span>
        <span class="c1"># downloads</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">confirm_override</span><span class="p">:</span>
            <span class="c1"># if the user has a third-party app, we can be more specific with</span>
            <span class="c1"># our error message.</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;It looks like you&#39;re using a third-party database table and &quot;</span>
                    <span class="s2">&quot;that the table already has data in it! This means you already &quot;</span>
                    <span class="s2">&quot;called load_remote_archive and don&#39;t need to do it again. &quot;</span>
                    <span class="s2">&quot;If you are trying reload a newer version of this data, make &quot;</span>
                    <span class="s2">&quot;sure you empty this table first. This can be done by &quot;</span>
                    <span class="s2">&quot;reseting your database or manually deleting all objects &quot;</span>
                    <span class="s2">&quot;with `ExampleTable.objects.all().delete()`&quot;</span>
                <span class="p">)</span>

            <span class="c1"># otherwise warning the user of overwriting data with matching</span>
            <span class="c1"># primary keys -- and ask them to use confirm_override.</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;It looks like this table already has data in it! By loading an &quot;</span>
                <span class="s2">&quot;archive, you could potentially overwrite this data. The most &quot;</span>
                <span class="s2">&quot;common mistake is non-unique primary keys between your current &quot;</span>
                <span class="s2">&quot;data and the archive -- if there is a duplicate primary key, it &quot;</span>
                <span class="s2">&quot;will overwrite your data. If you are confident the data is safe &quot;</span>
                <span class="s2">&quot;to load into your database, run this command again with &quot;</span>
                <span class="s2">&quot;confirm_override=True.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Django and Dask can only handle so much for the parallelization</span>
        <span class="c1"># of database writing with SQLite. So if the user has SQLite as their</span>
        <span class="c1"># backend, we need to stop them from using this feature.</span>
        <span class="kn">from</span> <span class="nn">simmate.configuration.django.settings</span> <span class="kn">import</span> <span class="n">DATABASES</span>

        <span class="k">if</span> <span class="n">parallel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">confirm_sqlite_parallel</span> <span class="ow">and</span> <span class="s2">&quot;sqlite3&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">DATABASES</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;It looks like you are trying to run things in parallel but are &quot;</span>
                <span class="s2">&quot;using the default database backend (sqlite3), which is not &quot;</span>
                <span class="s2">&quot;always stable for massively parallel methods. You can still &quot;</span>
                <span class="s2">&quot;do this, but this message serves as a word of caution. &quot;</span>
                <span class="s2">&quot;You If you see error messages pop up saying &#39;database is &quot;</span>
                <span class="s2">&quot;locked&#39;, then your database is not stable at the rate you&#39;re &quot;</span>
                <span class="s2">&quot;trying to write data. This is a sign that you should either &quot;</span>
                <span class="s2">&quot;(1) switch to a different database backend such as Postgres &quot;</span>
                <span class="s2">&quot;or (2) reduce the parallelization of your tasks. If you are &quot;</span>
                <span class="s2">&quot;comfortable with these warnings and know what you&#39;re doing, &quot;</span>
                <span class="s2">&quot;set confirm_sqlite_parallel=True.&quot;</span>
            <span class="p">)</span>

    <span class="c1"># @transaction.atomic  # We can&#39;t have an atomic transaction if we use Dask</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_archive</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delete_on_completion</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a compressed zip file made by `objects.to_archive` and loads the data</span>
<span class="sd">        back into the Simmate database.</span>

<span class="sd">        Typically, users won&#39;t call this method directly, but instead use the</span>
<span class="sd">        `load_remote_archive` method, which handles downloading the archive</span>
<span class="sd">        file from the Simmate website for you.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>

<span class="sd">        - `filename`:</span>
<span class="sd">            The filename to write the zip file to. By defualt, None will try to</span>
<span class="sd">            find a file named &quot;MyExampleTableName-2022-01-25.zip&quot;, where the date</span>
<span class="sd">            corresponds to version/timestamp. If multiple files match this format</span>
<span class="sd">            the most recent date will be used.</span>

<span class="sd">        - `delete_on_completion`:</span>
<span class="sd">            Whether to delete the archive file once all data is loaded into the</span>
<span class="sd">            database. Defaults to False</span>

<span class="sd">        - `confirm_override`:</span>
<span class="sd">            If the table already has data in it, the user must take particular</span>
<span class="sd">            care to downloading new data. This flag makes sure the user has</span>
<span class="sd">            made the proper checks to run this action. Default is False.</span>

<span class="sd">        - `parallel`:</span>
<span class="sd">            Whether to load the data in parallel. If true, this will start</span>
<span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
<span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
<span class="sd">            large datasets into the dataset. Default is False.</span>

<span class="sd">        - `confirm_sqlite_parallel`:</span>
<span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
<span class="sd">            knows what they are doing and know the risks of parallelization.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure the user actually wants to do this!</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
            <span class="n">confirm_override</span><span class="p">,</span>
            <span class="n">parallel</span><span class="p">,</span>
            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
        <span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span> <span class="k">as</span> <span class="n">ToolkitStructure</span>

        <span class="c1"># generate the file name if one wasn&#39;t given</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># The name will be something like &quot;MyExampleTable-2022-01-25.zip&quot;.</span>
            <span class="c1"># We go through all files that match &quot;MyExampleTable-*.zip&quot; and then</span>
            <span class="c1"># grab the most recent date.</span>
            <span class="n">matching_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">file</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># make sure there is at least one file</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No file found matching the </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">-*.zip format&quot;</span>
                <span class="p">)</span>
            <span class="c1"># sort the files by date and grab the first</span>
            <span class="n">matching_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">matching_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Turn the filename into the full path -- which makes a number of</span>
        <span class="c1"># manipulations easier below.</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># uncompress the zip file to the same directory that it is located in</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">extract_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># We will now have a csv file of the same name, which we load into</span>
        <span class="c1"># a pandas dataframe</span>
        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>

        <span class="c1"># BUG: NaN values throw errors when read into SQL databases, so we</span>
        <span class="c1"># convert all NaN entries to None. This hacky line was taken from</span>
        <span class="c1">#   https://stackoverflow.com/questions/39279824/</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># convert the dataframe to a list of dictionaries that we will iterate</span>
        <span class="c1"># through.</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>

        <span class="c1"># to enable parallelization, we define a function to load a single</span>
        <span class="c1"># entry (or row) of data. This allows us to submit the function to Dask.</span>
        <span class="k">def</span> <span class="nf">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>

            <span class="c1"># For all entries, convert the structure_string to a toolkit structure</span>
            <span class="k">if</span> <span class="s2">&quot;structure_string&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                <span class="n">structure_str</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure_string&quot;</span><span class="p">)</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">ToolkitStructure</span><span class="o">.</span><span class="n">from_database_string</span><span class="p">(</span><span class="n">structure_str</span><span class="p">)</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">structure</span>
            <span class="c1"># OPTIMIZE: is there a better way to do decide which entries need to be</span>
            <span class="c1"># converted to toolkit objects? This code may be better placed in</span>
            <span class="c1"># base_data_type methods (e.g. a `from_base_info` method for each)</span>

            <span class="n">entry_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">)</span>
            <span class="n">entry_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># now iterate through all entries to save them to the database</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="c1"># If user doesn&#39;t want parallelization, we run these in the main</span>
            <span class="c1"># thread and monitor progress with tqdm</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
                <span class="n">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="c1"># otherwise we use dask to submit these in batches!</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="kn">from</span> <span class="nn">simmate.utilities</span> <span class="kn">import</span> <span class="n">dask_batch_submit</span>

            <span class="n">dask_batch_submit</span><span class="p">(</span>
                <span class="n">function</span><span class="o">=</span><span class="n">load_single_entry</span><span class="p">,</span>
                <span class="n">args_list</span><span class="o">=</span><span class="n">entries</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># We can now delete the files. The zip file is only deleted if requested.</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_on_completion</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># the zip archive</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_remote_archive</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads a compressed zip file made by `objects.to_archive` and loads</span>
<span class="sd">        the data back into the Simmate database.</span>

<span class="sd">        This method should only be called once -- when you have a completely</span>
<span class="sd">        empty database. After this call, all data will be stored locally and</span>
<span class="sd">        you don&#39;t need to call this method again (even accross python sessions).</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        - `remote_archive_link`:</span>
<span class="sd">            The URL for that the archive will be downloaded from. If not supplied,</span>
<span class="sd">            it will default to the table&#39;s remote_archive_link attribute.</span>

<span class="sd">        - `confirm_override`:</span>
<span class="sd">            If the table already has data in it, the user must take particular</span>
<span class="sd">            care to downloading new data. This flag makes sure the user has</span>
<span class="sd">            made the proper checks to run this action.</span>

<span class="sd">        - `parallel`:</span>
<span class="sd">            Whether to load the data in parallel. If true, this will start</span>
<span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
<span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
<span class="sd">            large datasets into the dataset. Default is False.</span>

<span class="sd">        - `confirm_sqlite_parallel`:</span>
<span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
<span class="sd">            knows what they are doing and know the risks of parallelization.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure the user actually wants to do this!</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
            <span class="n">confirm_override</span><span class="p">,</span>
            <span class="n">parallel</span><span class="p">,</span>
            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># confirm that we have a link to download from</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">remote_archive_link</span><span class="p">:</span>
            <span class="c1"># if no link was given we take the input value from class attribute</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;This table does not have a default link to load the archive &quot;</span>
                    <span class="s2">&quot; from. You must provide a remote_archive_link.&quot;</span>
                <span class="p">)</span>
            <span class="n">remote_archive_link</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span>

        <span class="c1"># tell the user where the data comes from</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">WARNING: this data is NOT from the Simmate team, so be sure &quot;</span>
                <span class="s2">&quot;to visit the provider&#39;s website and to cite their work.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; This data is from </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2"> and the following paper &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;should be cited: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source_doi</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Predetermine the file name, which is just the ending of the URL</span>
        <span class="n">archive_filename</span> <span class="o">=</span> <span class="n">remote_archive_link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Download the archive zip file from the URL to the current working dir</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading archive file...&quot;</span><span class="p">)</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">remote_archive_link</span><span class="p">,</span> <span class="n">archive_filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># now that the archive is downloaded, we can load it into our db</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading data into Simmate database...&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">load_archive</span><span class="p">(</span>
            <span class="n">archive_filename</span><span class="p">,</span>
            <span class="n">delete_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">confirm_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
            <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
            <span class="n">confirm_sqlite_parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            </section>
                <section id="SearchResults">
                                <div class="attr class">
        <a class="headerlink" href="#SearchResults">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">SearchResults</span><wbr>(<span class="base">django.db.models.query.QuerySet</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">SearchResults</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">QuerySet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class adds some extra methods to the results returned from a database</span>
<span class="sd">    search. For example, if you searched all Structures and wanted to convert</span>
<span class="sd">    these to a pandas dataframe or even a list of pymatgen structures, you can</span>
<span class="sd">    now do...</span>

<span class="sd">    ``` python</span>
<span class="sd">    # for a list of database objects (django models)</span>
<span class="sd">    search_results = Structures.objects.all()</span>

<span class="sd">    # for a pandas dataframe (which is like an Excel table)</span>
<span class="sd">    dataframe = search_results.to_dataframe()</span>

<span class="sd">    # for a list of pymatgen structure objects</span>
<span class="sd">    structures = search_results.to_toolkit()</span>
<span class="sd">    ```</span>

<span class="sd">    All other functionality is inherited from</span>
<span class="sd">    [Django QuerySets](https://docs.djangoproject.com/en/4.0/ref/models/querysets/).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fieldnames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">datetime_index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a Pandas DataFrame of the search results</span>

<span class="sd">        This method is coppied from django_pandas&#39;</span>
<span class="sd">        [manager.py](https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py)</span>

<span class="sd">        Paramaters</span>
<span class="sd">        -----------</span>
<span class="sd">        - `fieldnames`:</span>
<span class="sd">            The model field names(columns) to utilise in creating the DataFrame.</span>
<span class="sd">            You can span a relationships in the usual Django ORM way by using</span>
<span class="sd">            the foreign key field name separated by double underscores and refer</span>
<span class="sd">            to a field in a related model.</span>
<span class="sd">        - `index`:</span>
<span class="sd">            specify the field to use  for the index. If the index field is not</span>
<span class="sd">            in fieldnames it will be appended. This is mandatory for timeseries.</span>
<span class="sd">        - `verbose`:</span>
<span class="sd">            If  this is `True` then populate the DataFrame with the human</span>
<span class="sd">            readable versions for foreign key fields else use the actual values</span>
<span class="sd">            set in the model</span>
<span class="sd">        - `coerce_float`:</span>
<span class="sd">            Attempt to convert values to non-string, non-numeric objects (like</span>
<span class="sd">            decimal.Decimal) to floating point.</span>
<span class="sd">        - `datetime_index`: bool</span>
<span class="sd">            specify whether index should be converted to a DateTimeIndex.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># BUG: read_frame runs a NEW query, so it may be a different length from</span>
        <span class="c1"># the original queryset.</span>
        <span class="c1"># See https://github.com/chrisdev/django-pandas/issues/138 for issue</span>
        <span class="k">return</span> <span class="n">read_frame</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">index_col</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
            <span class="n">datetime_index</span><span class="o">=</span><span class="n">datetime_index</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_toolkit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts your SearchResults to a list of pymatgen objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This method will only be for structures and other classes that</span>
        <span class="c1"># support this method. So we make sure the model has supports it first.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;to_toolkit&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;This database table does not have a to_toolkit method implemented&quot;</span>
            <span class="p">)</span>

        <span class="c1"># now we can iterate through the queryset and return the converted</span>
        <span class="c1"># pymatgen objects as a list</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">to_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a compressed zip file using the table&#39;s base_info attribute.</span>
<span class="sd">        Underneath, the file is written in a csv format.</span>

<span class="sd">        This is useful for small making archive files and reloading fixtures</span>
<span class="sd">        to a separate database.</span>

<span class="sd">        This method is attached to the table manager for scenarios to allow</span>
<span class="sd">        queryset filtering before dumping data.</span>

<span class="sd">        To load this database dump into a new database, use the class&#39;s</span>
<span class="sd">        `from_archive` method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>

<span class="sd">        - `filename`:</span>
<span class="sd">            The filename to write the zip file to. By defualt, None will make</span>
<span class="sd">            a filename named MyExampleTableName-2022-01-25.zip, where the date</span>
<span class="sd">            will be the current day (for versioning).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Generate the file name if one wasn&#39;t given.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># This is automatically the name of the table plus the date, where</span>
            <span class="c1"># the date is for versioning. For example...</span>
            <span class="c1">#   MyExampleTable-2022-01-25</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
            <span class="n">filename_base</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>

        <span class="c1"># Turn the filename into the full path. We do this because we only</span>
        <span class="c1"># want to</span>
        <span class="c1"># filename = os.path.abspath(filename)</span>
        <span class="c1"># os.path.dirname(filename)</span>

        <span class="c1"># grab the base_information, and if ID is not present, add it</span>
        <span class="n">base_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">base_info</span>
        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_info</span><span class="p">:</span>
            <span class="n">base_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="c1"># We want to load the entire table, but only grab the fields that</span>
        <span class="c1"># are in base_info.</span>
        <span class="n">base_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="o">*</span><span class="n">base_info</span><span class="p">)</span>

        <span class="c1"># now convert these objects to a pandas dataframe, again using just</span>
        <span class="c1"># the base_info columns</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">base_objs</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">fieldnames</span><span class="o">=</span><span class="n">base_info</span><span class="p">)</span>

        <span class="c1"># Write the data to a csv file</span>
        <span class="c1"># OPTIMIZE: is there a better format that pandas can write to?</span>
        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># now convert the dump file to a compressed zip. In the complex, os</span>
        <span class="c1"># functions below we are just grabbing the filename without the</span>
        <span class="c1"># zip ending. We are also grabbing the directory that the csv is</span>
        <span class="c1"># located in</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>
            <span class="n">base_name</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">),</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="n">root_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)),</span>
            <span class="n">base_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># we can now delete the csv file</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>

    <span class="c1"># EXPERIMENTAL</span>
    <span class="c1"># from prefect import Client</span>
    <span class="c1"># from prefect.utilities.graphql import with_args</span>
    <span class="c1"># def get_prefect_fields(self, fields):</span>
    <span class="c1">#     # This is only every used for Calculations! I have it here instead of making</span>
    <span class="c1">#     # whole new Manager subclass for simplicity.</span>
    <span class="c1">#     # Make sure we have a calculation by seeing if it has prefect_flow_run_id</span>
    <span class="c1">#     # field attached to the model</span>
    <span class="c1">#     if not hasattr(self.model, &quot;prefect_flow_run_id&quot;):</span>
    <span class="c1">#         raise Exception(&quot;get_prefect_fields() should only be used on Calculations!&quot;)</span>
    <span class="c1">#     # grab all the ids in the queryset</span>
    <span class="c1">#     ids = list(self.values_list(&quot;prefect_flow_run_id&quot;, flat=True).all())</span>
    <span class="c1">#     # now for all of the ids in this queryset, grab the corresponding info</span>
    <span class="c1">#     query = {</span>
    <span class="c1">#         &quot;query&quot;: {</span>
    <span class="c1">#             with_args(</span>
    <span class="c1">#                 &quot;flow_run&quot;,</span>
    <span class="c1">#                 {</span>
    <span class="c1">#                     &quot;where&quot;: {</span>
    <span class="c1">#                         &quot;id&quot;: {&quot;_in&quot;: ids},</span>
    <span class="c1">#                     },</span>
    <span class="c1">#                 },</span>
    <span class="c1">#             ): fields,</span>
    <span class="c1">#         }</span>
    <span class="c1">#     }</span>
    <span class="c1">#     client = Client()</span>
    <span class="c1">#     result = client.graphql(query)</span>
    <span class="c1">#     return result</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class adds some extra methods to the results returned from a database
search. For example, if you searched all Structures and wanted to convert
these to a pandas dataframe or even a list of pymatgen structures, you can
now do...</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># for a list of database objects (django models)</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">Structures</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="c1"># for a pandas dataframe (which is like an Excel table)</span>
<span class="n">dataframe</span> <span class="o">=</span> <span class="n">search_results</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>

<span class="c1"># for a list of pymatgen structure objects</span>
<span class="n">structures</span> <span class="o">=</span> <span class="n">search_results</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span>
</code></pre></div>

<p>All other functionality is inherited from
<a href="https://docs.djangoproject.com/en/4.0/ref/models/querysets/">Django QuerySets</a>.</p>
</div>


                            <div id="SearchResults.to_dataframe" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SearchResults.to_dataframe">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_dataframe</span><span class="signature">(
    self,
    fieldnames: List[str] = (),
    verbose: bool = True,
    index: str = None,
    coerce_float: str = False,
    datetime_index: str = False
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fieldnames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">datetime_index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a Pandas DataFrame of the search results</span>

<span class="sd">        This method is coppied from django_pandas&#39;</span>
<span class="sd">        [manager.py](https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py)</span>

<span class="sd">        Paramaters</span>
<span class="sd">        -----------</span>
<span class="sd">        - `fieldnames`:</span>
<span class="sd">            The model field names(columns) to utilise in creating the DataFrame.</span>
<span class="sd">            You can span a relationships in the usual Django ORM way by using</span>
<span class="sd">            the foreign key field name separated by double underscores and refer</span>
<span class="sd">            to a field in a related model.</span>
<span class="sd">        - `index`:</span>
<span class="sd">            specify the field to use  for the index. If the index field is not</span>
<span class="sd">            in fieldnames it will be appended. This is mandatory for timeseries.</span>
<span class="sd">        - `verbose`:</span>
<span class="sd">            If  this is `True` then populate the DataFrame with the human</span>
<span class="sd">            readable versions for foreign key fields else use the actual values</span>
<span class="sd">            set in the model</span>
<span class="sd">        - `coerce_float`:</span>
<span class="sd">            Attempt to convert values to non-string, non-numeric objects (like</span>
<span class="sd">            decimal.Decimal) to floating point.</span>
<span class="sd">        - `datetime_index`: bool</span>
<span class="sd">            specify whether index should be converted to a DateTimeIndex.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># BUG: read_frame runs a NEW query, so it may be a different length from</span>
        <span class="c1"># the original queryset.</span>
        <span class="c1"># See https://github.com/chrisdev/django-pandas/issues/138 for issue</span>
        <span class="k">return</span> <span class="n">read_frame</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">index_col</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
            <span class="n">datetime_index</span><span class="o">=</span><span class="n">datetime_index</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a Pandas DataFrame of the search results</p>

<p>This method is coppied from django_pandas'
<a href="https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py">manager.py</a></p>

<h2 id="paramaters">Paramaters</h2>

<ul>
<li><code>fieldnames</code>:
The model field names(columns) to utilise in creating the DataFrame.
You can span a relationships in the usual Django ORM way by using
the foreign key field name separated by double underscores and refer
to a field in a related model.</li>
<li><code>index</code>:
specify the field to use  for the index. If the index field is not
in fieldnames it will be appended. This is mandatory for timeseries.</li>
<li><code>verbose</code>:
If  this is <code>True</code> then populate the DataFrame with the human
readable versions for foreign key fields else use the actual values
set in the model</li>
<li><code>coerce_float</code>:
Attempt to convert values to non-string, non-numeric objects (like
decimal.Decimal) to floating point.</li>
<li><code>datetime_index</code>: bool
specify whether index should be converted to a DateTimeIndex.</li>
</ul>
</div>


                            </div>
                            <div id="SearchResults.to_toolkit" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SearchResults.to_toolkit">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_toolkit</span><span class="signature">(self)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">to_toolkit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts your SearchResults to a list of pymatgen objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This method will only be for structures and other classes that</span>
        <span class="c1"># support this method. So we make sure the model has supports it first.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;to_toolkit&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;This database table does not have a to_toolkit method implemented&quot;</span>
            <span class="p">)</span>

        <span class="c1"># now we can iterate through the queryset and return the converted</span>
        <span class="c1"># pymatgen objects as a list</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Converts your SearchResults to a list of pymatgen objects</p>
</div>


                            </div>
                            <div id="SearchResults.to_archive" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SearchResults.to_archive">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_archive</span><span class="signature">(self, filename: str = None)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">to_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a compressed zip file using the table&#39;s base_info attribute.</span>
<span class="sd">        Underneath, the file is written in a csv format.</span>

<span class="sd">        This is useful for small making archive files and reloading fixtures</span>
<span class="sd">        to a separate database.</span>

<span class="sd">        This method is attached to the table manager for scenarios to allow</span>
<span class="sd">        queryset filtering before dumping data.</span>

<span class="sd">        To load this database dump into a new database, use the class&#39;s</span>
<span class="sd">        `from_archive` method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>

<span class="sd">        - `filename`:</span>
<span class="sd">            The filename to write the zip file to. By defualt, None will make</span>
<span class="sd">            a filename named MyExampleTableName-2022-01-25.zip, where the date</span>
<span class="sd">            will be the current day (for versioning).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Generate the file name if one wasn&#39;t given.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># This is automatically the name of the table plus the date, where</span>
            <span class="c1"># the date is for versioning. For example...</span>
            <span class="c1">#   MyExampleTable-2022-01-25</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
            <span class="n">filename_base</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>

        <span class="c1"># Turn the filename into the full path. We do this because we only</span>
        <span class="c1"># want to</span>
        <span class="c1"># filename = os.path.abspath(filename)</span>
        <span class="c1"># os.path.dirname(filename)</span>

        <span class="c1"># grab the base_information, and if ID is not present, add it</span>
        <span class="n">base_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">base_info</span>
        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_info</span><span class="p">:</span>
            <span class="n">base_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="c1"># We want to load the entire table, but only grab the fields that</span>
        <span class="c1"># are in base_info.</span>
        <span class="n">base_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="o">*</span><span class="n">base_info</span><span class="p">)</span>

        <span class="c1"># now convert these objects to a pandas dataframe, again using just</span>
        <span class="c1"># the base_info columns</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">base_objs</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">fieldnames</span><span class="o">=</span><span class="n">base_info</span><span class="p">)</span>

        <span class="c1"># Write the data to a csv file</span>
        <span class="c1"># OPTIMIZE: is there a better format that pandas can write to?</span>
        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># now convert the dump file to a compressed zip. In the complex, os</span>
        <span class="c1"># functions below we are just grabbing the filename without the</span>
        <span class="c1"># zip ending. We are also grabbing the directory that the csv is</span>
        <span class="c1"># located in</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>
            <span class="n">base_name</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">),</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="n">root_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)),</span>
            <span class="n">base_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># we can now delete the csv file</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Writes a compressed zip file using the table's base_info attribute.
Underneath, the file is written in a csv format.</p>

<p>This is useful for small making archive files and reloading fixtures
to a separate database.</p>

<p>This method is attached to the table manager for scenarios to allow
queryset filtering before dumping data.</p>

<p>To load this database dump into a new database, use the class's
<code>from_archive</code> method.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><code>filename</code>:
The filename to write the zip file to. By defualt, None will make
a filename named MyExampleTableName-2022-01-25.zip, where the date
will be the current day (for versioning).</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>django.db.models.query.QuerySet</dt>
                                <dd id="SearchResults.__init__" class="function">QuerySet</dd>
                <dd id="SearchResults.query" class="variable">query</dd>
                <dd id="SearchResults.as_manager" class="function">as_manager</dd>
                <dd id="SearchResults.iterator" class="function">iterator</dd>
                <dd id="SearchResults.aggregate" class="function">aggregate</dd>
                <dd id="SearchResults.count" class="function">count</dd>
                <dd id="SearchResults.get" class="function">get</dd>
                <dd id="SearchResults.create" class="function">create</dd>
                <dd id="SearchResults.bulk_create" class="function">bulk_create</dd>
                <dd id="SearchResults.bulk_update" class="function">bulk_update</dd>
                <dd id="SearchResults.get_or_create" class="function">get_or_create</dd>
                <dd id="SearchResults.update_or_create" class="function">update_or_create</dd>
                <dd id="SearchResults.earliest" class="function">earliest</dd>
                <dd id="SearchResults.latest" class="function">latest</dd>
                <dd id="SearchResults.first" class="function">first</dd>
                <dd id="SearchResults.last" class="function">last</dd>
                <dd id="SearchResults.in_bulk" class="function">in_bulk</dd>
                <dd id="SearchResults.delete" class="function">delete</dd>
                <dd id="SearchResults.update" class="function">update</dd>
                <dd id="SearchResults.exists" class="function">exists</dd>
                <dd id="SearchResults.contains" class="function">contains</dd>
                <dd id="SearchResults.explain" class="function">explain</dd>
                <dd id="SearchResults.raw" class="function">raw</dd>
                <dd id="SearchResults.values" class="function">values</dd>
                <dd id="SearchResults.values_list" class="function">values_list</dd>
                <dd id="SearchResults.dates" class="function">dates</dd>
                <dd id="SearchResults.datetimes" class="function">datetimes</dd>
                <dd id="SearchResults.none" class="function">none</dd>
                <dd id="SearchResults.all" class="function">all</dd>
                <dd id="SearchResults.filter" class="function">filter</dd>
                <dd id="SearchResults.exclude" class="function">exclude</dd>
                <dd id="SearchResults.complex_filter" class="function">complex_filter</dd>
                <dd id="SearchResults.union" class="function">union</dd>
                <dd id="SearchResults.intersection" class="function">intersection</dd>
                <dd id="SearchResults.difference" class="function">difference</dd>
                <dd id="SearchResults.select_for_update" class="function">select_for_update</dd>
                <dd id="SearchResults.select_related" class="function">select_related</dd>
                <dd id="SearchResults.prefetch_related" class="function">prefetch_related</dd>
                <dd id="SearchResults.annotate" class="function">annotate</dd>
                <dd id="SearchResults.alias" class="function">alias</dd>
                <dd id="SearchResults.order_by" class="function">order_by</dd>
                <dd id="SearchResults.distinct" class="function">distinct</dd>
                <dd id="SearchResults.extra" class="function">extra</dd>
                <dd id="SearchResults.reverse" class="function">reverse</dd>
                <dd id="SearchResults.defer" class="function">defer</dd>
                <dd id="SearchResults.only" class="function">only</dd>
                <dd id="SearchResults.using" class="function">using</dd>
                <dd id="SearchResults.ordered" class="variable">ordered</dd>
                <dd id="SearchResults.db" class="variable">db</dd>
                <dd id="SearchResults.resolve_expression" class="function">resolve_expression</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DatabaseTable">
                                <div class="attr class">
        <a class="headerlink" href="#DatabaseTable">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">DatabaseTable</span><wbr>(<span class="base">django.db.models.base.Model</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DatabaseTable</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The base class for defining a table in the Simmate database. All tables and</span>
<span class="sd">    mixins inherit from this class.</span>

<span class="sd">    Usage is identical to</span>
<span class="sd">    [Models in Django](https://docs.djangoproject.com/en/4.0/#the-model-layer)</span>
<span class="sd">    where this class only adds extra methods for convenience.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">base_info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The base information for this database table and only these fields are stored</span>
<span class="sd">    when the `to_archive` method is used. Using the columns in this list, all </span>
<span class="sd">    other columns for this table can be calculated, so the columns in this list </span>
<span class="sd">    are effectively the &quot;raw data&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">JSONField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt; Note, this field is highly experimental at the moment and subject to</span>
<span class="sd">    change.</span>
<span class="sd">    </span>
<span class="sd">    This column indicated the data came from, and it could be a number of things,</span>
<span class="sd">    including...</span>
<span class="sd">     - a third party id</span>
<span class="sd">     - a structure from a different Simmate datbase table</span>
<span class="sd">     - a transformation of another structure</span>
<span class="sd">     - a creation method</span>
<span class="sd">     - a custom submission by the user</span>
<span class="sd">    </span>
<span class="sd">    By default, this is a JSON field to account for all scenarios, but some</span>
<span class="sd">    tables (such as those in `simmate.database.third_parties`) this is value</span>
<span class="sd">    should be the same for ALL entries in the table and therefore the column is</span>
<span class="sd">    overwritten as an attribute.</span>
<span class="sd">    </span>
<span class="sd">    For other tables where this is not a constant, here are some examples of</span>
<span class="sd">    values used in this column:</span>
<span class="sd">    </span>
<span class="sd">    ``` python</span>
<span class="sd">    # from a thirdparty database or separate table</span>
<span class="sd">    source = {</span>
<span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
<span class="sd">        &quot;id&quot;: &quot;mp-123&quot;,</span>
<span class="sd">    }</span>
<span class="sd">    </span>
<span class="sd">    # from a random structure creator</span>
<span class="sd">    source = {&quot;method&quot;: &quot;PyXtalStructure&quot;}</span>
<span class="sd">    </span>
<span class="sd">    # from a templated structure creator (e.g. substituition or prototypes)</span>
<span class="sd">    source = {</span>
<span class="sd">        &quot;method&quot;: &quot;PrototypeStructure&quot;,</span>
<span class="sd">        &quot;table&quot;: &quot;AFLOWPrototypes&quot;,</span>
<span class="sd">        &quot;id&quot;: 123,</span>
<span class="sd">    }</span>
<span class="sd">    </span>
<span class="sd">    # from a transformation</span>
<span class="sd">    source = {</span>
<span class="sd">        &quot;method&quot;: &quot;MirrorMutation&quot;,</span>
<span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
<span class="sd">        &quot;id&quot;: &quot;mp-123&quot;,</span>
<span class="sd">    }</span>
<span class="sd">    </span>
<span class="sd">    # from a multi-structure transformation</span>
<span class="sd">    source = {</span>
<span class="sd">        &quot;method&quot;: &quot;HereditaryMutation&quot;,</span>
<span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
<span class="sd">        &quot;ids&quot;: [&quot;mp-123&quot;, &quot;mp-321&quot;],</span>
<span class="sd">    }</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source_doi</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Source paper that must be referenced if this data is used. If this is None,</span>
<span class="sd">    please refer to the `source` attribute for further details on what to </span>
<span class="sd">    reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The URL that is used to download the archive and then populate this table.</span>
<span class="sd">    Many tables, such as those in `simmate.database.third_parties`, have</span>
<span class="sd">    pre-existing data that you can download and load into your local database,</span>
<span class="sd">    so if this attribute is set, you can use the `load_remote_archive` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># I override the default manager with the one we define above, which has</span>
    <span class="c1"># extra methods useful for our querysets.</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">DatabaseTableManager</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Accesses all of the rows in this datatable and initiates a SearchResults</span>
<span class="sd">    object. Using this, you can perform complex filtering and conversions on</span>
<span class="sd">    data from this table.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">show_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints a list of all the column names for this table and indicates which</span>
<span class="sd">        columns are related to other tables. This is primarily used to help users</span>
<span class="sd">        interactively view what data is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Iterate through and grab the columns</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (relation to </span><span class="si">{</span><span class="n">column</span><span class="o">.</span><span class="n">related_model</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">is_relation</span>
            <span class="k">else</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="c1"># Then use yaml to make the printout pretty (no quotes and separate lines)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclass</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">new_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is useful for dynamically creating a subclass DatabaseTable</span>
<span class="sd">        from some abstract class.</span>

<span class="sd">        Let&#39;s take an example where we inherit from a Structure table. The two</span>
<span class="sd">        ways we create a NewTable below are exactly the same:</span>

<span class="sd">        ``` python</span>
<span class="sd">        # Normal way to create a child class</span>
<span class="sd">        NewTable(Structure):</span>
<span class="sd">            new_field1 = table_column.FloatField()</span>
<span class="sd">            new_field2 = table_column.FloatField()</span>

<span class="sd">        # How this method makes the same child class</span>
<span class="sd">        NewTable = Structure.create_subclass(</span>
<span class="sd">            name=&quot;NewTable&quot;,</span>
<span class="sd">            module=__name__, # required for serialization</span>
<span class="sd">            new_field1 = table_column.FloatField()</span>
<span class="sd">            new_field2 = table_column.FloatField()</span>
<span class="sd">            # app_label --&gt; typically not required bc the parent class sets this</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">        While this might seem silly, it helps us avoid a bunch of boilerplate</span>
<span class="sd">        code when we need to redefine a bunch of relationships in every single</span>
<span class="sd">        child class (and always in the same way). A great example of it&#39;s utility</span>
<span class="sd">        is in `simmate.calculators.vasp.database.relaxation`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># because we update values below, we make sure we are editting a</span>
        <span class="c1"># copy of the dictionary</span>
        <span class="n">new_columns</span> <span class="o">=</span> <span class="n">new_columns</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># BUG: I&#39;m honestly not sure what this does, but it works...</span>
        <span class="c1"># https://stackoverflow.com/questions/27112816/</span>
        <span class="c1"># For a more robust way of setting the Meta class, see my code in</span>
        <span class="c1"># simmate.website.workflows.utilities</span>
        <span class="n">new_columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="n">module</span><span class="p">,</span>
                <span class="s2">&quot;Meta&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;app_label&quot;</span><span class="p">:</span> <span class="n">app_label</span><span class="p">}</span> <span class="k">if</span> <span class="n">app_label</span> <span class="k">else</span> <span class="p">{},</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># TODO: make it so I don&#39;t have to specify the module, but it is automatically</span>
        <span class="c1"># detected from where the class is created. This would remove boilerplate code.</span>
        <span class="c1"># A good start to this is here:</span>
        <span class="c1">#   https://stackoverflow.com/questions/59912684/</span>
        <span class="c1"># sys._getframe(1).f_globals[&quot;__name__&quot;]  &lt;-- grabs where this function is called</span>
        <span class="c1"># but doesn&#39;t work for multiple levels of inheritance. For example, this fails for</span>
        <span class="c1"># the Relaxation subclasses because the create_subclasses method calls</span>
        <span class="c1"># create_subclass -- therefore we&#39;d need _getframe(3) instead of 1...</span>

        <span class="c1"># Now we dynamically create a new class that inherits from this main</span>
        <span class="c1"># one and also adds the new columns to it.</span>
        <span class="n">NewClass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="n">new_columns</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NewClass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_toolkit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given fundamental &quot;base_info&quot; and toolkit objects, this method will populate</span>
<span class="sd">        all relevant columns.</span>

<span class="sd">        If the table is made up of multiple mix-ins, this method iterates through</span>
<span class="sd">        each of the `_from_toolkit` methods of those mixins and combines the results.</span>
<span class="sd">        Therefore, you must view this method for each mix-ins to determine which</span>
<span class="sd">        kwargs must be passed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `as_dict` :</span>
<span class="sd">            Whether to return the populated data as a dictionary or to initialize</span>
<span class="sd">            it as a database object. Defaults to False.</span>
<span class="sd">        - `**kwargs` :</span>
<span class="sd">            All fields required in order to initialize the database entry. For</span>
<span class="sd">            example, a Structure table would require a toolkit structure, while</span>
<span class="sd">            a Thermodynamics table would require an energy.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a dictionary if as_dict is True; and a database object if as_dict is False</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Grab a list of all parent classes</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># As we go through the parent classes below, we will identify the mixins</span>
        <span class="c1"># and populate data using those classes. All of this is fed in to our</span>
        <span class="c1"># main class at the end of the function. We keep this running dictionary</span>
        <span class="c1"># as we go.</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># TODO: How should I best handle passing extra kwargs to the final class</span>
        <span class="c1"># initialization? For example, I would want to pass `energy` but I wouldn&#39;t</span>
        <span class="c1"># want to pass the toolkit structure object. I may update this line in</span>
        <span class="c1"># the future to remove python objects. For now, I only remove structure</span>
        <span class="c1"># and migration_hop because I know that it is a toolkit object -- not</span>
        <span class="c1"># a database column.</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;band_structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;density_of_states&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>

            <span class="c1"># Skip the parent class if it doesn&#39;t directly inherit from the</span>
            <span class="c1"># DatabaseTable class. We do this because we want the fundamental</span>
            <span class="c1"># mixins that come with Simmate (such as Structure, Forces, Thermodynamics).</span>
            <span class="c1"># We also skip the classes that don&#39;t have a _from_toolkit method defined.</span>
            <span class="c1"># Right now, this is just the Calculation class that&#39;s skipped with this</span>
            <span class="c1"># condition.</span>
            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">__base__</span> <span class="o">!=</span> <span class="n">DatabaseTable</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;_from_toolkit&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Grab the input arguments for the _from_toolkit method. This will</span>
            <span class="c1"># give a list back like... [&#39;cls&#39;, &#39;structure&#39;, &#39;as_dict&#39;]. We</span>
            <span class="c1"># don&#39;t consider as_dict or cls, so we remove those too</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;as_dict&quot;</span><span class="p">)</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;cls&quot;</span><span class="p">)</span>

            <span class="c1"># Now inputs is current of list of keys that we need. Next, we go</span>
            <span class="c1"># through our kwargs and see if we have any of these keys, and if so,</span>
            <span class="c1"># grab them.</span>
            <span class="n">matching_inputs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">key</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="c1"># We now pass these inputs to the _from_toolkit. If we&#39;re missing</span>
            <span class="c1"># a required input, this will raise an error here. We only</span>
            <span class="c1"># want the expanded input, so we request a dictionary, not object.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">matching_inputs</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Now add this mixin&#39;s data to our collective dictionary</span>
            <span class="n">all_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
        <span class="c1"># return the dictionary</span>
        <span class="k">return</span> <span class="n">all_data</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">all_data</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_confirm_override</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A utility to make sure the user wants to load new data into their table</span>
<span class="sd">        and (if they are using sqlite) that they are aware of the risks of</span>
<span class="sd">        parallelizing their loading.</span>

<span class="sd">        This utility should not be called directly, as it is used within</span>
<span class="sd">        load_archive and load_remote_archive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first check if the table has data in it already. We raise errors</span>
        <span class="c1"># to stop the user from doing unneccessary and potentiall destructive</span>
        <span class="c1"># downloads</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">confirm_override</span><span class="p">:</span>
            <span class="c1"># if the user has a third-party app, we can be more specific with</span>
            <span class="c1"># our error message.</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;It looks like you&#39;re using a third-party database table and &quot;</span>
                    <span class="s2">&quot;that the table already has data in it! This means you already &quot;</span>
                    <span class="s2">&quot;called load_remote_archive and don&#39;t need to do it again. &quot;</span>
                    <span class="s2">&quot;If you are trying reload a newer version of this data, make &quot;</span>
                    <span class="s2">&quot;sure you empty this table first. This can be done by &quot;</span>
                    <span class="s2">&quot;reseting your database or manually deleting all objects &quot;</span>
                    <span class="s2">&quot;with `ExampleTable.objects.all().delete()`&quot;</span>
                <span class="p">)</span>

            <span class="c1"># otherwise warning the user of overwriting data with matching</span>
            <span class="c1"># primary keys -- and ask them to use confirm_override.</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;It looks like this table already has data in it! By loading an &quot;</span>
                <span class="s2">&quot;archive, you could potentially overwrite this data. The most &quot;</span>
                <span class="s2">&quot;common mistake is non-unique primary keys between your current &quot;</span>
                <span class="s2">&quot;data and the archive -- if there is a duplicate primary key, it &quot;</span>
                <span class="s2">&quot;will overwrite your data. If you are confident the data is safe &quot;</span>
                <span class="s2">&quot;to load into your database, run this command again with &quot;</span>
                <span class="s2">&quot;confirm_override=True.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Django and Dask can only handle so much for the parallelization</span>
        <span class="c1"># of database writing with SQLite. So if the user has SQLite as their</span>
        <span class="c1"># backend, we need to stop them from using this feature.</span>
        <span class="kn">from</span> <span class="nn">simmate.configuration.django.settings</span> <span class="kn">import</span> <span class="n">DATABASES</span>

        <span class="k">if</span> <span class="n">parallel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">confirm_sqlite_parallel</span> <span class="ow">and</span> <span class="s2">&quot;sqlite3&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">DATABASES</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;It looks like you are trying to run things in parallel but are &quot;</span>
                <span class="s2">&quot;using the default database backend (sqlite3), which is not &quot;</span>
                <span class="s2">&quot;always stable for massively parallel methods. You can still &quot;</span>
                <span class="s2">&quot;do this, but this message serves as a word of caution. &quot;</span>
                <span class="s2">&quot;You If you see error messages pop up saying &#39;database is &quot;</span>
                <span class="s2">&quot;locked&#39;, then your database is not stable at the rate you&#39;re &quot;</span>
                <span class="s2">&quot;trying to write data. This is a sign that you should either &quot;</span>
                <span class="s2">&quot;(1) switch to a different database backend such as Postgres &quot;</span>
                <span class="s2">&quot;or (2) reduce the parallelization of your tasks. If you are &quot;</span>
                <span class="s2">&quot;comfortable with these warnings and know what you&#39;re doing, &quot;</span>
                <span class="s2">&quot;set confirm_sqlite_parallel=True.&quot;</span>
            <span class="p">)</span>

    <span class="c1"># @transaction.atomic  # We can&#39;t have an atomic transaction if we use Dask</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_archive</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delete_on_completion</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a compressed zip file made by `objects.to_archive` and loads the data</span>
<span class="sd">        back into the Simmate database.</span>

<span class="sd">        Typically, users won&#39;t call this method directly, but instead use the</span>
<span class="sd">        `load_remote_archive` method, which handles downloading the archive</span>
<span class="sd">        file from the Simmate website for you.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>

<span class="sd">        - `filename`:</span>
<span class="sd">            The filename to write the zip file to. By defualt, None will try to</span>
<span class="sd">            find a file named &quot;MyExampleTableName-2022-01-25.zip&quot;, where the date</span>
<span class="sd">            corresponds to version/timestamp. If multiple files match this format</span>
<span class="sd">            the most recent date will be used.</span>

<span class="sd">        - `delete_on_completion`:</span>
<span class="sd">            Whether to delete the archive file once all data is loaded into the</span>
<span class="sd">            database. Defaults to False</span>

<span class="sd">        - `confirm_override`:</span>
<span class="sd">            If the table already has data in it, the user must take particular</span>
<span class="sd">            care to downloading new data. This flag makes sure the user has</span>
<span class="sd">            made the proper checks to run this action. Default is False.</span>

<span class="sd">        - `parallel`:</span>
<span class="sd">            Whether to load the data in parallel. If true, this will start</span>
<span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
<span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
<span class="sd">            large datasets into the dataset. Default is False.</span>

<span class="sd">        - `confirm_sqlite_parallel`:</span>
<span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
<span class="sd">            knows what they are doing and know the risks of parallelization.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure the user actually wants to do this!</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
            <span class="n">confirm_override</span><span class="p">,</span>
            <span class="n">parallel</span><span class="p">,</span>
            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
        <span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span> <span class="k">as</span> <span class="n">ToolkitStructure</span>

        <span class="c1"># generate the file name if one wasn&#39;t given</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># The name will be something like &quot;MyExampleTable-2022-01-25.zip&quot;.</span>
            <span class="c1"># We go through all files that match &quot;MyExampleTable-*.zip&quot; and then</span>
            <span class="c1"># grab the most recent date.</span>
            <span class="n">matching_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">file</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># make sure there is at least one file</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No file found matching the </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">-*.zip format&quot;</span>
                <span class="p">)</span>
            <span class="c1"># sort the files by date and grab the first</span>
            <span class="n">matching_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">matching_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Turn the filename into the full path -- which makes a number of</span>
        <span class="c1"># manipulations easier below.</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># uncompress the zip file to the same directory that it is located in</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">extract_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># We will now have a csv file of the same name, which we load into</span>
        <span class="c1"># a pandas dataframe</span>
        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>

        <span class="c1"># BUG: NaN values throw errors when read into SQL databases, so we</span>
        <span class="c1"># convert all NaN entries to None. This hacky line was taken from</span>
        <span class="c1">#   https://stackoverflow.com/questions/39279824/</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># convert the dataframe to a list of dictionaries that we will iterate</span>
        <span class="c1"># through.</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>

        <span class="c1"># to enable parallelization, we define a function to load a single</span>
        <span class="c1"># entry (or row) of data. This allows us to submit the function to Dask.</span>
        <span class="k">def</span> <span class="nf">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>

            <span class="c1"># For all entries, convert the structure_string to a toolkit structure</span>
            <span class="k">if</span> <span class="s2">&quot;structure_string&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                <span class="n">structure_str</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure_string&quot;</span><span class="p">)</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">ToolkitStructure</span><span class="o">.</span><span class="n">from_database_string</span><span class="p">(</span><span class="n">structure_str</span><span class="p">)</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">structure</span>
            <span class="c1"># OPTIMIZE: is there a better way to do decide which entries need to be</span>
            <span class="c1"># converted to toolkit objects? This code may be better placed in</span>
            <span class="c1"># base_data_type methods (e.g. a `from_base_info` method for each)</span>

            <span class="n">entry_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">)</span>
            <span class="n">entry_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># now iterate through all entries to save them to the database</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="c1"># If user doesn&#39;t want parallelization, we run these in the main</span>
            <span class="c1"># thread and monitor progress with tqdm</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
                <span class="n">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="c1"># otherwise we use dask to submit these in batches!</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="kn">from</span> <span class="nn">simmate.utilities</span> <span class="kn">import</span> <span class="n">dask_batch_submit</span>

            <span class="n">dask_batch_submit</span><span class="p">(</span>
                <span class="n">function</span><span class="o">=</span><span class="n">load_single_entry</span><span class="p">,</span>
                <span class="n">args_list</span><span class="o">=</span><span class="n">entries</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># We can now delete the files. The zip file is only deleted if requested.</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_on_completion</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># the zip archive</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_remote_archive</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads a compressed zip file made by `objects.to_archive` and loads</span>
<span class="sd">        the data back into the Simmate database.</span>

<span class="sd">        This method should only be called once -- when you have a completely</span>
<span class="sd">        empty database. After this call, all data will be stored locally and</span>
<span class="sd">        you don&#39;t need to call this method again (even accross python sessions).</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        - `remote_archive_link`:</span>
<span class="sd">            The URL for that the archive will be downloaded from. If not supplied,</span>
<span class="sd">            it will default to the table&#39;s remote_archive_link attribute.</span>

<span class="sd">        - `confirm_override`:</span>
<span class="sd">            If the table already has data in it, the user must take particular</span>
<span class="sd">            care to downloading new data. This flag makes sure the user has</span>
<span class="sd">            made the proper checks to run this action.</span>

<span class="sd">        - `parallel`:</span>
<span class="sd">            Whether to load the data in parallel. If true, this will start</span>
<span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
<span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
<span class="sd">            large datasets into the dataset. Default is False.</span>

<span class="sd">        - `confirm_sqlite_parallel`:</span>
<span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
<span class="sd">            knows what they are doing and know the risks of parallelization.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure the user actually wants to do this!</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
            <span class="n">confirm_override</span><span class="p">,</span>
            <span class="n">parallel</span><span class="p">,</span>
            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># confirm that we have a link to download from</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">remote_archive_link</span><span class="p">:</span>
            <span class="c1"># if no link was given we take the input value from class attribute</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;This table does not have a default link to load the archive &quot;</span>
                    <span class="s2">&quot; from. You must provide a remote_archive_link.&quot;</span>
                <span class="p">)</span>
            <span class="n">remote_archive_link</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span>

        <span class="c1"># tell the user where the data comes from</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">WARNING: this data is NOT from the Simmate team, so be sure &quot;</span>
                <span class="s2">&quot;to visit the provider&#39;s website and to cite their work.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; This data is from </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2"> and the following paper &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;should be cited: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source_doi</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Predetermine the file name, which is just the ending of the URL</span>
        <span class="n">archive_filename</span> <span class="o">=</span> <span class="n">remote_archive_link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Download the archive zip file from the URL to the current working dir</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading archive file...&quot;</span><span class="p">)</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">remote_archive_link</span><span class="p">,</span> <span class="n">archive_filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># now that the archive is downloaded, we can load it into our db</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading data into Simmate database...&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">load_archive</span><span class="p">(</span>
            <span class="n">archive_filename</span><span class="p">,</span>
            <span class="n">delete_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">confirm_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
            <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
            <span class="n">confirm_sqlite_parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>The base class for defining a table in the Simmate database. All tables and
mixins inherit from this class.</p>

<p>Usage is identical to
<a href="https://docs.djangoproject.com/en/4.0/#the-model-layer">Models in Django</a>
where this class only adds extra methods for convenience.</p>
</div>


                            <div id="DatabaseTable.base_info" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DatabaseTable.base_info">#&nbsp;&nbsp</a>

        <span class="name">base_info</span><span class="annotation">: List[str]</span><span class="default_value"> = []</span>
    </div>

    
            <div class="docstring"><p>The base information for this database table and only these fields are stored
when the <code>to_archive</code> method is used. Using the columns in this list, all 
other columns for this table can be calculated, so the columns in this list 
are effectively the "raw data".</p>
</div>


                            </div>
                            <div id="DatabaseTable.source" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.source">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">source</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><blockquote>
  <p>Note, this field is highly experimental at the moment and subject to
  change.</p>
</blockquote>

<p>This column indicated the data came from, and it could be a number of things,
including...</p>

<ul>
<li>a third party id</li>
<li>a structure from a different Simmate datbase table</li>
<li>a transformation of another structure</li>
<li>a creation method</li>
<li>a custom submission by the user</li>
</ul>

<p>By default, this is a JSON field to account for all scenarios, but some
tables (such as those in <code><a href="../third_parties.html">simmate.database.third_parties</a></code>) this is value
should be the same for ALL entries in the table and therefore the column is
overwritten as an attribute.</p>

<p>For other tables where this is not a constant, here are some examples of
values used in this column:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># from a thirdparty database or separate table</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a random structure creator</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PyXtalStructure&quot;</span><span class="p">}</span>

<span class="c1"># from a templated structure creator (e.g. substituition or prototypes)</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PrototypeStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;AFLOWPrototypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;MirrorMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a multi-structure transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;HereditaryMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mp-123&quot;</span><span class="p">,</span> <span class="s2">&quot;mp-321&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>
</div>


                            </div>
                            <div id="DatabaseTable.source_doi" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DatabaseTable.source_doi">#&nbsp;&nbsp</a>

        <span class="name">source_doi</span><span class="annotation">: str</span><span class="default_value"> = None</span>
    </div>

    
            <div class="docstring"><p>Source paper that must be referenced if this data is used. If this is None,
please refer to the <code><a href="#DatabaseTable.source">source</a></code> attribute for further details on what to 
reference.</p>
</div>


                            </div>
                            <div id="DatabaseTable.remote_archive_link" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DatabaseTable.remote_archive_link">#&nbsp;&nbsp</a>

        <span class="name">remote_archive_link</span><span class="annotation">: str</span><span class="default_value"> = None</span>
    </div>

    
            <div class="docstring"><p>The URL that is used to download the archive and then populate this table.
Many tables, such as those in <code><a href="../third_parties.html">simmate.database.third_parties</a></code>, have
pre-existing data that you can download and load into your local database,
so if this attribute is set, you can use the <code><a href="#DatabaseTable.load_remote_archive">load_remote_archive</a></code> method.</p>
</div>


                            </div>
                            <div id="DatabaseTable.objects" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.objects">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">objects</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>Accesses all of the rows in this datatable and initiates a SearchResults
object. Using this, you can perform complex filtering and conversions on
data from this table.</p>
</div>


                            </div>
                            <div id="DatabaseTable.show_columns" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.show_columns">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">show_columns</span><span class="signature">(cls)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">show_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints a list of all the column names for this table and indicates which</span>
<span class="sd">        columns are related to other tables. This is primarily used to help users</span>
<span class="sd">        interactively view what data is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Iterate through and grab the columns</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (relation to </span><span class="si">{</span><span class="n">column</span><span class="o">.</span><span class="n">related_model</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">is_relation</span>
            <span class="k">else</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="c1"># Then use yaml to make the printout pretty (no quotes and separate lines)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>
</pre></div>

        </details>

            <div class="docstring"><p>Prints a list of all the column names for this table and indicates which
columns are related to other tables. This is primarily used to help users
interactively view what data is available.</p>
</div>


                            </div>
                            <div id="DatabaseTable.create_subclass" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.create_subclass">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">create_subclass</span><span class="signature">(cls, name: str, module: str, app_label: str = None, **new_columns)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclass</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">new_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is useful for dynamically creating a subclass DatabaseTable</span>
<span class="sd">        from some abstract class.</span>

<span class="sd">        Let&#39;s take an example where we inherit from a Structure table. The two</span>
<span class="sd">        ways we create a NewTable below are exactly the same:</span>

<span class="sd">        ``` python</span>
<span class="sd">        # Normal way to create a child class</span>
<span class="sd">        NewTable(Structure):</span>
<span class="sd">            new_field1 = table_column.FloatField()</span>
<span class="sd">            new_field2 = table_column.FloatField()</span>

<span class="sd">        # How this method makes the same child class</span>
<span class="sd">        NewTable = Structure.create_subclass(</span>
<span class="sd">            name=&quot;NewTable&quot;,</span>
<span class="sd">            module=__name__, # required for serialization</span>
<span class="sd">            new_field1 = table_column.FloatField()</span>
<span class="sd">            new_field2 = table_column.FloatField()</span>
<span class="sd">            # app_label --&gt; typically not required bc the parent class sets this</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">        While this might seem silly, it helps us avoid a bunch of boilerplate</span>
<span class="sd">        code when we need to redefine a bunch of relationships in every single</span>
<span class="sd">        child class (and always in the same way). A great example of it&#39;s utility</span>
<span class="sd">        is in `simmate.calculators.vasp.database.relaxation`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># because we update values below, we make sure we are editting a</span>
        <span class="c1"># copy of the dictionary</span>
        <span class="n">new_columns</span> <span class="o">=</span> <span class="n">new_columns</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># BUG: I&#39;m honestly not sure what this does, but it works...</span>
        <span class="c1"># https://stackoverflow.com/questions/27112816/</span>
        <span class="c1"># For a more robust way of setting the Meta class, see my code in</span>
        <span class="c1"># simmate.website.workflows.utilities</span>
        <span class="n">new_columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="n">module</span><span class="p">,</span>
                <span class="s2">&quot;Meta&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;app_label&quot;</span><span class="p">:</span> <span class="n">app_label</span><span class="p">}</span> <span class="k">if</span> <span class="n">app_label</span> <span class="k">else</span> <span class="p">{},</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># TODO: make it so I don&#39;t have to specify the module, but it is automatically</span>
        <span class="c1"># detected from where the class is created. This would remove boilerplate code.</span>
        <span class="c1"># A good start to this is here:</span>
        <span class="c1">#   https://stackoverflow.com/questions/59912684/</span>
        <span class="c1"># sys._getframe(1).f_globals[&quot;__name__&quot;]  &lt;-- grabs where this function is called</span>
        <span class="c1"># but doesn&#39;t work for multiple levels of inheritance. For example, this fails for</span>
        <span class="c1"># the Relaxation subclasses because the create_subclasses method calls</span>
        <span class="c1"># create_subclass -- therefore we&#39;d need _getframe(3) instead of 1...</span>

        <span class="c1"># Now we dynamically create a new class that inherits from this main</span>
        <span class="c1"># one and also adds the new columns to it.</span>
        <span class="n">NewClass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="n">new_columns</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NewClass</span>
</pre></div>

        </details>

            <div class="docstring"><p>This method is useful for dynamically creating a subclass DatabaseTable
from some abstract class.</p>

<p>Let's take an example where we inherit from a Structure table. The two
ways we create a NewTable below are exactly the same:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># Normal way to create a child class</span>
<span class="n">NewTable</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">new_field1</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">new_field2</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>

<span class="c1"># How this method makes the same child class</span>
<span class="n">NewTable</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NewTable&quot;</span><span class="p">,</span>
    <span class="n">module</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span> <span class="c1"># required for serialization</span>
    <span class="n">new_field1</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">new_field2</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="c1"># app_label --&gt; typically not required bc the parent class sets this</span>
<span class="p">)</span>
</code></pre></div>

<p>While this might seem silly, it helps us avoid a bunch of boilerplate
code when we need to redefine a bunch of relationships in every single
child class (and always in the same way). A great example of it's utility
is in <code><a href="../../calculators/vasp/database/relaxation.html">simmate.calculators.vasp.database.relaxation</a></code>.</p>
</div>


                            </div>
                            <div id="DatabaseTable.from_toolkit" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.from_toolkit">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">from_toolkit</span><span class="signature">(cls, as_dict=False, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_toolkit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given fundamental &quot;base_info&quot; and toolkit objects, this method will populate</span>
<span class="sd">        all relevant columns.</span>

<span class="sd">        If the table is made up of multiple mix-ins, this method iterates through</span>
<span class="sd">        each of the `_from_toolkit` methods of those mixins and combines the results.</span>
<span class="sd">        Therefore, you must view this method for each mix-ins to determine which</span>
<span class="sd">        kwargs must be passed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `as_dict` :</span>
<span class="sd">            Whether to return the populated data as a dictionary or to initialize</span>
<span class="sd">            it as a database object. Defaults to False.</span>
<span class="sd">        - `**kwargs` :</span>
<span class="sd">            All fields required in order to initialize the database entry. For</span>
<span class="sd">            example, a Structure table would require a toolkit structure, while</span>
<span class="sd">            a Thermodynamics table would require an energy.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a dictionary if as_dict is True; and a database object if as_dict is False</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Grab a list of all parent classes</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># As we go through the parent classes below, we will identify the mixins</span>
        <span class="c1"># and populate data using those classes. All of this is fed in to our</span>
        <span class="c1"># main class at the end of the function. We keep this running dictionary</span>
        <span class="c1"># as we go.</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># TODO: How should I best handle passing extra kwargs to the final class</span>
        <span class="c1"># initialization? For example, I would want to pass `energy` but I wouldn&#39;t</span>
        <span class="c1"># want to pass the toolkit structure object. I may update this line in</span>
        <span class="c1"># the future to remove python objects. For now, I only remove structure</span>
        <span class="c1"># and migration_hop because I know that it is a toolkit object -- not</span>
        <span class="c1"># a database column.</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;band_structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;density_of_states&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>

            <span class="c1"># Skip the parent class if it doesn&#39;t directly inherit from the</span>
            <span class="c1"># DatabaseTable class. We do this because we want the fundamental</span>
            <span class="c1"># mixins that come with Simmate (such as Structure, Forces, Thermodynamics).</span>
            <span class="c1"># We also skip the classes that don&#39;t have a _from_toolkit method defined.</span>
            <span class="c1"># Right now, this is just the Calculation class that&#39;s skipped with this</span>
            <span class="c1"># condition.</span>
            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">__base__</span> <span class="o">!=</span> <span class="n">DatabaseTable</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;_from_toolkit&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Grab the input arguments for the _from_toolkit method. This will</span>
            <span class="c1"># give a list back like... [&#39;cls&#39;, &#39;structure&#39;, &#39;as_dict&#39;]. We</span>
            <span class="c1"># don&#39;t consider as_dict or cls, so we remove those too</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;as_dict&quot;</span><span class="p">)</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;cls&quot;</span><span class="p">)</span>

            <span class="c1"># Now inputs is current of list of keys that we need. Next, we go</span>
            <span class="c1"># through our kwargs and see if we have any of these keys, and if so,</span>
            <span class="c1"># grab them.</span>
            <span class="n">matching_inputs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">key</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="c1"># We now pass these inputs to the _from_toolkit. If we&#39;re missing</span>
            <span class="c1"># a required input, this will raise an error here. We only</span>
            <span class="c1"># want the expanded input, so we request a dictionary, not object.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">matching_inputs</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Now add this mixin&#39;s data to our collective dictionary</span>
            <span class="n">all_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
        <span class="c1"># return the dictionary</span>
        <span class="k">return</span> <span class="n">all_data</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">all_data</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Given fundamental "base_info" and toolkit objects, this method will populate
all relevant columns.</p>

<p>If the table is made up of multiple mix-ins, this method iterates through
each of the <code>_from_toolkit</code> methods of those mixins and combines the results.
Therefore, you must view this method for each mix-ins to determine which
kwargs must be passed.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><code>as_dict</code> :
Whether to return the populated data as a dictionary or to initialize
it as a database object. Defaults to False.</li>
<li><code>**kwargs</code> :
All fields required in order to initialize the database entry. For
example, a Structure table would require a toolkit structure, while
a Thermodynamics table would require an energy.</li>
</ul>

<h2 id="returns">Returns</h2>

<p>a dictionary if as_dict is True; and a database object if as_dict is False</p>
</div>


                            </div>
                            <div id="DatabaseTable.load_archive" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.load_archive">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">load_archive</span><span class="signature">(
    cls,
    filename: str = None,
    delete_on_completion: bool = False,
    confirm_override: bool = False,
    parallel: bool = False,
    confirm_sqlite_parallel: bool = False
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_archive</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delete_on_completion</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a compressed zip file made by `objects.to_archive` and loads the data</span>
<span class="sd">        back into the Simmate database.</span>

<span class="sd">        Typically, users won&#39;t call this method directly, but instead use the</span>
<span class="sd">        `load_remote_archive` method, which handles downloading the archive</span>
<span class="sd">        file from the Simmate website for you.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>

<span class="sd">        - `filename`:</span>
<span class="sd">            The filename to write the zip file to. By defualt, None will try to</span>
<span class="sd">            find a file named &quot;MyExampleTableName-2022-01-25.zip&quot;, where the date</span>
<span class="sd">            corresponds to version/timestamp. If multiple files match this format</span>
<span class="sd">            the most recent date will be used.</span>

<span class="sd">        - `delete_on_completion`:</span>
<span class="sd">            Whether to delete the archive file once all data is loaded into the</span>
<span class="sd">            database. Defaults to False</span>

<span class="sd">        - `confirm_override`:</span>
<span class="sd">            If the table already has data in it, the user must take particular</span>
<span class="sd">            care to downloading new data. This flag makes sure the user has</span>
<span class="sd">            made the proper checks to run this action. Default is False.</span>

<span class="sd">        - `parallel`:</span>
<span class="sd">            Whether to load the data in parallel. If true, this will start</span>
<span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
<span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
<span class="sd">            large datasets into the dataset. Default is False.</span>

<span class="sd">        - `confirm_sqlite_parallel`:</span>
<span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
<span class="sd">            knows what they are doing and know the risks of parallelization.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure the user actually wants to do this!</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
            <span class="n">confirm_override</span><span class="p">,</span>
            <span class="n">parallel</span><span class="p">,</span>
            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
        <span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span> <span class="k">as</span> <span class="n">ToolkitStructure</span>

        <span class="c1"># generate the file name if one wasn&#39;t given</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># The name will be something like &quot;MyExampleTable-2022-01-25.zip&quot;.</span>
            <span class="c1"># We go through all files that match &quot;MyExampleTable-*.zip&quot; and then</span>
            <span class="c1"># grab the most recent date.</span>
            <span class="n">matching_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">file</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># make sure there is at least one file</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No file found matching the </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">-*.zip format&quot;</span>
                <span class="p">)</span>
            <span class="c1"># sort the files by date and grab the first</span>
            <span class="n">matching_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">matching_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Turn the filename into the full path -- which makes a number of</span>
        <span class="c1"># manipulations easier below.</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># uncompress the zip file to the same directory that it is located in</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">extract_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># We will now have a csv file of the same name, which we load into</span>
        <span class="c1"># a pandas dataframe</span>
        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>

        <span class="c1"># BUG: NaN values throw errors when read into SQL databases, so we</span>
        <span class="c1"># convert all NaN entries to None. This hacky line was taken from</span>
        <span class="c1">#   https://stackoverflow.com/questions/39279824/</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># convert the dataframe to a list of dictionaries that we will iterate</span>
        <span class="c1"># through.</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>

        <span class="c1"># to enable parallelization, we define a function to load a single</span>
        <span class="c1"># entry (or row) of data. This allows us to submit the function to Dask.</span>
        <span class="k">def</span> <span class="nf">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>

            <span class="c1"># For all entries, convert the structure_string to a toolkit structure</span>
            <span class="k">if</span> <span class="s2">&quot;structure_string&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                <span class="n">structure_str</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure_string&quot;</span><span class="p">)</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">ToolkitStructure</span><span class="o">.</span><span class="n">from_database_string</span><span class="p">(</span><span class="n">structure_str</span><span class="p">)</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">structure</span>
            <span class="c1"># OPTIMIZE: is there a better way to do decide which entries need to be</span>
            <span class="c1"># converted to toolkit objects? This code may be better placed in</span>
            <span class="c1"># base_data_type methods (e.g. a `from_base_info` method for each)</span>

            <span class="n">entry_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">)</span>
            <span class="n">entry_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># now iterate through all entries to save them to the database</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="c1"># If user doesn&#39;t want parallelization, we run these in the main</span>
            <span class="c1"># thread and monitor progress with tqdm</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
                <span class="n">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="c1"># otherwise we use dask to submit these in batches!</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="kn">from</span> <span class="nn">simmate.utilities</span> <span class="kn">import</span> <span class="n">dask_batch_submit</span>

            <span class="n">dask_batch_submit</span><span class="p">(</span>
                <span class="n">function</span><span class="o">=</span><span class="n">load_single_entry</span><span class="p">,</span>
                <span class="n">args_list</span><span class="o">=</span><span class="n">entries</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># We can now delete the files. The zip file is only deleted if requested.</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_on_completion</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># the zip archive</span>
</pre></div>

        </details>

            <div class="docstring"><p>Reads a compressed zip file made by <code>objects.to_archive</code> and loads the data
back into the Simmate database.</p>

<p>Typically, users won't call this method directly, but instead use the
<code><a href="#DatabaseTable.load_remote_archive">load_remote_archive</a></code> method, which handles downloading the archive
file from the Simmate website for you.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><p><code>filename</code>:
The filename to write the zip file to. By defualt, None will try to
find a file named "MyExampleTableName-2022-01-25.zip", where the date
corresponds to version/timestamp. If multiple files match this format
the most recent date will be used.</p></li>
<li><p><code>delete_on_completion</code>:
Whether to delete the archive file once all data is loaded into the
database. Defaults to False</p></li>
<li><p><code>confirm_override</code>:
If the table already has data in it, the user must take particular
care to downloading new data. This flag makes sure the user has
made the proper checks to run this action. Default is False.</p></li>
<li><p><code>parallel</code>:
Whether to load the data in parallel. If true, this will start
a local Dask cluster and each data row will be submitted as a task
to the cluster. This provides substansial speed-ups for loading
large datasets into the dataset. Default is False.</p></li>
<li><p><code>confirm_sqlite_parallel</code>:
If the database backend is sqlite, this parameter ensures the user
knows what they are doing and know the risks of parallelization.
Default is False.</p></li>
</ul>
</div>


                            </div>
                            <div id="DatabaseTable.load_remote_archive" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.load_remote_archive">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">load_remote_archive</span><span class="signature">(
    cls,
    remote_archive_link: str = None,
    confirm_override: bool = False,
    parallel: bool = False,
    confirm_sqlite_parallel: bool = False
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_remote_archive</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads a compressed zip file made by `objects.to_archive` and loads</span>
<span class="sd">        the data back into the Simmate database.</span>

<span class="sd">        This method should only be called once -- when you have a completely</span>
<span class="sd">        empty database. After this call, all data will be stored locally and</span>
<span class="sd">        you don&#39;t need to call this method again (even accross python sessions).</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        - `remote_archive_link`:</span>
<span class="sd">            The URL for that the archive will be downloaded from. If not supplied,</span>
<span class="sd">            it will default to the table&#39;s remote_archive_link attribute.</span>

<span class="sd">        - `confirm_override`:</span>
<span class="sd">            If the table already has data in it, the user must take particular</span>
<span class="sd">            care to downloading new data. This flag makes sure the user has</span>
<span class="sd">            made the proper checks to run this action.</span>

<span class="sd">        - `parallel`:</span>
<span class="sd">            Whether to load the data in parallel. If true, this will start</span>
<span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
<span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
<span class="sd">            large datasets into the dataset. Default is False.</span>

<span class="sd">        - `confirm_sqlite_parallel`:</span>
<span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
<span class="sd">            knows what they are doing and know the risks of parallelization.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure the user actually wants to do this!</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
            <span class="n">confirm_override</span><span class="p">,</span>
            <span class="n">parallel</span><span class="p">,</span>
            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># confirm that we have a link to download from</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">remote_archive_link</span><span class="p">:</span>
            <span class="c1"># if no link was given we take the input value from class attribute</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;This table does not have a default link to load the archive &quot;</span>
                    <span class="s2">&quot; from. You must provide a remote_archive_link.&quot;</span>
                <span class="p">)</span>
            <span class="n">remote_archive_link</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span>

        <span class="c1"># tell the user where the data comes from</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">WARNING: this data is NOT from the Simmate team, so be sure &quot;</span>
                <span class="s2">&quot;to visit the provider&#39;s website and to cite their work.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; This data is from </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2"> and the following paper &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;should be cited: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source_doi</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Predetermine the file name, which is just the ending of the URL</span>
        <span class="n">archive_filename</span> <span class="o">=</span> <span class="n">remote_archive_link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Download the archive zip file from the URL to the current working dir</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading archive file...&quot;</span><span class="p">)</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">remote_archive_link</span><span class="p">,</span> <span class="n">archive_filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># now that the archive is downloaded, we can load it into our db</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading data into Simmate database...&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">load_archive</span><span class="p">(</span>
            <span class="n">archive_filename</span><span class="p">,</span>
            <span class="n">delete_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">confirm_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
            <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
            <span class="n">confirm_sqlite_parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Downloads a compressed zip file made by <code>objects.to_archive</code> and loads
the data back into the Simmate database.</p>

<p>This method should only be called once -- when you have a completely
empty database. After this call, all data will be stored locally and
you don't need to call this method again (even accross python sessions).</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><p><code><a href="#DatabaseTable.remote_archive_link">remote_archive_link</a></code>:
The URL for that the archive will be downloaded from. If not supplied,
it will default to the table's remote_archive_link attribute.</p></li>
<li><p><code>confirm_override</code>:
If the table already has data in it, the user must take particular
care to downloading new data. This flag makes sure the user has
made the proper checks to run this action.</p></li>
<li><p><code>parallel</code>:
Whether to load the data in parallel. If true, this will start
a local Dask cluster and each data row will be submitted as a task
to the cluster. This provides substansial speed-ups for loading
large datasets into the dataset. Default is False.</p></li>
<li><p><code>confirm_sqlite_parallel</code>:
If the database backend is sqlite, this parameter ensures the user
knows what they are doing and know the risks of parallelization.
Default is False.</p></li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>django.db.models.base.Model</dt>
                                <dd id="DatabaseTable.__init__" class="function">Model</dd>
                <dd id="DatabaseTable.from_db" class="function">from_db</dd>
                <dd id="DatabaseTable.pk" class="variable">pk</dd>
                <dd id="DatabaseTable.get_deferred_fields" class="function">get_deferred_fields</dd>
                <dd id="DatabaseTable.refresh_from_db" class="function">refresh_from_db</dd>
                <dd id="DatabaseTable.serializable_value" class="function">serializable_value</dd>
                <dd id="DatabaseTable.save" class="function">save</dd>
                <dd id="DatabaseTable.save_base" class="function">save_base</dd>
                <dd id="DatabaseTable.delete" class="function">delete</dd>
                <dd id="DatabaseTable.prepare_database_save" class="function">prepare_database_save</dd>
                <dd id="DatabaseTable.clean" class="function">clean</dd>
                <dd id="DatabaseTable.validate_unique" class="function">validate_unique</dd>
                <dd id="DatabaseTable.date_error_message" class="function">date_error_message</dd>
                <dd id="DatabaseTable.unique_error_message" class="function">unique_error_message</dd>
                <dd id="DatabaseTable.full_clean" class="function">full_clean</dd>
                <dd id="DatabaseTable.clean_fields" class="function">clean_fields</dd>
                <dd id="DatabaseTable.check" class="function">check</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DatabaseTable.Meta">
                                <div class="attr class">
        <a class="headerlink" href="#DatabaseTable.Meta">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">DatabaseTable.Meta</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

        </details>

    

                            <div id="DatabaseTable.Meta.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.Meta.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">DatabaseTable.Meta</span><span class="signature">()</span>
    </div>

    
    

                            </div>
                            <div id="DatabaseTable.Meta.abstract" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DatabaseTable.Meta.abstract">#&nbsp;&nbsp</a>

        <span class="name">abstract</span><span class="default_value"> = False</span>
    </div>

    
    

                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>