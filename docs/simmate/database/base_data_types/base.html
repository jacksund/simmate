<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 11.1.0"/>
    <title>simmate.database.base_data_types.base API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(:first-of-type){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc > section:first-of-type details > summary{top:-20px;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../base_data_types.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simmate.database.base_data_types</a>

<a href="https://github.com/jacksund/simmate">            <img src="https://github.com/jacksund/simmate/blob/main/src/simmate/website/static_files/images/simmate-logo.svg?raw=true" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#SearchResults">SearchResults</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SearchResults.to_dataframe">to_dataframe</a>
                        </li>
                        <li>
                                <a class="function" href="#SearchResults.to_toolkit">to_toolkit</a>
                        </li>
                        <li>
                                <a class="function" href="#SearchResults.to_archive">to_archive</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DatabaseTable">DatabaseTable</a>
                            <ul class="memberlist">
                        <li>
                                <a class="class" href="#DatabaseTable.Meta">DatabaseTable.Meta</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#DatabaseTable.Meta.__init__">Meta</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#DatabaseTable.Meta.abstract">abstract</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="variable" href="#DatabaseTable.base_info">base_info</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.source">source</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatabaseTable.source_doi">source_doi</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatabaseTable.remote_archive_link">remote_archive_link</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.objects">objects</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.get_table_name">get_table_name</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.create_subclass">create_subclass</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.from_toolkit">from_toolkit</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.load_archive">load_archive</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.load_remote_archive">load_remote_archive</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.get_column_names">get_column_names</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.show_columns">show_columns</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.get_mixins">get_mixins</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.get_mixin_names">get_mixin_names</a>
                        </li>
                        <li>
                                <a class="function" href="#DatabaseTable.get_extra_columns">get_extra_columns</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/database/base_data_types/base.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../simmate.html">simmate</a><wbr>.<a href="./../../database.html">database</a><wbr>.<a href="./../base_data_types.html">base_data_types</a><wbr>.base    </h1>

                        <div class="docstring"><p>This module defines the lowest-level classes for database tables and their
search results.</p>

<p>See the <code><a href="../base_data_types.html">simmate.database.base_data_types</a></code> (which is the parent module of 
this one) for example usage.</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="L-0"><a href="#L-0"><span class="linenos">  0</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">This module defines the lowest-level classes for database tables and their</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">search results.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">See the `simmate.database.base_data_types` (which is the parent module of </span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">this one) for example usage.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">inspect</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span> <span class="nn">urllib</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">import</span> <span class="nn">yaml</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">import</span> <span class="nn">pandas</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>  <span class="c1"># , transaction</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span> <span class="nn">django_pandas.io</span> <span class="kn">import</span> <span class="n">read_frame</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span> <span class="nn">django.utils.timezone</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="c1"># This line does NOTHING but rename a module. I have this because I want to use</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="c1"># &quot;table_column.CharField(...)&quot; instead of &quot;models.CharField(...)&quot; in my Models.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="c1"># This let&#39;s beginners read my higher level classes and instantly understand what</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="c1"># each thing represents -- without them needing to understand</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="c1"># that Django Model == Database Table. Experts may find this annoying, so I&#39;m</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="c1"># sorry :(</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span> <span class="k">as</span> <span class="n">table_column</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="k">class</span> <span class="nc">SearchResults</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">QuerySet</span><span class="p">):</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    This class adds some extra methods to the results returned from a database</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    search. For example, if you searched all Structures and wanted to convert</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    these to a pandas dataframe or even a list of pymatgen structures, you can</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    now do...</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    ``` python</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    # for a list of database objects (django models)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    search_results = Structures.objects.all()</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    # for a pandas dataframe (which is like an Excel table)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    dataframe = search_results.to_dataframe()</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    # for a list of pymatgen structure objects</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    structures = search_results.to_toolkit()</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    ```</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    All other functionality is inherited from</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    [Django QuerySets](https://docs.djangoproject.com/en/4.0/ref/models/querysets/).</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="n">fieldnames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="n">datetime_index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        Returns a Pandas DataFrame of the search results</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        This method is coppied from django_pandas&#39;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        [manager.py](https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        Paramaters</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        -----------</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">        - `fieldnames`:</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">            The model field names(columns) to utilise in creating the DataFrame.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            You can span a relationships in the usual Django ORM way by using</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">            the foreign key field name separated by double underscores and refer</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">            to a field in a related model.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        - `index`:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">            specify the field to use  for the index. If the index field is not</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">            in fieldnames it will be appended. This is mandatory for timeseries.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        - `verbose`:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">            If  this is `True` then populate the DataFrame with the human</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">            readable versions for foreign key fields else use the actual values</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">            set in the model</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        - `coerce_float`:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">            Attempt to convert values to non-string, non-numeric objects (like</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">            decimal.Decimal) to floating point.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        - `datetime_index`: bool</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">            specify whether index should be converted to a DateTimeIndex.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="c1"># BUG: read_frame runs a NEW query, so it may be a different length from</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="c1"># the original queryset.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="c1"># See https://github.com/chrisdev/django-pandas/issues/138 for issue</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="k">return</span> <span class="n">read_frame</span><span class="p">(</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>            <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">,</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>            <span class="n">index_col</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>            <span class="n">datetime_index</span><span class="o">=</span><span class="n">datetime_index</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">to_toolkit</span><span class="p">(</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>  <span class="c1"># type of object varies (e.g. Structure, BandStructure, etc.)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        Converts your SearchResults to a list of pymatgen objects</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="c1"># This method will only be for structures and other classes that</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="c1"># support this method. So we make sure the model has supports it first.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;to_toolkit&quot;</span><span class="p">):</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="s2">&quot;This database table does not have a to_toolkit method implemented&quot;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>            <span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="c1"># now we can iterate through the queryset and return the converted</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="c1"># pymatgen objects as a list</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="nf">to_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        Writes a compressed zip file using the table&#39;s base_info attribute.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        Underneath, the file is written in a csv format.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        This is useful for small making archive files and reloading fixtures</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        to a separate database.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        This method is attached to the table manager for scenarios to allow</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        queryset filtering before dumping data.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        To load this database dump into a new database, use the class&#39;s</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        `from_archive` method.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">        #### Parameters</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        - `filename`:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">            The filename to write the zip file to. By defualt, None will make</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">            a filename named MyExampleTableName-2022-01-25.zip, where the date</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">            will be the current day (for versioning).</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="c1"># Generate the file name if one wasn&#39;t given.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="c1"># This is automatically the name of the table plus the date, where</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="c1"># the date is for versioning. For example...</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="c1">#   MyExampleTable-2022-01-25</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="n">filename_base</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                <span class="p">[</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>                <span class="p">]</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="c1"># Turn the filename into the full path. We do this because we only</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="c1"># want to</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="c1"># filename = os.path.abspath(filename)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="c1"># os.path.dirname(filename)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="c1"># grab the base_information, and if ID is not present, add it</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="n">base_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">base_info</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_info</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="n">base_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="c1"># We want to load the entire table, but only grab the fields that</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="c1"># are in base_info.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="n">base_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="o">*</span><span class="n">base_info</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="c1"># now convert these objects to a pandas dataframe, again using just</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="c1"># the base_info columns</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">base_objs</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">fieldnames</span><span class="o">=</span><span class="n">base_info</span><span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="c1"># Write the data to a csv file</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="c1"># OPTIMIZE: is there a better format that pandas can write to?</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="c1"># now convert the dump file to a compressed zip. In the complex, os</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="c1"># functions below we are just grabbing the filename without the</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="c1"># zip ending. We are also grabbing the directory that the csv is</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="c1"># located in</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="n">base_name</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">),</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="n">root_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)),</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="n">base_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">),</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="c1"># we can now delete the csv file</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="c1"># EXPERIMENTAL</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="c1"># from prefect import Client</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="c1"># from prefect.utilities.graphql import with_args</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>    <span class="c1"># def get_prefect_fields(self, fields):</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>    <span class="c1">#     # This is only every used for Calculations! I have it here instead of making</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>    <span class="c1">#     # whole new Manager subclass for simplicity.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>    <span class="c1">#     # Make sure we have a calculation by seeing if it has prefect_flow_run_id</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>    <span class="c1">#     # field attached to the model</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>    <span class="c1">#     if not hasattr(self.model, &quot;prefect_flow_run_id&quot;):</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="c1">#         raise Exception(&quot;get_prefect_fields() should only be used on Calculations!&quot;)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="c1">#     # grab all the ids in the queryset</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="c1">#     ids = list(self.values_list(&quot;prefect_flow_run_id&quot;, flat=True).all())</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>    <span class="c1">#     # now for all of the ids in this queryset, grab the corresponding info</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="c1">#     query = {</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>    <span class="c1">#         &quot;query&quot;: {</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>    <span class="c1">#             with_args(</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>    <span class="c1">#                 &quot;flow_run&quot;,</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="c1">#                 {</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>    <span class="c1">#                     &quot;where&quot;: {</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>    <span class="c1">#                         &quot;id&quot;: {&quot;_in&quot;: ids},</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="c1">#                     },</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>    <span class="c1">#                 },</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>    <span class="c1">#             ): fields,</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="c1">#         }</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="c1">#     }</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>    <span class="c1">#     client = Client()</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>    <span class="c1">#     result = client.graphql(query)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>    <span class="c1">#     return result</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="c1"># Copied this line from...</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="c1"># https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="c1"># It simply converts this queryset class to a manager.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="n">DatabaseTableManager</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">from_queryset</span><span class="p">(</span><span class="n">SearchResults</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="k">class</span> <span class="nc">DatabaseTable</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">    The base class for defining a table in the Simmate database. All tables and</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">    mixins inherit from this class.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">    Usage is identical to</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">    [models in Django](https://docs.djangoproject.com/en/4.0/#the-model-layer)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">    where this class only adds extra methods for convenience.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="n">base_info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">    The base information for this database table and only these fields are stored</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">    when the `to_archive` method is used. Using the columns in this list, all </span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">    other columns for this table can be calculated, so the columns in this list </span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">    are effectively the &quot;raw data&quot;.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="n">source</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">JSONField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">    &gt; Note, this field is highly experimental at the moment and subject to</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">    change.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">    </span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">    This column indicates where the data came from, and it could be a number </span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">    of things including...</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">     - a third party id</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">     - a structure from a different Simmate datbase table</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">     - a transformation of another structure</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">     - a creation method</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">     - a custom submission by the user</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">    </span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">    By default, this is a JSON field to account for all scenarios, but some</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">    tables (such as those in `simmate.database.third_parties`) this is value</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">    should be the same for ALL entries in the table and therefore the column is</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">    overwritten as an attribute.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">    </span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">    For other tables where this is not a constant, here are some examples of</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">    values used in this column:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">    </span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">    ``` python</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">    # from a thirdparty database or separate table</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">    source = {</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">        &quot;id&quot;: &quot;mp-123&quot;,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">    }</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">    </span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">    # from a random structure creator</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">    source = {&quot;method&quot;: &quot;PyXtalStructure&quot;}</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">    </span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">    # from a templated structure creator (e.g. substituition or prototypes)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">    source = {</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        &quot;method&quot;: &quot;PrototypeStructure&quot;,</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">        &quot;table&quot;: &quot;AFLOWPrototypes&quot;,</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        &quot;id&quot;: 123,</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">    }</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">    </span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">    # from a transformation</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">    source = {</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        &quot;method&quot;: &quot;MirrorMutation&quot;,</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        &quot;id&quot;: &quot;mp-123&quot;,</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">    }</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">    </span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    # from a multi-structure transformation</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">    source = {</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        &quot;method&quot;: &quot;HereditaryMutation&quot;,</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        &quot;ids&quot;: [&quot;mp-123&quot;, &quot;mp-321&quot;],</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">    }</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">    ```</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="c1"># TODO: Explore polymorphic relations instead of a JSON dictionary.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>    <span class="c1"># Making relationships to different tables makes things difficult to use, so</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>    <span class="c1"># these columns are just standalone.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>    <span class="c1">#</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>    <span class="c1"># This is will be very important for &quot;source&quot; and &quot;parent_nested_calculations&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>    <span class="c1"># fields because I have no way to efficiently convert these fields to the objects</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>    <span class="c1"># that they refer to. There&#39;s also no good way to access a structure&#39;s &quot;children&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>    <span class="c1"># (i.e. structure where they are the source).</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>    <span class="c1">#</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>    <span class="c1"># I should investigate generic relations in django though:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>    <span class="c1"># https://docs.djangoproject.com/en/3.2/ref/contrib/contenttypes/#generic-relations</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>    <span class="c1">#</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>    <span class="c1"># Another option is using django-polymorphic.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>    <span class="c1"># https://django-polymorphic.readthedocs.io/en/latest/</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>    <span class="c1"># This thread is really helpful on the subject:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>    <span class="c1"># https://stackoverflow.com/questions/30343212/</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>    <span class="c1">#</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="c1"># TODO: Consider adding some methods to track the history of a structure.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>    <span class="c1">#  This would be useful for things like evolutionary algorithms.</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>    <span class="c1"># get_source_parent:</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="c1">#   this would iterate through sources until we find one in the same table</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>    <span class="c1">#   as this one. Parent sources are often the most recent transformation</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="c1">#   or mutation applied to a structure, such as a MirrorMutation.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>    <span class="c1"># get_source_seed:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    <span class="c1">#   this would iterate through sources until we hit a dead-end. So the seed</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>    <span class="c1">#   source would be something like a third-party database, a method that</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>    <span class="c1">#   randomly create structures, or a prototype.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>    <span class="c1"># Both of these get more complex when we consider transformation that have</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>    <span class="c1"># multiple parents (and therefore multiple seeds too). An example of this</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>    <span class="c1"># is the HereditaryMutation.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>    <span class="n">source_doi</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">    Source paper that must be referenced if this data is used. If this is None,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">    please refer to the `source` attribute for further details on what to </span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">    reference.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">    The URL that is used to download the archive and then populate this table.</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">    Many tables, such as those in `simmate.database.third_parties`, have</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">    pre-existing data that you can download and load into your local database,</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">    so if this attribute is set, you can use the `load_remote_archive` method.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="c1"># I override the default manager with the one we define above, which has</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>    <span class="c1"># extra methods useful for our querysets.</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">DatabaseTableManager</span><span class="p">()</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">    Accesses all of the rows in this datatable and initiates a SearchResults</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">    object. Using this, you can perform complex filtering and conversions on</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">    data from this table.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="nf">get_table_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        Returns the name of this database table, which will simply match the</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        class name. Using `Table.__name__` is often easier. This method simply</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">        makes the name accessible in Django Templates.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>    <span class="k">def</span> <span class="nf">create_subclass</span><span class="p">(</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="o">**</span><span class="n">new_columns</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="p">):</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        This method is useful for dynamically creating a subclass DatabaseTable</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        from some abstract class.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">        Let&#39;s take an example where we inherit from a Structure table. The two</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        ways we create a NewTable below are exactly the same:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        ``` python</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        # Normal way to create a child class</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        NewTable(Structure):</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">            new_field1 = table_column.FloatField()</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">            new_field2 = table_column.FloatField()</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        # How this method makes the same child class</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        NewTable = Structure.create_subclass(</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">            name=&quot;NewTable&quot;,</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">            module=__name__, # required for serialization</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">            new_field1 = table_column.FloatField()</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">            new_field2 = table_column.FloatField()</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">            # app_label --&gt; typically not required bc the parent class sets this</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        )</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">        ```</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        While this might seem silly, it helps us avoid a bunch of boilerplate</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        code when we need to redefine a bunch of relationships in every single</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">        child class (and always in the same way). A great example of it&#39;s utility</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        is in `simmate.calculators.vasp.database.relaxation`.</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="c1"># because we update values below, we make sure we are editting a</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="c1"># copy of the dictionary</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="n">new_columns</span> <span class="o">=</span> <span class="n">new_columns</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="c1"># BUG: I&#39;m honestly not sure what this does, but it works...</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="c1"># https://stackoverflow.com/questions/27112816/</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="c1"># For a more robust way of setting the Meta class, see my code in</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="c1"># simmate.website.workflows.utilities</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="n">new_columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="p">{</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>                <span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="n">module</span><span class="p">,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>                <span class="s2">&quot;Meta&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;app_label&quot;</span><span class="p">:</span> <span class="n">app_label</span><span class="p">}</span> <span class="k">if</span> <span class="n">app_label</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="p">}</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="c1"># TODO: make it so I don&#39;t have to specify the module, but it is automatically</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="c1"># detected from where the class is created. This would remove boilerplate code.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        <span class="c1"># A good start to this is here:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="c1">#   https://stackoverflow.com/questions/59912684/</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="c1"># sys._getframe(1).f_globals[&quot;__name__&quot;]  &lt;-- grabs where this function is called</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="c1"># but doesn&#39;t work for multiple levels of inheritance. For example, this fails for</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="c1"># the Relaxation subclasses because the create_subclasses method calls</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="c1"># create_subclass -- therefore we&#39;d need _getframe(3) instead of 1...</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="c1"># Now we dynamically create a new class that inherits from this main</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="c1"># one and also adds the new columns to it.</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="n">NewClass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="n">new_columns</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="k">return</span> <span class="n">NewClass</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>    <span class="k">def</span> <span class="nf">from_toolkit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">        Given fundamental &quot;base_info&quot; and toolkit objects, this method will populate</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        all relevant columns.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">        If the table is made up of multiple mix-ins, this method iterates through</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">        each of the `_from_toolkit` methods of those mixins and combines the results.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        Therefore, you must view this method for each mix-ins to determine which</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        kwargs must be passed.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">        #### Parameters</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">        - `as_dict` :</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">            Whether to return the populated data as a dictionary or to initialize</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">            it as a database object. Defaults to False.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">        - `**kwargs` :</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">            All fields required in order to initialize the database entry. For</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">            example, a Structure table would require a toolkit structure, while</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">            a Thermodynamics table would require an energy.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">        Returns</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">        -------</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        a dictionary if as_dict is True; and a database object if as_dict is False</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="c1"># Grab a list of all parent classes</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="n">parents</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="c1"># As we go through the parent classes below, we will identify the mixins</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="c1"># and populate data using those classes. All of this is fed in to our</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="c1"># main class at the end of the function. We keep this running dictionary</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="c1"># as we go.</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="n">all_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="c1"># TODO: How should I best handle passing extra kwargs to the final class</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="c1"># initialization? For example, I would want to pass `energy` but I wouldn&#39;t</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="c1"># want to pass the toolkit structure object. I may update this line in</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="c1"># the future to remove python objects. For now, I only remove structure</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="c1"># and migration_hop because I know that it is a toolkit object -- not</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="c1"># a database column.</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;band_structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;density_of_states&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>            <span class="c1"># Skip the parent class if it doesn&#39;t directly inherit from the</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="c1"># DatabaseTable class. We do this because we want the fundamental</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>            <span class="c1"># mixins that come with Simmate (such as Structure, Forces, Thermodynamics).</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>            <span class="c1"># We also skip the classes that don&#39;t have a _from_toolkit method defined.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>            <span class="c1"># Right now, this is just the Calculation class that&#39;s skipped with this</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="c1"># condition.</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">__base__</span> <span class="o">!=</span> <span class="n">DatabaseTable</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;_from_toolkit&quot;</span><span class="p">):</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>                <span class="k">continue</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>            <span class="c1"># Grab the input arguments for the _from_toolkit method. This will</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>            <span class="c1"># give a list back like... [&#39;cls&#39;, &#39;structure&#39;, &#39;as_dict&#39;]. We</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="c1"># don&#39;t consider as_dict or cls, so we remove those too</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="n">inputs</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;as_dict&quot;</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;cls&quot;</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="c1"># Now inputs is current of list of keys that we need. Next, we go</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>            <span class="c1"># through our kwargs and see if we have any of these keys, and if so,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="c1"># grab them.</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>            <span class="n">matching_inputs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>                <span class="n">key</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="p">}</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>            <span class="c1"># We now pass these inputs to the _from_toolkit. If we&#39;re missing</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="c1"># a required input, this will raise an error here. We only</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="c1"># want the expanded input, so we request a dictionary, not object.</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">matching_inputs</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="c1"># Now add this mixin&#39;s data to our collective dictionary</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>            <span class="n">all_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="c1"># return the dictionary</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="k">return</span> <span class="n">all_data</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>    <span class="k">def</span> <span class="nf">_confirm_override</span><span class="p">(</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>    <span class="p">):</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        A utility to make sure the user wants to load new data into their table</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">        and (if they are using sqlite) that they are aware of the risks of</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">        parallelizing their loading.</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">        This utility should not be called directly, as it is used within</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">        load_archive and load_remote_archive.</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="c1"># first check if the table has data in it already. We raise errors</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="c1"># to stop the user from doing unneccessary and potentiall destructive</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="c1"># downloads</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">confirm_override</span><span class="p">:</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>            <span class="c1"># if the user has a third-party app, we can be more specific with</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>            <span class="c1"># our error message.</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>                    <span class="s2">&quot;It looks like you&#39;re using a third-party database table and &quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>                    <span class="s2">&quot;that the table already has data in it! This means you already &quot;</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>                    <span class="s2">&quot;called load_remote_archive and don&#39;t need to do it again. &quot;</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>                    <span class="s2">&quot;If you are trying reload a newer version of this data, make &quot;</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>                    <span class="s2">&quot;sure you empty this table first. This can be done by &quot;</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>                    <span class="s2">&quot;reseting your database or manually deleting all objects &quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>                    <span class="s2">&quot;with `ExampleTable.objects.all().delete()`&quot;</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>                <span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>            <span class="c1"># otherwise warning the user of overwriting data with matching</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="c1"># primary keys -- and ask them to use confirm_override.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>                <span class="s2">&quot;It looks like this table already has data in it! By loading an &quot;</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>                <span class="s2">&quot;archive, you could potentially overwrite this data. The most &quot;</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>                <span class="s2">&quot;common mistake is non-unique primary keys between your current &quot;</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>                <span class="s2">&quot;data and the archive -- if there is a duplicate primary key, it &quot;</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>                <span class="s2">&quot;will overwrite your data. If you are confident the data is safe &quot;</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>                <span class="s2">&quot;to load into your database, run this command again with &quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>                <span class="s2">&quot;confirm_override=True.&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>            <span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="c1"># Django and Dask can only handle so much for the parallelization</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="c1"># of database writing with SQLite. So if the user has SQLite as their</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="c1"># backend, we need to stop them from using this feature.</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="kn">from</span> <span class="nn">simmate.configuration.django.settings</span> <span class="kn">import</span> <span class="n">DATABASES</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>        <span class="k">if</span> <span class="n">parallel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">confirm_sqlite_parallel</span> <span class="ow">and</span> <span class="s2">&quot;sqlite3&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">DATABASES</span><span class="p">):</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>                <span class="s2">&quot;It looks like you are trying to run things in parallel but are &quot;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>                <span class="s2">&quot;using the default database backend (sqlite3), which is not &quot;</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>                <span class="s2">&quot;always stable for massively parallel methods. You can still &quot;</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>                <span class="s2">&quot;do this, but this message serves as a word of caution. &quot;</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>                <span class="s2">&quot;You If you see error messages pop up saying &#39;database is &quot;</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>                <span class="s2">&quot;locked&#39;, then your database is not stable at the rate you&#39;re &quot;</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>                <span class="s2">&quot;trying to write data. This is a sign that you should either &quot;</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>                <span class="s2">&quot;(1) switch to a different database backend such as Postgres &quot;</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>                <span class="s2">&quot;or (2) reduce the parallelization of your tasks. If you are &quot;</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>                <span class="s2">&quot;comfortable with these warnings and know what you&#39;re doing, &quot;</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>                <span class="s2">&quot;set confirm_sqlite_parallel=True.&quot;</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>            <span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>    <span class="c1"># @transaction.atomic  # We can&#39;t have an atomic transaction if we use Dask</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>    <span class="k">def</span> <span class="nf">load_archive</span><span class="p">(</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>        <span class="n">delete_on_completion</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>    <span class="p">):</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">        Reads a compressed zip file made by `objects.to_archive` and loads the data</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">        back into the Simmate database.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">        Typically, users won&#39;t call this method directly, but instead use the</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">        `load_remote_archive` method, which handles downloading the archive</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">        file from the Simmate website for you.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">        #### Parameters</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">        - `filename`:</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">            The filename to write the zip file to. By defualt, None will try to</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">            find a file named &quot;MyExampleTableName-2022-01-25.zip&quot;, where the date</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">            corresponds to version/timestamp. If multiple files match this format</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">            the most recent date will be used.</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">        - `delete_on_completion`:</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">            Whether to delete the archive file once all data is loaded into the</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="sd">            database. Defaults to False</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a><span class="sd">        - `confirm_override`:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a><span class="sd">            If the table already has data in it, the user must take particular</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a><span class="sd">            care to downloading new data. This flag makes sure the user has</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="sd">            made the proper checks to run this action. Default is False.</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a><span class="sd">        - `parallel`:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">            Whether to load the data in parallel. If true, this will start</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a><span class="sd">            large datasets into the dataset. Default is False.</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a><span class="sd">        - `confirm_sqlite_parallel`:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a><span class="sd">            knows what they are doing and know the risks of parallelization.</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a><span class="sd">            Default is False.</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>        <span class="c1"># make sure the user actually wants to do this!</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>            <span class="n">confirm_override</span><span class="p">,</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>            <span class="n">parallel</span><span class="p">,</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="p">)</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>        <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>        <span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span> <span class="k">as</span> <span class="n">ToolkitStructure</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>        <span class="c1"># generate the file name if one wasn&#39;t given</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>            <span class="c1"># The name will be something like &quot;MyExampleTable-2022-01-25.zip&quot;.</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>            <span class="c1"># We go through all files that match &quot;MyExampleTable-*.zip&quot; and then</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>            <span class="c1"># grab the most recent date.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>            <span class="n">matching_files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>                <span class="n">file</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>            <span class="p">]</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>            <span class="c1"># make sure there is at least one file</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_files</span><span class="p">:</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>                    <span class="sa">f</span><span class="s2">&quot;No file found matching the </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">-*.zip format&quot;</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>                <span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>            <span class="c1"># sort the files by date and grab the first</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>            <span class="n">matching_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">matching_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>        <span class="c1"># Turn the filename into the full path -- which makes a number of</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>        <span class="c1"># manipulations easier below.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>        <span class="c1"># uncompress the zip file to the same directory that it is located in</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>            <span class="n">filename</span><span class="p">,</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>            <span class="n">extract_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>        <span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>        <span class="c1"># We will now have a csv file of the same name, which we load into</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>        <span class="c1"># a pandas dataframe</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>        <span class="c1"># BUG: NaN values throw errors when read into SQL databases, so we</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="c1"># convert all NaN entries to None. This hacky line was taken from</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>        <span class="c1">#   https://stackoverflow.com/questions/39279824/</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>        <span class="c1"># convert the dataframe to a list of dictionaries that we will iterate</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>        <span class="c1"># through.</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>        <span class="c1"># to enable parallelization, we define a function to load a single</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>        <span class="c1"># entry (or row) of data. This allows us to submit the function to Dask.</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>        <span class="k">def</span> <span class="nf">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>            <span class="c1"># For all entries, convert the structure_string to a toolkit structure</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>            <span class="k">if</span> <span class="s2">&quot;structure_string&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>                <span class="n">structure_str</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure_string&quot;</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>                <span class="n">structure</span> <span class="o">=</span> <span class="n">ToolkitStructure</span><span class="o">.</span><span class="n">from_database_string</span><span class="p">(</span><span class="n">structure_str</span><span class="p">)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">structure</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>            <span class="c1"># OPTIMIZE: is there a better way to do decide which entries need to be</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>            <span class="c1"># converted to toolkit objects? This code may be better placed in</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>            <span class="c1"># base_data_type methods (e.g. a `from_base_info` method for each)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>            <span class="n">entry_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>            <span class="n">entry_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>        <span class="c1"># now iterate through all entries to save them to the database</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>            <span class="c1"># If user doesn&#39;t want parallelization, we run these in the main</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>            <span class="c1"># thread and monitor progress with tqdm</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>                <span class="n">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>        <span class="c1"># otherwise we use dask to submit these in batches!</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>            <span class="kn">from</span> <span class="nn">simmate.configuration.dask</span> <span class="kn">import</span> <span class="n">batch_submit</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>            <span class="n">batch_submit</span><span class="p">(</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>                <span class="n">function</span><span class="o">=</span><span class="n">load_single_entry</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>                <span class="n">args_list</span><span class="o">=</span><span class="n">entries</span><span class="p">,</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>            <span class="p">)</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>        <span class="c1"># We can now delete the files. The zip file is only deleted if requested.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>        <span class="k">if</span> <span class="n">delete_on_completion</span><span class="p">:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># the zip archive</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>    <span class="k">def</span> <span class="nf">load_remote_archive</span><span class="p">(</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>        <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>    <span class="p">):</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a><span class="sd">        Downloads a compressed zip file made by `objects.to_archive` and loads</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a><span class="sd">        the data back into the Simmate database.</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a><span class="sd">        This method should only be called once -- when you have a completely</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a><span class="sd">        empty database. After this call, all data will be stored locally and</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a><span class="sd">        you don&#39;t need to call this method again (even accross python sessions).</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a><span class="sd">        #### Parameters</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a><span class="sd">        - `remote_archive_link`:</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a><span class="sd">            The URL for that the archive will be downloaded from. If not supplied,</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a><span class="sd">            it will default to the table&#39;s remote_archive_link attribute.</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a><span class="sd">        - `confirm_override`:</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a><span class="sd">            If the table already has data in it, the user must take particular</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a><span class="sd">            care to downloading new data. This flag makes sure the user has</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a><span class="sd">            made the proper checks to run this action.</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a><span class="sd">        - `parallel`:</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a><span class="sd">            Whether to load the data in parallel. If true, this will start</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a><span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a><span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a><span class="sd">            large datasets into the dataset. Default is False.</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a><span class="sd">        - `confirm_sqlite_parallel`:</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a><span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a><span class="sd">            knows what they are doing and know the risks of parallelization.</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a><span class="sd">            Default is False.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>        <span class="c1"># make sure the user actually wants to do this!</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>            <span class="n">confirm_override</span><span class="p">,</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>            <span class="n">parallel</span><span class="p">,</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>        <span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>        <span class="c1"># confirm that we have a link to download from</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">remote_archive_link</span><span class="p">:</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>            <span class="c1"># if no link was given we take the input value from class attribute</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span><span class="p">:</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>                    <span class="s2">&quot;This table does not have a default link to load the archive &quot;</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>                    <span class="s2">&quot; from. You must provide a remote_archive_link.&quot;</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>                <span class="p">)</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>            <span class="n">remote_archive_link</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>        <span class="c1"># tell the user where the data comes from</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">WARNING: this data is NOT from the Simmate team, so be sure &quot;</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>                <span class="s2">&quot;to visit the provider&#39;s website and to cite their work.&quot;</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>                <span class="sa">f</span><span class="s2">&quot; This data is from </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2"> and the following paper &quot;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>                <span class="sa">f</span><span class="s2">&quot;should be cited: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source_doi</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>            <span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>        <span class="c1"># Predetermine the file name, which is just the ending of the URL</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>        <span class="n">archive_filename</span> <span class="o">=</span> <span class="n">remote_archive_link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>        <span class="c1"># Download the archive zip file from the URL to the current working dir</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading archive file...&quot;</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">remote_archive_link</span><span class="p">,</span> <span class="n">archive_filename</span><span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>        <span class="c1"># now that the archive is downloaded, we can load it into our db</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading data into Simmate database...&quot;</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">load_archive</span><span class="p">(</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>            <span class="n">archive_filename</span><span class="p">,</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>            <span class="n">delete_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>            <span class="n">confirm_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a>            <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>            <span class="n">confirm_sqlite_parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>        <span class="p">)</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>    <span class="k">def</span> <span class="nf">get_column_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a><span class="sd">        Returns a list of all the column names for this table and indicates which</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a><span class="sd">        columns are related to other tables. This is primarily used to help</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a><span class="sd">        view what data is available.</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()]</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>    <span class="k">def</span> <span class="nf">show_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a><span class="sd">        Prints a list of all the column names for this table and indicates which</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a><span class="sd">        columns are related to other tables. This is primarily used to help users</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a><span class="sd">        interactively view what data is available.</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>        <span class="c1"># Iterate through and grab the columns. Note we don&#39;t use get_column_names</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>        <span class="c1"># here because we are attaching relation data as well.</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>            <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (relation to </span><span class="si">{</span><span class="n">column</span><span class="o">.</span><span class="n">related_model</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>            <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">is_relation</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>            <span class="k">else</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a>            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a>        <span class="p">]</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a>        <span class="c1"># Then use yaml to make the printout pretty (no quotes and separate lines)</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>    <span class="k">def</span> <span class="nf">get_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>  <span class="c1"># -&gt; List[DatabaseTable]</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a><span class="sd">        Grabs the mix-in Tables that were used to make this class. This will</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a><span class="sd">        be mix-ins like Structure, Forces, etc. from the</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a><span class="sd">        `simmate.database.base_data_types` module.</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>        <span class="c1"># this must be imported locally because it depends on all other classes</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a>        <span class="c1"># from this module -- and will create circular import issues if outside</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>        <span class="kn">from</span> <span class="nn">simmate.database</span> <span class="kn">import</span> <span class="n">base_data_types</span> <span class="k">as</span> <span class="n">simmate_mixins</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>            <span class="n">parent</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a>            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">simmate_mixins</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>            <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;DatabaseTable&quot;</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>        <span class="p">]</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a>    <span class="k">def</span> <span class="nf">get_mixin_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a><span class="sd">        Grabs the mix-in Tables that were used to make this class and returns</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a><span class="sd">        a list of their names.</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">mixin</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">mixin</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_mixins</span><span class="p">()]</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>    <span class="k">def</span> <span class="nf">get_extra_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a><span class="sd">        Finds all columns that aren&#39;t covered by the supported Table mix-ins.</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a><span class="sd">        For example, a table made from...</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a><span class="sd">        ``` python</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a><span class="sd">        from simmate.database.base_data_types import (</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a><span class="sd">            table_column,</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a><span class="sd">            Structure,</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a><span class="sd">            Forces,</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a><span class="sd">        )</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a><span class="sd">        class ExampleTable(Structure, Forces):</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a><span class="sd">            custom_column1 = table_column.FloatField()</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a><span class="sd">            custom_column2 = table_column.FloatField()</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a><span class="sd">        ```</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a><span class="sd">        ... would return ...</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a><span class="sd">        ``` python</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a><span class="sd">        [&quot;custom_column1&quot;, &quot;custom_column2&quot;]</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a><span class="sd">        ```</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a>        <span class="n">all_columns</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">()</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos">885</span></a>        <span class="n">columns_w_mixin</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos">886</span></a>            <span class="n">column</span> <span class="k">for</span> <span class="n">mixin</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_mixins</span><span class="p">()</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">mixin</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">()</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos">887</span></a>        <span class="p">]</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos">888</span></a>        <span class="n">extra_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos">889</span></a>            <span class="n">column</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos">890</span></a>            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">all_columns</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos">891</span></a>            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns_w_mixin</span> <span class="ow">and</span> <span class="n">column</span> <span class="o">!=</span> <span class="s2">&quot;id&quot;</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos">892</span></a>        <span class="p">]</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos">893</span></a>        <span class="k">return</span> <span class="n">extra_columns</span>
</span></pre></div>

        </details>

            </section>
                <section id="SearchResults">
                                <div class="attr class">
        <a class="headerlink" href="#SearchResults">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">SearchResults</span><wbr>(<span class="base">django.db.models.query.QuerySet</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SearchResults-35"><a href="#SearchResults-35"><span class="linenos"> 35</span></a><span class="k">class</span> <span class="nc">SearchResults</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">QuerySet</span><span class="p">):</span>
</span><span id="SearchResults-36"><a href="#SearchResults-36"><span class="linenos"> 36</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SearchResults-37"><a href="#SearchResults-37"><span class="linenos"> 37</span></a><span class="sd">    This class adds some extra methods to the results returned from a database</span>
</span><span id="SearchResults-38"><a href="#SearchResults-38"><span class="linenos"> 38</span></a><span class="sd">    search. For example, if you searched all Structures and wanted to convert</span>
</span><span id="SearchResults-39"><a href="#SearchResults-39"><span class="linenos"> 39</span></a><span class="sd">    these to a pandas dataframe or even a list of pymatgen structures, you can</span>
</span><span id="SearchResults-40"><a href="#SearchResults-40"><span class="linenos"> 40</span></a><span class="sd">    now do...</span>
</span><span id="SearchResults-41"><a href="#SearchResults-41"><span class="linenos"> 41</span></a>
</span><span id="SearchResults-42"><a href="#SearchResults-42"><span class="linenos"> 42</span></a><span class="sd">    ``` python</span>
</span><span id="SearchResults-43"><a href="#SearchResults-43"><span class="linenos"> 43</span></a><span class="sd">    # for a list of database objects (django models)</span>
</span><span id="SearchResults-44"><a href="#SearchResults-44"><span class="linenos"> 44</span></a><span class="sd">    search_results = Structures.objects.all()</span>
</span><span id="SearchResults-45"><a href="#SearchResults-45"><span class="linenos"> 45</span></a>
</span><span id="SearchResults-46"><a href="#SearchResults-46"><span class="linenos"> 46</span></a><span class="sd">    # for a pandas dataframe (which is like an Excel table)</span>
</span><span id="SearchResults-47"><a href="#SearchResults-47"><span class="linenos"> 47</span></a><span class="sd">    dataframe = search_results.to_dataframe()</span>
</span><span id="SearchResults-48"><a href="#SearchResults-48"><span class="linenos"> 48</span></a>
</span><span id="SearchResults-49"><a href="#SearchResults-49"><span class="linenos"> 49</span></a><span class="sd">    # for a list of pymatgen structure objects</span>
</span><span id="SearchResults-50"><a href="#SearchResults-50"><span class="linenos"> 50</span></a><span class="sd">    structures = search_results.to_toolkit()</span>
</span><span id="SearchResults-51"><a href="#SearchResults-51"><span class="linenos"> 51</span></a><span class="sd">    ```</span>
</span><span id="SearchResults-52"><a href="#SearchResults-52"><span class="linenos"> 52</span></a>
</span><span id="SearchResults-53"><a href="#SearchResults-53"><span class="linenos"> 53</span></a><span class="sd">    All other functionality is inherited from</span>
</span><span id="SearchResults-54"><a href="#SearchResults-54"><span class="linenos"> 54</span></a><span class="sd">    [Django QuerySets](https://docs.djangoproject.com/en/4.0/ref/models/querysets/).</span>
</span><span id="SearchResults-55"><a href="#SearchResults-55"><span class="linenos"> 55</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SearchResults-56"><a href="#SearchResults-56"><span class="linenos"> 56</span></a>
</span><span id="SearchResults-57"><a href="#SearchResults-57"><span class="linenos"> 57</span></a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span>
</span><span id="SearchResults-58"><a href="#SearchResults-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SearchResults-59"><a href="#SearchResults-59"><span class="linenos"> 59</span></a>        <span class="n">fieldnames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="SearchResults-60"><a href="#SearchResults-60"><span class="linenos"> 60</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SearchResults-61"><a href="#SearchResults-61"><span class="linenos"> 61</span></a>        <span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SearchResults-62"><a href="#SearchResults-62"><span class="linenos"> 62</span></a>        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SearchResults-63"><a href="#SearchResults-63"><span class="linenos"> 63</span></a>        <span class="n">datetime_index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SearchResults-64"><a href="#SearchResults-64"><span class="linenos"> 64</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="SearchResults-65"><a href="#SearchResults-65"><span class="linenos"> 65</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SearchResults-66"><a href="#SearchResults-66"><span class="linenos"> 66</span></a><span class="sd">        Returns a Pandas DataFrame of the search results</span>
</span><span id="SearchResults-67"><a href="#SearchResults-67"><span class="linenos"> 67</span></a>
</span><span id="SearchResults-68"><a href="#SearchResults-68"><span class="linenos"> 68</span></a><span class="sd">        This method is coppied from django_pandas&#39;</span>
</span><span id="SearchResults-69"><a href="#SearchResults-69"><span class="linenos"> 69</span></a><span class="sd">        [manager.py](https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py)</span>
</span><span id="SearchResults-70"><a href="#SearchResults-70"><span class="linenos"> 70</span></a>
</span><span id="SearchResults-71"><a href="#SearchResults-71"><span class="linenos"> 71</span></a><span class="sd">        Paramaters</span>
</span><span id="SearchResults-72"><a href="#SearchResults-72"><span class="linenos"> 72</span></a><span class="sd">        -----------</span>
</span><span id="SearchResults-73"><a href="#SearchResults-73"><span class="linenos"> 73</span></a><span class="sd">        - `fieldnames`:</span>
</span><span id="SearchResults-74"><a href="#SearchResults-74"><span class="linenos"> 74</span></a><span class="sd">            The model field names(columns) to utilise in creating the DataFrame.</span>
</span><span id="SearchResults-75"><a href="#SearchResults-75"><span class="linenos"> 75</span></a><span class="sd">            You can span a relationships in the usual Django ORM way by using</span>
</span><span id="SearchResults-76"><a href="#SearchResults-76"><span class="linenos"> 76</span></a><span class="sd">            the foreign key field name separated by double underscores and refer</span>
</span><span id="SearchResults-77"><a href="#SearchResults-77"><span class="linenos"> 77</span></a><span class="sd">            to a field in a related model.</span>
</span><span id="SearchResults-78"><a href="#SearchResults-78"><span class="linenos"> 78</span></a><span class="sd">        - `index`:</span>
</span><span id="SearchResults-79"><a href="#SearchResults-79"><span class="linenos"> 79</span></a><span class="sd">            specify the field to use  for the index. If the index field is not</span>
</span><span id="SearchResults-80"><a href="#SearchResults-80"><span class="linenos"> 80</span></a><span class="sd">            in fieldnames it will be appended. This is mandatory for timeseries.</span>
</span><span id="SearchResults-81"><a href="#SearchResults-81"><span class="linenos"> 81</span></a><span class="sd">        - `verbose`:</span>
</span><span id="SearchResults-82"><a href="#SearchResults-82"><span class="linenos"> 82</span></a><span class="sd">            If  this is `True` then populate the DataFrame with the human</span>
</span><span id="SearchResults-83"><a href="#SearchResults-83"><span class="linenos"> 83</span></a><span class="sd">            readable versions for foreign key fields else use the actual values</span>
</span><span id="SearchResults-84"><a href="#SearchResults-84"><span class="linenos"> 84</span></a><span class="sd">            set in the model</span>
</span><span id="SearchResults-85"><a href="#SearchResults-85"><span class="linenos"> 85</span></a><span class="sd">        - `coerce_float`:</span>
</span><span id="SearchResults-86"><a href="#SearchResults-86"><span class="linenos"> 86</span></a><span class="sd">            Attempt to convert values to non-string, non-numeric objects (like</span>
</span><span id="SearchResults-87"><a href="#SearchResults-87"><span class="linenos"> 87</span></a><span class="sd">            decimal.Decimal) to floating point.</span>
</span><span id="SearchResults-88"><a href="#SearchResults-88"><span class="linenos"> 88</span></a><span class="sd">        - `datetime_index`: bool</span>
</span><span id="SearchResults-89"><a href="#SearchResults-89"><span class="linenos"> 89</span></a><span class="sd">            specify whether index should be converted to a DateTimeIndex.</span>
</span><span id="SearchResults-90"><a href="#SearchResults-90"><span class="linenos"> 90</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SearchResults-91"><a href="#SearchResults-91"><span class="linenos"> 91</span></a>
</span><span id="SearchResults-92"><a href="#SearchResults-92"><span class="linenos"> 92</span></a>        <span class="c1"># BUG: read_frame runs a NEW query, so it may be a different length from</span>
</span><span id="SearchResults-93"><a href="#SearchResults-93"><span class="linenos"> 93</span></a>        <span class="c1"># the original queryset.</span>
</span><span id="SearchResults-94"><a href="#SearchResults-94"><span class="linenos"> 94</span></a>        <span class="c1"># See https://github.com/chrisdev/django-pandas/issues/138 for issue</span>
</span><span id="SearchResults-95"><a href="#SearchResults-95"><span class="linenos"> 95</span></a>        <span class="k">return</span> <span class="n">read_frame</span><span class="p">(</span>
</span><span id="SearchResults-96"><a href="#SearchResults-96"><span class="linenos"> 96</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SearchResults-97"><a href="#SearchResults-97"><span class="linenos"> 97</span></a>            <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">,</span>
</span><span id="SearchResults-98"><a href="#SearchResults-98"><span class="linenos"> 98</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="SearchResults-99"><a href="#SearchResults-99"><span class="linenos"> 99</span></a>            <span class="n">index_col</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
</span><span id="SearchResults-100"><a href="#SearchResults-100"><span class="linenos">100</span></a>            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
</span><span id="SearchResults-101"><a href="#SearchResults-101"><span class="linenos">101</span></a>            <span class="n">datetime_index</span><span class="o">=</span><span class="n">datetime_index</span><span class="p">,</span>
</span><span id="SearchResults-102"><a href="#SearchResults-102"><span class="linenos">102</span></a>        <span class="p">)</span>
</span><span id="SearchResults-103"><a href="#SearchResults-103"><span class="linenos">103</span></a>
</span><span id="SearchResults-104"><a href="#SearchResults-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">to_toolkit</span><span class="p">(</span>
</span><span id="SearchResults-105"><a href="#SearchResults-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SearchResults-106"><a href="#SearchResults-106"><span class="linenos">106</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>  <span class="c1"># type of object varies (e.g. Structure, BandStructure, etc.)</span>
</span><span id="SearchResults-107"><a href="#SearchResults-107"><span class="linenos">107</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SearchResults-108"><a href="#SearchResults-108"><span class="linenos">108</span></a><span class="sd">        Converts your SearchResults to a list of pymatgen objects</span>
</span><span id="SearchResults-109"><a href="#SearchResults-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SearchResults-110"><a href="#SearchResults-110"><span class="linenos">110</span></a>
</span><span id="SearchResults-111"><a href="#SearchResults-111"><span class="linenos">111</span></a>        <span class="c1"># This method will only be for structures and other classes that</span>
</span><span id="SearchResults-112"><a href="#SearchResults-112"><span class="linenos">112</span></a>        <span class="c1"># support this method. So we make sure the model has supports it first.</span>
</span><span id="SearchResults-113"><a href="#SearchResults-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;to_toolkit&quot;</span><span class="p">):</span>
</span><span id="SearchResults-114"><a href="#SearchResults-114"><span class="linenos">114</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="SearchResults-115"><a href="#SearchResults-115"><span class="linenos">115</span></a>                <span class="s2">&quot;This database table does not have a to_toolkit method implemented&quot;</span>
</span><span id="SearchResults-116"><a href="#SearchResults-116"><span class="linenos">116</span></a>            <span class="p">)</span>
</span><span id="SearchResults-117"><a href="#SearchResults-117"><span class="linenos">117</span></a>
</span><span id="SearchResults-118"><a href="#SearchResults-118"><span class="linenos">118</span></a>        <span class="c1"># now we can iterate through the queryset and return the converted</span>
</span><span id="SearchResults-119"><a href="#SearchResults-119"><span class="linenos">119</span></a>        <span class="c1"># pymatgen objects as a list</span>
</span><span id="SearchResults-120"><a href="#SearchResults-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
</span><span id="SearchResults-121"><a href="#SearchResults-121"><span class="linenos">121</span></a>
</span><span id="SearchResults-122"><a href="#SearchResults-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">to_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="SearchResults-123"><a href="#SearchResults-123"><span class="linenos">123</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SearchResults-124"><a href="#SearchResults-124"><span class="linenos">124</span></a><span class="sd">        Writes a compressed zip file using the table&#39;s base_info attribute.</span>
</span><span id="SearchResults-125"><a href="#SearchResults-125"><span class="linenos">125</span></a><span class="sd">        Underneath, the file is written in a csv format.</span>
</span><span id="SearchResults-126"><a href="#SearchResults-126"><span class="linenos">126</span></a>
</span><span id="SearchResults-127"><a href="#SearchResults-127"><span class="linenos">127</span></a><span class="sd">        This is useful for small making archive files and reloading fixtures</span>
</span><span id="SearchResults-128"><a href="#SearchResults-128"><span class="linenos">128</span></a><span class="sd">        to a separate database.</span>
</span><span id="SearchResults-129"><a href="#SearchResults-129"><span class="linenos">129</span></a>
</span><span id="SearchResults-130"><a href="#SearchResults-130"><span class="linenos">130</span></a><span class="sd">        This method is attached to the table manager for scenarios to allow</span>
</span><span id="SearchResults-131"><a href="#SearchResults-131"><span class="linenos">131</span></a><span class="sd">        queryset filtering before dumping data.</span>
</span><span id="SearchResults-132"><a href="#SearchResults-132"><span class="linenos">132</span></a>
</span><span id="SearchResults-133"><a href="#SearchResults-133"><span class="linenos">133</span></a><span class="sd">        To load this database dump into a new database, use the class&#39;s</span>
</span><span id="SearchResults-134"><a href="#SearchResults-134"><span class="linenos">134</span></a><span class="sd">        `from_archive` method.</span>
</span><span id="SearchResults-135"><a href="#SearchResults-135"><span class="linenos">135</span></a>
</span><span id="SearchResults-136"><a href="#SearchResults-136"><span class="linenos">136</span></a><span class="sd">        #### Parameters</span>
</span><span id="SearchResults-137"><a href="#SearchResults-137"><span class="linenos">137</span></a>
</span><span id="SearchResults-138"><a href="#SearchResults-138"><span class="linenos">138</span></a><span class="sd">        - `filename`:</span>
</span><span id="SearchResults-139"><a href="#SearchResults-139"><span class="linenos">139</span></a><span class="sd">            The filename to write the zip file to. By defualt, None will make</span>
</span><span id="SearchResults-140"><a href="#SearchResults-140"><span class="linenos">140</span></a><span class="sd">            a filename named MyExampleTableName-2022-01-25.zip, where the date</span>
</span><span id="SearchResults-141"><a href="#SearchResults-141"><span class="linenos">141</span></a><span class="sd">            will be the current day (for versioning).</span>
</span><span id="SearchResults-142"><a href="#SearchResults-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SearchResults-143"><a href="#SearchResults-143"><span class="linenos">143</span></a>
</span><span id="SearchResults-144"><a href="#SearchResults-144"><span class="linenos">144</span></a>        <span class="c1"># Generate the file name if one wasn&#39;t given.</span>
</span><span id="SearchResults-145"><a href="#SearchResults-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SearchResults-146"><a href="#SearchResults-146"><span class="linenos">146</span></a>            <span class="c1"># This is automatically the name of the table plus the date, where</span>
</span><span id="SearchResults-147"><a href="#SearchResults-147"><span class="linenos">147</span></a>            <span class="c1"># the date is for versioning. For example...</span>
</span><span id="SearchResults-148"><a href="#SearchResults-148"><span class="linenos">148</span></a>            <span class="c1">#   MyExampleTable-2022-01-25</span>
</span><span id="SearchResults-149"><a href="#SearchResults-149"><span class="linenos">149</span></a>            <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</span><span id="SearchResults-150"><a href="#SearchResults-150"><span class="linenos">150</span></a>            <span class="n">filename_base</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SearchResults-151"><a href="#SearchResults-151"><span class="linenos">151</span></a>                <span class="p">[</span>
</span><span id="SearchResults-152"><a href="#SearchResults-152"><span class="linenos">152</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="SearchResults-153"><a href="#SearchResults-153"><span class="linenos">153</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
</span><span id="SearchResults-154"><a href="#SearchResults-154"><span class="linenos">154</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span id="SearchResults-155"><a href="#SearchResults-155"><span class="linenos">155</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span id="SearchResults-156"><a href="#SearchResults-156"><span class="linenos">156</span></a>                <span class="p">]</span>
</span><span id="SearchResults-157"><a href="#SearchResults-157"><span class="linenos">157</span></a>            <span class="p">)</span>
</span><span id="SearchResults-158"><a href="#SearchResults-158"><span class="linenos">158</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>
</span><span id="SearchResults-159"><a href="#SearchResults-159"><span class="linenos">159</span></a>
</span><span id="SearchResults-160"><a href="#SearchResults-160"><span class="linenos">160</span></a>        <span class="c1"># Turn the filename into the full path. We do this because we only</span>
</span><span id="SearchResults-161"><a href="#SearchResults-161"><span class="linenos">161</span></a>        <span class="c1"># want to</span>
</span><span id="SearchResults-162"><a href="#SearchResults-162"><span class="linenos">162</span></a>        <span class="c1"># filename = os.path.abspath(filename)</span>
</span><span id="SearchResults-163"><a href="#SearchResults-163"><span class="linenos">163</span></a>        <span class="c1"># os.path.dirname(filename)</span>
</span><span id="SearchResults-164"><a href="#SearchResults-164"><span class="linenos">164</span></a>
</span><span id="SearchResults-165"><a href="#SearchResults-165"><span class="linenos">165</span></a>        <span class="c1"># grab the base_information, and if ID is not present, add it</span>
</span><span id="SearchResults-166"><a href="#SearchResults-166"><span class="linenos">166</span></a>        <span class="n">base_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">base_info</span>
</span><span id="SearchResults-167"><a href="#SearchResults-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_info</span><span class="p">:</span>
</span><span id="SearchResults-168"><a href="#SearchResults-168"><span class="linenos">168</span></a>            <span class="n">base_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="SearchResults-169"><a href="#SearchResults-169"><span class="linenos">169</span></a>
</span><span id="SearchResults-170"><a href="#SearchResults-170"><span class="linenos">170</span></a>        <span class="c1"># We want to load the entire table, but only grab the fields that</span>
</span><span id="SearchResults-171"><a href="#SearchResults-171"><span class="linenos">171</span></a>        <span class="c1"># are in base_info.</span>
</span><span id="SearchResults-172"><a href="#SearchResults-172"><span class="linenos">172</span></a>        <span class="n">base_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="o">*</span><span class="n">base_info</span><span class="p">)</span>
</span><span id="SearchResults-173"><a href="#SearchResults-173"><span class="linenos">173</span></a>
</span><span id="SearchResults-174"><a href="#SearchResults-174"><span class="linenos">174</span></a>        <span class="c1"># now convert these objects to a pandas dataframe, again using just</span>
</span><span id="SearchResults-175"><a href="#SearchResults-175"><span class="linenos">175</span></a>        <span class="c1"># the base_info columns</span>
</span><span id="SearchResults-176"><a href="#SearchResults-176"><span class="linenos">176</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">base_objs</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">fieldnames</span><span class="o">=</span><span class="n">base_info</span><span class="p">)</span>
</span><span id="SearchResults-177"><a href="#SearchResults-177"><span class="linenos">177</span></a>
</span><span id="SearchResults-178"><a href="#SearchResults-178"><span class="linenos">178</span></a>        <span class="c1"># Write the data to a csv file</span>
</span><span id="SearchResults-179"><a href="#SearchResults-179"><span class="linenos">179</span></a>        <span class="c1"># OPTIMIZE: is there a better format that pandas can write to?</span>
</span><span id="SearchResults-180"><a href="#SearchResults-180"><span class="linenos">180</span></a>        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</span><span id="SearchResults-181"><a href="#SearchResults-181"><span class="linenos">181</span></a>        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SearchResults-182"><a href="#SearchResults-182"><span class="linenos">182</span></a>
</span><span id="SearchResults-183"><a href="#SearchResults-183"><span class="linenos">183</span></a>        <span class="c1"># now convert the dump file to a compressed zip. In the complex, os</span>
</span><span id="SearchResults-184"><a href="#SearchResults-184"><span class="linenos">184</span></a>        <span class="c1"># functions below we are just grabbing the filename without the</span>
</span><span id="SearchResults-185"><a href="#SearchResults-185"><span class="linenos">185</span></a>        <span class="c1"># zip ending. We are also grabbing the directory that the csv is</span>
</span><span id="SearchResults-186"><a href="#SearchResults-186"><span class="linenos">186</span></a>        <span class="c1"># located in</span>
</span><span id="SearchResults-187"><a href="#SearchResults-187"><span class="linenos">187</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>
</span><span id="SearchResults-188"><a href="#SearchResults-188"><span class="linenos">188</span></a>            <span class="n">base_name</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">),</span>
</span><span id="SearchResults-189"><a href="#SearchResults-189"><span class="linenos">189</span></a>            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span>
</span><span id="SearchResults-190"><a href="#SearchResults-190"><span class="linenos">190</span></a>            <span class="n">root_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)),</span>
</span><span id="SearchResults-191"><a href="#SearchResults-191"><span class="linenos">191</span></a>            <span class="n">base_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">),</span>
</span><span id="SearchResults-192"><a href="#SearchResults-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="SearchResults-193"><a href="#SearchResults-193"><span class="linenos">193</span></a>
</span><span id="SearchResults-194"><a href="#SearchResults-194"><span class="linenos">194</span></a>        <span class="c1"># we can now delete the csv file</span>
</span><span id="SearchResults-195"><a href="#SearchResults-195"><span class="linenos">195</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</span><span id="SearchResults-196"><a href="#SearchResults-196"><span class="linenos">196</span></a>
</span><span id="SearchResults-197"><a href="#SearchResults-197"><span class="linenos">197</span></a>    <span class="c1"># EXPERIMENTAL</span>
</span><span id="SearchResults-198"><a href="#SearchResults-198"><span class="linenos">198</span></a>    <span class="c1"># from prefect import Client</span>
</span><span id="SearchResults-199"><a href="#SearchResults-199"><span class="linenos">199</span></a>    <span class="c1"># from prefect.utilities.graphql import with_args</span>
</span><span id="SearchResults-200"><a href="#SearchResults-200"><span class="linenos">200</span></a>    <span class="c1"># def get_prefect_fields(self, fields):</span>
</span><span id="SearchResults-201"><a href="#SearchResults-201"><span class="linenos">201</span></a>    <span class="c1">#     # This is only every used for Calculations! I have it here instead of making</span>
</span><span id="SearchResults-202"><a href="#SearchResults-202"><span class="linenos">202</span></a>    <span class="c1">#     # whole new Manager subclass for simplicity.</span>
</span><span id="SearchResults-203"><a href="#SearchResults-203"><span class="linenos">203</span></a>    <span class="c1">#     # Make sure we have a calculation by seeing if it has prefect_flow_run_id</span>
</span><span id="SearchResults-204"><a href="#SearchResults-204"><span class="linenos">204</span></a>    <span class="c1">#     # field attached to the model</span>
</span><span id="SearchResults-205"><a href="#SearchResults-205"><span class="linenos">205</span></a>    <span class="c1">#     if not hasattr(self.model, &quot;prefect_flow_run_id&quot;):</span>
</span><span id="SearchResults-206"><a href="#SearchResults-206"><span class="linenos">206</span></a>    <span class="c1">#         raise Exception(&quot;get_prefect_fields() should only be used on Calculations!&quot;)</span>
</span><span id="SearchResults-207"><a href="#SearchResults-207"><span class="linenos">207</span></a>    <span class="c1">#     # grab all the ids in the queryset</span>
</span><span id="SearchResults-208"><a href="#SearchResults-208"><span class="linenos">208</span></a>    <span class="c1">#     ids = list(self.values_list(&quot;prefect_flow_run_id&quot;, flat=True).all())</span>
</span><span id="SearchResults-209"><a href="#SearchResults-209"><span class="linenos">209</span></a>    <span class="c1">#     # now for all of the ids in this queryset, grab the corresponding info</span>
</span><span id="SearchResults-210"><a href="#SearchResults-210"><span class="linenos">210</span></a>    <span class="c1">#     query = {</span>
</span><span id="SearchResults-211"><a href="#SearchResults-211"><span class="linenos">211</span></a>    <span class="c1">#         &quot;query&quot;: {</span>
</span><span id="SearchResults-212"><a href="#SearchResults-212"><span class="linenos">212</span></a>    <span class="c1">#             with_args(</span>
</span><span id="SearchResults-213"><a href="#SearchResults-213"><span class="linenos">213</span></a>    <span class="c1">#                 &quot;flow_run&quot;,</span>
</span><span id="SearchResults-214"><a href="#SearchResults-214"><span class="linenos">214</span></a>    <span class="c1">#                 {</span>
</span><span id="SearchResults-215"><a href="#SearchResults-215"><span class="linenos">215</span></a>    <span class="c1">#                     &quot;where&quot;: {</span>
</span><span id="SearchResults-216"><a href="#SearchResults-216"><span class="linenos">216</span></a>    <span class="c1">#                         &quot;id&quot;: {&quot;_in&quot;: ids},</span>
</span><span id="SearchResults-217"><a href="#SearchResults-217"><span class="linenos">217</span></a>    <span class="c1">#                     },</span>
</span><span id="SearchResults-218"><a href="#SearchResults-218"><span class="linenos">218</span></a>    <span class="c1">#                 },</span>
</span><span id="SearchResults-219"><a href="#SearchResults-219"><span class="linenos">219</span></a>    <span class="c1">#             ): fields,</span>
</span><span id="SearchResults-220"><a href="#SearchResults-220"><span class="linenos">220</span></a>    <span class="c1">#         }</span>
</span><span id="SearchResults-221"><a href="#SearchResults-221"><span class="linenos">221</span></a>    <span class="c1">#     }</span>
</span><span id="SearchResults-222"><a href="#SearchResults-222"><span class="linenos">222</span></a>    <span class="c1">#     client = Client()</span>
</span><span id="SearchResults-223"><a href="#SearchResults-223"><span class="linenos">223</span></a>    <span class="c1">#     result = client.graphql(query)</span>
</span><span id="SearchResults-224"><a href="#SearchResults-224"><span class="linenos">224</span></a>    <span class="c1">#     return result</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>This class adds some extra methods to the results returned from a database
search. For example, if you searched all Structures and wanted to convert
these to a pandas dataframe or even a list of pymatgen structures, you can
now do...</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># for a list of database objects (django models)</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">Structures</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="c1"># for a pandas dataframe (which is like an Excel table)</span>
<span class="n">dataframe</span> <span class="o">=</span> <span class="n">search_results</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>

<span class="c1"># for a list of pymatgen structure objects</span>
<span class="n">structures</span> <span class="o">=</span> <span class="n">search_results</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span>
</code></pre></div>

<p>All other functionality is inherited from
<a href="https://docs.djangoproject.com/en/4.0/ref/models/querysets/">Django QuerySets</a>.</p>
</div>


                            <div id="SearchResults.to_dataframe" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SearchResults.to_dataframe">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_dataframe</span><span class="signature">(
    self,
    fieldnames: List[str] = (),
    verbose: bool = True,
    index: str = None,
    coerce_float: str = False,
    datetime_index: str = False
) -&gt; pandas.core.frame.DataFrame</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SearchResults.to_dataframe-57"><a href="#SearchResults.to_dataframe-57"><span class="linenos"> 57</span></a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span>
</span><span id="SearchResults.to_dataframe-58"><a href="#SearchResults.to_dataframe-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-59"><a href="#SearchResults.to_dataframe-59"><span class="linenos"> 59</span></a>        <span class="n">fieldnames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="SearchResults.to_dataframe-60"><a href="#SearchResults.to_dataframe-60"><span class="linenos"> 60</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-61"><a href="#SearchResults.to_dataframe-61"><span class="linenos"> 61</span></a>        <span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-62"><a href="#SearchResults.to_dataframe-62"><span class="linenos"> 62</span></a>        <span class="n">coerce_float</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-63"><a href="#SearchResults.to_dataframe-63"><span class="linenos"> 63</span></a>        <span class="n">datetime_index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-64"><a href="#SearchResults.to_dataframe-64"><span class="linenos"> 64</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="SearchResults.to_dataframe-65"><a href="#SearchResults.to_dataframe-65"><span class="linenos"> 65</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SearchResults.to_dataframe-66"><a href="#SearchResults.to_dataframe-66"><span class="linenos"> 66</span></a><span class="sd">        Returns a Pandas DataFrame of the search results</span>
</span><span id="SearchResults.to_dataframe-67"><a href="#SearchResults.to_dataframe-67"><span class="linenos"> 67</span></a>
</span><span id="SearchResults.to_dataframe-68"><a href="#SearchResults.to_dataframe-68"><span class="linenos"> 68</span></a><span class="sd">        This method is coppied from django_pandas&#39;</span>
</span><span id="SearchResults.to_dataframe-69"><a href="#SearchResults.to_dataframe-69"><span class="linenos"> 69</span></a><span class="sd">        [manager.py](https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py)</span>
</span><span id="SearchResults.to_dataframe-70"><a href="#SearchResults.to_dataframe-70"><span class="linenos"> 70</span></a>
</span><span id="SearchResults.to_dataframe-71"><a href="#SearchResults.to_dataframe-71"><span class="linenos"> 71</span></a><span class="sd">        Paramaters</span>
</span><span id="SearchResults.to_dataframe-72"><a href="#SearchResults.to_dataframe-72"><span class="linenos"> 72</span></a><span class="sd">        -----------</span>
</span><span id="SearchResults.to_dataframe-73"><a href="#SearchResults.to_dataframe-73"><span class="linenos"> 73</span></a><span class="sd">        - `fieldnames`:</span>
</span><span id="SearchResults.to_dataframe-74"><a href="#SearchResults.to_dataframe-74"><span class="linenos"> 74</span></a><span class="sd">            The model field names(columns) to utilise in creating the DataFrame.</span>
</span><span id="SearchResults.to_dataframe-75"><a href="#SearchResults.to_dataframe-75"><span class="linenos"> 75</span></a><span class="sd">            You can span a relationships in the usual Django ORM way by using</span>
</span><span id="SearchResults.to_dataframe-76"><a href="#SearchResults.to_dataframe-76"><span class="linenos"> 76</span></a><span class="sd">            the foreign key field name separated by double underscores and refer</span>
</span><span id="SearchResults.to_dataframe-77"><a href="#SearchResults.to_dataframe-77"><span class="linenos"> 77</span></a><span class="sd">            to a field in a related model.</span>
</span><span id="SearchResults.to_dataframe-78"><a href="#SearchResults.to_dataframe-78"><span class="linenos"> 78</span></a><span class="sd">        - `index`:</span>
</span><span id="SearchResults.to_dataframe-79"><a href="#SearchResults.to_dataframe-79"><span class="linenos"> 79</span></a><span class="sd">            specify the field to use  for the index. If the index field is not</span>
</span><span id="SearchResults.to_dataframe-80"><a href="#SearchResults.to_dataframe-80"><span class="linenos"> 80</span></a><span class="sd">            in fieldnames it will be appended. This is mandatory for timeseries.</span>
</span><span id="SearchResults.to_dataframe-81"><a href="#SearchResults.to_dataframe-81"><span class="linenos"> 81</span></a><span class="sd">        - `verbose`:</span>
</span><span id="SearchResults.to_dataframe-82"><a href="#SearchResults.to_dataframe-82"><span class="linenos"> 82</span></a><span class="sd">            If  this is `True` then populate the DataFrame with the human</span>
</span><span id="SearchResults.to_dataframe-83"><a href="#SearchResults.to_dataframe-83"><span class="linenos"> 83</span></a><span class="sd">            readable versions for foreign key fields else use the actual values</span>
</span><span id="SearchResults.to_dataframe-84"><a href="#SearchResults.to_dataframe-84"><span class="linenos"> 84</span></a><span class="sd">            set in the model</span>
</span><span id="SearchResults.to_dataframe-85"><a href="#SearchResults.to_dataframe-85"><span class="linenos"> 85</span></a><span class="sd">        - `coerce_float`:</span>
</span><span id="SearchResults.to_dataframe-86"><a href="#SearchResults.to_dataframe-86"><span class="linenos"> 86</span></a><span class="sd">            Attempt to convert values to non-string, non-numeric objects (like</span>
</span><span id="SearchResults.to_dataframe-87"><a href="#SearchResults.to_dataframe-87"><span class="linenos"> 87</span></a><span class="sd">            decimal.Decimal) to floating point.</span>
</span><span id="SearchResults.to_dataframe-88"><a href="#SearchResults.to_dataframe-88"><span class="linenos"> 88</span></a><span class="sd">        - `datetime_index`: bool</span>
</span><span id="SearchResults.to_dataframe-89"><a href="#SearchResults.to_dataframe-89"><span class="linenos"> 89</span></a><span class="sd">            specify whether index should be converted to a DateTimeIndex.</span>
</span><span id="SearchResults.to_dataframe-90"><a href="#SearchResults.to_dataframe-90"><span class="linenos"> 90</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SearchResults.to_dataframe-91"><a href="#SearchResults.to_dataframe-91"><span class="linenos"> 91</span></a>
</span><span id="SearchResults.to_dataframe-92"><a href="#SearchResults.to_dataframe-92"><span class="linenos"> 92</span></a>        <span class="c1"># BUG: read_frame runs a NEW query, so it may be a different length from</span>
</span><span id="SearchResults.to_dataframe-93"><a href="#SearchResults.to_dataframe-93"><span class="linenos"> 93</span></a>        <span class="c1"># the original queryset.</span>
</span><span id="SearchResults.to_dataframe-94"><a href="#SearchResults.to_dataframe-94"><span class="linenos"> 94</span></a>        <span class="c1"># See https://github.com/chrisdev/django-pandas/issues/138 for issue</span>
</span><span id="SearchResults.to_dataframe-95"><a href="#SearchResults.to_dataframe-95"><span class="linenos"> 95</span></a>        <span class="k">return</span> <span class="n">read_frame</span><span class="p">(</span>
</span><span id="SearchResults.to_dataframe-96"><a href="#SearchResults.to_dataframe-96"><span class="linenos"> 96</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-97"><a href="#SearchResults.to_dataframe-97"><span class="linenos"> 97</span></a>            <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-98"><a href="#SearchResults.to_dataframe-98"><span class="linenos"> 98</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-99"><a href="#SearchResults.to_dataframe-99"><span class="linenos"> 99</span></a>            <span class="n">index_col</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-100"><a href="#SearchResults.to_dataframe-100"><span class="linenos">100</span></a>            <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-101"><a href="#SearchResults.to_dataframe-101"><span class="linenos">101</span></a>            <span class="n">datetime_index</span><span class="o">=</span><span class="n">datetime_index</span><span class="p">,</span>
</span><span id="SearchResults.to_dataframe-102"><a href="#SearchResults.to_dataframe-102"><span class="linenos">102</span></a>        <span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Returns a Pandas DataFrame of the search results</p>

<p>This method is coppied from django_pandas'
<a href="https://github.com/chrisdev/django-pandas/blob/master/django_pandas/managers.py">manager.py</a></p>

<h2 id="paramaters">Paramaters</h2>

<ul>
<li><code>fieldnames</code>:
The model field names(columns) to utilise in creating the DataFrame.
You can span a relationships in the usual Django ORM way by using
the foreign key field name separated by double underscores and refer
to a field in a related model.</li>
<li><code>index</code>:
specify the field to use  for the index. If the index field is not
in fieldnames it will be appended. This is mandatory for timeseries.</li>
<li><code>verbose</code>:
If  this is <code>True</code> then populate the DataFrame with the human
readable versions for foreign key fields else use the actual values
set in the model</li>
<li><code>coerce_float</code>:
Attempt to convert values to non-string, non-numeric objects (like
decimal.Decimal) to floating point.</li>
<li><code>datetime_index</code>: bool
specify whether index should be converted to a DateTimeIndex.</li>
</ul>
</div>


                            </div>
                            <div id="SearchResults.to_toolkit" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SearchResults.to_toolkit">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_toolkit</span><span class="signature">(self) -&gt; list</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SearchResults.to_toolkit-104"><a href="#SearchResults.to_toolkit-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">to_toolkit</span><span class="p">(</span>
</span><span id="SearchResults.to_toolkit-105"><a href="#SearchResults.to_toolkit-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SearchResults.to_toolkit-106"><a href="#SearchResults.to_toolkit-106"><span class="linenos">106</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>  <span class="c1"># type of object varies (e.g. Structure, BandStructure, etc.)</span>
</span><span id="SearchResults.to_toolkit-107"><a href="#SearchResults.to_toolkit-107"><span class="linenos">107</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SearchResults.to_toolkit-108"><a href="#SearchResults.to_toolkit-108"><span class="linenos">108</span></a><span class="sd">        Converts your SearchResults to a list of pymatgen objects</span>
</span><span id="SearchResults.to_toolkit-109"><a href="#SearchResults.to_toolkit-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SearchResults.to_toolkit-110"><a href="#SearchResults.to_toolkit-110"><span class="linenos">110</span></a>
</span><span id="SearchResults.to_toolkit-111"><a href="#SearchResults.to_toolkit-111"><span class="linenos">111</span></a>        <span class="c1"># This method will only be for structures and other classes that</span>
</span><span id="SearchResults.to_toolkit-112"><a href="#SearchResults.to_toolkit-112"><span class="linenos">112</span></a>        <span class="c1"># support this method. So we make sure the model has supports it first.</span>
</span><span id="SearchResults.to_toolkit-113"><a href="#SearchResults.to_toolkit-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;to_toolkit&quot;</span><span class="p">):</span>
</span><span id="SearchResults.to_toolkit-114"><a href="#SearchResults.to_toolkit-114"><span class="linenos">114</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="SearchResults.to_toolkit-115"><a href="#SearchResults.to_toolkit-115"><span class="linenos">115</span></a>                <span class="s2">&quot;This database table does not have a to_toolkit method implemented&quot;</span>
</span><span id="SearchResults.to_toolkit-116"><a href="#SearchResults.to_toolkit-116"><span class="linenos">116</span></a>            <span class="p">)</span>
</span><span id="SearchResults.to_toolkit-117"><a href="#SearchResults.to_toolkit-117"><span class="linenos">117</span></a>
</span><span id="SearchResults.to_toolkit-118"><a href="#SearchResults.to_toolkit-118"><span class="linenos">118</span></a>        <span class="c1"># now we can iterate through the queryset and return the converted</span>
</span><span id="SearchResults.to_toolkit-119"><a href="#SearchResults.to_toolkit-119"><span class="linenos">119</span></a>        <span class="c1"># pymatgen objects as a list</span>
</span><span id="SearchResults.to_toolkit-120"><a href="#SearchResults.to_toolkit-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Converts your SearchResults to a list of pymatgen objects</p>
</div>


                            </div>
                            <div id="SearchResults.to_archive" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SearchResults.to_archive">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_archive</span><span class="signature">(self, filename: str = None)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SearchResults.to_archive-122"><a href="#SearchResults.to_archive-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">to_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="SearchResults.to_archive-123"><a href="#SearchResults.to_archive-123"><span class="linenos">123</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SearchResults.to_archive-124"><a href="#SearchResults.to_archive-124"><span class="linenos">124</span></a><span class="sd">        Writes a compressed zip file using the table&#39;s base_info attribute.</span>
</span><span id="SearchResults.to_archive-125"><a href="#SearchResults.to_archive-125"><span class="linenos">125</span></a><span class="sd">        Underneath, the file is written in a csv format.</span>
</span><span id="SearchResults.to_archive-126"><a href="#SearchResults.to_archive-126"><span class="linenos">126</span></a>
</span><span id="SearchResults.to_archive-127"><a href="#SearchResults.to_archive-127"><span class="linenos">127</span></a><span class="sd">        This is useful for small making archive files and reloading fixtures</span>
</span><span id="SearchResults.to_archive-128"><a href="#SearchResults.to_archive-128"><span class="linenos">128</span></a><span class="sd">        to a separate database.</span>
</span><span id="SearchResults.to_archive-129"><a href="#SearchResults.to_archive-129"><span class="linenos">129</span></a>
</span><span id="SearchResults.to_archive-130"><a href="#SearchResults.to_archive-130"><span class="linenos">130</span></a><span class="sd">        This method is attached to the table manager for scenarios to allow</span>
</span><span id="SearchResults.to_archive-131"><a href="#SearchResults.to_archive-131"><span class="linenos">131</span></a><span class="sd">        queryset filtering before dumping data.</span>
</span><span id="SearchResults.to_archive-132"><a href="#SearchResults.to_archive-132"><span class="linenos">132</span></a>
</span><span id="SearchResults.to_archive-133"><a href="#SearchResults.to_archive-133"><span class="linenos">133</span></a><span class="sd">        To load this database dump into a new database, use the class&#39;s</span>
</span><span id="SearchResults.to_archive-134"><a href="#SearchResults.to_archive-134"><span class="linenos">134</span></a><span class="sd">        `from_archive` method.</span>
</span><span id="SearchResults.to_archive-135"><a href="#SearchResults.to_archive-135"><span class="linenos">135</span></a>
</span><span id="SearchResults.to_archive-136"><a href="#SearchResults.to_archive-136"><span class="linenos">136</span></a><span class="sd">        #### Parameters</span>
</span><span id="SearchResults.to_archive-137"><a href="#SearchResults.to_archive-137"><span class="linenos">137</span></a>
</span><span id="SearchResults.to_archive-138"><a href="#SearchResults.to_archive-138"><span class="linenos">138</span></a><span class="sd">        - `filename`:</span>
</span><span id="SearchResults.to_archive-139"><a href="#SearchResults.to_archive-139"><span class="linenos">139</span></a><span class="sd">            The filename to write the zip file to. By defualt, None will make</span>
</span><span id="SearchResults.to_archive-140"><a href="#SearchResults.to_archive-140"><span class="linenos">140</span></a><span class="sd">            a filename named MyExampleTableName-2022-01-25.zip, where the date</span>
</span><span id="SearchResults.to_archive-141"><a href="#SearchResults.to_archive-141"><span class="linenos">141</span></a><span class="sd">            will be the current day (for versioning).</span>
</span><span id="SearchResults.to_archive-142"><a href="#SearchResults.to_archive-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SearchResults.to_archive-143"><a href="#SearchResults.to_archive-143"><span class="linenos">143</span></a>
</span><span id="SearchResults.to_archive-144"><a href="#SearchResults.to_archive-144"><span class="linenos">144</span></a>        <span class="c1"># Generate the file name if one wasn&#39;t given.</span>
</span><span id="SearchResults.to_archive-145"><a href="#SearchResults.to_archive-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SearchResults.to_archive-146"><a href="#SearchResults.to_archive-146"><span class="linenos">146</span></a>            <span class="c1"># This is automatically the name of the table plus the date, where</span>
</span><span id="SearchResults.to_archive-147"><a href="#SearchResults.to_archive-147"><span class="linenos">147</span></a>            <span class="c1"># the date is for versioning. For example...</span>
</span><span id="SearchResults.to_archive-148"><a href="#SearchResults.to_archive-148"><span class="linenos">148</span></a>            <span class="c1">#   MyExampleTable-2022-01-25</span>
</span><span id="SearchResults.to_archive-149"><a href="#SearchResults.to_archive-149"><span class="linenos">149</span></a>            <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</span><span id="SearchResults.to_archive-150"><a href="#SearchResults.to_archive-150"><span class="linenos">150</span></a>            <span class="n">filename_base</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SearchResults.to_archive-151"><a href="#SearchResults.to_archive-151"><span class="linenos">151</span></a>                <span class="p">[</span>
</span><span id="SearchResults.to_archive-152"><a href="#SearchResults.to_archive-152"><span class="linenos">152</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="SearchResults.to_archive-153"><a href="#SearchResults.to_archive-153"><span class="linenos">153</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
</span><span id="SearchResults.to_archive-154"><a href="#SearchResults.to_archive-154"><span class="linenos">154</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span id="SearchResults.to_archive-155"><a href="#SearchResults.to_archive-155"><span class="linenos">155</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span id="SearchResults.to_archive-156"><a href="#SearchResults.to_archive-156"><span class="linenos">156</span></a>                <span class="p">]</span>
</span><span id="SearchResults.to_archive-157"><a href="#SearchResults.to_archive-157"><span class="linenos">157</span></a>            <span class="p">)</span>
</span><span id="SearchResults.to_archive-158"><a href="#SearchResults.to_archive-158"><span class="linenos">158</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>
</span><span id="SearchResults.to_archive-159"><a href="#SearchResults.to_archive-159"><span class="linenos">159</span></a>
</span><span id="SearchResults.to_archive-160"><a href="#SearchResults.to_archive-160"><span class="linenos">160</span></a>        <span class="c1"># Turn the filename into the full path. We do this because we only</span>
</span><span id="SearchResults.to_archive-161"><a href="#SearchResults.to_archive-161"><span class="linenos">161</span></a>        <span class="c1"># want to</span>
</span><span id="SearchResults.to_archive-162"><a href="#SearchResults.to_archive-162"><span class="linenos">162</span></a>        <span class="c1"># filename = os.path.abspath(filename)</span>
</span><span id="SearchResults.to_archive-163"><a href="#SearchResults.to_archive-163"><span class="linenos">163</span></a>        <span class="c1"># os.path.dirname(filename)</span>
</span><span id="SearchResults.to_archive-164"><a href="#SearchResults.to_archive-164"><span class="linenos">164</span></a>
</span><span id="SearchResults.to_archive-165"><a href="#SearchResults.to_archive-165"><span class="linenos">165</span></a>        <span class="c1"># grab the base_information, and if ID is not present, add it</span>
</span><span id="SearchResults.to_archive-166"><a href="#SearchResults.to_archive-166"><span class="linenos">166</span></a>        <span class="n">base_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">base_info</span>
</span><span id="SearchResults.to_archive-167"><a href="#SearchResults.to_archive-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_info</span><span class="p">:</span>
</span><span id="SearchResults.to_archive-168"><a href="#SearchResults.to_archive-168"><span class="linenos">168</span></a>            <span class="n">base_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="SearchResults.to_archive-169"><a href="#SearchResults.to_archive-169"><span class="linenos">169</span></a>
</span><span id="SearchResults.to_archive-170"><a href="#SearchResults.to_archive-170"><span class="linenos">170</span></a>        <span class="c1"># We want to load the entire table, but only grab the fields that</span>
</span><span id="SearchResults.to_archive-171"><a href="#SearchResults.to_archive-171"><span class="linenos">171</span></a>        <span class="c1"># are in base_info.</span>
</span><span id="SearchResults.to_archive-172"><a href="#SearchResults.to_archive-172"><span class="linenos">172</span></a>        <span class="n">base_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="o">*</span><span class="n">base_info</span><span class="p">)</span>
</span><span id="SearchResults.to_archive-173"><a href="#SearchResults.to_archive-173"><span class="linenos">173</span></a>
</span><span id="SearchResults.to_archive-174"><a href="#SearchResults.to_archive-174"><span class="linenos">174</span></a>        <span class="c1"># now convert these objects to a pandas dataframe, again using just</span>
</span><span id="SearchResults.to_archive-175"><a href="#SearchResults.to_archive-175"><span class="linenos">175</span></a>        <span class="c1"># the base_info columns</span>
</span><span id="SearchResults.to_archive-176"><a href="#SearchResults.to_archive-176"><span class="linenos">176</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">base_objs</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">fieldnames</span><span class="o">=</span><span class="n">base_info</span><span class="p">)</span>
</span><span id="SearchResults.to_archive-177"><a href="#SearchResults.to_archive-177"><span class="linenos">177</span></a>
</span><span id="SearchResults.to_archive-178"><a href="#SearchResults.to_archive-178"><span class="linenos">178</span></a>        <span class="c1"># Write the data to a csv file</span>
</span><span id="SearchResults.to_archive-179"><a href="#SearchResults.to_archive-179"><span class="linenos">179</span></a>        <span class="c1"># OPTIMIZE: is there a better format that pandas can write to?</span>
</span><span id="SearchResults.to_archive-180"><a href="#SearchResults.to_archive-180"><span class="linenos">180</span></a>        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</span><span id="SearchResults.to_archive-181"><a href="#SearchResults.to_archive-181"><span class="linenos">181</span></a>        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SearchResults.to_archive-182"><a href="#SearchResults.to_archive-182"><span class="linenos">182</span></a>
</span><span id="SearchResults.to_archive-183"><a href="#SearchResults.to_archive-183"><span class="linenos">183</span></a>        <span class="c1"># now convert the dump file to a compressed zip. In the complex, os</span>
</span><span id="SearchResults.to_archive-184"><a href="#SearchResults.to_archive-184"><span class="linenos">184</span></a>        <span class="c1"># functions below we are just grabbing the filename without the</span>
</span><span id="SearchResults.to_archive-185"><a href="#SearchResults.to_archive-185"><span class="linenos">185</span></a>        <span class="c1"># zip ending. We are also grabbing the directory that the csv is</span>
</span><span id="SearchResults.to_archive-186"><a href="#SearchResults.to_archive-186"><span class="linenos">186</span></a>        <span class="c1"># located in</span>
</span><span id="SearchResults.to_archive-187"><a href="#SearchResults.to_archive-187"><span class="linenos">187</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>
</span><span id="SearchResults.to_archive-188"><a href="#SearchResults.to_archive-188"><span class="linenos">188</span></a>            <span class="n">base_name</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">),</span>
</span><span id="SearchResults.to_archive-189"><a href="#SearchResults.to_archive-189"><span class="linenos">189</span></a>            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span>
</span><span id="SearchResults.to_archive-190"><a href="#SearchResults.to_archive-190"><span class="linenos">190</span></a>            <span class="n">root_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)),</span>
</span><span id="SearchResults.to_archive-191"><a href="#SearchResults.to_archive-191"><span class="linenos">191</span></a>            <span class="n">base_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">),</span>
</span><span id="SearchResults.to_archive-192"><a href="#SearchResults.to_archive-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="SearchResults.to_archive-193"><a href="#SearchResults.to_archive-193"><span class="linenos">193</span></a>
</span><span id="SearchResults.to_archive-194"><a href="#SearchResults.to_archive-194"><span class="linenos">194</span></a>        <span class="c1"># we can now delete the csv file</span>
</span><span id="SearchResults.to_archive-195"><a href="#SearchResults.to_archive-195"><span class="linenos">195</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Writes a compressed zip file using the table's base_info attribute.
Underneath, the file is written in a csv format.</p>

<p>This is useful for small making archive files and reloading fixtures
to a separate database.</p>

<p>This method is attached to the table manager for scenarios to allow
queryset filtering before dumping data.</p>

<p>To load this database dump into a new database, use the class's
<code>from_archive</code> method.</p>

<h4 id="parameters">Parameters</h4>

<ul>
<li><code>filename</code>:
The filename to write the zip file to. By defualt, None will make
a filename named MyExampleTableName-2022-01-25.zip, where the date
will be the current day (for versioning).</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>django.db.models.query.QuerySet</dt>
                                <dd id="SearchResults.__init__" class="function">QuerySet</dd>
                <dd id="SearchResults.query" class="variable">query</dd>
                <dd id="SearchResults.as_manager" class="function">as_manager</dd>
                <dd id="SearchResults.iterator" class="function">iterator</dd>
                <dd id="SearchResults.aggregate" class="function">aggregate</dd>
                <dd id="SearchResults.count" class="function">count</dd>
                <dd id="SearchResults.get" class="function">get</dd>
                <dd id="SearchResults.create" class="function">create</dd>
                <dd id="SearchResults.bulk_create" class="function">bulk_create</dd>
                <dd id="SearchResults.bulk_update" class="function">bulk_update</dd>
                <dd id="SearchResults.get_or_create" class="function">get_or_create</dd>
                <dd id="SearchResults.update_or_create" class="function">update_or_create</dd>
                <dd id="SearchResults.earliest" class="function">earliest</dd>
                <dd id="SearchResults.latest" class="function">latest</dd>
                <dd id="SearchResults.first" class="function">first</dd>
                <dd id="SearchResults.last" class="function">last</dd>
                <dd id="SearchResults.in_bulk" class="function">in_bulk</dd>
                <dd id="SearchResults.delete" class="function">delete</dd>
                <dd id="SearchResults.update" class="function">update</dd>
                <dd id="SearchResults.exists" class="function">exists</dd>
                <dd id="SearchResults.contains" class="function">contains</dd>
                <dd id="SearchResults.explain" class="function">explain</dd>
                <dd id="SearchResults.raw" class="function">raw</dd>
                <dd id="SearchResults.values" class="function">values</dd>
                <dd id="SearchResults.values_list" class="function">values_list</dd>
                <dd id="SearchResults.dates" class="function">dates</dd>
                <dd id="SearchResults.datetimes" class="function">datetimes</dd>
                <dd id="SearchResults.none" class="function">none</dd>
                <dd id="SearchResults.all" class="function">all</dd>
                <dd id="SearchResults.filter" class="function">filter</dd>
                <dd id="SearchResults.exclude" class="function">exclude</dd>
                <dd id="SearchResults.complex_filter" class="function">complex_filter</dd>
                <dd id="SearchResults.union" class="function">union</dd>
                <dd id="SearchResults.intersection" class="function">intersection</dd>
                <dd id="SearchResults.difference" class="function">difference</dd>
                <dd id="SearchResults.select_for_update" class="function">select_for_update</dd>
                <dd id="SearchResults.select_related" class="function">select_related</dd>
                <dd id="SearchResults.prefetch_related" class="function">prefetch_related</dd>
                <dd id="SearchResults.annotate" class="function">annotate</dd>
                <dd id="SearchResults.alias" class="function">alias</dd>
                <dd id="SearchResults.order_by" class="function">order_by</dd>
                <dd id="SearchResults.distinct" class="function">distinct</dd>
                <dd id="SearchResults.extra" class="function">extra</dd>
                <dd id="SearchResults.reverse" class="function">reverse</dd>
                <dd id="SearchResults.defer" class="function">defer</dd>
                <dd id="SearchResults.only" class="function">only</dd>
                <dd id="SearchResults.using" class="function">using</dd>
                <dd id="SearchResults.ordered" class="variable">ordered</dd>
                <dd id="SearchResults.db" class="variable">db</dd>
                <dd id="SearchResults.resolve_expression" class="function">resolve_expression</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DatabaseTable">
                                <div class="attr class">
        <a class="headerlink" href="#DatabaseTable">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">DatabaseTable</span><wbr>(<span class="base">django.db.models.base.Model</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable-233"><a href="#DatabaseTable-233"><span class="linenos">233</span></a><span class="k">class</span> <span class="nc">DatabaseTable</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="DatabaseTable-234"><a href="#DatabaseTable-234"><span class="linenos">234</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-235"><a href="#DatabaseTable-235"><span class="linenos">235</span></a><span class="sd">    The base class for defining a table in the Simmate database. All tables and</span>
</span><span id="DatabaseTable-236"><a href="#DatabaseTable-236"><span class="linenos">236</span></a><span class="sd">    mixins inherit from this class.</span>
</span><span id="DatabaseTable-237"><a href="#DatabaseTable-237"><span class="linenos">237</span></a>
</span><span id="DatabaseTable-238"><a href="#DatabaseTable-238"><span class="linenos">238</span></a><span class="sd">    Usage is identical to</span>
</span><span id="DatabaseTable-239"><a href="#DatabaseTable-239"><span class="linenos">239</span></a><span class="sd">    [models in Django](https://docs.djangoproject.com/en/4.0/#the-model-layer)</span>
</span><span id="DatabaseTable-240"><a href="#DatabaseTable-240"><span class="linenos">240</span></a><span class="sd">    where this class only adds extra methods for convenience.</span>
</span><span id="DatabaseTable-241"><a href="#DatabaseTable-241"><span class="linenos">241</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-242"><a href="#DatabaseTable-242"><span class="linenos">242</span></a>
</span><span id="DatabaseTable-243"><a href="#DatabaseTable-243"><span class="linenos">243</span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span id="DatabaseTable-244"><a href="#DatabaseTable-244"><span class="linenos">244</span></a>        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DatabaseTable-245"><a href="#DatabaseTable-245"><span class="linenos">245</span></a>
</span><span id="DatabaseTable-246"><a href="#DatabaseTable-246"><span class="linenos">246</span></a>    <span class="n">base_info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DatabaseTable-247"><a href="#DatabaseTable-247"><span class="linenos">247</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-248"><a href="#DatabaseTable-248"><span class="linenos">248</span></a><span class="sd">    The base information for this database table and only these fields are stored</span>
</span><span id="DatabaseTable-249"><a href="#DatabaseTable-249"><span class="linenos">249</span></a><span class="sd">    when the `to_archive` method is used. Using the columns in this list, all </span>
</span><span id="DatabaseTable-250"><a href="#DatabaseTable-250"><span class="linenos">250</span></a><span class="sd">    other columns for this table can be calculated, so the columns in this list </span>
</span><span id="DatabaseTable-251"><a href="#DatabaseTable-251"><span class="linenos">251</span></a><span class="sd">    are effectively the &quot;raw data&quot;.</span>
</span><span id="DatabaseTable-252"><a href="#DatabaseTable-252"><span class="linenos">252</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-253"><a href="#DatabaseTable-253"><span class="linenos">253</span></a>
</span><span id="DatabaseTable-254"><a href="#DatabaseTable-254"><span class="linenos">254</span></a>    <span class="n">source</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">JSONField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DatabaseTable-255"><a href="#DatabaseTable-255"><span class="linenos">255</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-256"><a href="#DatabaseTable-256"><span class="linenos">256</span></a><span class="sd">    &gt; Note, this field is highly experimental at the moment and subject to</span>
</span><span id="DatabaseTable-257"><a href="#DatabaseTable-257"><span class="linenos">257</span></a><span class="sd">    change.</span>
</span><span id="DatabaseTable-258"><a href="#DatabaseTable-258"><span class="linenos">258</span></a><span class="sd">    </span>
</span><span id="DatabaseTable-259"><a href="#DatabaseTable-259"><span class="linenos">259</span></a><span class="sd">    This column indicates where the data came from, and it could be a number </span>
</span><span id="DatabaseTable-260"><a href="#DatabaseTable-260"><span class="linenos">260</span></a><span class="sd">    of things including...</span>
</span><span id="DatabaseTable-261"><a href="#DatabaseTable-261"><span class="linenos">261</span></a><span class="sd">     - a third party id</span>
</span><span id="DatabaseTable-262"><a href="#DatabaseTable-262"><span class="linenos">262</span></a><span class="sd">     - a structure from a different Simmate datbase table</span>
</span><span id="DatabaseTable-263"><a href="#DatabaseTable-263"><span class="linenos">263</span></a><span class="sd">     - a transformation of another structure</span>
</span><span id="DatabaseTable-264"><a href="#DatabaseTable-264"><span class="linenos">264</span></a><span class="sd">     - a creation method</span>
</span><span id="DatabaseTable-265"><a href="#DatabaseTable-265"><span class="linenos">265</span></a><span class="sd">     - a custom submission by the user</span>
</span><span id="DatabaseTable-266"><a href="#DatabaseTable-266"><span class="linenos">266</span></a><span class="sd">    </span>
</span><span id="DatabaseTable-267"><a href="#DatabaseTable-267"><span class="linenos">267</span></a><span class="sd">    By default, this is a JSON field to account for all scenarios, but some</span>
</span><span id="DatabaseTable-268"><a href="#DatabaseTable-268"><span class="linenos">268</span></a><span class="sd">    tables (such as those in `simmate.database.third_parties`) this is value</span>
</span><span id="DatabaseTable-269"><a href="#DatabaseTable-269"><span class="linenos">269</span></a><span class="sd">    should be the same for ALL entries in the table and therefore the column is</span>
</span><span id="DatabaseTable-270"><a href="#DatabaseTable-270"><span class="linenos">270</span></a><span class="sd">    overwritten as an attribute.</span>
</span><span id="DatabaseTable-271"><a href="#DatabaseTable-271"><span class="linenos">271</span></a><span class="sd">    </span>
</span><span id="DatabaseTable-272"><a href="#DatabaseTable-272"><span class="linenos">272</span></a><span class="sd">    For other tables where this is not a constant, here are some examples of</span>
</span><span id="DatabaseTable-273"><a href="#DatabaseTable-273"><span class="linenos">273</span></a><span class="sd">    values used in this column:</span>
</span><span id="DatabaseTable-274"><a href="#DatabaseTable-274"><span class="linenos">274</span></a><span class="sd">    </span>
</span><span id="DatabaseTable-275"><a href="#DatabaseTable-275"><span class="linenos">275</span></a><span class="sd">    ``` python</span>
</span><span id="DatabaseTable-276"><a href="#DatabaseTable-276"><span class="linenos">276</span></a><span class="sd">    # from a thirdparty database or separate table</span>
</span><span id="DatabaseTable-277"><a href="#DatabaseTable-277"><span class="linenos">277</span></a><span class="sd">    source = {</span>
</span><span id="DatabaseTable-278"><a href="#DatabaseTable-278"><span class="linenos">278</span></a><span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
</span><span id="DatabaseTable-279"><a href="#DatabaseTable-279"><span class="linenos">279</span></a><span class="sd">        &quot;id&quot;: &quot;mp-123&quot;,</span>
</span><span id="DatabaseTable-280"><a href="#DatabaseTable-280"><span class="linenos">280</span></a><span class="sd">    }</span>
</span><span id="DatabaseTable-281"><a href="#DatabaseTable-281"><span class="linenos">281</span></a><span class="sd">    </span>
</span><span id="DatabaseTable-282"><a href="#DatabaseTable-282"><span class="linenos">282</span></a><span class="sd">    # from a random structure creator</span>
</span><span id="DatabaseTable-283"><a href="#DatabaseTable-283"><span class="linenos">283</span></a><span class="sd">    source = {&quot;method&quot;: &quot;PyXtalStructure&quot;}</span>
</span><span id="DatabaseTable-284"><a href="#DatabaseTable-284"><span class="linenos">284</span></a><span class="sd">    </span>
</span><span id="DatabaseTable-285"><a href="#DatabaseTable-285"><span class="linenos">285</span></a><span class="sd">    # from a templated structure creator (e.g. substituition or prototypes)</span>
</span><span id="DatabaseTable-286"><a href="#DatabaseTable-286"><span class="linenos">286</span></a><span class="sd">    source = {</span>
</span><span id="DatabaseTable-287"><a href="#DatabaseTable-287"><span class="linenos">287</span></a><span class="sd">        &quot;method&quot;: &quot;PrototypeStructure&quot;,</span>
</span><span id="DatabaseTable-288"><a href="#DatabaseTable-288"><span class="linenos">288</span></a><span class="sd">        &quot;table&quot;: &quot;AFLOWPrototypes&quot;,</span>
</span><span id="DatabaseTable-289"><a href="#DatabaseTable-289"><span class="linenos">289</span></a><span class="sd">        &quot;id&quot;: 123,</span>
</span><span id="DatabaseTable-290"><a href="#DatabaseTable-290"><span class="linenos">290</span></a><span class="sd">    }</span>
</span><span id="DatabaseTable-291"><a href="#DatabaseTable-291"><span class="linenos">291</span></a><span class="sd">    </span>
</span><span id="DatabaseTable-292"><a href="#DatabaseTable-292"><span class="linenos">292</span></a><span class="sd">    # from a transformation</span>
</span><span id="DatabaseTable-293"><a href="#DatabaseTable-293"><span class="linenos">293</span></a><span class="sd">    source = {</span>
</span><span id="DatabaseTable-294"><a href="#DatabaseTable-294"><span class="linenos">294</span></a><span class="sd">        &quot;method&quot;: &quot;MirrorMutation&quot;,</span>
</span><span id="DatabaseTable-295"><a href="#DatabaseTable-295"><span class="linenos">295</span></a><span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
</span><span id="DatabaseTable-296"><a href="#DatabaseTable-296"><span class="linenos">296</span></a><span class="sd">        &quot;id&quot;: &quot;mp-123&quot;,</span>
</span><span id="DatabaseTable-297"><a href="#DatabaseTable-297"><span class="linenos">297</span></a><span class="sd">    }</span>
</span><span id="DatabaseTable-298"><a href="#DatabaseTable-298"><span class="linenos">298</span></a><span class="sd">    </span>
</span><span id="DatabaseTable-299"><a href="#DatabaseTable-299"><span class="linenos">299</span></a><span class="sd">    # from a multi-structure transformation</span>
</span><span id="DatabaseTable-300"><a href="#DatabaseTable-300"><span class="linenos">300</span></a><span class="sd">    source = {</span>
</span><span id="DatabaseTable-301"><a href="#DatabaseTable-301"><span class="linenos">301</span></a><span class="sd">        &quot;method&quot;: &quot;HereditaryMutation&quot;,</span>
</span><span id="DatabaseTable-302"><a href="#DatabaseTable-302"><span class="linenos">302</span></a><span class="sd">        &quot;table&quot;: &quot;MatProjStructure&quot;,</span>
</span><span id="DatabaseTable-303"><a href="#DatabaseTable-303"><span class="linenos">303</span></a><span class="sd">        &quot;ids&quot;: [&quot;mp-123&quot;, &quot;mp-321&quot;],</span>
</span><span id="DatabaseTable-304"><a href="#DatabaseTable-304"><span class="linenos">304</span></a><span class="sd">    }</span>
</span><span id="DatabaseTable-305"><a href="#DatabaseTable-305"><span class="linenos">305</span></a><span class="sd">    ```</span>
</span><span id="DatabaseTable-306"><a href="#DatabaseTable-306"><span class="linenos">306</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-307"><a href="#DatabaseTable-307"><span class="linenos">307</span></a>    <span class="c1"># TODO: Explore polymorphic relations instead of a JSON dictionary.</span>
</span><span id="DatabaseTable-308"><a href="#DatabaseTable-308"><span class="linenos">308</span></a>    <span class="c1"># Making relationships to different tables makes things difficult to use, so</span>
</span><span id="DatabaseTable-309"><a href="#DatabaseTable-309"><span class="linenos">309</span></a>    <span class="c1"># these columns are just standalone.</span>
</span><span id="DatabaseTable-310"><a href="#DatabaseTable-310"><span class="linenos">310</span></a>    <span class="c1">#</span>
</span><span id="DatabaseTable-311"><a href="#DatabaseTable-311"><span class="linenos">311</span></a>    <span class="c1"># This is will be very important for &quot;source&quot; and &quot;parent_nested_calculations&quot;</span>
</span><span id="DatabaseTable-312"><a href="#DatabaseTable-312"><span class="linenos">312</span></a>    <span class="c1"># fields because I have no way to efficiently convert these fields to the objects</span>
</span><span id="DatabaseTable-313"><a href="#DatabaseTable-313"><span class="linenos">313</span></a>    <span class="c1"># that they refer to. There&#39;s also no good way to access a structure&#39;s &quot;children&quot;</span>
</span><span id="DatabaseTable-314"><a href="#DatabaseTable-314"><span class="linenos">314</span></a>    <span class="c1"># (i.e. structure where they are the source).</span>
</span><span id="DatabaseTable-315"><a href="#DatabaseTable-315"><span class="linenos">315</span></a>    <span class="c1">#</span>
</span><span id="DatabaseTable-316"><a href="#DatabaseTable-316"><span class="linenos">316</span></a>    <span class="c1"># I should investigate generic relations in django though:</span>
</span><span id="DatabaseTable-317"><a href="#DatabaseTable-317"><span class="linenos">317</span></a>    <span class="c1"># https://docs.djangoproject.com/en/3.2/ref/contrib/contenttypes/#generic-relations</span>
</span><span id="DatabaseTable-318"><a href="#DatabaseTable-318"><span class="linenos">318</span></a>    <span class="c1">#</span>
</span><span id="DatabaseTable-319"><a href="#DatabaseTable-319"><span class="linenos">319</span></a>    <span class="c1"># Another option is using django-polymorphic.</span>
</span><span id="DatabaseTable-320"><a href="#DatabaseTable-320"><span class="linenos">320</span></a>    <span class="c1"># https://django-polymorphic.readthedocs.io/en/latest/</span>
</span><span id="DatabaseTable-321"><a href="#DatabaseTable-321"><span class="linenos">321</span></a>    <span class="c1"># This thread is really helpful on the subject:</span>
</span><span id="DatabaseTable-322"><a href="#DatabaseTable-322"><span class="linenos">322</span></a>    <span class="c1"># https://stackoverflow.com/questions/30343212/</span>
</span><span id="DatabaseTable-323"><a href="#DatabaseTable-323"><span class="linenos">323</span></a>    <span class="c1">#</span>
</span><span id="DatabaseTable-324"><a href="#DatabaseTable-324"><span class="linenos">324</span></a>    <span class="c1"># TODO: Consider adding some methods to track the history of a structure.</span>
</span><span id="DatabaseTable-325"><a href="#DatabaseTable-325"><span class="linenos">325</span></a>    <span class="c1">#  This would be useful for things like evolutionary algorithms.</span>
</span><span id="DatabaseTable-326"><a href="#DatabaseTable-326"><span class="linenos">326</span></a>    <span class="c1"># get_source_parent:</span>
</span><span id="DatabaseTable-327"><a href="#DatabaseTable-327"><span class="linenos">327</span></a>    <span class="c1">#   this would iterate through sources until we find one in the same table</span>
</span><span id="DatabaseTable-328"><a href="#DatabaseTable-328"><span class="linenos">328</span></a>    <span class="c1">#   as this one. Parent sources are often the most recent transformation</span>
</span><span id="DatabaseTable-329"><a href="#DatabaseTable-329"><span class="linenos">329</span></a>    <span class="c1">#   or mutation applied to a structure, such as a MirrorMutation.</span>
</span><span id="DatabaseTable-330"><a href="#DatabaseTable-330"><span class="linenos">330</span></a>    <span class="c1"># get_source_seed:</span>
</span><span id="DatabaseTable-331"><a href="#DatabaseTable-331"><span class="linenos">331</span></a>    <span class="c1">#   this would iterate through sources until we hit a dead-end. So the seed</span>
</span><span id="DatabaseTable-332"><a href="#DatabaseTable-332"><span class="linenos">332</span></a>    <span class="c1">#   source would be something like a third-party database, a method that</span>
</span><span id="DatabaseTable-333"><a href="#DatabaseTable-333"><span class="linenos">333</span></a>    <span class="c1">#   randomly create structures, or a prototype.</span>
</span><span id="DatabaseTable-334"><a href="#DatabaseTable-334"><span class="linenos">334</span></a>    <span class="c1"># Both of these get more complex when we consider transformation that have</span>
</span><span id="DatabaseTable-335"><a href="#DatabaseTable-335"><span class="linenos">335</span></a>    <span class="c1"># multiple parents (and therefore multiple seeds too). An example of this</span>
</span><span id="DatabaseTable-336"><a href="#DatabaseTable-336"><span class="linenos">336</span></a>    <span class="c1"># is the HereditaryMutation.</span>
</span><span id="DatabaseTable-337"><a href="#DatabaseTable-337"><span class="linenos">337</span></a>
</span><span id="DatabaseTable-338"><a href="#DatabaseTable-338"><span class="linenos">338</span></a>    <span class="n">source_doi</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DatabaseTable-339"><a href="#DatabaseTable-339"><span class="linenos">339</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-340"><a href="#DatabaseTable-340"><span class="linenos">340</span></a><span class="sd">    Source paper that must be referenced if this data is used. If this is None,</span>
</span><span id="DatabaseTable-341"><a href="#DatabaseTable-341"><span class="linenos">341</span></a><span class="sd">    please refer to the `source` attribute for further details on what to </span>
</span><span id="DatabaseTable-342"><a href="#DatabaseTable-342"><span class="linenos">342</span></a><span class="sd">    reference.</span>
</span><span id="DatabaseTable-343"><a href="#DatabaseTable-343"><span class="linenos">343</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-344"><a href="#DatabaseTable-344"><span class="linenos">344</span></a>
</span><span id="DatabaseTable-345"><a href="#DatabaseTable-345"><span class="linenos">345</span></a>    <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DatabaseTable-346"><a href="#DatabaseTable-346"><span class="linenos">346</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-347"><a href="#DatabaseTable-347"><span class="linenos">347</span></a><span class="sd">    The URL that is used to download the archive and then populate this table.</span>
</span><span id="DatabaseTable-348"><a href="#DatabaseTable-348"><span class="linenos">348</span></a><span class="sd">    Many tables, such as those in `simmate.database.third_parties`, have</span>
</span><span id="DatabaseTable-349"><a href="#DatabaseTable-349"><span class="linenos">349</span></a><span class="sd">    pre-existing data that you can download and load into your local database,</span>
</span><span id="DatabaseTable-350"><a href="#DatabaseTable-350"><span class="linenos">350</span></a><span class="sd">    so if this attribute is set, you can use the `load_remote_archive` method.</span>
</span><span id="DatabaseTable-351"><a href="#DatabaseTable-351"><span class="linenos">351</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-352"><a href="#DatabaseTable-352"><span class="linenos">352</span></a>
</span><span id="DatabaseTable-353"><a href="#DatabaseTable-353"><span class="linenos">353</span></a>    <span class="c1"># I override the default manager with the one we define above, which has</span>
</span><span id="DatabaseTable-354"><a href="#DatabaseTable-354"><span class="linenos">354</span></a>    <span class="c1"># extra methods useful for our querysets.</span>
</span><span id="DatabaseTable-355"><a href="#DatabaseTable-355"><span class="linenos">355</span></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">DatabaseTableManager</span><span class="p">()</span>
</span><span id="DatabaseTable-356"><a href="#DatabaseTable-356"><span class="linenos">356</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-357"><a href="#DatabaseTable-357"><span class="linenos">357</span></a><span class="sd">    Accesses all of the rows in this datatable and initiates a SearchResults</span>
</span><span id="DatabaseTable-358"><a href="#DatabaseTable-358"><span class="linenos">358</span></a><span class="sd">    object. Using this, you can perform complex filtering and conversions on</span>
</span><span id="DatabaseTable-359"><a href="#DatabaseTable-359"><span class="linenos">359</span></a><span class="sd">    data from this table.</span>
</span><span id="DatabaseTable-360"><a href="#DatabaseTable-360"><span class="linenos">360</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-361"><a href="#DatabaseTable-361"><span class="linenos">361</span></a>
</span><span id="DatabaseTable-362"><a href="#DatabaseTable-362"><span class="linenos">362</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-363"><a href="#DatabaseTable-363"><span class="linenos">363</span></a>    <span class="k">def</span> <span class="nf">get_table_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DatabaseTable-364"><a href="#DatabaseTable-364"><span class="linenos">364</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-365"><a href="#DatabaseTable-365"><span class="linenos">365</span></a><span class="sd">        Returns the name of this database table, which will simply match the</span>
</span><span id="DatabaseTable-366"><a href="#DatabaseTable-366"><span class="linenos">366</span></a><span class="sd">        class name. Using `Table.__name__` is often easier. This method simply</span>
</span><span id="DatabaseTable-367"><a href="#DatabaseTable-367"><span class="linenos">367</span></a><span class="sd">        makes the name accessible in Django Templates.</span>
</span><span id="DatabaseTable-368"><a href="#DatabaseTable-368"><span class="linenos">368</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-369"><a href="#DatabaseTable-369"><span class="linenos">369</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="DatabaseTable-370"><a href="#DatabaseTable-370"><span class="linenos">370</span></a>
</span><span id="DatabaseTable-371"><a href="#DatabaseTable-371"><span class="linenos">371</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-372"><a href="#DatabaseTable-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">create_subclass</span><span class="p">(</span>
</span><span id="DatabaseTable-373"><a href="#DatabaseTable-373"><span class="linenos">373</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="DatabaseTable-374"><a href="#DatabaseTable-374"><span class="linenos">374</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DatabaseTable-375"><a href="#DatabaseTable-375"><span class="linenos">375</span></a>        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DatabaseTable-376"><a href="#DatabaseTable-376"><span class="linenos">376</span></a>        <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DatabaseTable-377"><a href="#DatabaseTable-377"><span class="linenos">377</span></a>        <span class="o">**</span><span class="n">new_columns</span><span class="p">,</span>
</span><span id="DatabaseTable-378"><a href="#DatabaseTable-378"><span class="linenos">378</span></a>    <span class="p">):</span>
</span><span id="DatabaseTable-379"><a href="#DatabaseTable-379"><span class="linenos">379</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-380"><a href="#DatabaseTable-380"><span class="linenos">380</span></a><span class="sd">        This method is useful for dynamically creating a subclass DatabaseTable</span>
</span><span id="DatabaseTable-381"><a href="#DatabaseTable-381"><span class="linenos">381</span></a><span class="sd">        from some abstract class.</span>
</span><span id="DatabaseTable-382"><a href="#DatabaseTable-382"><span class="linenos">382</span></a>
</span><span id="DatabaseTable-383"><a href="#DatabaseTable-383"><span class="linenos">383</span></a><span class="sd">        Let&#39;s take an example where we inherit from a Structure table. The two</span>
</span><span id="DatabaseTable-384"><a href="#DatabaseTable-384"><span class="linenos">384</span></a><span class="sd">        ways we create a NewTable below are exactly the same:</span>
</span><span id="DatabaseTable-385"><a href="#DatabaseTable-385"><span class="linenos">385</span></a>
</span><span id="DatabaseTable-386"><a href="#DatabaseTable-386"><span class="linenos">386</span></a><span class="sd">        ``` python</span>
</span><span id="DatabaseTable-387"><a href="#DatabaseTable-387"><span class="linenos">387</span></a><span class="sd">        # Normal way to create a child class</span>
</span><span id="DatabaseTable-388"><a href="#DatabaseTable-388"><span class="linenos">388</span></a><span class="sd">        NewTable(Structure):</span>
</span><span id="DatabaseTable-389"><a href="#DatabaseTable-389"><span class="linenos">389</span></a><span class="sd">            new_field1 = table_column.FloatField()</span>
</span><span id="DatabaseTable-390"><a href="#DatabaseTable-390"><span class="linenos">390</span></a><span class="sd">            new_field2 = table_column.FloatField()</span>
</span><span id="DatabaseTable-391"><a href="#DatabaseTable-391"><span class="linenos">391</span></a>
</span><span id="DatabaseTable-392"><a href="#DatabaseTable-392"><span class="linenos">392</span></a><span class="sd">        # How this method makes the same child class</span>
</span><span id="DatabaseTable-393"><a href="#DatabaseTable-393"><span class="linenos">393</span></a><span class="sd">        NewTable = Structure.create_subclass(</span>
</span><span id="DatabaseTable-394"><a href="#DatabaseTable-394"><span class="linenos">394</span></a><span class="sd">            name=&quot;NewTable&quot;,</span>
</span><span id="DatabaseTable-395"><a href="#DatabaseTable-395"><span class="linenos">395</span></a><span class="sd">            module=__name__, # required for serialization</span>
</span><span id="DatabaseTable-396"><a href="#DatabaseTable-396"><span class="linenos">396</span></a><span class="sd">            new_field1 = table_column.FloatField()</span>
</span><span id="DatabaseTable-397"><a href="#DatabaseTable-397"><span class="linenos">397</span></a><span class="sd">            new_field2 = table_column.FloatField()</span>
</span><span id="DatabaseTable-398"><a href="#DatabaseTable-398"><span class="linenos">398</span></a><span class="sd">            # app_label --&gt; typically not required bc the parent class sets this</span>
</span><span id="DatabaseTable-399"><a href="#DatabaseTable-399"><span class="linenos">399</span></a><span class="sd">        )</span>
</span><span id="DatabaseTable-400"><a href="#DatabaseTable-400"><span class="linenos">400</span></a><span class="sd">        ```</span>
</span><span id="DatabaseTable-401"><a href="#DatabaseTable-401"><span class="linenos">401</span></a>
</span><span id="DatabaseTable-402"><a href="#DatabaseTable-402"><span class="linenos">402</span></a><span class="sd">        While this might seem silly, it helps us avoid a bunch of boilerplate</span>
</span><span id="DatabaseTable-403"><a href="#DatabaseTable-403"><span class="linenos">403</span></a><span class="sd">        code when we need to redefine a bunch of relationships in every single</span>
</span><span id="DatabaseTable-404"><a href="#DatabaseTable-404"><span class="linenos">404</span></a><span class="sd">        child class (and always in the same way). A great example of it&#39;s utility</span>
</span><span id="DatabaseTable-405"><a href="#DatabaseTable-405"><span class="linenos">405</span></a><span class="sd">        is in `simmate.calculators.vasp.database.relaxation`.</span>
</span><span id="DatabaseTable-406"><a href="#DatabaseTable-406"><span class="linenos">406</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-407"><a href="#DatabaseTable-407"><span class="linenos">407</span></a>
</span><span id="DatabaseTable-408"><a href="#DatabaseTable-408"><span class="linenos">408</span></a>        <span class="c1"># because we update values below, we make sure we are editting a</span>
</span><span id="DatabaseTable-409"><a href="#DatabaseTable-409"><span class="linenos">409</span></a>        <span class="c1"># copy of the dictionary</span>
</span><span id="DatabaseTable-410"><a href="#DatabaseTable-410"><span class="linenos">410</span></a>        <span class="n">new_columns</span> <span class="o">=</span> <span class="n">new_columns</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DatabaseTable-411"><a href="#DatabaseTable-411"><span class="linenos">411</span></a>
</span><span id="DatabaseTable-412"><a href="#DatabaseTable-412"><span class="linenos">412</span></a>        <span class="c1"># BUG: I&#39;m honestly not sure what this does, but it works...</span>
</span><span id="DatabaseTable-413"><a href="#DatabaseTable-413"><span class="linenos">413</span></a>        <span class="c1"># https://stackoverflow.com/questions/27112816/</span>
</span><span id="DatabaseTable-414"><a href="#DatabaseTable-414"><span class="linenos">414</span></a>        <span class="c1"># For a more robust way of setting the Meta class, see my code in</span>
</span><span id="DatabaseTable-415"><a href="#DatabaseTable-415"><span class="linenos">415</span></a>        <span class="c1"># simmate.website.workflows.utilities</span>
</span><span id="DatabaseTable-416"><a href="#DatabaseTable-416"><span class="linenos">416</span></a>        <span class="n">new_columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="DatabaseTable-417"><a href="#DatabaseTable-417"><span class="linenos">417</span></a>            <span class="p">{</span>
</span><span id="DatabaseTable-418"><a href="#DatabaseTable-418"><span class="linenos">418</span></a>                <span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="n">module</span><span class="p">,</span>
</span><span id="DatabaseTable-419"><a href="#DatabaseTable-419"><span class="linenos">419</span></a>                <span class="s2">&quot;Meta&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;app_label&quot;</span><span class="p">:</span> <span class="n">app_label</span><span class="p">}</span> <span class="k">if</span> <span class="n">app_label</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="DatabaseTable-420"><a href="#DatabaseTable-420"><span class="linenos">420</span></a>            <span class="p">}</span>
</span><span id="DatabaseTable-421"><a href="#DatabaseTable-421"><span class="linenos">421</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable-422"><a href="#DatabaseTable-422"><span class="linenos">422</span></a>        <span class="c1"># TODO: make it so I don&#39;t have to specify the module, but it is automatically</span>
</span><span id="DatabaseTable-423"><a href="#DatabaseTable-423"><span class="linenos">423</span></a>        <span class="c1"># detected from where the class is created. This would remove boilerplate code.</span>
</span><span id="DatabaseTable-424"><a href="#DatabaseTable-424"><span class="linenos">424</span></a>        <span class="c1"># A good start to this is here:</span>
</span><span id="DatabaseTable-425"><a href="#DatabaseTable-425"><span class="linenos">425</span></a>        <span class="c1">#   https://stackoverflow.com/questions/59912684/</span>
</span><span id="DatabaseTable-426"><a href="#DatabaseTable-426"><span class="linenos">426</span></a>        <span class="c1"># sys._getframe(1).f_globals[&quot;__name__&quot;]  &lt;-- grabs where this function is called</span>
</span><span id="DatabaseTable-427"><a href="#DatabaseTable-427"><span class="linenos">427</span></a>        <span class="c1"># but doesn&#39;t work for multiple levels of inheritance. For example, this fails for</span>
</span><span id="DatabaseTable-428"><a href="#DatabaseTable-428"><span class="linenos">428</span></a>        <span class="c1"># the Relaxation subclasses because the create_subclasses method calls</span>
</span><span id="DatabaseTable-429"><a href="#DatabaseTable-429"><span class="linenos">429</span></a>        <span class="c1"># create_subclass -- therefore we&#39;d need _getframe(3) instead of 1...</span>
</span><span id="DatabaseTable-430"><a href="#DatabaseTable-430"><span class="linenos">430</span></a>
</span><span id="DatabaseTable-431"><a href="#DatabaseTable-431"><span class="linenos">431</span></a>        <span class="c1"># Now we dynamically create a new class that inherits from this main</span>
</span><span id="DatabaseTable-432"><a href="#DatabaseTable-432"><span class="linenos">432</span></a>        <span class="c1"># one and also adds the new columns to it.</span>
</span><span id="DatabaseTable-433"><a href="#DatabaseTable-433"><span class="linenos">433</span></a>        <span class="n">NewClass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="n">new_columns</span><span class="p">)</span>
</span><span id="DatabaseTable-434"><a href="#DatabaseTable-434"><span class="linenos">434</span></a>
</span><span id="DatabaseTable-435"><a href="#DatabaseTable-435"><span class="linenos">435</span></a>        <span class="k">return</span> <span class="n">NewClass</span>
</span><span id="DatabaseTable-436"><a href="#DatabaseTable-436"><span class="linenos">436</span></a>
</span><span id="DatabaseTable-437"><a href="#DatabaseTable-437"><span class="linenos">437</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-438"><a href="#DatabaseTable-438"><span class="linenos">438</span></a>    <span class="k">def</span> <span class="nf">from_toolkit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DatabaseTable-439"><a href="#DatabaseTable-439"><span class="linenos">439</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-440"><a href="#DatabaseTable-440"><span class="linenos">440</span></a><span class="sd">        Given fundamental &quot;base_info&quot; and toolkit objects, this method will populate</span>
</span><span id="DatabaseTable-441"><a href="#DatabaseTable-441"><span class="linenos">441</span></a><span class="sd">        all relevant columns.</span>
</span><span id="DatabaseTable-442"><a href="#DatabaseTable-442"><span class="linenos">442</span></a>
</span><span id="DatabaseTable-443"><a href="#DatabaseTable-443"><span class="linenos">443</span></a><span class="sd">        If the table is made up of multiple mix-ins, this method iterates through</span>
</span><span id="DatabaseTable-444"><a href="#DatabaseTable-444"><span class="linenos">444</span></a><span class="sd">        each of the `_from_toolkit` methods of those mixins and combines the results.</span>
</span><span id="DatabaseTable-445"><a href="#DatabaseTable-445"><span class="linenos">445</span></a><span class="sd">        Therefore, you must view this method for each mix-ins to determine which</span>
</span><span id="DatabaseTable-446"><a href="#DatabaseTable-446"><span class="linenos">446</span></a><span class="sd">        kwargs must be passed.</span>
</span><span id="DatabaseTable-447"><a href="#DatabaseTable-447"><span class="linenos">447</span></a>
</span><span id="DatabaseTable-448"><a href="#DatabaseTable-448"><span class="linenos">448</span></a><span class="sd">        #### Parameters</span>
</span><span id="DatabaseTable-449"><a href="#DatabaseTable-449"><span class="linenos">449</span></a>
</span><span id="DatabaseTable-450"><a href="#DatabaseTable-450"><span class="linenos">450</span></a><span class="sd">        - `as_dict` :</span>
</span><span id="DatabaseTable-451"><a href="#DatabaseTable-451"><span class="linenos">451</span></a><span class="sd">            Whether to return the populated data as a dictionary or to initialize</span>
</span><span id="DatabaseTable-452"><a href="#DatabaseTable-452"><span class="linenos">452</span></a><span class="sd">            it as a database object. Defaults to False.</span>
</span><span id="DatabaseTable-453"><a href="#DatabaseTable-453"><span class="linenos">453</span></a><span class="sd">        - `**kwargs` :</span>
</span><span id="DatabaseTable-454"><a href="#DatabaseTable-454"><span class="linenos">454</span></a><span class="sd">            All fields required in order to initialize the database entry. For</span>
</span><span id="DatabaseTable-455"><a href="#DatabaseTable-455"><span class="linenos">455</span></a><span class="sd">            example, a Structure table would require a toolkit structure, while</span>
</span><span id="DatabaseTable-456"><a href="#DatabaseTable-456"><span class="linenos">456</span></a><span class="sd">            a Thermodynamics table would require an energy.</span>
</span><span id="DatabaseTable-457"><a href="#DatabaseTable-457"><span class="linenos">457</span></a>
</span><span id="DatabaseTable-458"><a href="#DatabaseTable-458"><span class="linenos">458</span></a><span class="sd">        Returns</span>
</span><span id="DatabaseTable-459"><a href="#DatabaseTable-459"><span class="linenos">459</span></a><span class="sd">        -------</span>
</span><span id="DatabaseTable-460"><a href="#DatabaseTable-460"><span class="linenos">460</span></a><span class="sd">        a dictionary if as_dict is True; and a database object if as_dict is False</span>
</span><span id="DatabaseTable-461"><a href="#DatabaseTable-461"><span class="linenos">461</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-462"><a href="#DatabaseTable-462"><span class="linenos">462</span></a>
</span><span id="DatabaseTable-463"><a href="#DatabaseTable-463"><span class="linenos">463</span></a>        <span class="c1"># Grab a list of all parent classes</span>
</span><span id="DatabaseTable-464"><a href="#DatabaseTable-464"><span class="linenos">464</span></a>        <span class="n">parents</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="DatabaseTable-465"><a href="#DatabaseTable-465"><span class="linenos">465</span></a>
</span><span id="DatabaseTable-466"><a href="#DatabaseTable-466"><span class="linenos">466</span></a>        <span class="c1"># As we go through the parent classes below, we will identify the mixins</span>
</span><span id="DatabaseTable-467"><a href="#DatabaseTable-467"><span class="linenos">467</span></a>        <span class="c1"># and populate data using those classes. All of this is fed in to our</span>
</span><span id="DatabaseTable-468"><a href="#DatabaseTable-468"><span class="linenos">468</span></a>        <span class="c1"># main class at the end of the function. We keep this running dictionary</span>
</span><span id="DatabaseTable-469"><a href="#DatabaseTable-469"><span class="linenos">469</span></a>        <span class="c1"># as we go.</span>
</span><span id="DatabaseTable-470"><a href="#DatabaseTable-470"><span class="linenos">470</span></a>        <span class="n">all_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DatabaseTable-471"><a href="#DatabaseTable-471"><span class="linenos">471</span></a>        <span class="c1"># TODO: How should I best handle passing extra kwargs to the final class</span>
</span><span id="DatabaseTable-472"><a href="#DatabaseTable-472"><span class="linenos">472</span></a>        <span class="c1"># initialization? For example, I would want to pass `energy` but I wouldn&#39;t</span>
</span><span id="DatabaseTable-473"><a href="#DatabaseTable-473"><span class="linenos">473</span></a>        <span class="c1"># want to pass the toolkit structure object. I may update this line in</span>
</span><span id="DatabaseTable-474"><a href="#DatabaseTable-474"><span class="linenos">474</span></a>        <span class="c1"># the future to remove python objects. For now, I only remove structure</span>
</span><span id="DatabaseTable-475"><a href="#DatabaseTable-475"><span class="linenos">475</span></a>        <span class="c1"># and migration_hop because I know that it is a toolkit object -- not</span>
</span><span id="DatabaseTable-476"><a href="#DatabaseTable-476"><span class="linenos">476</span></a>        <span class="c1"># a database column.</span>
</span><span id="DatabaseTable-477"><a href="#DatabaseTable-477"><span class="linenos">477</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable-478"><a href="#DatabaseTable-478"><span class="linenos">478</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable-479"><a href="#DatabaseTable-479"><span class="linenos">479</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;band_structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable-480"><a href="#DatabaseTable-480"><span class="linenos">480</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;density_of_states&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable-481"><a href="#DatabaseTable-481"><span class="linenos">481</span></a>
</span><span id="DatabaseTable-482"><a href="#DatabaseTable-482"><span class="linenos">482</span></a>        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
</span><span id="DatabaseTable-483"><a href="#DatabaseTable-483"><span class="linenos">483</span></a>
</span><span id="DatabaseTable-484"><a href="#DatabaseTable-484"><span class="linenos">484</span></a>            <span class="c1"># Skip the parent class if it doesn&#39;t directly inherit from the</span>
</span><span id="DatabaseTable-485"><a href="#DatabaseTable-485"><span class="linenos">485</span></a>            <span class="c1"># DatabaseTable class. We do this because we want the fundamental</span>
</span><span id="DatabaseTable-486"><a href="#DatabaseTable-486"><span class="linenos">486</span></a>            <span class="c1"># mixins that come with Simmate (such as Structure, Forces, Thermodynamics).</span>
</span><span id="DatabaseTable-487"><a href="#DatabaseTable-487"><span class="linenos">487</span></a>            <span class="c1"># We also skip the classes that don&#39;t have a _from_toolkit method defined.</span>
</span><span id="DatabaseTable-488"><a href="#DatabaseTable-488"><span class="linenos">488</span></a>            <span class="c1"># Right now, this is just the Calculation class that&#39;s skipped with this</span>
</span><span id="DatabaseTable-489"><a href="#DatabaseTable-489"><span class="linenos">489</span></a>            <span class="c1"># condition.</span>
</span><span id="DatabaseTable-490"><a href="#DatabaseTable-490"><span class="linenos">490</span></a>            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">__base__</span> <span class="o">!=</span> <span class="n">DatabaseTable</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;_from_toolkit&quot;</span><span class="p">):</span>
</span><span id="DatabaseTable-491"><a href="#DatabaseTable-491"><span class="linenos">491</span></a>                <span class="k">continue</span>
</span><span id="DatabaseTable-492"><a href="#DatabaseTable-492"><span class="linenos">492</span></a>
</span><span id="DatabaseTable-493"><a href="#DatabaseTable-493"><span class="linenos">493</span></a>            <span class="c1"># Grab the input arguments for the _from_toolkit method. This will</span>
</span><span id="DatabaseTable-494"><a href="#DatabaseTable-494"><span class="linenos">494</span></a>            <span class="c1"># give a list back like... [&#39;cls&#39;, &#39;structure&#39;, &#39;as_dict&#39;]. We</span>
</span><span id="DatabaseTable-495"><a href="#DatabaseTable-495"><span class="linenos">495</span></a>            <span class="c1"># don&#39;t consider as_dict or cls, so we remove those too</span>
</span><span id="DatabaseTable-496"><a href="#DatabaseTable-496"><span class="linenos">496</span></a>            <span class="n">inputs</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
</span><span id="DatabaseTable-497"><a href="#DatabaseTable-497"><span class="linenos">497</span></a>            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;as_dict&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-498"><a href="#DatabaseTable-498"><span class="linenos">498</span></a>            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;cls&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-499"><a href="#DatabaseTable-499"><span class="linenos">499</span></a>
</span><span id="DatabaseTable-500"><a href="#DatabaseTable-500"><span class="linenos">500</span></a>            <span class="c1"># Now inputs is current of list of keys that we need. Next, we go</span>
</span><span id="DatabaseTable-501"><a href="#DatabaseTable-501"><span class="linenos">501</span></a>            <span class="c1"># through our kwargs and see if we have any of these keys, and if so,</span>
</span><span id="DatabaseTable-502"><a href="#DatabaseTable-502"><span class="linenos">502</span></a>            <span class="c1"># grab them.</span>
</span><span id="DatabaseTable-503"><a href="#DatabaseTable-503"><span class="linenos">503</span></a>            <span class="n">matching_inputs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DatabaseTable-504"><a href="#DatabaseTable-504"><span class="linenos">504</span></a>                <span class="n">key</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="DatabaseTable-505"><a href="#DatabaseTable-505"><span class="linenos">505</span></a>            <span class="p">}</span>
</span><span id="DatabaseTable-506"><a href="#DatabaseTable-506"><span class="linenos">506</span></a>
</span><span id="DatabaseTable-507"><a href="#DatabaseTable-507"><span class="linenos">507</span></a>            <span class="c1"># We now pass these inputs to the _from_toolkit. If we&#39;re missing</span>
</span><span id="DatabaseTable-508"><a href="#DatabaseTable-508"><span class="linenos">508</span></a>            <span class="c1"># a required input, this will raise an error here. We only</span>
</span><span id="DatabaseTable-509"><a href="#DatabaseTable-509"><span class="linenos">509</span></a>            <span class="c1"># want the expanded input, so we request a dictionary, not object.</span>
</span><span id="DatabaseTable-510"><a href="#DatabaseTable-510"><span class="linenos">510</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">matching_inputs</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DatabaseTable-511"><a href="#DatabaseTable-511"><span class="linenos">511</span></a>
</span><span id="DatabaseTable-512"><a href="#DatabaseTable-512"><span class="linenos">512</span></a>            <span class="c1"># Now add this mixin&#39;s data to our collective dictionary</span>
</span><span id="DatabaseTable-513"><a href="#DatabaseTable-513"><span class="linenos">513</span></a>            <span class="n">all_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="DatabaseTable-514"><a href="#DatabaseTable-514"><span class="linenos">514</span></a>
</span><span id="DatabaseTable-515"><a href="#DatabaseTable-515"><span class="linenos">515</span></a>        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
</span><span id="DatabaseTable-516"><a href="#DatabaseTable-516"><span class="linenos">516</span></a>        <span class="c1"># return the dictionary</span>
</span><span id="DatabaseTable-517"><a href="#DatabaseTable-517"><span class="linenos">517</span></a>        <span class="k">return</span> <span class="n">all_data</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="DatabaseTable-518"><a href="#DatabaseTable-518"><span class="linenos">518</span></a>
</span><span id="DatabaseTable-519"><a href="#DatabaseTable-519"><span class="linenos">519</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-520"><a href="#DatabaseTable-520"><span class="linenos">520</span></a>    <span class="k">def</span> <span class="nf">_confirm_override</span><span class="p">(</span>
</span><span id="DatabaseTable-521"><a href="#DatabaseTable-521"><span class="linenos">521</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="DatabaseTable-522"><a href="#DatabaseTable-522"><span class="linenos">522</span></a>        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="DatabaseTable-523"><a href="#DatabaseTable-523"><span class="linenos">523</span></a>        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="DatabaseTable-524"><a href="#DatabaseTable-524"><span class="linenos">524</span></a>        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="DatabaseTable-525"><a href="#DatabaseTable-525"><span class="linenos">525</span></a>    <span class="p">):</span>
</span><span id="DatabaseTable-526"><a href="#DatabaseTable-526"><span class="linenos">526</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-527"><a href="#DatabaseTable-527"><span class="linenos">527</span></a><span class="sd">        A utility to make sure the user wants to load new data into their table</span>
</span><span id="DatabaseTable-528"><a href="#DatabaseTable-528"><span class="linenos">528</span></a><span class="sd">        and (if they are using sqlite) that they are aware of the risks of</span>
</span><span id="DatabaseTable-529"><a href="#DatabaseTable-529"><span class="linenos">529</span></a><span class="sd">        parallelizing their loading.</span>
</span><span id="DatabaseTable-530"><a href="#DatabaseTable-530"><span class="linenos">530</span></a>
</span><span id="DatabaseTable-531"><a href="#DatabaseTable-531"><span class="linenos">531</span></a><span class="sd">        This utility should not be called directly, as it is used within</span>
</span><span id="DatabaseTable-532"><a href="#DatabaseTable-532"><span class="linenos">532</span></a><span class="sd">        load_archive and load_remote_archive.</span>
</span><span id="DatabaseTable-533"><a href="#DatabaseTable-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-534"><a href="#DatabaseTable-534"><span class="linenos">534</span></a>        <span class="c1"># first check if the table has data in it already. We raise errors</span>
</span><span id="DatabaseTable-535"><a href="#DatabaseTable-535"><span class="linenos">535</span></a>        <span class="c1"># to stop the user from doing unneccessary and potentiall destructive</span>
</span><span id="DatabaseTable-536"><a href="#DatabaseTable-536"><span class="linenos">536</span></a>        <span class="c1"># downloads</span>
</span><span id="DatabaseTable-537"><a href="#DatabaseTable-537"><span class="linenos">537</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">confirm_override</span><span class="p">:</span>
</span><span id="DatabaseTable-538"><a href="#DatabaseTable-538"><span class="linenos">538</span></a>            <span class="c1"># if the user has a third-party app, we can be more specific with</span>
</span><span id="DatabaseTable-539"><a href="#DatabaseTable-539"><span class="linenos">539</span></a>            <span class="c1"># our error message.</span>
</span><span id="DatabaseTable-540"><a href="#DatabaseTable-540"><span class="linenos">540</span></a>            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
</span><span id="DatabaseTable-541"><a href="#DatabaseTable-541"><span class="linenos">541</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="DatabaseTable-542"><a href="#DatabaseTable-542"><span class="linenos">542</span></a>                    <span class="s2">&quot;It looks like you&#39;re using a third-party database table and &quot;</span>
</span><span id="DatabaseTable-543"><a href="#DatabaseTable-543"><span class="linenos">543</span></a>                    <span class="s2">&quot;that the table already has data in it! This means you already &quot;</span>
</span><span id="DatabaseTable-544"><a href="#DatabaseTable-544"><span class="linenos">544</span></a>                    <span class="s2">&quot;called load_remote_archive and don&#39;t need to do it again. &quot;</span>
</span><span id="DatabaseTable-545"><a href="#DatabaseTable-545"><span class="linenos">545</span></a>                    <span class="s2">&quot;If you are trying reload a newer version of this data, make &quot;</span>
</span><span id="DatabaseTable-546"><a href="#DatabaseTable-546"><span class="linenos">546</span></a>                    <span class="s2">&quot;sure you empty this table first. This can be done by &quot;</span>
</span><span id="DatabaseTable-547"><a href="#DatabaseTable-547"><span class="linenos">547</span></a>                    <span class="s2">&quot;reseting your database or manually deleting all objects &quot;</span>
</span><span id="DatabaseTable-548"><a href="#DatabaseTable-548"><span class="linenos">548</span></a>                    <span class="s2">&quot;with `ExampleTable.objects.all().delete()`&quot;</span>
</span><span id="DatabaseTable-549"><a href="#DatabaseTable-549"><span class="linenos">549</span></a>                <span class="p">)</span>
</span><span id="DatabaseTable-550"><a href="#DatabaseTable-550"><span class="linenos">550</span></a>
</span><span id="DatabaseTable-551"><a href="#DatabaseTable-551"><span class="linenos">551</span></a>            <span class="c1"># otherwise warning the user of overwriting data with matching</span>
</span><span id="DatabaseTable-552"><a href="#DatabaseTable-552"><span class="linenos">552</span></a>            <span class="c1"># primary keys -- and ask them to use confirm_override.</span>
</span><span id="DatabaseTable-553"><a href="#DatabaseTable-553"><span class="linenos">553</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="DatabaseTable-554"><a href="#DatabaseTable-554"><span class="linenos">554</span></a>                <span class="s2">&quot;It looks like this table already has data in it! By loading an &quot;</span>
</span><span id="DatabaseTable-555"><a href="#DatabaseTable-555"><span class="linenos">555</span></a>                <span class="s2">&quot;archive, you could potentially overwrite this data. The most &quot;</span>
</span><span id="DatabaseTable-556"><a href="#DatabaseTable-556"><span class="linenos">556</span></a>                <span class="s2">&quot;common mistake is non-unique primary keys between your current &quot;</span>
</span><span id="DatabaseTable-557"><a href="#DatabaseTable-557"><span class="linenos">557</span></a>                <span class="s2">&quot;data and the archive -- if there is a duplicate primary key, it &quot;</span>
</span><span id="DatabaseTable-558"><a href="#DatabaseTable-558"><span class="linenos">558</span></a>                <span class="s2">&quot;will overwrite your data. If you are confident the data is safe &quot;</span>
</span><span id="DatabaseTable-559"><a href="#DatabaseTable-559"><span class="linenos">559</span></a>                <span class="s2">&quot;to load into your database, run this command again with &quot;</span>
</span><span id="DatabaseTable-560"><a href="#DatabaseTable-560"><span class="linenos">560</span></a>                <span class="s2">&quot;confirm_override=True.&quot;</span>
</span><span id="DatabaseTable-561"><a href="#DatabaseTable-561"><span class="linenos">561</span></a>            <span class="p">)</span>
</span><span id="DatabaseTable-562"><a href="#DatabaseTable-562"><span class="linenos">562</span></a>
</span><span id="DatabaseTable-563"><a href="#DatabaseTable-563"><span class="linenos">563</span></a>        <span class="c1"># Django and Dask can only handle so much for the parallelization</span>
</span><span id="DatabaseTable-564"><a href="#DatabaseTable-564"><span class="linenos">564</span></a>        <span class="c1"># of database writing with SQLite. So if the user has SQLite as their</span>
</span><span id="DatabaseTable-565"><a href="#DatabaseTable-565"><span class="linenos">565</span></a>        <span class="c1"># backend, we need to stop them from using this feature.</span>
</span><span id="DatabaseTable-566"><a href="#DatabaseTable-566"><span class="linenos">566</span></a>        <span class="kn">from</span> <span class="nn">simmate.configuration.django.settings</span> <span class="kn">import</span> <span class="n">DATABASES</span>
</span><span id="DatabaseTable-567"><a href="#DatabaseTable-567"><span class="linenos">567</span></a>
</span><span id="DatabaseTable-568"><a href="#DatabaseTable-568"><span class="linenos">568</span></a>        <span class="k">if</span> <span class="n">parallel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">confirm_sqlite_parallel</span> <span class="ow">and</span> <span class="s2">&quot;sqlite3&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">DATABASES</span><span class="p">):</span>
</span><span id="DatabaseTable-569"><a href="#DatabaseTable-569"><span class="linenos">569</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="DatabaseTable-570"><a href="#DatabaseTable-570"><span class="linenos">570</span></a>                <span class="s2">&quot;It looks like you are trying to run things in parallel but are &quot;</span>
</span><span id="DatabaseTable-571"><a href="#DatabaseTable-571"><span class="linenos">571</span></a>                <span class="s2">&quot;using the default database backend (sqlite3), which is not &quot;</span>
</span><span id="DatabaseTable-572"><a href="#DatabaseTable-572"><span class="linenos">572</span></a>                <span class="s2">&quot;always stable for massively parallel methods. You can still &quot;</span>
</span><span id="DatabaseTable-573"><a href="#DatabaseTable-573"><span class="linenos">573</span></a>                <span class="s2">&quot;do this, but this message serves as a word of caution. &quot;</span>
</span><span id="DatabaseTable-574"><a href="#DatabaseTable-574"><span class="linenos">574</span></a>                <span class="s2">&quot;You If you see error messages pop up saying &#39;database is &quot;</span>
</span><span id="DatabaseTable-575"><a href="#DatabaseTable-575"><span class="linenos">575</span></a>                <span class="s2">&quot;locked&#39;, then your database is not stable at the rate you&#39;re &quot;</span>
</span><span id="DatabaseTable-576"><a href="#DatabaseTable-576"><span class="linenos">576</span></a>                <span class="s2">&quot;trying to write data. This is a sign that you should either &quot;</span>
</span><span id="DatabaseTable-577"><a href="#DatabaseTable-577"><span class="linenos">577</span></a>                <span class="s2">&quot;(1) switch to a different database backend such as Postgres &quot;</span>
</span><span id="DatabaseTable-578"><a href="#DatabaseTable-578"><span class="linenos">578</span></a>                <span class="s2">&quot;or (2) reduce the parallelization of your tasks. If you are &quot;</span>
</span><span id="DatabaseTable-579"><a href="#DatabaseTable-579"><span class="linenos">579</span></a>                <span class="s2">&quot;comfortable with these warnings and know what you&#39;re doing, &quot;</span>
</span><span id="DatabaseTable-580"><a href="#DatabaseTable-580"><span class="linenos">580</span></a>                <span class="s2">&quot;set confirm_sqlite_parallel=True.&quot;</span>
</span><span id="DatabaseTable-581"><a href="#DatabaseTable-581"><span class="linenos">581</span></a>            <span class="p">)</span>
</span><span id="DatabaseTable-582"><a href="#DatabaseTable-582"><span class="linenos">582</span></a>
</span><span id="DatabaseTable-583"><a href="#DatabaseTable-583"><span class="linenos">583</span></a>    <span class="c1"># @transaction.atomic  # We can&#39;t have an atomic transaction if we use Dask</span>
</span><span id="DatabaseTable-584"><a href="#DatabaseTable-584"><span class="linenos">584</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-585"><a href="#DatabaseTable-585"><span class="linenos">585</span></a>    <span class="k">def</span> <span class="nf">load_archive</span><span class="p">(</span>
</span><span id="DatabaseTable-586"><a href="#DatabaseTable-586"><span class="linenos">586</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="DatabaseTable-587"><a href="#DatabaseTable-587"><span class="linenos">587</span></a>        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DatabaseTable-588"><a href="#DatabaseTable-588"><span class="linenos">588</span></a>        <span class="n">delete_on_completion</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable-589"><a href="#DatabaseTable-589"><span class="linenos">589</span></a>        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable-590"><a href="#DatabaseTable-590"><span class="linenos">590</span></a>        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable-591"><a href="#DatabaseTable-591"><span class="linenos">591</span></a>        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable-592"><a href="#DatabaseTable-592"><span class="linenos">592</span></a>    <span class="p">):</span>
</span><span id="DatabaseTable-593"><a href="#DatabaseTable-593"><span class="linenos">593</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-594"><a href="#DatabaseTable-594"><span class="linenos">594</span></a><span class="sd">        Reads a compressed zip file made by `objects.to_archive` and loads the data</span>
</span><span id="DatabaseTable-595"><a href="#DatabaseTable-595"><span class="linenos">595</span></a><span class="sd">        back into the Simmate database.</span>
</span><span id="DatabaseTable-596"><a href="#DatabaseTable-596"><span class="linenos">596</span></a>
</span><span id="DatabaseTable-597"><a href="#DatabaseTable-597"><span class="linenos">597</span></a><span class="sd">        Typically, users won&#39;t call this method directly, but instead use the</span>
</span><span id="DatabaseTable-598"><a href="#DatabaseTable-598"><span class="linenos">598</span></a><span class="sd">        `load_remote_archive` method, which handles downloading the archive</span>
</span><span id="DatabaseTable-599"><a href="#DatabaseTable-599"><span class="linenos">599</span></a><span class="sd">        file from the Simmate website for you.</span>
</span><span id="DatabaseTable-600"><a href="#DatabaseTable-600"><span class="linenos">600</span></a>
</span><span id="DatabaseTable-601"><a href="#DatabaseTable-601"><span class="linenos">601</span></a><span class="sd">        #### Parameters</span>
</span><span id="DatabaseTable-602"><a href="#DatabaseTable-602"><span class="linenos">602</span></a>
</span><span id="DatabaseTable-603"><a href="#DatabaseTable-603"><span class="linenos">603</span></a><span class="sd">        - `filename`:</span>
</span><span id="DatabaseTable-604"><a href="#DatabaseTable-604"><span class="linenos">604</span></a><span class="sd">            The filename to write the zip file to. By defualt, None will try to</span>
</span><span id="DatabaseTable-605"><a href="#DatabaseTable-605"><span class="linenos">605</span></a><span class="sd">            find a file named &quot;MyExampleTableName-2022-01-25.zip&quot;, where the date</span>
</span><span id="DatabaseTable-606"><a href="#DatabaseTable-606"><span class="linenos">606</span></a><span class="sd">            corresponds to version/timestamp. If multiple files match this format</span>
</span><span id="DatabaseTable-607"><a href="#DatabaseTable-607"><span class="linenos">607</span></a><span class="sd">            the most recent date will be used.</span>
</span><span id="DatabaseTable-608"><a href="#DatabaseTable-608"><span class="linenos">608</span></a>
</span><span id="DatabaseTable-609"><a href="#DatabaseTable-609"><span class="linenos">609</span></a><span class="sd">        - `delete_on_completion`:</span>
</span><span id="DatabaseTable-610"><a href="#DatabaseTable-610"><span class="linenos">610</span></a><span class="sd">            Whether to delete the archive file once all data is loaded into the</span>
</span><span id="DatabaseTable-611"><a href="#DatabaseTable-611"><span class="linenos">611</span></a><span class="sd">            database. Defaults to False</span>
</span><span id="DatabaseTable-612"><a href="#DatabaseTable-612"><span class="linenos">612</span></a>
</span><span id="DatabaseTable-613"><a href="#DatabaseTable-613"><span class="linenos">613</span></a><span class="sd">        - `confirm_override`:</span>
</span><span id="DatabaseTable-614"><a href="#DatabaseTable-614"><span class="linenos">614</span></a><span class="sd">            If the table already has data in it, the user must take particular</span>
</span><span id="DatabaseTable-615"><a href="#DatabaseTable-615"><span class="linenos">615</span></a><span class="sd">            care to downloading new data. This flag makes sure the user has</span>
</span><span id="DatabaseTable-616"><a href="#DatabaseTable-616"><span class="linenos">616</span></a><span class="sd">            made the proper checks to run this action. Default is False.</span>
</span><span id="DatabaseTable-617"><a href="#DatabaseTable-617"><span class="linenos">617</span></a>
</span><span id="DatabaseTable-618"><a href="#DatabaseTable-618"><span class="linenos">618</span></a><span class="sd">        - `parallel`:</span>
</span><span id="DatabaseTable-619"><a href="#DatabaseTable-619"><span class="linenos">619</span></a><span class="sd">            Whether to load the data in parallel. If true, this will start</span>
</span><span id="DatabaseTable-620"><a href="#DatabaseTable-620"><span class="linenos">620</span></a><span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
</span><span id="DatabaseTable-621"><a href="#DatabaseTable-621"><span class="linenos">621</span></a><span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
</span><span id="DatabaseTable-622"><a href="#DatabaseTable-622"><span class="linenos">622</span></a><span class="sd">            large datasets into the dataset. Default is False.</span>
</span><span id="DatabaseTable-623"><a href="#DatabaseTable-623"><span class="linenos">623</span></a>
</span><span id="DatabaseTable-624"><a href="#DatabaseTable-624"><span class="linenos">624</span></a><span class="sd">        - `confirm_sqlite_parallel`:</span>
</span><span id="DatabaseTable-625"><a href="#DatabaseTable-625"><span class="linenos">625</span></a><span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
</span><span id="DatabaseTable-626"><a href="#DatabaseTable-626"><span class="linenos">626</span></a><span class="sd">            knows what they are doing and know the risks of parallelization.</span>
</span><span id="DatabaseTable-627"><a href="#DatabaseTable-627"><span class="linenos">627</span></a><span class="sd">            Default is False.</span>
</span><span id="DatabaseTable-628"><a href="#DatabaseTable-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-629"><a href="#DatabaseTable-629"><span class="linenos">629</span></a>
</span><span id="DatabaseTable-630"><a href="#DatabaseTable-630"><span class="linenos">630</span></a>        <span class="c1"># make sure the user actually wants to do this!</span>
</span><span id="DatabaseTable-631"><a href="#DatabaseTable-631"><span class="linenos">631</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
</span><span id="DatabaseTable-632"><a href="#DatabaseTable-632"><span class="linenos">632</span></a>            <span class="n">confirm_override</span><span class="p">,</span>
</span><span id="DatabaseTable-633"><a href="#DatabaseTable-633"><span class="linenos">633</span></a>            <span class="n">parallel</span><span class="p">,</span>
</span><span id="DatabaseTable-634"><a href="#DatabaseTable-634"><span class="linenos">634</span></a>            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
</span><span id="DatabaseTable-635"><a href="#DatabaseTable-635"><span class="linenos">635</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable-636"><a href="#DatabaseTable-636"><span class="linenos">636</span></a>
</span><span id="DatabaseTable-637"><a href="#DatabaseTable-637"><span class="linenos">637</span></a>        <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="DatabaseTable-638"><a href="#DatabaseTable-638"><span class="linenos">638</span></a>        <span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span> <span class="k">as</span> <span class="n">ToolkitStructure</span>
</span><span id="DatabaseTable-639"><a href="#DatabaseTable-639"><span class="linenos">639</span></a>
</span><span id="DatabaseTable-640"><a href="#DatabaseTable-640"><span class="linenos">640</span></a>        <span class="c1"># generate the file name if one wasn&#39;t given</span>
</span><span id="DatabaseTable-641"><a href="#DatabaseTable-641"><span class="linenos">641</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="DatabaseTable-642"><a href="#DatabaseTable-642"><span class="linenos">642</span></a>            <span class="c1"># The name will be something like &quot;MyExampleTable-2022-01-25.zip&quot;.</span>
</span><span id="DatabaseTable-643"><a href="#DatabaseTable-643"><span class="linenos">643</span></a>            <span class="c1"># We go through all files that match &quot;MyExampleTable-*.zip&quot; and then</span>
</span><span id="DatabaseTable-644"><a href="#DatabaseTable-644"><span class="linenos">644</span></a>            <span class="c1"># grab the most recent date.</span>
</span><span id="DatabaseTable-645"><a href="#DatabaseTable-645"><span class="linenos">645</span></a>            <span class="n">matching_files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DatabaseTable-646"><a href="#DatabaseTable-646"><span class="linenos">646</span></a>                <span class="n">file</span>
</span><span id="DatabaseTable-647"><a href="#DatabaseTable-647"><span class="linenos">647</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
</span><span id="DatabaseTable-648"><a href="#DatabaseTable-648"><span class="linenos">648</span></a>                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-649"><a href="#DatabaseTable-649"><span class="linenos">649</span></a>            <span class="p">]</span>
</span><span id="DatabaseTable-650"><a href="#DatabaseTable-650"><span class="linenos">650</span></a>            <span class="c1"># make sure there is at least one file</span>
</span><span id="DatabaseTable-651"><a href="#DatabaseTable-651"><span class="linenos">651</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_files</span><span class="p">:</span>
</span><span id="DatabaseTable-652"><a href="#DatabaseTable-652"><span class="linenos">652</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
</span><span id="DatabaseTable-653"><a href="#DatabaseTable-653"><span class="linenos">653</span></a>                    <span class="sa">f</span><span class="s2">&quot;No file found matching the </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">-*.zip format&quot;</span>
</span><span id="DatabaseTable-654"><a href="#DatabaseTable-654"><span class="linenos">654</span></a>                <span class="p">)</span>
</span><span id="DatabaseTable-655"><a href="#DatabaseTable-655"><span class="linenos">655</span></a>            <span class="c1"># sort the files by date and grab the first</span>
</span><span id="DatabaseTable-656"><a href="#DatabaseTable-656"><span class="linenos">656</span></a>            <span class="n">matching_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DatabaseTable-657"><a href="#DatabaseTable-657"><span class="linenos">657</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">matching_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DatabaseTable-658"><a href="#DatabaseTable-658"><span class="linenos">658</span></a>
</span><span id="DatabaseTable-659"><a href="#DatabaseTable-659"><span class="linenos">659</span></a>        <span class="c1"># Turn the filename into the full path -- which makes a number of</span>
</span><span id="DatabaseTable-660"><a href="#DatabaseTable-660"><span class="linenos">660</span></a>        <span class="c1"># manipulations easier below.</span>
</span><span id="DatabaseTable-661"><a href="#DatabaseTable-661"><span class="linenos">661</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="DatabaseTable-662"><a href="#DatabaseTable-662"><span class="linenos">662</span></a>
</span><span id="DatabaseTable-663"><a href="#DatabaseTable-663"><span class="linenos">663</span></a>        <span class="c1"># uncompress the zip file to the same directory that it is located in</span>
</span><span id="DatabaseTable-664"><a href="#DatabaseTable-664"><span class="linenos">664</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
</span><span id="DatabaseTable-665"><a href="#DatabaseTable-665"><span class="linenos">665</span></a>            <span class="n">filename</span><span class="p">,</span>
</span><span id="DatabaseTable-666"><a href="#DatabaseTable-666"><span class="linenos">666</span></a>            <span class="n">extract_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
</span><span id="DatabaseTable-667"><a href="#DatabaseTable-667"><span class="linenos">667</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable-668"><a href="#DatabaseTable-668"><span class="linenos">668</span></a>
</span><span id="DatabaseTable-669"><a href="#DatabaseTable-669"><span class="linenos">669</span></a>        <span class="c1"># We will now have a csv file of the same name, which we load into</span>
</span><span id="DatabaseTable-670"><a href="#DatabaseTable-670"><span class="linenos">670</span></a>        <span class="c1"># a pandas dataframe</span>
</span><span id="DatabaseTable-671"><a href="#DatabaseTable-671"><span class="linenos">671</span></a>        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-672"><a href="#DatabaseTable-672"><span class="linenos">672</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</span><span id="DatabaseTable-673"><a href="#DatabaseTable-673"><span class="linenos">673</span></a>
</span><span id="DatabaseTable-674"><a href="#DatabaseTable-674"><span class="linenos">674</span></a>        <span class="c1"># BUG: NaN values throw errors when read into SQL databases, so we</span>
</span><span id="DatabaseTable-675"><a href="#DatabaseTable-675"><span class="linenos">675</span></a>        <span class="c1"># convert all NaN entries to None. This hacky line was taken from</span>
</span><span id="DatabaseTable-676"><a href="#DatabaseTable-676"><span class="linenos">676</span></a>        <span class="c1">#   https://stackoverflow.com/questions/39279824/</span>
</span><span id="DatabaseTable-677"><a href="#DatabaseTable-677"><span class="linenos">677</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable-678"><a href="#DatabaseTable-678"><span class="linenos">678</span></a>
</span><span id="DatabaseTable-679"><a href="#DatabaseTable-679"><span class="linenos">679</span></a>        <span class="c1"># convert the dataframe to a list of dictionaries that we will iterate</span>
</span><span id="DatabaseTable-680"><a href="#DatabaseTable-680"><span class="linenos">680</span></a>        <span class="c1"># through.</span>
</span><span id="DatabaseTable-681"><a href="#DatabaseTable-681"><span class="linenos">681</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-682"><a href="#DatabaseTable-682"><span class="linenos">682</span></a>
</span><span id="DatabaseTable-683"><a href="#DatabaseTable-683"><span class="linenos">683</span></a>        <span class="c1"># to enable parallelization, we define a function to load a single</span>
</span><span id="DatabaseTable-684"><a href="#DatabaseTable-684"><span class="linenos">684</span></a>        <span class="c1"># entry (or row) of data. This allows us to submit the function to Dask.</span>
</span><span id="DatabaseTable-685"><a href="#DatabaseTable-685"><span class="linenos">685</span></a>        <span class="k">def</span> <span class="nf">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
</span><span id="DatabaseTable-686"><a href="#DatabaseTable-686"><span class="linenos">686</span></a>
</span><span id="DatabaseTable-687"><a href="#DatabaseTable-687"><span class="linenos">687</span></a>            <span class="c1"># For all entries, convert the structure_string to a toolkit structure</span>
</span><span id="DatabaseTable-688"><a href="#DatabaseTable-688"><span class="linenos">688</span></a>            <span class="k">if</span> <span class="s2">&quot;structure_string&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
</span><span id="DatabaseTable-689"><a href="#DatabaseTable-689"><span class="linenos">689</span></a>                <span class="n">structure_str</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure_string&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-690"><a href="#DatabaseTable-690"><span class="linenos">690</span></a>                <span class="n">structure</span> <span class="o">=</span> <span class="n">ToolkitStructure</span><span class="o">.</span><span class="n">from_database_string</span><span class="p">(</span><span class="n">structure_str</span><span class="p">)</span>
</span><span id="DatabaseTable-691"><a href="#DatabaseTable-691"><span class="linenos">691</span></a>                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">structure</span>
</span><span id="DatabaseTable-692"><a href="#DatabaseTable-692"><span class="linenos">692</span></a>            <span class="c1"># OPTIMIZE: is there a better way to do decide which entries need to be</span>
</span><span id="DatabaseTable-693"><a href="#DatabaseTable-693"><span class="linenos">693</span></a>            <span class="c1"># converted to toolkit objects? This code may be better placed in</span>
</span><span id="DatabaseTable-694"><a href="#DatabaseTable-694"><span class="linenos">694</span></a>            <span class="c1"># base_data_type methods (e.g. a `from_base_info` method for each)</span>
</span><span id="DatabaseTable-695"><a href="#DatabaseTable-695"><span class="linenos">695</span></a>
</span><span id="DatabaseTable-696"><a href="#DatabaseTable-696"><span class="linenos">696</span></a>            <span class="n">entry_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">)</span>
</span><span id="DatabaseTable-697"><a href="#DatabaseTable-697"><span class="linenos">697</span></a>            <span class="n">entry_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="DatabaseTable-698"><a href="#DatabaseTable-698"><span class="linenos">698</span></a>
</span><span id="DatabaseTable-699"><a href="#DatabaseTable-699"><span class="linenos">699</span></a>        <span class="c1"># now iterate through all entries to save them to the database</span>
</span><span id="DatabaseTable-700"><a href="#DatabaseTable-700"><span class="linenos">700</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="DatabaseTable-701"><a href="#DatabaseTable-701"><span class="linenos">701</span></a>            <span class="c1"># If user doesn&#39;t want parallelization, we run these in the main</span>
</span><span id="DatabaseTable-702"><a href="#DatabaseTable-702"><span class="linenos">702</span></a>            <span class="c1"># thread and monitor progress with tqdm</span>
</span><span id="DatabaseTable-703"><a href="#DatabaseTable-703"><span class="linenos">703</span></a>            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
</span><span id="DatabaseTable-704"><a href="#DatabaseTable-704"><span class="linenos">704</span></a>                <span class="n">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="DatabaseTable-705"><a href="#DatabaseTable-705"><span class="linenos">705</span></a>        <span class="c1"># otherwise we use dask to submit these in batches!</span>
</span><span id="DatabaseTable-706"><a href="#DatabaseTable-706"><span class="linenos">706</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DatabaseTable-707"><a href="#DatabaseTable-707"><span class="linenos">707</span></a>
</span><span id="DatabaseTable-708"><a href="#DatabaseTable-708"><span class="linenos">708</span></a>            <span class="kn">from</span> <span class="nn">simmate.configuration.dask</span> <span class="kn">import</span> <span class="n">batch_submit</span>
</span><span id="DatabaseTable-709"><a href="#DatabaseTable-709"><span class="linenos">709</span></a>
</span><span id="DatabaseTable-710"><a href="#DatabaseTable-710"><span class="linenos">710</span></a>            <span class="n">batch_submit</span><span class="p">(</span>
</span><span id="DatabaseTable-711"><a href="#DatabaseTable-711"><span class="linenos">711</span></a>                <span class="n">function</span><span class="o">=</span><span class="n">load_single_entry</span><span class="p">,</span>
</span><span id="DatabaseTable-712"><a href="#DatabaseTable-712"><span class="linenos">712</span></a>                <span class="n">args_list</span><span class="o">=</span><span class="n">entries</span><span class="p">,</span>
</span><span id="DatabaseTable-713"><a href="#DatabaseTable-713"><span class="linenos">713</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span>
</span><span id="DatabaseTable-714"><a href="#DatabaseTable-714"><span class="linenos">714</span></a>            <span class="p">)</span>
</span><span id="DatabaseTable-715"><a href="#DatabaseTable-715"><span class="linenos">715</span></a>
</span><span id="DatabaseTable-716"><a href="#DatabaseTable-716"><span class="linenos">716</span></a>        <span class="c1"># We can now delete the files. The zip file is only deleted if requested.</span>
</span><span id="DatabaseTable-717"><a href="#DatabaseTable-717"><span class="linenos">717</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</span><span id="DatabaseTable-718"><a href="#DatabaseTable-718"><span class="linenos">718</span></a>        <span class="k">if</span> <span class="n">delete_on_completion</span><span class="p">:</span>
</span><span id="DatabaseTable-719"><a href="#DatabaseTable-719"><span class="linenos">719</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># the zip archive</span>
</span><span id="DatabaseTable-720"><a href="#DatabaseTable-720"><span class="linenos">720</span></a>
</span><span id="DatabaseTable-721"><a href="#DatabaseTable-721"><span class="linenos">721</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-722"><a href="#DatabaseTable-722"><span class="linenos">722</span></a>    <span class="k">def</span> <span class="nf">load_remote_archive</span><span class="p">(</span>
</span><span id="DatabaseTable-723"><a href="#DatabaseTable-723"><span class="linenos">723</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="DatabaseTable-724"><a href="#DatabaseTable-724"><span class="linenos">724</span></a>        <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DatabaseTable-725"><a href="#DatabaseTable-725"><span class="linenos">725</span></a>        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable-726"><a href="#DatabaseTable-726"><span class="linenos">726</span></a>        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable-727"><a href="#DatabaseTable-727"><span class="linenos">727</span></a>        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable-728"><a href="#DatabaseTable-728"><span class="linenos">728</span></a>    <span class="p">):</span>
</span><span id="DatabaseTable-729"><a href="#DatabaseTable-729"><span class="linenos">729</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-730"><a href="#DatabaseTable-730"><span class="linenos">730</span></a><span class="sd">        Downloads a compressed zip file made by `objects.to_archive` and loads</span>
</span><span id="DatabaseTable-731"><a href="#DatabaseTable-731"><span class="linenos">731</span></a><span class="sd">        the data back into the Simmate database.</span>
</span><span id="DatabaseTable-732"><a href="#DatabaseTable-732"><span class="linenos">732</span></a>
</span><span id="DatabaseTable-733"><a href="#DatabaseTable-733"><span class="linenos">733</span></a><span class="sd">        This method should only be called once -- when you have a completely</span>
</span><span id="DatabaseTable-734"><a href="#DatabaseTable-734"><span class="linenos">734</span></a><span class="sd">        empty database. After this call, all data will be stored locally and</span>
</span><span id="DatabaseTable-735"><a href="#DatabaseTable-735"><span class="linenos">735</span></a><span class="sd">        you don&#39;t need to call this method again (even accross python sessions).</span>
</span><span id="DatabaseTable-736"><a href="#DatabaseTable-736"><span class="linenos">736</span></a>
</span><span id="DatabaseTable-737"><a href="#DatabaseTable-737"><span class="linenos">737</span></a><span class="sd">        #### Parameters</span>
</span><span id="DatabaseTable-738"><a href="#DatabaseTable-738"><span class="linenos">738</span></a>
</span><span id="DatabaseTable-739"><a href="#DatabaseTable-739"><span class="linenos">739</span></a><span class="sd">        - `remote_archive_link`:</span>
</span><span id="DatabaseTable-740"><a href="#DatabaseTable-740"><span class="linenos">740</span></a><span class="sd">            The URL for that the archive will be downloaded from. If not supplied,</span>
</span><span id="DatabaseTable-741"><a href="#DatabaseTable-741"><span class="linenos">741</span></a><span class="sd">            it will default to the table&#39;s remote_archive_link attribute.</span>
</span><span id="DatabaseTable-742"><a href="#DatabaseTable-742"><span class="linenos">742</span></a>
</span><span id="DatabaseTable-743"><a href="#DatabaseTable-743"><span class="linenos">743</span></a><span class="sd">        - `confirm_override`:</span>
</span><span id="DatabaseTable-744"><a href="#DatabaseTable-744"><span class="linenos">744</span></a><span class="sd">            If the table already has data in it, the user must take particular</span>
</span><span id="DatabaseTable-745"><a href="#DatabaseTable-745"><span class="linenos">745</span></a><span class="sd">            care to downloading new data. This flag makes sure the user has</span>
</span><span id="DatabaseTable-746"><a href="#DatabaseTable-746"><span class="linenos">746</span></a><span class="sd">            made the proper checks to run this action.</span>
</span><span id="DatabaseTable-747"><a href="#DatabaseTable-747"><span class="linenos">747</span></a>
</span><span id="DatabaseTable-748"><a href="#DatabaseTable-748"><span class="linenos">748</span></a><span class="sd">        - `parallel`:</span>
</span><span id="DatabaseTable-749"><a href="#DatabaseTable-749"><span class="linenos">749</span></a><span class="sd">            Whether to load the data in parallel. If true, this will start</span>
</span><span id="DatabaseTable-750"><a href="#DatabaseTable-750"><span class="linenos">750</span></a><span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
</span><span id="DatabaseTable-751"><a href="#DatabaseTable-751"><span class="linenos">751</span></a><span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
</span><span id="DatabaseTable-752"><a href="#DatabaseTable-752"><span class="linenos">752</span></a><span class="sd">            large datasets into the dataset. Default is False.</span>
</span><span id="DatabaseTable-753"><a href="#DatabaseTable-753"><span class="linenos">753</span></a>
</span><span id="DatabaseTable-754"><a href="#DatabaseTable-754"><span class="linenos">754</span></a><span class="sd">        - `confirm_sqlite_parallel`:</span>
</span><span id="DatabaseTable-755"><a href="#DatabaseTable-755"><span class="linenos">755</span></a><span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
</span><span id="DatabaseTable-756"><a href="#DatabaseTable-756"><span class="linenos">756</span></a><span class="sd">            knows what they are doing and know the risks of parallelization.</span>
</span><span id="DatabaseTable-757"><a href="#DatabaseTable-757"><span class="linenos">757</span></a><span class="sd">            Default is False.</span>
</span><span id="DatabaseTable-758"><a href="#DatabaseTable-758"><span class="linenos">758</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-759"><a href="#DatabaseTable-759"><span class="linenos">759</span></a>
</span><span id="DatabaseTable-760"><a href="#DatabaseTable-760"><span class="linenos">760</span></a>        <span class="c1"># make sure the user actually wants to do this!</span>
</span><span id="DatabaseTable-761"><a href="#DatabaseTable-761"><span class="linenos">761</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
</span><span id="DatabaseTable-762"><a href="#DatabaseTable-762"><span class="linenos">762</span></a>            <span class="n">confirm_override</span><span class="p">,</span>
</span><span id="DatabaseTable-763"><a href="#DatabaseTable-763"><span class="linenos">763</span></a>            <span class="n">parallel</span><span class="p">,</span>
</span><span id="DatabaseTable-764"><a href="#DatabaseTable-764"><span class="linenos">764</span></a>            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
</span><span id="DatabaseTable-765"><a href="#DatabaseTable-765"><span class="linenos">765</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable-766"><a href="#DatabaseTable-766"><span class="linenos">766</span></a>
</span><span id="DatabaseTable-767"><a href="#DatabaseTable-767"><span class="linenos">767</span></a>        <span class="c1"># confirm that we have a link to download from</span>
</span><span id="DatabaseTable-768"><a href="#DatabaseTable-768"><span class="linenos">768</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">remote_archive_link</span><span class="p">:</span>
</span><span id="DatabaseTable-769"><a href="#DatabaseTable-769"><span class="linenos">769</span></a>            <span class="c1"># if no link was given we take the input value from class attribute</span>
</span><span id="DatabaseTable-770"><a href="#DatabaseTable-770"><span class="linenos">770</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span><span class="p">:</span>
</span><span id="DatabaseTable-771"><a href="#DatabaseTable-771"><span class="linenos">771</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="DatabaseTable-772"><a href="#DatabaseTable-772"><span class="linenos">772</span></a>                    <span class="s2">&quot;This table does not have a default link to load the archive &quot;</span>
</span><span id="DatabaseTable-773"><a href="#DatabaseTable-773"><span class="linenos">773</span></a>                    <span class="s2">&quot; from. You must provide a remote_archive_link.&quot;</span>
</span><span id="DatabaseTable-774"><a href="#DatabaseTable-774"><span class="linenos">774</span></a>                <span class="p">)</span>
</span><span id="DatabaseTable-775"><a href="#DatabaseTable-775"><span class="linenos">775</span></a>            <span class="n">remote_archive_link</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span>
</span><span id="DatabaseTable-776"><a href="#DatabaseTable-776"><span class="linenos">776</span></a>
</span><span id="DatabaseTable-777"><a href="#DatabaseTable-777"><span class="linenos">777</span></a>        <span class="c1"># tell the user where the data comes from</span>
</span><span id="DatabaseTable-778"><a href="#DatabaseTable-778"><span class="linenos">778</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
</span><span id="DatabaseTable-779"><a href="#DatabaseTable-779"><span class="linenos">779</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="DatabaseTable-780"><a href="#DatabaseTable-780"><span class="linenos">780</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">WARNING: this data is NOT from the Simmate team, so be sure &quot;</span>
</span><span id="DatabaseTable-781"><a href="#DatabaseTable-781"><span class="linenos">781</span></a>                <span class="s2">&quot;to visit the provider&#39;s website and to cite their work.&quot;</span>
</span><span id="DatabaseTable-782"><a href="#DatabaseTable-782"><span class="linenos">782</span></a>                <span class="sa">f</span><span class="s2">&quot; This data is from </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2"> and the following paper &quot;</span>
</span><span id="DatabaseTable-783"><a href="#DatabaseTable-783"><span class="linenos">783</span></a>                <span class="sa">f</span><span class="s2">&quot;should be cited: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source_doi</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DatabaseTable-784"><a href="#DatabaseTable-784"><span class="linenos">784</span></a>            <span class="p">)</span>
</span><span id="DatabaseTable-785"><a href="#DatabaseTable-785"><span class="linenos">785</span></a>
</span><span id="DatabaseTable-786"><a href="#DatabaseTable-786"><span class="linenos">786</span></a>        <span class="c1"># Predetermine the file name, which is just the ending of the URL</span>
</span><span id="DatabaseTable-787"><a href="#DatabaseTable-787"><span class="linenos">787</span></a>        <span class="n">archive_filename</span> <span class="o">=</span> <span class="n">remote_archive_link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DatabaseTable-788"><a href="#DatabaseTable-788"><span class="linenos">788</span></a>
</span><span id="DatabaseTable-789"><a href="#DatabaseTable-789"><span class="linenos">789</span></a>        <span class="c1"># Download the archive zip file from the URL to the current working dir</span>
</span><span id="DatabaseTable-790"><a href="#DatabaseTable-790"><span class="linenos">790</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading archive file...&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-791"><a href="#DatabaseTable-791"><span class="linenos">791</span></a>        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">remote_archive_link</span><span class="p">,</span> <span class="n">archive_filename</span><span class="p">)</span>
</span><span id="DatabaseTable-792"><a href="#DatabaseTable-792"><span class="linenos">792</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-793"><a href="#DatabaseTable-793"><span class="linenos">793</span></a>
</span><span id="DatabaseTable-794"><a href="#DatabaseTable-794"><span class="linenos">794</span></a>        <span class="c1"># now that the archive is downloaded, we can load it into our db</span>
</span><span id="DatabaseTable-795"><a href="#DatabaseTable-795"><span class="linenos">795</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading data into Simmate database...&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-796"><a href="#DatabaseTable-796"><span class="linenos">796</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">load_archive</span><span class="p">(</span>
</span><span id="DatabaseTable-797"><a href="#DatabaseTable-797"><span class="linenos">797</span></a>            <span class="n">archive_filename</span><span class="p">,</span>
</span><span id="DatabaseTable-798"><a href="#DatabaseTable-798"><span class="linenos">798</span></a>            <span class="n">delete_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DatabaseTable-799"><a href="#DatabaseTable-799"><span class="linenos">799</span></a>            <span class="n">confirm_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
</span><span id="DatabaseTable-800"><a href="#DatabaseTable-800"><span class="linenos">800</span></a>            <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
</span><span id="DatabaseTable-801"><a href="#DatabaseTable-801"><span class="linenos">801</span></a>            <span class="n">confirm_sqlite_parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
</span><span id="DatabaseTable-802"><a href="#DatabaseTable-802"><span class="linenos">802</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable-803"><a href="#DatabaseTable-803"><span class="linenos">803</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable-804"><a href="#DatabaseTable-804"><span class="linenos">804</span></a>
</span><span id="DatabaseTable-805"><a href="#DatabaseTable-805"><span class="linenos">805</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-806"><a href="#DatabaseTable-806"><span class="linenos">806</span></a>    <span class="k">def</span> <span class="nf">get_column_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DatabaseTable-807"><a href="#DatabaseTable-807"><span class="linenos">807</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-808"><a href="#DatabaseTable-808"><span class="linenos">808</span></a><span class="sd">        Returns a list of all the column names for this table and indicates which</span>
</span><span id="DatabaseTable-809"><a href="#DatabaseTable-809"><span class="linenos">809</span></a><span class="sd">        columns are related to other tables. This is primarily used to help</span>
</span><span id="DatabaseTable-810"><a href="#DatabaseTable-810"><span class="linenos">810</span></a><span class="sd">        view what data is available.</span>
</span><span id="DatabaseTable-811"><a href="#DatabaseTable-811"><span class="linenos">811</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-812"><a href="#DatabaseTable-812"><span class="linenos">812</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()]</span>
</span><span id="DatabaseTable-813"><a href="#DatabaseTable-813"><span class="linenos">813</span></a>
</span><span id="DatabaseTable-814"><a href="#DatabaseTable-814"><span class="linenos">814</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-815"><a href="#DatabaseTable-815"><span class="linenos">815</span></a>    <span class="k">def</span> <span class="nf">show_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="DatabaseTable-816"><a href="#DatabaseTable-816"><span class="linenos">816</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-817"><a href="#DatabaseTable-817"><span class="linenos">817</span></a><span class="sd">        Prints a list of all the column names for this table and indicates which</span>
</span><span id="DatabaseTable-818"><a href="#DatabaseTable-818"><span class="linenos">818</span></a><span class="sd">        columns are related to other tables. This is primarily used to help users</span>
</span><span id="DatabaseTable-819"><a href="#DatabaseTable-819"><span class="linenos">819</span></a><span class="sd">        interactively view what data is available.</span>
</span><span id="DatabaseTable-820"><a href="#DatabaseTable-820"><span class="linenos">820</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-821"><a href="#DatabaseTable-821"><span class="linenos">821</span></a>        <span class="c1"># Iterate through and grab the columns. Note we don&#39;t use get_column_names</span>
</span><span id="DatabaseTable-822"><a href="#DatabaseTable-822"><span class="linenos">822</span></a>        <span class="c1"># here because we are attaching relation data as well.</span>
</span><span id="DatabaseTable-823"><a href="#DatabaseTable-823"><span class="linenos">823</span></a>        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DatabaseTable-824"><a href="#DatabaseTable-824"><span class="linenos">824</span></a>            <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (relation to </span><span class="si">{</span><span class="n">column</span><span class="o">.</span><span class="n">related_model</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="DatabaseTable-825"><a href="#DatabaseTable-825"><span class="linenos">825</span></a>            <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">is_relation</span>
</span><span id="DatabaseTable-826"><a href="#DatabaseTable-826"><span class="linenos">826</span></a>            <span class="k">else</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
</span><span id="DatabaseTable-827"><a href="#DatabaseTable-827"><span class="linenos">827</span></a>            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
</span><span id="DatabaseTable-828"><a href="#DatabaseTable-828"><span class="linenos">828</span></a>        <span class="p">]</span>
</span><span id="DatabaseTable-829"><a href="#DatabaseTable-829"><span class="linenos">829</span></a>
</span><span id="DatabaseTable-830"><a href="#DatabaseTable-830"><span class="linenos">830</span></a>        <span class="c1"># Then use yaml to make the printout pretty (no quotes and separate lines)</span>
</span><span id="DatabaseTable-831"><a href="#DatabaseTable-831"><span class="linenos">831</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>
</span><span id="DatabaseTable-832"><a href="#DatabaseTable-832"><span class="linenos">832</span></a>
</span><span id="DatabaseTable-833"><a href="#DatabaseTable-833"><span class="linenos">833</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-834"><a href="#DatabaseTable-834"><span class="linenos">834</span></a>    <span class="k">def</span> <span class="nf">get_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>  <span class="c1"># -&gt; List[DatabaseTable]</span>
</span><span id="DatabaseTable-835"><a href="#DatabaseTable-835"><span class="linenos">835</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-836"><a href="#DatabaseTable-836"><span class="linenos">836</span></a><span class="sd">        Grabs the mix-in Tables that were used to make this class. This will</span>
</span><span id="DatabaseTable-837"><a href="#DatabaseTable-837"><span class="linenos">837</span></a><span class="sd">        be mix-ins like Structure, Forces, etc. from the</span>
</span><span id="DatabaseTable-838"><a href="#DatabaseTable-838"><span class="linenos">838</span></a><span class="sd">        `simmate.database.base_data_types` module.</span>
</span><span id="DatabaseTable-839"><a href="#DatabaseTable-839"><span class="linenos">839</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-840"><a href="#DatabaseTable-840"><span class="linenos">840</span></a>        <span class="c1"># this must be imported locally because it depends on all other classes</span>
</span><span id="DatabaseTable-841"><a href="#DatabaseTable-841"><span class="linenos">841</span></a>        <span class="c1"># from this module -- and will create circular import issues if outside</span>
</span><span id="DatabaseTable-842"><a href="#DatabaseTable-842"><span class="linenos">842</span></a>        <span class="kn">from</span> <span class="nn">simmate.database</span> <span class="kn">import</span> <span class="n">base_data_types</span> <span class="k">as</span> <span class="n">simmate_mixins</span>
</span><span id="DatabaseTable-843"><a href="#DatabaseTable-843"><span class="linenos">843</span></a>
</span><span id="DatabaseTable-844"><a href="#DatabaseTable-844"><span class="linenos">844</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="DatabaseTable-845"><a href="#DatabaseTable-845"><span class="linenos">845</span></a>            <span class="n">parent</span>
</span><span id="DatabaseTable-846"><a href="#DatabaseTable-846"><span class="linenos">846</span></a>            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span>
</span><span id="DatabaseTable-847"><a href="#DatabaseTable-847"><span class="linenos">847</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">simmate_mixins</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="DatabaseTable-848"><a href="#DatabaseTable-848"><span class="linenos">848</span></a>            <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;DatabaseTable&quot;</span>
</span><span id="DatabaseTable-849"><a href="#DatabaseTable-849"><span class="linenos">849</span></a>        <span class="p">]</span>
</span><span id="DatabaseTable-850"><a href="#DatabaseTable-850"><span class="linenos">850</span></a>
</span><span id="DatabaseTable-851"><a href="#DatabaseTable-851"><span class="linenos">851</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-852"><a href="#DatabaseTable-852"><span class="linenos">852</span></a>    <span class="k">def</span> <span class="nf">get_mixin_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DatabaseTable-853"><a href="#DatabaseTable-853"><span class="linenos">853</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-854"><a href="#DatabaseTable-854"><span class="linenos">854</span></a><span class="sd">        Grabs the mix-in Tables that were used to make this class and returns</span>
</span><span id="DatabaseTable-855"><a href="#DatabaseTable-855"><span class="linenos">855</span></a><span class="sd">        a list of their names.</span>
</span><span id="DatabaseTable-856"><a href="#DatabaseTable-856"><span class="linenos">856</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-857"><a href="#DatabaseTable-857"><span class="linenos">857</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">mixin</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">mixin</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_mixins</span><span class="p">()]</span>
</span><span id="DatabaseTable-858"><a href="#DatabaseTable-858"><span class="linenos">858</span></a>
</span><span id="DatabaseTable-859"><a href="#DatabaseTable-859"><span class="linenos">859</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable-860"><a href="#DatabaseTable-860"><span class="linenos">860</span></a>    <span class="k">def</span> <span class="nf">get_extra_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DatabaseTable-861"><a href="#DatabaseTable-861"><span class="linenos">861</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable-862"><a href="#DatabaseTable-862"><span class="linenos">862</span></a><span class="sd">        Finds all columns that aren&#39;t covered by the supported Table mix-ins.</span>
</span><span id="DatabaseTable-863"><a href="#DatabaseTable-863"><span class="linenos">863</span></a>
</span><span id="DatabaseTable-864"><a href="#DatabaseTable-864"><span class="linenos">864</span></a><span class="sd">        For example, a table made from...</span>
</span><span id="DatabaseTable-865"><a href="#DatabaseTable-865"><span class="linenos">865</span></a>
</span><span id="DatabaseTable-866"><a href="#DatabaseTable-866"><span class="linenos">866</span></a><span class="sd">        ``` python</span>
</span><span id="DatabaseTable-867"><a href="#DatabaseTable-867"><span class="linenos">867</span></a><span class="sd">        from simmate.database.base_data_types import (</span>
</span><span id="DatabaseTable-868"><a href="#DatabaseTable-868"><span class="linenos">868</span></a><span class="sd">            table_column,</span>
</span><span id="DatabaseTable-869"><a href="#DatabaseTable-869"><span class="linenos">869</span></a><span class="sd">            Structure,</span>
</span><span id="DatabaseTable-870"><a href="#DatabaseTable-870"><span class="linenos">870</span></a><span class="sd">            Forces,</span>
</span><span id="DatabaseTable-871"><a href="#DatabaseTable-871"><span class="linenos">871</span></a><span class="sd">        )</span>
</span><span id="DatabaseTable-872"><a href="#DatabaseTable-872"><span class="linenos">872</span></a>
</span><span id="DatabaseTable-873"><a href="#DatabaseTable-873"><span class="linenos">873</span></a><span class="sd">        class ExampleTable(Structure, Forces):</span>
</span><span id="DatabaseTable-874"><a href="#DatabaseTable-874"><span class="linenos">874</span></a><span class="sd">            custom_column1 = table_column.FloatField()</span>
</span><span id="DatabaseTable-875"><a href="#DatabaseTable-875"><span class="linenos">875</span></a><span class="sd">            custom_column2 = table_column.FloatField()</span>
</span><span id="DatabaseTable-876"><a href="#DatabaseTable-876"><span class="linenos">876</span></a><span class="sd">        ```</span>
</span><span id="DatabaseTable-877"><a href="#DatabaseTable-877"><span class="linenos">877</span></a>
</span><span id="DatabaseTable-878"><a href="#DatabaseTable-878"><span class="linenos">878</span></a><span class="sd">        ... would return ...</span>
</span><span id="DatabaseTable-879"><a href="#DatabaseTable-879"><span class="linenos">879</span></a>
</span><span id="DatabaseTable-880"><a href="#DatabaseTable-880"><span class="linenos">880</span></a><span class="sd">        ``` python</span>
</span><span id="DatabaseTable-881"><a href="#DatabaseTable-881"><span class="linenos">881</span></a><span class="sd">        [&quot;custom_column1&quot;, &quot;custom_column2&quot;]</span>
</span><span id="DatabaseTable-882"><a href="#DatabaseTable-882"><span class="linenos">882</span></a><span class="sd">        ```</span>
</span><span id="DatabaseTable-883"><a href="#DatabaseTable-883"><span class="linenos">883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable-884"><a href="#DatabaseTable-884"><span class="linenos">884</span></a>
</span><span id="DatabaseTable-885"><a href="#DatabaseTable-885"><span class="linenos">885</span></a>        <span class="n">all_columns</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">()</span>
</span><span id="DatabaseTable-886"><a href="#DatabaseTable-886"><span class="linenos">886</span></a>        <span class="n">columns_w_mixin</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DatabaseTable-887"><a href="#DatabaseTable-887"><span class="linenos">887</span></a>            <span class="n">column</span> <span class="k">for</span> <span class="n">mixin</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_mixins</span><span class="p">()</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">mixin</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">()</span>
</span><span id="DatabaseTable-888"><a href="#DatabaseTable-888"><span class="linenos">888</span></a>        <span class="p">]</span>
</span><span id="DatabaseTable-889"><a href="#DatabaseTable-889"><span class="linenos">889</span></a>        <span class="n">extra_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DatabaseTable-890"><a href="#DatabaseTable-890"><span class="linenos">890</span></a>            <span class="n">column</span>
</span><span id="DatabaseTable-891"><a href="#DatabaseTable-891"><span class="linenos">891</span></a>            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">all_columns</span>
</span><span id="DatabaseTable-892"><a href="#DatabaseTable-892"><span class="linenos">892</span></a>            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns_w_mixin</span> <span class="ow">and</span> <span class="n">column</span> <span class="o">!=</span> <span class="s2">&quot;id&quot;</span>
</span><span id="DatabaseTable-893"><a href="#DatabaseTable-893"><span class="linenos">893</span></a>        <span class="p">]</span>
</span><span id="DatabaseTable-894"><a href="#DatabaseTable-894"><span class="linenos">894</span></a>        <span class="k">return</span> <span class="n">extra_columns</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>The base class for defining a table in the Simmate database. All tables and
mixins inherit from this class.</p>

<p>Usage is identical to
<a href="https://docs.djangoproject.com/en/4.0/#the-model-layer">models in Django</a>
where this class only adds extra methods for convenience.</p>
</div>


                            <div id="DatabaseTable.base_info" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DatabaseTable.base_info">#&nbsp;&nbsp</a>

        <span class="name">base_info</span><span class="annotation">: List[str]</span><span class="default_value"> = []</span>
    </div>

    
            <div class="docstring"><p>The base information for this database table and only these fields are stored
when the <code>to_archive</code> method is used. Using the columns in this list, all 
other columns for this table can be calculated, so the columns in this list 
are effectively the "raw data".</p>
</div>


                            </div>
                            <div id="DatabaseTable.source" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.source">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">source</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><blockquote>
  <p>Note, this field is highly experimental at the moment and subject to
  change.</p>
</blockquote>

<p>This column indicates where the data came from, and it could be a number 
of things including...</p>

<ul>
<li>a third party id</li>
<li>a structure from a different Simmate datbase table</li>
<li>a transformation of another structure</li>
<li>a creation method</li>
<li>a custom submission by the user</li>
</ul>

<p>By default, this is a JSON field to account for all scenarios, but some
tables (such as those in <code><a href="../third_parties.html">simmate.database.third_parties</a></code>) this is value
should be the same for ALL entries in the table and therefore the column is
overwritten as an attribute.</p>

<p>For other tables where this is not a constant, here are some examples of
values used in this column:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># from a thirdparty database or separate table</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a random structure creator</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PyXtalStructure&quot;</span><span class="p">}</span>

<span class="c1"># from a templated structure creator (e.g. substituition or prototypes)</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PrototypeStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;AFLOWPrototypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;MirrorMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a multi-structure transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;HereditaryMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mp-123&quot;</span><span class="p">,</span> <span class="s2">&quot;mp-321&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>
</div>


                            </div>
                            <div id="DatabaseTable.source_doi" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DatabaseTable.source_doi">#&nbsp;&nbsp</a>

        <span class="name">source_doi</span><span class="annotation">: str</span><span class="default_value"> = None</span>
    </div>

    
            <div class="docstring"><p>Source paper that must be referenced if this data is used. If this is None,
please refer to the <code><a href="#DatabaseTable.source">source</a></code> attribute for further details on what to 
reference.</p>
</div>


                            </div>
                            <div id="DatabaseTable.remote_archive_link" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DatabaseTable.remote_archive_link">#&nbsp;&nbsp</a>

        <span class="name">remote_archive_link</span><span class="annotation">: str</span><span class="default_value"> = None</span>
    </div>

    
            <div class="docstring"><p>The URL that is used to download the archive and then populate this table.
Many tables, such as those in <code><a href="../third_parties.html">simmate.database.third_parties</a></code>, have
pre-existing data that you can download and load into your local database,
so if this attribute is set, you can use the <code><a href="#DatabaseTable.load_remote_archive">load_remote_archive</a></code> method.</p>
</div>


                            </div>
                            <div id="DatabaseTable.objects" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.objects">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">objects</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>Accesses all of the rows in this datatable and initiates a SearchResults
object. Using this, you can perform complex filtering and conversions on
data from this table.</p>
</div>


                            </div>
                            <div id="DatabaseTable.get_table_name" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.get_table_name">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">get_table_name</span><span class="signature">(cls) -&gt; str</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.get_table_name-362"><a href="#DatabaseTable.get_table_name-362"><span class="linenos">362</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.get_table_name-363"><a href="#DatabaseTable.get_table_name-363"><span class="linenos">363</span></a>    <span class="k">def</span> <span class="nf">get_table_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DatabaseTable.get_table_name-364"><a href="#DatabaseTable.get_table_name-364"><span class="linenos">364</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_table_name-365"><a href="#DatabaseTable.get_table_name-365"><span class="linenos">365</span></a><span class="sd">        Returns the name of this database table, which will simply match the</span>
</span><span id="DatabaseTable.get_table_name-366"><a href="#DatabaseTable.get_table_name-366"><span class="linenos">366</span></a><span class="sd">        class name. Using `Table.__name__` is often easier. This method simply</span>
</span><span id="DatabaseTable.get_table_name-367"><a href="#DatabaseTable.get_table_name-367"><span class="linenos">367</span></a><span class="sd">        makes the name accessible in Django Templates.</span>
</span><span id="DatabaseTable.get_table_name-368"><a href="#DatabaseTable.get_table_name-368"><span class="linenos">368</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_table_name-369"><a href="#DatabaseTable.get_table_name-369"><span class="linenos">369</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Returns the name of this database table, which will simply match the
class name. Using <code>Table.__name__</code> is often easier. This method simply
makes the name accessible in Django Templates.</p>
</div>


                            </div>
                            <div id="DatabaseTable.create_subclass" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.create_subclass">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">create_subclass</span><span class="signature">(cls, name: str, module: str, app_label: str = None, **new_columns)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.create_subclass-371"><a href="#DatabaseTable.create_subclass-371"><span class="linenos">371</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.create_subclass-372"><a href="#DatabaseTable.create_subclass-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">create_subclass</span><span class="p">(</span>
</span><span id="DatabaseTable.create_subclass-373"><a href="#DatabaseTable.create_subclass-373"><span class="linenos">373</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="DatabaseTable.create_subclass-374"><a href="#DatabaseTable.create_subclass-374"><span class="linenos">374</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DatabaseTable.create_subclass-375"><a href="#DatabaseTable.create_subclass-375"><span class="linenos">375</span></a>        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DatabaseTable.create_subclass-376"><a href="#DatabaseTable.create_subclass-376"><span class="linenos">376</span></a>        <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DatabaseTable.create_subclass-377"><a href="#DatabaseTable.create_subclass-377"><span class="linenos">377</span></a>        <span class="o">**</span><span class="n">new_columns</span><span class="p">,</span>
</span><span id="DatabaseTable.create_subclass-378"><a href="#DatabaseTable.create_subclass-378"><span class="linenos">378</span></a>    <span class="p">):</span>
</span><span id="DatabaseTable.create_subclass-379"><a href="#DatabaseTable.create_subclass-379"><span class="linenos">379</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.create_subclass-380"><a href="#DatabaseTable.create_subclass-380"><span class="linenos">380</span></a><span class="sd">        This method is useful for dynamically creating a subclass DatabaseTable</span>
</span><span id="DatabaseTable.create_subclass-381"><a href="#DatabaseTable.create_subclass-381"><span class="linenos">381</span></a><span class="sd">        from some abstract class.</span>
</span><span id="DatabaseTable.create_subclass-382"><a href="#DatabaseTable.create_subclass-382"><span class="linenos">382</span></a>
</span><span id="DatabaseTable.create_subclass-383"><a href="#DatabaseTable.create_subclass-383"><span class="linenos">383</span></a><span class="sd">        Let&#39;s take an example where we inherit from a Structure table. The two</span>
</span><span id="DatabaseTable.create_subclass-384"><a href="#DatabaseTable.create_subclass-384"><span class="linenos">384</span></a><span class="sd">        ways we create a NewTable below are exactly the same:</span>
</span><span id="DatabaseTable.create_subclass-385"><a href="#DatabaseTable.create_subclass-385"><span class="linenos">385</span></a>
</span><span id="DatabaseTable.create_subclass-386"><a href="#DatabaseTable.create_subclass-386"><span class="linenos">386</span></a><span class="sd">        ``` python</span>
</span><span id="DatabaseTable.create_subclass-387"><a href="#DatabaseTable.create_subclass-387"><span class="linenos">387</span></a><span class="sd">        # Normal way to create a child class</span>
</span><span id="DatabaseTable.create_subclass-388"><a href="#DatabaseTable.create_subclass-388"><span class="linenos">388</span></a><span class="sd">        NewTable(Structure):</span>
</span><span id="DatabaseTable.create_subclass-389"><a href="#DatabaseTable.create_subclass-389"><span class="linenos">389</span></a><span class="sd">            new_field1 = table_column.FloatField()</span>
</span><span id="DatabaseTable.create_subclass-390"><a href="#DatabaseTable.create_subclass-390"><span class="linenos">390</span></a><span class="sd">            new_field2 = table_column.FloatField()</span>
</span><span id="DatabaseTable.create_subclass-391"><a href="#DatabaseTable.create_subclass-391"><span class="linenos">391</span></a>
</span><span id="DatabaseTable.create_subclass-392"><a href="#DatabaseTable.create_subclass-392"><span class="linenos">392</span></a><span class="sd">        # How this method makes the same child class</span>
</span><span id="DatabaseTable.create_subclass-393"><a href="#DatabaseTable.create_subclass-393"><span class="linenos">393</span></a><span class="sd">        NewTable = Structure.create_subclass(</span>
</span><span id="DatabaseTable.create_subclass-394"><a href="#DatabaseTable.create_subclass-394"><span class="linenos">394</span></a><span class="sd">            name=&quot;NewTable&quot;,</span>
</span><span id="DatabaseTable.create_subclass-395"><a href="#DatabaseTable.create_subclass-395"><span class="linenos">395</span></a><span class="sd">            module=__name__, # required for serialization</span>
</span><span id="DatabaseTable.create_subclass-396"><a href="#DatabaseTable.create_subclass-396"><span class="linenos">396</span></a><span class="sd">            new_field1 = table_column.FloatField()</span>
</span><span id="DatabaseTable.create_subclass-397"><a href="#DatabaseTable.create_subclass-397"><span class="linenos">397</span></a><span class="sd">            new_field2 = table_column.FloatField()</span>
</span><span id="DatabaseTable.create_subclass-398"><a href="#DatabaseTable.create_subclass-398"><span class="linenos">398</span></a><span class="sd">            # app_label --&gt; typically not required bc the parent class sets this</span>
</span><span id="DatabaseTable.create_subclass-399"><a href="#DatabaseTable.create_subclass-399"><span class="linenos">399</span></a><span class="sd">        )</span>
</span><span id="DatabaseTable.create_subclass-400"><a href="#DatabaseTable.create_subclass-400"><span class="linenos">400</span></a><span class="sd">        ```</span>
</span><span id="DatabaseTable.create_subclass-401"><a href="#DatabaseTable.create_subclass-401"><span class="linenos">401</span></a>
</span><span id="DatabaseTable.create_subclass-402"><a href="#DatabaseTable.create_subclass-402"><span class="linenos">402</span></a><span class="sd">        While this might seem silly, it helps us avoid a bunch of boilerplate</span>
</span><span id="DatabaseTable.create_subclass-403"><a href="#DatabaseTable.create_subclass-403"><span class="linenos">403</span></a><span class="sd">        code when we need to redefine a bunch of relationships in every single</span>
</span><span id="DatabaseTable.create_subclass-404"><a href="#DatabaseTable.create_subclass-404"><span class="linenos">404</span></a><span class="sd">        child class (and always in the same way). A great example of it&#39;s utility</span>
</span><span id="DatabaseTable.create_subclass-405"><a href="#DatabaseTable.create_subclass-405"><span class="linenos">405</span></a><span class="sd">        is in `simmate.calculators.vasp.database.relaxation`.</span>
</span><span id="DatabaseTable.create_subclass-406"><a href="#DatabaseTable.create_subclass-406"><span class="linenos">406</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.create_subclass-407"><a href="#DatabaseTable.create_subclass-407"><span class="linenos">407</span></a>
</span><span id="DatabaseTable.create_subclass-408"><a href="#DatabaseTable.create_subclass-408"><span class="linenos">408</span></a>        <span class="c1"># because we update values below, we make sure we are editting a</span>
</span><span id="DatabaseTable.create_subclass-409"><a href="#DatabaseTable.create_subclass-409"><span class="linenos">409</span></a>        <span class="c1"># copy of the dictionary</span>
</span><span id="DatabaseTable.create_subclass-410"><a href="#DatabaseTable.create_subclass-410"><span class="linenos">410</span></a>        <span class="n">new_columns</span> <span class="o">=</span> <span class="n">new_columns</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DatabaseTable.create_subclass-411"><a href="#DatabaseTable.create_subclass-411"><span class="linenos">411</span></a>
</span><span id="DatabaseTable.create_subclass-412"><a href="#DatabaseTable.create_subclass-412"><span class="linenos">412</span></a>        <span class="c1"># BUG: I&#39;m honestly not sure what this does, but it works...</span>
</span><span id="DatabaseTable.create_subclass-413"><a href="#DatabaseTable.create_subclass-413"><span class="linenos">413</span></a>        <span class="c1"># https://stackoverflow.com/questions/27112816/</span>
</span><span id="DatabaseTable.create_subclass-414"><a href="#DatabaseTable.create_subclass-414"><span class="linenos">414</span></a>        <span class="c1"># For a more robust way of setting the Meta class, see my code in</span>
</span><span id="DatabaseTable.create_subclass-415"><a href="#DatabaseTable.create_subclass-415"><span class="linenos">415</span></a>        <span class="c1"># simmate.website.workflows.utilities</span>
</span><span id="DatabaseTable.create_subclass-416"><a href="#DatabaseTable.create_subclass-416"><span class="linenos">416</span></a>        <span class="n">new_columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="DatabaseTable.create_subclass-417"><a href="#DatabaseTable.create_subclass-417"><span class="linenos">417</span></a>            <span class="p">{</span>
</span><span id="DatabaseTable.create_subclass-418"><a href="#DatabaseTable.create_subclass-418"><span class="linenos">418</span></a>                <span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="n">module</span><span class="p">,</span>
</span><span id="DatabaseTable.create_subclass-419"><a href="#DatabaseTable.create_subclass-419"><span class="linenos">419</span></a>                <span class="s2">&quot;Meta&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;app_label&quot;</span><span class="p">:</span> <span class="n">app_label</span><span class="p">}</span> <span class="k">if</span> <span class="n">app_label</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="DatabaseTable.create_subclass-420"><a href="#DatabaseTable.create_subclass-420"><span class="linenos">420</span></a>            <span class="p">}</span>
</span><span id="DatabaseTable.create_subclass-421"><a href="#DatabaseTable.create_subclass-421"><span class="linenos">421</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable.create_subclass-422"><a href="#DatabaseTable.create_subclass-422"><span class="linenos">422</span></a>        <span class="c1"># TODO: make it so I don&#39;t have to specify the module, but it is automatically</span>
</span><span id="DatabaseTable.create_subclass-423"><a href="#DatabaseTable.create_subclass-423"><span class="linenos">423</span></a>        <span class="c1"># detected from where the class is created. This would remove boilerplate code.</span>
</span><span id="DatabaseTable.create_subclass-424"><a href="#DatabaseTable.create_subclass-424"><span class="linenos">424</span></a>        <span class="c1"># A good start to this is here:</span>
</span><span id="DatabaseTable.create_subclass-425"><a href="#DatabaseTable.create_subclass-425"><span class="linenos">425</span></a>        <span class="c1">#   https://stackoverflow.com/questions/59912684/</span>
</span><span id="DatabaseTable.create_subclass-426"><a href="#DatabaseTable.create_subclass-426"><span class="linenos">426</span></a>        <span class="c1"># sys._getframe(1).f_globals[&quot;__name__&quot;]  &lt;-- grabs where this function is called</span>
</span><span id="DatabaseTable.create_subclass-427"><a href="#DatabaseTable.create_subclass-427"><span class="linenos">427</span></a>        <span class="c1"># but doesn&#39;t work for multiple levels of inheritance. For example, this fails for</span>
</span><span id="DatabaseTable.create_subclass-428"><a href="#DatabaseTable.create_subclass-428"><span class="linenos">428</span></a>        <span class="c1"># the Relaxation subclasses because the create_subclasses method calls</span>
</span><span id="DatabaseTable.create_subclass-429"><a href="#DatabaseTable.create_subclass-429"><span class="linenos">429</span></a>        <span class="c1"># create_subclass -- therefore we&#39;d need _getframe(3) instead of 1...</span>
</span><span id="DatabaseTable.create_subclass-430"><a href="#DatabaseTable.create_subclass-430"><span class="linenos">430</span></a>
</span><span id="DatabaseTable.create_subclass-431"><a href="#DatabaseTable.create_subclass-431"><span class="linenos">431</span></a>        <span class="c1"># Now we dynamically create a new class that inherits from this main</span>
</span><span id="DatabaseTable.create_subclass-432"><a href="#DatabaseTable.create_subclass-432"><span class="linenos">432</span></a>        <span class="c1"># one and also adds the new columns to it.</span>
</span><span id="DatabaseTable.create_subclass-433"><a href="#DatabaseTable.create_subclass-433"><span class="linenos">433</span></a>        <span class="n">NewClass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="n">new_columns</span><span class="p">)</span>
</span><span id="DatabaseTable.create_subclass-434"><a href="#DatabaseTable.create_subclass-434"><span class="linenos">434</span></a>
</span><span id="DatabaseTable.create_subclass-435"><a href="#DatabaseTable.create_subclass-435"><span class="linenos">435</span></a>        <span class="k">return</span> <span class="n">NewClass</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>This method is useful for dynamically creating a subclass DatabaseTable
from some abstract class.</p>

<p>Let's take an example where we inherit from a Structure table. The two
ways we create a NewTable below are exactly the same:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># Normal way to create a child class</span>
<span class="n">NewTable</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">new_field1</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">new_field2</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>

<span class="c1"># How this method makes the same child class</span>
<span class="n">NewTable</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NewTable&quot;</span><span class="p">,</span>
    <span class="n">module</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span> <span class="c1"># required for serialization</span>
    <span class="n">new_field1</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">new_field2</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="c1"># app_label --&gt; typically not required bc the parent class sets this</span>
<span class="p">)</span>
</code></pre></div>

<p>While this might seem silly, it helps us avoid a bunch of boilerplate
code when we need to redefine a bunch of relationships in every single
child class (and always in the same way). A great example of it's utility
is in <code><a href="../../calculators/vasp/database/relaxation.html">simmate.calculators.vasp.database.relaxation</a></code>.</p>
</div>


                            </div>
                            <div id="DatabaseTable.from_toolkit" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.from_toolkit">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">from_toolkit</span><span class="signature">(cls, as_dict: bool = False, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.from_toolkit-437"><a href="#DatabaseTable.from_toolkit-437"><span class="linenos">437</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.from_toolkit-438"><a href="#DatabaseTable.from_toolkit-438"><span class="linenos">438</span></a>    <span class="k">def</span> <span class="nf">from_toolkit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DatabaseTable.from_toolkit-439"><a href="#DatabaseTable.from_toolkit-439"><span class="linenos">439</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.from_toolkit-440"><a href="#DatabaseTable.from_toolkit-440"><span class="linenos">440</span></a><span class="sd">        Given fundamental &quot;base_info&quot; and toolkit objects, this method will populate</span>
</span><span id="DatabaseTable.from_toolkit-441"><a href="#DatabaseTable.from_toolkit-441"><span class="linenos">441</span></a><span class="sd">        all relevant columns.</span>
</span><span id="DatabaseTable.from_toolkit-442"><a href="#DatabaseTable.from_toolkit-442"><span class="linenos">442</span></a>
</span><span id="DatabaseTable.from_toolkit-443"><a href="#DatabaseTable.from_toolkit-443"><span class="linenos">443</span></a><span class="sd">        If the table is made up of multiple mix-ins, this method iterates through</span>
</span><span id="DatabaseTable.from_toolkit-444"><a href="#DatabaseTable.from_toolkit-444"><span class="linenos">444</span></a><span class="sd">        each of the `_from_toolkit` methods of those mixins and combines the results.</span>
</span><span id="DatabaseTable.from_toolkit-445"><a href="#DatabaseTable.from_toolkit-445"><span class="linenos">445</span></a><span class="sd">        Therefore, you must view this method for each mix-ins to determine which</span>
</span><span id="DatabaseTable.from_toolkit-446"><a href="#DatabaseTable.from_toolkit-446"><span class="linenos">446</span></a><span class="sd">        kwargs must be passed.</span>
</span><span id="DatabaseTable.from_toolkit-447"><a href="#DatabaseTable.from_toolkit-447"><span class="linenos">447</span></a>
</span><span id="DatabaseTable.from_toolkit-448"><a href="#DatabaseTable.from_toolkit-448"><span class="linenos">448</span></a><span class="sd">        #### Parameters</span>
</span><span id="DatabaseTable.from_toolkit-449"><a href="#DatabaseTable.from_toolkit-449"><span class="linenos">449</span></a>
</span><span id="DatabaseTable.from_toolkit-450"><a href="#DatabaseTable.from_toolkit-450"><span class="linenos">450</span></a><span class="sd">        - `as_dict` :</span>
</span><span id="DatabaseTable.from_toolkit-451"><a href="#DatabaseTable.from_toolkit-451"><span class="linenos">451</span></a><span class="sd">            Whether to return the populated data as a dictionary or to initialize</span>
</span><span id="DatabaseTable.from_toolkit-452"><a href="#DatabaseTable.from_toolkit-452"><span class="linenos">452</span></a><span class="sd">            it as a database object. Defaults to False.</span>
</span><span id="DatabaseTable.from_toolkit-453"><a href="#DatabaseTable.from_toolkit-453"><span class="linenos">453</span></a><span class="sd">        - `**kwargs` :</span>
</span><span id="DatabaseTable.from_toolkit-454"><a href="#DatabaseTable.from_toolkit-454"><span class="linenos">454</span></a><span class="sd">            All fields required in order to initialize the database entry. For</span>
</span><span id="DatabaseTable.from_toolkit-455"><a href="#DatabaseTable.from_toolkit-455"><span class="linenos">455</span></a><span class="sd">            example, a Structure table would require a toolkit structure, while</span>
</span><span id="DatabaseTable.from_toolkit-456"><a href="#DatabaseTable.from_toolkit-456"><span class="linenos">456</span></a><span class="sd">            a Thermodynamics table would require an energy.</span>
</span><span id="DatabaseTable.from_toolkit-457"><a href="#DatabaseTable.from_toolkit-457"><span class="linenos">457</span></a>
</span><span id="DatabaseTable.from_toolkit-458"><a href="#DatabaseTable.from_toolkit-458"><span class="linenos">458</span></a><span class="sd">        Returns</span>
</span><span id="DatabaseTable.from_toolkit-459"><a href="#DatabaseTable.from_toolkit-459"><span class="linenos">459</span></a><span class="sd">        -------</span>
</span><span id="DatabaseTable.from_toolkit-460"><a href="#DatabaseTable.from_toolkit-460"><span class="linenos">460</span></a><span class="sd">        a dictionary if as_dict is True; and a database object if as_dict is False</span>
</span><span id="DatabaseTable.from_toolkit-461"><a href="#DatabaseTable.from_toolkit-461"><span class="linenos">461</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.from_toolkit-462"><a href="#DatabaseTable.from_toolkit-462"><span class="linenos">462</span></a>
</span><span id="DatabaseTable.from_toolkit-463"><a href="#DatabaseTable.from_toolkit-463"><span class="linenos">463</span></a>        <span class="c1"># Grab a list of all parent classes</span>
</span><span id="DatabaseTable.from_toolkit-464"><a href="#DatabaseTable.from_toolkit-464"><span class="linenos">464</span></a>        <span class="n">parents</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="DatabaseTable.from_toolkit-465"><a href="#DatabaseTable.from_toolkit-465"><span class="linenos">465</span></a>
</span><span id="DatabaseTable.from_toolkit-466"><a href="#DatabaseTable.from_toolkit-466"><span class="linenos">466</span></a>        <span class="c1"># As we go through the parent classes below, we will identify the mixins</span>
</span><span id="DatabaseTable.from_toolkit-467"><a href="#DatabaseTable.from_toolkit-467"><span class="linenos">467</span></a>        <span class="c1"># and populate data using those classes. All of this is fed in to our</span>
</span><span id="DatabaseTable.from_toolkit-468"><a href="#DatabaseTable.from_toolkit-468"><span class="linenos">468</span></a>        <span class="c1"># main class at the end of the function. We keep this running dictionary</span>
</span><span id="DatabaseTable.from_toolkit-469"><a href="#DatabaseTable.from_toolkit-469"><span class="linenos">469</span></a>        <span class="c1"># as we go.</span>
</span><span id="DatabaseTable.from_toolkit-470"><a href="#DatabaseTable.from_toolkit-470"><span class="linenos">470</span></a>        <span class="n">all_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DatabaseTable.from_toolkit-471"><a href="#DatabaseTable.from_toolkit-471"><span class="linenos">471</span></a>        <span class="c1"># TODO: How should I best handle passing extra kwargs to the final class</span>
</span><span id="DatabaseTable.from_toolkit-472"><a href="#DatabaseTable.from_toolkit-472"><span class="linenos">472</span></a>        <span class="c1"># initialization? For example, I would want to pass `energy` but I wouldn&#39;t</span>
</span><span id="DatabaseTable.from_toolkit-473"><a href="#DatabaseTable.from_toolkit-473"><span class="linenos">473</span></a>        <span class="c1"># want to pass the toolkit structure object. I may update this line in</span>
</span><span id="DatabaseTable.from_toolkit-474"><a href="#DatabaseTable.from_toolkit-474"><span class="linenos">474</span></a>        <span class="c1"># the future to remove python objects. For now, I only remove structure</span>
</span><span id="DatabaseTable.from_toolkit-475"><a href="#DatabaseTable.from_toolkit-475"><span class="linenos">475</span></a>        <span class="c1"># and migration_hop because I know that it is a toolkit object -- not</span>
</span><span id="DatabaseTable.from_toolkit-476"><a href="#DatabaseTable.from_toolkit-476"><span class="linenos">476</span></a>        <span class="c1"># a database column.</span>
</span><span id="DatabaseTable.from_toolkit-477"><a href="#DatabaseTable.from_toolkit-477"><span class="linenos">477</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable.from_toolkit-478"><a href="#DatabaseTable.from_toolkit-478"><span class="linenos">478</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable.from_toolkit-479"><a href="#DatabaseTable.from_toolkit-479"><span class="linenos">479</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;band_structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable.from_toolkit-480"><a href="#DatabaseTable.from_toolkit-480"><span class="linenos">480</span></a>        <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;density_of_states&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable.from_toolkit-481"><a href="#DatabaseTable.from_toolkit-481"><span class="linenos">481</span></a>
</span><span id="DatabaseTable.from_toolkit-482"><a href="#DatabaseTable.from_toolkit-482"><span class="linenos">482</span></a>        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
</span><span id="DatabaseTable.from_toolkit-483"><a href="#DatabaseTable.from_toolkit-483"><span class="linenos">483</span></a>
</span><span id="DatabaseTable.from_toolkit-484"><a href="#DatabaseTable.from_toolkit-484"><span class="linenos">484</span></a>            <span class="c1"># Skip the parent class if it doesn&#39;t directly inherit from the</span>
</span><span id="DatabaseTable.from_toolkit-485"><a href="#DatabaseTable.from_toolkit-485"><span class="linenos">485</span></a>            <span class="c1"># DatabaseTable class. We do this because we want the fundamental</span>
</span><span id="DatabaseTable.from_toolkit-486"><a href="#DatabaseTable.from_toolkit-486"><span class="linenos">486</span></a>            <span class="c1"># mixins that come with Simmate (such as Structure, Forces, Thermodynamics).</span>
</span><span id="DatabaseTable.from_toolkit-487"><a href="#DatabaseTable.from_toolkit-487"><span class="linenos">487</span></a>            <span class="c1"># We also skip the classes that don&#39;t have a _from_toolkit method defined.</span>
</span><span id="DatabaseTable.from_toolkit-488"><a href="#DatabaseTable.from_toolkit-488"><span class="linenos">488</span></a>            <span class="c1"># Right now, this is just the Calculation class that&#39;s skipped with this</span>
</span><span id="DatabaseTable.from_toolkit-489"><a href="#DatabaseTable.from_toolkit-489"><span class="linenos">489</span></a>            <span class="c1"># condition.</span>
</span><span id="DatabaseTable.from_toolkit-490"><a href="#DatabaseTable.from_toolkit-490"><span class="linenos">490</span></a>            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">__base__</span> <span class="o">!=</span> <span class="n">DatabaseTable</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;_from_toolkit&quot;</span><span class="p">):</span>
</span><span id="DatabaseTable.from_toolkit-491"><a href="#DatabaseTable.from_toolkit-491"><span class="linenos">491</span></a>                <span class="k">continue</span>
</span><span id="DatabaseTable.from_toolkit-492"><a href="#DatabaseTable.from_toolkit-492"><span class="linenos">492</span></a>
</span><span id="DatabaseTable.from_toolkit-493"><a href="#DatabaseTable.from_toolkit-493"><span class="linenos">493</span></a>            <span class="c1"># Grab the input arguments for the _from_toolkit method. This will</span>
</span><span id="DatabaseTable.from_toolkit-494"><a href="#DatabaseTable.from_toolkit-494"><span class="linenos">494</span></a>            <span class="c1"># give a list back like... [&#39;cls&#39;, &#39;structure&#39;, &#39;as_dict&#39;]. We</span>
</span><span id="DatabaseTable.from_toolkit-495"><a href="#DatabaseTable.from_toolkit-495"><span class="linenos">495</span></a>            <span class="c1"># don&#39;t consider as_dict or cls, so we remove those too</span>
</span><span id="DatabaseTable.from_toolkit-496"><a href="#DatabaseTable.from_toolkit-496"><span class="linenos">496</span></a>            <span class="n">inputs</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
</span><span id="DatabaseTable.from_toolkit-497"><a href="#DatabaseTable.from_toolkit-497"><span class="linenos">497</span></a>            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;as_dict&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable.from_toolkit-498"><a href="#DatabaseTable.from_toolkit-498"><span class="linenos">498</span></a>            <span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;cls&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable.from_toolkit-499"><a href="#DatabaseTable.from_toolkit-499"><span class="linenos">499</span></a>
</span><span id="DatabaseTable.from_toolkit-500"><a href="#DatabaseTable.from_toolkit-500"><span class="linenos">500</span></a>            <span class="c1"># Now inputs is current of list of keys that we need. Next, we go</span>
</span><span id="DatabaseTable.from_toolkit-501"><a href="#DatabaseTable.from_toolkit-501"><span class="linenos">501</span></a>            <span class="c1"># through our kwargs and see if we have any of these keys, and if so,</span>
</span><span id="DatabaseTable.from_toolkit-502"><a href="#DatabaseTable.from_toolkit-502"><span class="linenos">502</span></a>            <span class="c1"># grab them.</span>
</span><span id="DatabaseTable.from_toolkit-503"><a href="#DatabaseTable.from_toolkit-503"><span class="linenos">503</span></a>            <span class="n">matching_inputs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DatabaseTable.from_toolkit-504"><a href="#DatabaseTable.from_toolkit-504"><span class="linenos">504</span></a>                <span class="n">key</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="DatabaseTable.from_toolkit-505"><a href="#DatabaseTable.from_toolkit-505"><span class="linenos">505</span></a>            <span class="p">}</span>
</span><span id="DatabaseTable.from_toolkit-506"><a href="#DatabaseTable.from_toolkit-506"><span class="linenos">506</span></a>
</span><span id="DatabaseTable.from_toolkit-507"><a href="#DatabaseTable.from_toolkit-507"><span class="linenos">507</span></a>            <span class="c1"># We now pass these inputs to the _from_toolkit. If we&#39;re missing</span>
</span><span id="DatabaseTable.from_toolkit-508"><a href="#DatabaseTable.from_toolkit-508"><span class="linenos">508</span></a>            <span class="c1"># a required input, this will raise an error here. We only</span>
</span><span id="DatabaseTable.from_toolkit-509"><a href="#DatabaseTable.from_toolkit-509"><span class="linenos">509</span></a>            <span class="c1"># want the expanded input, so we request a dictionary, not object.</span>
</span><span id="DatabaseTable.from_toolkit-510"><a href="#DatabaseTable.from_toolkit-510"><span class="linenos">510</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">matching_inputs</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DatabaseTable.from_toolkit-511"><a href="#DatabaseTable.from_toolkit-511"><span class="linenos">511</span></a>
</span><span id="DatabaseTable.from_toolkit-512"><a href="#DatabaseTable.from_toolkit-512"><span class="linenos">512</span></a>            <span class="c1"># Now add this mixin&#39;s data to our collective dictionary</span>
</span><span id="DatabaseTable.from_toolkit-513"><a href="#DatabaseTable.from_toolkit-513"><span class="linenos">513</span></a>            <span class="n">all_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="DatabaseTable.from_toolkit-514"><a href="#DatabaseTable.from_toolkit-514"><span class="linenos">514</span></a>
</span><span id="DatabaseTable.from_toolkit-515"><a href="#DatabaseTable.from_toolkit-515"><span class="linenos">515</span></a>        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
</span><span id="DatabaseTable.from_toolkit-516"><a href="#DatabaseTable.from_toolkit-516"><span class="linenos">516</span></a>        <span class="c1"># return the dictionary</span>
</span><span id="DatabaseTable.from_toolkit-517"><a href="#DatabaseTable.from_toolkit-517"><span class="linenos">517</span></a>        <span class="k">return</span> <span class="n">all_data</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">all_data</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Given fundamental "base_info" and toolkit objects, this method will populate
all relevant columns.</p>

<p>If the table is made up of multiple mix-ins, this method iterates through
each of the <code>_from_toolkit</code> methods of those mixins and combines the results.
Therefore, you must view this method for each mix-ins to determine which
kwargs must be passed.</p>

<h4 id="parameters">Parameters</h4>

<ul>
<li><code>as_dict</code> :
Whether to return the populated data as a dictionary or to initialize
it as a database object. Defaults to False.</li>
<li><code>**kwargs</code> :
All fields required in order to initialize the database entry. For
example, a Structure table would require a toolkit structure, while
a Thermodynamics table would require an energy.</li>
</ul>

<h2 id="returns">Returns</h2>

<p>a dictionary if as_dict is True; and a database object if as_dict is False</p>
</div>


                            </div>
                            <div id="DatabaseTable.load_archive" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.load_archive">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">load_archive</span><span class="signature">(
    cls,
    filename: str = None,
    delete_on_completion: bool = False,
    confirm_override: bool = False,
    parallel: bool = False,
    confirm_sqlite_parallel: bool = False
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.load_archive-584"><a href="#DatabaseTable.load_archive-584"><span class="linenos">584</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.load_archive-585"><a href="#DatabaseTable.load_archive-585"><span class="linenos">585</span></a>    <span class="k">def</span> <span class="nf">load_archive</span><span class="p">(</span>
</span><span id="DatabaseTable.load_archive-586"><a href="#DatabaseTable.load_archive-586"><span class="linenos">586</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-587"><a href="#DatabaseTable.load_archive-587"><span class="linenos">587</span></a>        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-588"><a href="#DatabaseTable.load_archive-588"><span class="linenos">588</span></a>        <span class="n">delete_on_completion</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-589"><a href="#DatabaseTable.load_archive-589"><span class="linenos">589</span></a>        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-590"><a href="#DatabaseTable.load_archive-590"><span class="linenos">590</span></a>        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-591"><a href="#DatabaseTable.load_archive-591"><span class="linenos">591</span></a>        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-592"><a href="#DatabaseTable.load_archive-592"><span class="linenos">592</span></a>    <span class="p">):</span>
</span><span id="DatabaseTable.load_archive-593"><a href="#DatabaseTable.load_archive-593"><span class="linenos">593</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.load_archive-594"><a href="#DatabaseTable.load_archive-594"><span class="linenos">594</span></a><span class="sd">        Reads a compressed zip file made by `objects.to_archive` and loads the data</span>
</span><span id="DatabaseTable.load_archive-595"><a href="#DatabaseTable.load_archive-595"><span class="linenos">595</span></a><span class="sd">        back into the Simmate database.</span>
</span><span id="DatabaseTable.load_archive-596"><a href="#DatabaseTable.load_archive-596"><span class="linenos">596</span></a>
</span><span id="DatabaseTable.load_archive-597"><a href="#DatabaseTable.load_archive-597"><span class="linenos">597</span></a><span class="sd">        Typically, users won&#39;t call this method directly, but instead use the</span>
</span><span id="DatabaseTable.load_archive-598"><a href="#DatabaseTable.load_archive-598"><span class="linenos">598</span></a><span class="sd">        `load_remote_archive` method, which handles downloading the archive</span>
</span><span id="DatabaseTable.load_archive-599"><a href="#DatabaseTable.load_archive-599"><span class="linenos">599</span></a><span class="sd">        file from the Simmate website for you.</span>
</span><span id="DatabaseTable.load_archive-600"><a href="#DatabaseTable.load_archive-600"><span class="linenos">600</span></a>
</span><span id="DatabaseTable.load_archive-601"><a href="#DatabaseTable.load_archive-601"><span class="linenos">601</span></a><span class="sd">        #### Parameters</span>
</span><span id="DatabaseTable.load_archive-602"><a href="#DatabaseTable.load_archive-602"><span class="linenos">602</span></a>
</span><span id="DatabaseTable.load_archive-603"><a href="#DatabaseTable.load_archive-603"><span class="linenos">603</span></a><span class="sd">        - `filename`:</span>
</span><span id="DatabaseTable.load_archive-604"><a href="#DatabaseTable.load_archive-604"><span class="linenos">604</span></a><span class="sd">            The filename to write the zip file to. By defualt, None will try to</span>
</span><span id="DatabaseTable.load_archive-605"><a href="#DatabaseTable.load_archive-605"><span class="linenos">605</span></a><span class="sd">            find a file named &quot;MyExampleTableName-2022-01-25.zip&quot;, where the date</span>
</span><span id="DatabaseTable.load_archive-606"><a href="#DatabaseTable.load_archive-606"><span class="linenos">606</span></a><span class="sd">            corresponds to version/timestamp. If multiple files match this format</span>
</span><span id="DatabaseTable.load_archive-607"><a href="#DatabaseTable.load_archive-607"><span class="linenos">607</span></a><span class="sd">            the most recent date will be used.</span>
</span><span id="DatabaseTable.load_archive-608"><a href="#DatabaseTable.load_archive-608"><span class="linenos">608</span></a>
</span><span id="DatabaseTable.load_archive-609"><a href="#DatabaseTable.load_archive-609"><span class="linenos">609</span></a><span class="sd">        - `delete_on_completion`:</span>
</span><span id="DatabaseTable.load_archive-610"><a href="#DatabaseTable.load_archive-610"><span class="linenos">610</span></a><span class="sd">            Whether to delete the archive file once all data is loaded into the</span>
</span><span id="DatabaseTable.load_archive-611"><a href="#DatabaseTable.load_archive-611"><span class="linenos">611</span></a><span class="sd">            database. Defaults to False</span>
</span><span id="DatabaseTable.load_archive-612"><a href="#DatabaseTable.load_archive-612"><span class="linenos">612</span></a>
</span><span id="DatabaseTable.load_archive-613"><a href="#DatabaseTable.load_archive-613"><span class="linenos">613</span></a><span class="sd">        - `confirm_override`:</span>
</span><span id="DatabaseTable.load_archive-614"><a href="#DatabaseTable.load_archive-614"><span class="linenos">614</span></a><span class="sd">            If the table already has data in it, the user must take particular</span>
</span><span id="DatabaseTable.load_archive-615"><a href="#DatabaseTable.load_archive-615"><span class="linenos">615</span></a><span class="sd">            care to downloading new data. This flag makes sure the user has</span>
</span><span id="DatabaseTable.load_archive-616"><a href="#DatabaseTable.load_archive-616"><span class="linenos">616</span></a><span class="sd">            made the proper checks to run this action. Default is False.</span>
</span><span id="DatabaseTable.load_archive-617"><a href="#DatabaseTable.load_archive-617"><span class="linenos">617</span></a>
</span><span id="DatabaseTable.load_archive-618"><a href="#DatabaseTable.load_archive-618"><span class="linenos">618</span></a><span class="sd">        - `parallel`:</span>
</span><span id="DatabaseTable.load_archive-619"><a href="#DatabaseTable.load_archive-619"><span class="linenos">619</span></a><span class="sd">            Whether to load the data in parallel. If true, this will start</span>
</span><span id="DatabaseTable.load_archive-620"><a href="#DatabaseTable.load_archive-620"><span class="linenos">620</span></a><span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
</span><span id="DatabaseTable.load_archive-621"><a href="#DatabaseTable.load_archive-621"><span class="linenos">621</span></a><span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
</span><span id="DatabaseTable.load_archive-622"><a href="#DatabaseTable.load_archive-622"><span class="linenos">622</span></a><span class="sd">            large datasets into the dataset. Default is False.</span>
</span><span id="DatabaseTable.load_archive-623"><a href="#DatabaseTable.load_archive-623"><span class="linenos">623</span></a>
</span><span id="DatabaseTable.load_archive-624"><a href="#DatabaseTable.load_archive-624"><span class="linenos">624</span></a><span class="sd">        - `confirm_sqlite_parallel`:</span>
</span><span id="DatabaseTable.load_archive-625"><a href="#DatabaseTable.load_archive-625"><span class="linenos">625</span></a><span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
</span><span id="DatabaseTable.load_archive-626"><a href="#DatabaseTable.load_archive-626"><span class="linenos">626</span></a><span class="sd">            knows what they are doing and know the risks of parallelization.</span>
</span><span id="DatabaseTable.load_archive-627"><a href="#DatabaseTable.load_archive-627"><span class="linenos">627</span></a><span class="sd">            Default is False.</span>
</span><span id="DatabaseTable.load_archive-628"><a href="#DatabaseTable.load_archive-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.load_archive-629"><a href="#DatabaseTable.load_archive-629"><span class="linenos">629</span></a>
</span><span id="DatabaseTable.load_archive-630"><a href="#DatabaseTable.load_archive-630"><span class="linenos">630</span></a>        <span class="c1"># make sure the user actually wants to do this!</span>
</span><span id="DatabaseTable.load_archive-631"><a href="#DatabaseTable.load_archive-631"><span class="linenos">631</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
</span><span id="DatabaseTable.load_archive-632"><a href="#DatabaseTable.load_archive-632"><span class="linenos">632</span></a>            <span class="n">confirm_override</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-633"><a href="#DatabaseTable.load_archive-633"><span class="linenos">633</span></a>            <span class="n">parallel</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-634"><a href="#DatabaseTable.load_archive-634"><span class="linenos">634</span></a>            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-635"><a href="#DatabaseTable.load_archive-635"><span class="linenos">635</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable.load_archive-636"><a href="#DatabaseTable.load_archive-636"><span class="linenos">636</span></a>
</span><span id="DatabaseTable.load_archive-637"><a href="#DatabaseTable.load_archive-637"><span class="linenos">637</span></a>        <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="DatabaseTable.load_archive-638"><a href="#DatabaseTable.load_archive-638"><span class="linenos">638</span></a>        <span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span> <span class="k">as</span> <span class="n">ToolkitStructure</span>
</span><span id="DatabaseTable.load_archive-639"><a href="#DatabaseTable.load_archive-639"><span class="linenos">639</span></a>
</span><span id="DatabaseTable.load_archive-640"><a href="#DatabaseTable.load_archive-640"><span class="linenos">640</span></a>        <span class="c1"># generate the file name if one wasn&#39;t given</span>
</span><span id="DatabaseTable.load_archive-641"><a href="#DatabaseTable.load_archive-641"><span class="linenos">641</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="DatabaseTable.load_archive-642"><a href="#DatabaseTable.load_archive-642"><span class="linenos">642</span></a>            <span class="c1"># The name will be something like &quot;MyExampleTable-2022-01-25.zip&quot;.</span>
</span><span id="DatabaseTable.load_archive-643"><a href="#DatabaseTable.load_archive-643"><span class="linenos">643</span></a>            <span class="c1"># We go through all files that match &quot;MyExampleTable-*.zip&quot; and then</span>
</span><span id="DatabaseTable.load_archive-644"><a href="#DatabaseTable.load_archive-644"><span class="linenos">644</span></a>            <span class="c1"># grab the most recent date.</span>
</span><span id="DatabaseTable.load_archive-645"><a href="#DatabaseTable.load_archive-645"><span class="linenos">645</span></a>            <span class="n">matching_files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DatabaseTable.load_archive-646"><a href="#DatabaseTable.load_archive-646"><span class="linenos">646</span></a>                <span class="n">file</span>
</span><span id="DatabaseTable.load_archive-647"><a href="#DatabaseTable.load_archive-647"><span class="linenos">647</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
</span><span id="DatabaseTable.load_archive-648"><a href="#DatabaseTable.load_archive-648"><span class="linenos">648</span></a>                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-649"><a href="#DatabaseTable.load_archive-649"><span class="linenos">649</span></a>            <span class="p">]</span>
</span><span id="DatabaseTable.load_archive-650"><a href="#DatabaseTable.load_archive-650"><span class="linenos">650</span></a>            <span class="c1"># make sure there is at least one file</span>
</span><span id="DatabaseTable.load_archive-651"><a href="#DatabaseTable.load_archive-651"><span class="linenos">651</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_files</span><span class="p">:</span>
</span><span id="DatabaseTable.load_archive-652"><a href="#DatabaseTable.load_archive-652"><span class="linenos">652</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
</span><span id="DatabaseTable.load_archive-653"><a href="#DatabaseTable.load_archive-653"><span class="linenos">653</span></a>                    <span class="sa">f</span><span class="s2">&quot;No file found matching the </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">-*.zip format&quot;</span>
</span><span id="DatabaseTable.load_archive-654"><a href="#DatabaseTable.load_archive-654"><span class="linenos">654</span></a>                <span class="p">)</span>
</span><span id="DatabaseTable.load_archive-655"><a href="#DatabaseTable.load_archive-655"><span class="linenos">655</span></a>            <span class="c1"># sort the files by date and grab the first</span>
</span><span id="DatabaseTable.load_archive-656"><a href="#DatabaseTable.load_archive-656"><span class="linenos">656</span></a>            <span class="n">matching_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-657"><a href="#DatabaseTable.load_archive-657"><span class="linenos">657</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">matching_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DatabaseTable.load_archive-658"><a href="#DatabaseTable.load_archive-658"><span class="linenos">658</span></a>
</span><span id="DatabaseTable.load_archive-659"><a href="#DatabaseTable.load_archive-659"><span class="linenos">659</span></a>        <span class="c1"># Turn the filename into the full path -- which makes a number of</span>
</span><span id="DatabaseTable.load_archive-660"><a href="#DatabaseTable.load_archive-660"><span class="linenos">660</span></a>        <span class="c1"># manipulations easier below.</span>
</span><span id="DatabaseTable.load_archive-661"><a href="#DatabaseTable.load_archive-661"><span class="linenos">661</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-662"><a href="#DatabaseTable.load_archive-662"><span class="linenos">662</span></a>
</span><span id="DatabaseTable.load_archive-663"><a href="#DatabaseTable.load_archive-663"><span class="linenos">663</span></a>        <span class="c1"># uncompress the zip file to the same directory that it is located in</span>
</span><span id="DatabaseTable.load_archive-664"><a href="#DatabaseTable.load_archive-664"><span class="linenos">664</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
</span><span id="DatabaseTable.load_archive-665"><a href="#DatabaseTable.load_archive-665"><span class="linenos">665</span></a>            <span class="n">filename</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-666"><a href="#DatabaseTable.load_archive-666"><span class="linenos">666</span></a>            <span class="n">extract_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
</span><span id="DatabaseTable.load_archive-667"><a href="#DatabaseTable.load_archive-667"><span class="linenos">667</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable.load_archive-668"><a href="#DatabaseTable.load_archive-668"><span class="linenos">668</span></a>
</span><span id="DatabaseTable.load_archive-669"><a href="#DatabaseTable.load_archive-669"><span class="linenos">669</span></a>        <span class="c1"># We will now have a csv file of the same name, which we load into</span>
</span><span id="DatabaseTable.load_archive-670"><a href="#DatabaseTable.load_archive-670"><span class="linenos">670</span></a>        <span class="c1"># a pandas dataframe</span>
</span><span id="DatabaseTable.load_archive-671"><a href="#DatabaseTable.load_archive-671"><span class="linenos">671</span></a>        <span class="n">csv_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-672"><a href="#DatabaseTable.load_archive-672"><span class="linenos">672</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-673"><a href="#DatabaseTable.load_archive-673"><span class="linenos">673</span></a>
</span><span id="DatabaseTable.load_archive-674"><a href="#DatabaseTable.load_archive-674"><span class="linenos">674</span></a>        <span class="c1"># BUG: NaN values throw errors when read into SQL databases, so we</span>
</span><span id="DatabaseTable.load_archive-675"><a href="#DatabaseTable.load_archive-675"><span class="linenos">675</span></a>        <span class="c1"># convert all NaN entries to None. This hacky line was taken from</span>
</span><span id="DatabaseTable.load_archive-676"><a href="#DatabaseTable.load_archive-676"><span class="linenos">676</span></a>        <span class="c1">#   https://stackoverflow.com/questions/39279824/</span>
</span><span id="DatabaseTable.load_archive-677"><a href="#DatabaseTable.load_archive-677"><span class="linenos">677</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-678"><a href="#DatabaseTable.load_archive-678"><span class="linenos">678</span></a>
</span><span id="DatabaseTable.load_archive-679"><a href="#DatabaseTable.load_archive-679"><span class="linenos">679</span></a>        <span class="c1"># convert the dataframe to a list of dictionaries that we will iterate</span>
</span><span id="DatabaseTable.load_archive-680"><a href="#DatabaseTable.load_archive-680"><span class="linenos">680</span></a>        <span class="c1"># through.</span>
</span><span id="DatabaseTable.load_archive-681"><a href="#DatabaseTable.load_archive-681"><span class="linenos">681</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-682"><a href="#DatabaseTable.load_archive-682"><span class="linenos">682</span></a>
</span><span id="DatabaseTable.load_archive-683"><a href="#DatabaseTable.load_archive-683"><span class="linenos">683</span></a>        <span class="c1"># to enable parallelization, we define a function to load a single</span>
</span><span id="DatabaseTable.load_archive-684"><a href="#DatabaseTable.load_archive-684"><span class="linenos">684</span></a>        <span class="c1"># entry (or row) of data. This allows us to submit the function to Dask.</span>
</span><span id="DatabaseTable.load_archive-685"><a href="#DatabaseTable.load_archive-685"><span class="linenos">685</span></a>        <span class="k">def</span> <span class="nf">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
</span><span id="DatabaseTable.load_archive-686"><a href="#DatabaseTable.load_archive-686"><span class="linenos">686</span></a>
</span><span id="DatabaseTable.load_archive-687"><a href="#DatabaseTable.load_archive-687"><span class="linenos">687</span></a>            <span class="c1"># For all entries, convert the structure_string to a toolkit structure</span>
</span><span id="DatabaseTable.load_archive-688"><a href="#DatabaseTable.load_archive-688"><span class="linenos">688</span></a>            <span class="k">if</span> <span class="s2">&quot;structure_string&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
</span><span id="DatabaseTable.load_archive-689"><a href="#DatabaseTable.load_archive-689"><span class="linenos">689</span></a>                <span class="n">structure_str</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure_string&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-690"><a href="#DatabaseTable.load_archive-690"><span class="linenos">690</span></a>                <span class="n">structure</span> <span class="o">=</span> <span class="n">ToolkitStructure</span><span class="o">.</span><span class="n">from_database_string</span><span class="p">(</span><span class="n">structure_str</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-691"><a href="#DatabaseTable.load_archive-691"><span class="linenos">691</span></a>                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">structure</span>
</span><span id="DatabaseTable.load_archive-692"><a href="#DatabaseTable.load_archive-692"><span class="linenos">692</span></a>            <span class="c1"># OPTIMIZE: is there a better way to do decide which entries need to be</span>
</span><span id="DatabaseTable.load_archive-693"><a href="#DatabaseTable.load_archive-693"><span class="linenos">693</span></a>            <span class="c1"># converted to toolkit objects? This code may be better placed in</span>
</span><span id="DatabaseTable.load_archive-694"><a href="#DatabaseTable.load_archive-694"><span class="linenos">694</span></a>            <span class="c1"># base_data_type methods (e.g. a `from_base_info` method for each)</span>
</span><span id="DatabaseTable.load_archive-695"><a href="#DatabaseTable.load_archive-695"><span class="linenos">695</span></a>
</span><span id="DatabaseTable.load_archive-696"><a href="#DatabaseTable.load_archive-696"><span class="linenos">696</span></a>            <span class="n">entry_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-697"><a href="#DatabaseTable.load_archive-697"><span class="linenos">697</span></a>            <span class="n">entry_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="DatabaseTable.load_archive-698"><a href="#DatabaseTable.load_archive-698"><span class="linenos">698</span></a>
</span><span id="DatabaseTable.load_archive-699"><a href="#DatabaseTable.load_archive-699"><span class="linenos">699</span></a>        <span class="c1"># now iterate through all entries to save them to the database</span>
</span><span id="DatabaseTable.load_archive-700"><a href="#DatabaseTable.load_archive-700"><span class="linenos">700</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="DatabaseTable.load_archive-701"><a href="#DatabaseTable.load_archive-701"><span class="linenos">701</span></a>            <span class="c1"># If user doesn&#39;t want parallelization, we run these in the main</span>
</span><span id="DatabaseTable.load_archive-702"><a href="#DatabaseTable.load_archive-702"><span class="linenos">702</span></a>            <span class="c1"># thread and monitor progress with tqdm</span>
</span><span id="DatabaseTable.load_archive-703"><a href="#DatabaseTable.load_archive-703"><span class="linenos">703</span></a>            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
</span><span id="DatabaseTable.load_archive-704"><a href="#DatabaseTable.load_archive-704"><span class="linenos">704</span></a>                <span class="n">load_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-705"><a href="#DatabaseTable.load_archive-705"><span class="linenos">705</span></a>        <span class="c1"># otherwise we use dask to submit these in batches!</span>
</span><span id="DatabaseTable.load_archive-706"><a href="#DatabaseTable.load_archive-706"><span class="linenos">706</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DatabaseTable.load_archive-707"><a href="#DatabaseTable.load_archive-707"><span class="linenos">707</span></a>
</span><span id="DatabaseTable.load_archive-708"><a href="#DatabaseTable.load_archive-708"><span class="linenos">708</span></a>            <span class="kn">from</span> <span class="nn">simmate.configuration.dask</span> <span class="kn">import</span> <span class="n">batch_submit</span>
</span><span id="DatabaseTable.load_archive-709"><a href="#DatabaseTable.load_archive-709"><span class="linenos">709</span></a>
</span><span id="DatabaseTable.load_archive-710"><a href="#DatabaseTable.load_archive-710"><span class="linenos">710</span></a>            <span class="n">batch_submit</span><span class="p">(</span>
</span><span id="DatabaseTable.load_archive-711"><a href="#DatabaseTable.load_archive-711"><span class="linenos">711</span></a>                <span class="n">function</span><span class="o">=</span><span class="n">load_single_entry</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-712"><a href="#DatabaseTable.load_archive-712"><span class="linenos">712</span></a>                <span class="n">args_list</span><span class="o">=</span><span class="n">entries</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-713"><a href="#DatabaseTable.load_archive-713"><span class="linenos">713</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span>
</span><span id="DatabaseTable.load_archive-714"><a href="#DatabaseTable.load_archive-714"><span class="linenos">714</span></a>            <span class="p">)</span>
</span><span id="DatabaseTable.load_archive-715"><a href="#DatabaseTable.load_archive-715"><span class="linenos">715</span></a>
</span><span id="DatabaseTable.load_archive-716"><a href="#DatabaseTable.load_archive-716"><span class="linenos">716</span></a>        <span class="c1"># We can now delete the files. The zip file is only deleted if requested.</span>
</span><span id="DatabaseTable.load_archive-717"><a href="#DatabaseTable.load_archive-717"><span class="linenos">717</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
</span><span id="DatabaseTable.load_archive-718"><a href="#DatabaseTable.load_archive-718"><span class="linenos">718</span></a>        <span class="k">if</span> <span class="n">delete_on_completion</span><span class="p">:</span>
</span><span id="DatabaseTable.load_archive-719"><a href="#DatabaseTable.load_archive-719"><span class="linenos">719</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># the zip archive</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Reads a compressed zip file made by <code>objects.to_archive</code> and loads the data
back into the Simmate database.</p>

<p>Typically, users won't call this method directly, but instead use the
<code><a href="#DatabaseTable.load_remote_archive">load_remote_archive</a></code> method, which handles downloading the archive
file from the Simmate website for you.</p>

<h4 id="parameters">Parameters</h4>

<ul>
<li><p><code>filename</code>:
The filename to write the zip file to. By defualt, None will try to
find a file named "MyExampleTableName-2022-01-25.zip", where the date
corresponds to version/timestamp. If multiple files match this format
the most recent date will be used.</p></li>
<li><p><code>delete_on_completion</code>:
Whether to delete the archive file once all data is loaded into the
database. Defaults to False</p></li>
<li><p><code>confirm_override</code>:
If the table already has data in it, the user must take particular
care to downloading new data. This flag makes sure the user has
made the proper checks to run this action. Default is False.</p></li>
<li><p><code>parallel</code>:
Whether to load the data in parallel. If true, this will start
a local Dask cluster and each data row will be submitted as a task
to the cluster. This provides substansial speed-ups for loading
large datasets into the dataset. Default is False.</p></li>
<li><p><code>confirm_sqlite_parallel</code>:
If the database backend is sqlite, this parameter ensures the user
knows what they are doing and know the risks of parallelization.
Default is False.</p></li>
</ul>
</div>


                            </div>
                            <div id="DatabaseTable.load_remote_archive" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.load_remote_archive">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">load_remote_archive</span><span class="signature">(
    cls,
    remote_archive_link: str = None,
    confirm_override: bool = False,
    parallel: bool = False,
    confirm_sqlite_parallel: bool = False
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.load_remote_archive-721"><a href="#DatabaseTable.load_remote_archive-721"><span class="linenos">721</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.load_remote_archive-722"><a href="#DatabaseTable.load_remote_archive-722"><span class="linenos">722</span></a>    <span class="k">def</span> <span class="nf">load_remote_archive</span><span class="p">(</span>
</span><span id="DatabaseTable.load_remote_archive-723"><a href="#DatabaseTable.load_remote_archive-723"><span class="linenos">723</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-724"><a href="#DatabaseTable.load_remote_archive-724"><span class="linenos">724</span></a>        <span class="n">remote_archive_link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-725"><a href="#DatabaseTable.load_remote_archive-725"><span class="linenos">725</span></a>        <span class="n">confirm_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-726"><a href="#DatabaseTable.load_remote_archive-726"><span class="linenos">726</span></a>        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-727"><a href="#DatabaseTable.load_remote_archive-727"><span class="linenos">727</span></a>        <span class="n">confirm_sqlite_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-728"><a href="#DatabaseTable.load_remote_archive-728"><span class="linenos">728</span></a>    <span class="p">):</span>
</span><span id="DatabaseTable.load_remote_archive-729"><a href="#DatabaseTable.load_remote_archive-729"><span class="linenos">729</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.load_remote_archive-730"><a href="#DatabaseTable.load_remote_archive-730"><span class="linenos">730</span></a><span class="sd">        Downloads a compressed zip file made by `objects.to_archive` and loads</span>
</span><span id="DatabaseTable.load_remote_archive-731"><a href="#DatabaseTable.load_remote_archive-731"><span class="linenos">731</span></a><span class="sd">        the data back into the Simmate database.</span>
</span><span id="DatabaseTable.load_remote_archive-732"><a href="#DatabaseTable.load_remote_archive-732"><span class="linenos">732</span></a>
</span><span id="DatabaseTable.load_remote_archive-733"><a href="#DatabaseTable.load_remote_archive-733"><span class="linenos">733</span></a><span class="sd">        This method should only be called once -- when you have a completely</span>
</span><span id="DatabaseTable.load_remote_archive-734"><a href="#DatabaseTable.load_remote_archive-734"><span class="linenos">734</span></a><span class="sd">        empty database. After this call, all data will be stored locally and</span>
</span><span id="DatabaseTable.load_remote_archive-735"><a href="#DatabaseTable.load_remote_archive-735"><span class="linenos">735</span></a><span class="sd">        you don&#39;t need to call this method again (even accross python sessions).</span>
</span><span id="DatabaseTable.load_remote_archive-736"><a href="#DatabaseTable.load_remote_archive-736"><span class="linenos">736</span></a>
</span><span id="DatabaseTable.load_remote_archive-737"><a href="#DatabaseTable.load_remote_archive-737"><span class="linenos">737</span></a><span class="sd">        #### Parameters</span>
</span><span id="DatabaseTable.load_remote_archive-738"><a href="#DatabaseTable.load_remote_archive-738"><span class="linenos">738</span></a>
</span><span id="DatabaseTable.load_remote_archive-739"><a href="#DatabaseTable.load_remote_archive-739"><span class="linenos">739</span></a><span class="sd">        - `remote_archive_link`:</span>
</span><span id="DatabaseTable.load_remote_archive-740"><a href="#DatabaseTable.load_remote_archive-740"><span class="linenos">740</span></a><span class="sd">            The URL for that the archive will be downloaded from. If not supplied,</span>
</span><span id="DatabaseTable.load_remote_archive-741"><a href="#DatabaseTable.load_remote_archive-741"><span class="linenos">741</span></a><span class="sd">            it will default to the table&#39;s remote_archive_link attribute.</span>
</span><span id="DatabaseTable.load_remote_archive-742"><a href="#DatabaseTable.load_remote_archive-742"><span class="linenos">742</span></a>
</span><span id="DatabaseTable.load_remote_archive-743"><a href="#DatabaseTable.load_remote_archive-743"><span class="linenos">743</span></a><span class="sd">        - `confirm_override`:</span>
</span><span id="DatabaseTable.load_remote_archive-744"><a href="#DatabaseTable.load_remote_archive-744"><span class="linenos">744</span></a><span class="sd">            If the table already has data in it, the user must take particular</span>
</span><span id="DatabaseTable.load_remote_archive-745"><a href="#DatabaseTable.load_remote_archive-745"><span class="linenos">745</span></a><span class="sd">            care to downloading new data. This flag makes sure the user has</span>
</span><span id="DatabaseTable.load_remote_archive-746"><a href="#DatabaseTable.load_remote_archive-746"><span class="linenos">746</span></a><span class="sd">            made the proper checks to run this action.</span>
</span><span id="DatabaseTable.load_remote_archive-747"><a href="#DatabaseTable.load_remote_archive-747"><span class="linenos">747</span></a>
</span><span id="DatabaseTable.load_remote_archive-748"><a href="#DatabaseTable.load_remote_archive-748"><span class="linenos">748</span></a><span class="sd">        - `parallel`:</span>
</span><span id="DatabaseTable.load_remote_archive-749"><a href="#DatabaseTable.load_remote_archive-749"><span class="linenos">749</span></a><span class="sd">            Whether to load the data in parallel. If true, this will start</span>
</span><span id="DatabaseTable.load_remote_archive-750"><a href="#DatabaseTable.load_remote_archive-750"><span class="linenos">750</span></a><span class="sd">            a local Dask cluster and each data row will be submitted as a task</span>
</span><span id="DatabaseTable.load_remote_archive-751"><a href="#DatabaseTable.load_remote_archive-751"><span class="linenos">751</span></a><span class="sd">            to the cluster. This provides substansial speed-ups for loading</span>
</span><span id="DatabaseTable.load_remote_archive-752"><a href="#DatabaseTable.load_remote_archive-752"><span class="linenos">752</span></a><span class="sd">            large datasets into the dataset. Default is False.</span>
</span><span id="DatabaseTable.load_remote_archive-753"><a href="#DatabaseTable.load_remote_archive-753"><span class="linenos">753</span></a>
</span><span id="DatabaseTable.load_remote_archive-754"><a href="#DatabaseTable.load_remote_archive-754"><span class="linenos">754</span></a><span class="sd">        - `confirm_sqlite_parallel`:</span>
</span><span id="DatabaseTable.load_remote_archive-755"><a href="#DatabaseTable.load_remote_archive-755"><span class="linenos">755</span></a><span class="sd">            If the database backend is sqlite, this parameter ensures the user</span>
</span><span id="DatabaseTable.load_remote_archive-756"><a href="#DatabaseTable.load_remote_archive-756"><span class="linenos">756</span></a><span class="sd">            knows what they are doing and know the risks of parallelization.</span>
</span><span id="DatabaseTable.load_remote_archive-757"><a href="#DatabaseTable.load_remote_archive-757"><span class="linenos">757</span></a><span class="sd">            Default is False.</span>
</span><span id="DatabaseTable.load_remote_archive-758"><a href="#DatabaseTable.load_remote_archive-758"><span class="linenos">758</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.load_remote_archive-759"><a href="#DatabaseTable.load_remote_archive-759"><span class="linenos">759</span></a>
</span><span id="DatabaseTable.load_remote_archive-760"><a href="#DatabaseTable.load_remote_archive-760"><span class="linenos">760</span></a>        <span class="c1"># make sure the user actually wants to do this!</span>
</span><span id="DatabaseTable.load_remote_archive-761"><a href="#DatabaseTable.load_remote_archive-761"><span class="linenos">761</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_confirm_override</span><span class="p">(</span>
</span><span id="DatabaseTable.load_remote_archive-762"><a href="#DatabaseTable.load_remote_archive-762"><span class="linenos">762</span></a>            <span class="n">confirm_override</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-763"><a href="#DatabaseTable.load_remote_archive-763"><span class="linenos">763</span></a>            <span class="n">parallel</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-764"><a href="#DatabaseTable.load_remote_archive-764"><span class="linenos">764</span></a>            <span class="n">confirm_sqlite_parallel</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-765"><a href="#DatabaseTable.load_remote_archive-765"><span class="linenos">765</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable.load_remote_archive-766"><a href="#DatabaseTable.load_remote_archive-766"><span class="linenos">766</span></a>
</span><span id="DatabaseTable.load_remote_archive-767"><a href="#DatabaseTable.load_remote_archive-767"><span class="linenos">767</span></a>        <span class="c1"># confirm that we have a link to download from</span>
</span><span id="DatabaseTable.load_remote_archive-768"><a href="#DatabaseTable.load_remote_archive-768"><span class="linenos">768</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">remote_archive_link</span><span class="p">:</span>
</span><span id="DatabaseTable.load_remote_archive-769"><a href="#DatabaseTable.load_remote_archive-769"><span class="linenos">769</span></a>            <span class="c1"># if no link was given we take the input value from class attribute</span>
</span><span id="DatabaseTable.load_remote_archive-770"><a href="#DatabaseTable.load_remote_archive-770"><span class="linenos">770</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span><span class="p">:</span>
</span><span id="DatabaseTable.load_remote_archive-771"><a href="#DatabaseTable.load_remote_archive-771"><span class="linenos">771</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="DatabaseTable.load_remote_archive-772"><a href="#DatabaseTable.load_remote_archive-772"><span class="linenos">772</span></a>                    <span class="s2">&quot;This table does not have a default link to load the archive &quot;</span>
</span><span id="DatabaseTable.load_remote_archive-773"><a href="#DatabaseTable.load_remote_archive-773"><span class="linenos">773</span></a>                    <span class="s2">&quot; from. You must provide a remote_archive_link.&quot;</span>
</span><span id="DatabaseTable.load_remote_archive-774"><a href="#DatabaseTable.load_remote_archive-774"><span class="linenos">774</span></a>                <span class="p">)</span>
</span><span id="DatabaseTable.load_remote_archive-775"><a href="#DatabaseTable.load_remote_archive-775"><span class="linenos">775</span></a>            <span class="n">remote_archive_link</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remote_archive_link</span>
</span><span id="DatabaseTable.load_remote_archive-776"><a href="#DatabaseTable.load_remote_archive-776"><span class="linenos">776</span></a>
</span><span id="DatabaseTable.load_remote_archive-777"><a href="#DatabaseTable.load_remote_archive-777"><span class="linenos">777</span></a>        <span class="c1"># tell the user where the data comes from</span>
</span><span id="DatabaseTable.load_remote_archive-778"><a href="#DatabaseTable.load_remote_archive-778"><span class="linenos">778</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span> <span class="o">==</span> <span class="s2">&quot;third_parties&quot;</span><span class="p">:</span>
</span><span id="DatabaseTable.load_remote_archive-779"><a href="#DatabaseTable.load_remote_archive-779"><span class="linenos">779</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="DatabaseTable.load_remote_archive-780"><a href="#DatabaseTable.load_remote_archive-780"><span class="linenos">780</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">WARNING: this data is NOT from the Simmate team, so be sure &quot;</span>
</span><span id="DatabaseTable.load_remote_archive-781"><a href="#DatabaseTable.load_remote_archive-781"><span class="linenos">781</span></a>                <span class="s2">&quot;to visit the provider&#39;s website and to cite their work.&quot;</span>
</span><span id="DatabaseTable.load_remote_archive-782"><a href="#DatabaseTable.load_remote_archive-782"><span class="linenos">782</span></a>                <span class="sa">f</span><span class="s2">&quot; This data is from </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2"> and the following paper &quot;</span>
</span><span id="DatabaseTable.load_remote_archive-783"><a href="#DatabaseTable.load_remote_archive-783"><span class="linenos">783</span></a>                <span class="sa">f</span><span class="s2">&quot;should be cited: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">source_doi</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DatabaseTable.load_remote_archive-784"><a href="#DatabaseTable.load_remote_archive-784"><span class="linenos">784</span></a>            <span class="p">)</span>
</span><span id="DatabaseTable.load_remote_archive-785"><a href="#DatabaseTable.load_remote_archive-785"><span class="linenos">785</span></a>
</span><span id="DatabaseTable.load_remote_archive-786"><a href="#DatabaseTable.load_remote_archive-786"><span class="linenos">786</span></a>        <span class="c1"># Predetermine the file name, which is just the ending of the URL</span>
</span><span id="DatabaseTable.load_remote_archive-787"><a href="#DatabaseTable.load_remote_archive-787"><span class="linenos">787</span></a>        <span class="n">archive_filename</span> <span class="o">=</span> <span class="n">remote_archive_link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DatabaseTable.load_remote_archive-788"><a href="#DatabaseTable.load_remote_archive-788"><span class="linenos">788</span></a>
</span><span id="DatabaseTable.load_remote_archive-789"><a href="#DatabaseTable.load_remote_archive-789"><span class="linenos">789</span></a>        <span class="c1"># Download the archive zip file from the URL to the current working dir</span>
</span><span id="DatabaseTable.load_remote_archive-790"><a href="#DatabaseTable.load_remote_archive-790"><span class="linenos">790</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading archive file...&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable.load_remote_archive-791"><a href="#DatabaseTable.load_remote_archive-791"><span class="linenos">791</span></a>        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">remote_archive_link</span><span class="p">,</span> <span class="n">archive_filename</span><span class="p">)</span>
</span><span id="DatabaseTable.load_remote_archive-792"><a href="#DatabaseTable.load_remote_archive-792"><span class="linenos">792</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable.load_remote_archive-793"><a href="#DatabaseTable.load_remote_archive-793"><span class="linenos">793</span></a>
</span><span id="DatabaseTable.load_remote_archive-794"><a href="#DatabaseTable.load_remote_archive-794"><span class="linenos">794</span></a>        <span class="c1"># now that the archive is downloaded, we can load it into our db</span>
</span><span id="DatabaseTable.load_remote_archive-795"><a href="#DatabaseTable.load_remote_archive-795"><span class="linenos">795</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading data into Simmate database...&quot;</span><span class="p">)</span>
</span><span id="DatabaseTable.load_remote_archive-796"><a href="#DatabaseTable.load_remote_archive-796"><span class="linenos">796</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">load_archive</span><span class="p">(</span>
</span><span id="DatabaseTable.load_remote_archive-797"><a href="#DatabaseTable.load_remote_archive-797"><span class="linenos">797</span></a>            <span class="n">archive_filename</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-798"><a href="#DatabaseTable.load_remote_archive-798"><span class="linenos">798</span></a>            <span class="n">delete_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-799"><a href="#DatabaseTable.load_remote_archive-799"><span class="linenos">799</span></a>            <span class="n">confirm_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
</span><span id="DatabaseTable.load_remote_archive-800"><a href="#DatabaseTable.load_remote_archive-800"><span class="linenos">800</span></a>            <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
</span><span id="DatabaseTable.load_remote_archive-801"><a href="#DatabaseTable.load_remote_archive-801"><span class="linenos">801</span></a>            <span class="n">confirm_sqlite_parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we already confirmed this above</span>
</span><span id="DatabaseTable.load_remote_archive-802"><a href="#DatabaseTable.load_remote_archive-802"><span class="linenos">802</span></a>        <span class="p">)</span>
</span><span id="DatabaseTable.load_remote_archive-803"><a href="#DatabaseTable.load_remote_archive-803"><span class="linenos">803</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Downloads a compressed zip file made by <code>objects.to_archive</code> and loads
the data back into the Simmate database.</p>

<p>This method should only be called once -- when you have a completely
empty database. After this call, all data will be stored locally and
you don't need to call this method again (even accross python sessions).</p>

<h4 id="parameters">Parameters</h4>

<ul>
<li><p><code><a href="#DatabaseTable.remote_archive_link">remote_archive_link</a></code>:
The URL for that the archive will be downloaded from. If not supplied,
it will default to the table's remote_archive_link attribute.</p></li>
<li><p><code>confirm_override</code>:
If the table already has data in it, the user must take particular
care to downloading new data. This flag makes sure the user has
made the proper checks to run this action.</p></li>
<li><p><code>parallel</code>:
Whether to load the data in parallel. If true, this will start
a local Dask cluster and each data row will be submitted as a task
to the cluster. This provides substansial speed-ups for loading
large datasets into the dataset. Default is False.</p></li>
<li><p><code>confirm_sqlite_parallel</code>:
If the database backend is sqlite, this parameter ensures the user
knows what they are doing and know the risks of parallelization.
Default is False.</p></li>
</ul>
</div>


                            </div>
                            <div id="DatabaseTable.get_column_names" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.get_column_names">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">get_column_names</span><span class="signature">(cls) -&gt; List[str]</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.get_column_names-805"><a href="#DatabaseTable.get_column_names-805"><span class="linenos">805</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.get_column_names-806"><a href="#DatabaseTable.get_column_names-806"><span class="linenos">806</span></a>    <span class="k">def</span> <span class="nf">get_column_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DatabaseTable.get_column_names-807"><a href="#DatabaseTable.get_column_names-807"><span class="linenos">807</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_column_names-808"><a href="#DatabaseTable.get_column_names-808"><span class="linenos">808</span></a><span class="sd">        Returns a list of all the column names for this table and indicates which</span>
</span><span id="DatabaseTable.get_column_names-809"><a href="#DatabaseTable.get_column_names-809"><span class="linenos">809</span></a><span class="sd">        columns are related to other tables. This is primarily used to help</span>
</span><span id="DatabaseTable.get_column_names-810"><a href="#DatabaseTable.get_column_names-810"><span class="linenos">810</span></a><span class="sd">        view what data is available.</span>
</span><span id="DatabaseTable.get_column_names-811"><a href="#DatabaseTable.get_column_names-811"><span class="linenos">811</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_column_names-812"><a href="#DatabaseTable.get_column_names-812"><span class="linenos">812</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()]</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Returns a list of all the column names for this table and indicates which
columns are related to other tables. This is primarily used to help
view what data is available.</p>
</div>


                            </div>
                            <div id="DatabaseTable.show_columns" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.show_columns">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">show_columns</span><span class="signature">(cls)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.show_columns-814"><a href="#DatabaseTable.show_columns-814"><span class="linenos">814</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.show_columns-815"><a href="#DatabaseTable.show_columns-815"><span class="linenos">815</span></a>    <span class="k">def</span> <span class="nf">show_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="DatabaseTable.show_columns-816"><a href="#DatabaseTable.show_columns-816"><span class="linenos">816</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.show_columns-817"><a href="#DatabaseTable.show_columns-817"><span class="linenos">817</span></a><span class="sd">        Prints a list of all the column names for this table and indicates which</span>
</span><span id="DatabaseTable.show_columns-818"><a href="#DatabaseTable.show_columns-818"><span class="linenos">818</span></a><span class="sd">        columns are related to other tables. This is primarily used to help users</span>
</span><span id="DatabaseTable.show_columns-819"><a href="#DatabaseTable.show_columns-819"><span class="linenos">819</span></a><span class="sd">        interactively view what data is available.</span>
</span><span id="DatabaseTable.show_columns-820"><a href="#DatabaseTable.show_columns-820"><span class="linenos">820</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.show_columns-821"><a href="#DatabaseTable.show_columns-821"><span class="linenos">821</span></a>        <span class="c1"># Iterate through and grab the columns. Note we don&#39;t use get_column_names</span>
</span><span id="DatabaseTable.show_columns-822"><a href="#DatabaseTable.show_columns-822"><span class="linenos">822</span></a>        <span class="c1"># here because we are attaching relation data as well.</span>
</span><span id="DatabaseTable.show_columns-823"><a href="#DatabaseTable.show_columns-823"><span class="linenos">823</span></a>        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DatabaseTable.show_columns-824"><a href="#DatabaseTable.show_columns-824"><span class="linenos">824</span></a>            <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (relation to </span><span class="si">{</span><span class="n">column</span><span class="o">.</span><span class="n">related_model</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="DatabaseTable.show_columns-825"><a href="#DatabaseTable.show_columns-825"><span class="linenos">825</span></a>            <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">is_relation</span>
</span><span id="DatabaseTable.show_columns-826"><a href="#DatabaseTable.show_columns-826"><span class="linenos">826</span></a>            <span class="k">else</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
</span><span id="DatabaseTable.show_columns-827"><a href="#DatabaseTable.show_columns-827"><span class="linenos">827</span></a>            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
</span><span id="DatabaseTable.show_columns-828"><a href="#DatabaseTable.show_columns-828"><span class="linenos">828</span></a>        <span class="p">]</span>
</span><span id="DatabaseTable.show_columns-829"><a href="#DatabaseTable.show_columns-829"><span class="linenos">829</span></a>
</span><span id="DatabaseTable.show_columns-830"><a href="#DatabaseTable.show_columns-830"><span class="linenos">830</span></a>        <span class="c1"># Then use yaml to make the printout pretty (no quotes and separate lines)</span>
</span><span id="DatabaseTable.show_columns-831"><a href="#DatabaseTable.show_columns-831"><span class="linenos">831</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Prints a list of all the column names for this table and indicates which
columns are related to other tables. This is primarily used to help users
interactively view what data is available.</p>
</div>


                            </div>
                            <div id="DatabaseTable.get_mixins" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.get_mixins">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">get_mixins</span><span class="signature">(cls) -&gt; list</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.get_mixins-833"><a href="#DatabaseTable.get_mixins-833"><span class="linenos">833</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.get_mixins-834"><a href="#DatabaseTable.get_mixins-834"><span class="linenos">834</span></a>    <span class="k">def</span> <span class="nf">get_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>  <span class="c1"># -&gt; List[DatabaseTable]</span>
</span><span id="DatabaseTable.get_mixins-835"><a href="#DatabaseTable.get_mixins-835"><span class="linenos">835</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_mixins-836"><a href="#DatabaseTable.get_mixins-836"><span class="linenos">836</span></a><span class="sd">        Grabs the mix-in Tables that were used to make this class. This will</span>
</span><span id="DatabaseTable.get_mixins-837"><a href="#DatabaseTable.get_mixins-837"><span class="linenos">837</span></a><span class="sd">        be mix-ins like Structure, Forces, etc. from the</span>
</span><span id="DatabaseTable.get_mixins-838"><a href="#DatabaseTable.get_mixins-838"><span class="linenos">838</span></a><span class="sd">        `simmate.database.base_data_types` module.</span>
</span><span id="DatabaseTable.get_mixins-839"><a href="#DatabaseTable.get_mixins-839"><span class="linenos">839</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_mixins-840"><a href="#DatabaseTable.get_mixins-840"><span class="linenos">840</span></a>        <span class="c1"># this must be imported locally because it depends on all other classes</span>
</span><span id="DatabaseTable.get_mixins-841"><a href="#DatabaseTable.get_mixins-841"><span class="linenos">841</span></a>        <span class="c1"># from this module -- and will create circular import issues if outside</span>
</span><span id="DatabaseTable.get_mixins-842"><a href="#DatabaseTable.get_mixins-842"><span class="linenos">842</span></a>        <span class="kn">from</span> <span class="nn">simmate.database</span> <span class="kn">import</span> <span class="n">base_data_types</span> <span class="k">as</span> <span class="n">simmate_mixins</span>
</span><span id="DatabaseTable.get_mixins-843"><a href="#DatabaseTable.get_mixins-843"><span class="linenos">843</span></a>
</span><span id="DatabaseTable.get_mixins-844"><a href="#DatabaseTable.get_mixins-844"><span class="linenos">844</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="DatabaseTable.get_mixins-845"><a href="#DatabaseTable.get_mixins-845"><span class="linenos">845</span></a>            <span class="n">parent</span>
</span><span id="DatabaseTable.get_mixins-846"><a href="#DatabaseTable.get_mixins-846"><span class="linenos">846</span></a>            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span>
</span><span id="DatabaseTable.get_mixins-847"><a href="#DatabaseTable.get_mixins-847"><span class="linenos">847</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">simmate_mixins</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="DatabaseTable.get_mixins-848"><a href="#DatabaseTable.get_mixins-848"><span class="linenos">848</span></a>            <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;DatabaseTable&quot;</span>
</span><span id="DatabaseTable.get_mixins-849"><a href="#DatabaseTable.get_mixins-849"><span class="linenos">849</span></a>        <span class="p">]</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Grabs the mix-in Tables that were used to make this class. This will
be mix-ins like Structure, Forces, etc. from the
<code><a href="../base_data_types.html">simmate.database.base_data_types</a></code> module.</p>
</div>


                            </div>
                            <div id="DatabaseTable.get_mixin_names" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.get_mixin_names">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">get_mixin_names</span><span class="signature">(cls) -&gt; List[str]</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.get_mixin_names-851"><a href="#DatabaseTable.get_mixin_names-851"><span class="linenos">851</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.get_mixin_names-852"><a href="#DatabaseTable.get_mixin_names-852"><span class="linenos">852</span></a>    <span class="k">def</span> <span class="nf">get_mixin_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DatabaseTable.get_mixin_names-853"><a href="#DatabaseTable.get_mixin_names-853"><span class="linenos">853</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_mixin_names-854"><a href="#DatabaseTable.get_mixin_names-854"><span class="linenos">854</span></a><span class="sd">        Grabs the mix-in Tables that were used to make this class and returns</span>
</span><span id="DatabaseTable.get_mixin_names-855"><a href="#DatabaseTable.get_mixin_names-855"><span class="linenos">855</span></a><span class="sd">        a list of their names.</span>
</span><span id="DatabaseTable.get_mixin_names-856"><a href="#DatabaseTable.get_mixin_names-856"><span class="linenos">856</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_mixin_names-857"><a href="#DatabaseTable.get_mixin_names-857"><span class="linenos">857</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">mixin</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">mixin</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_mixins</span><span class="p">()]</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Grabs the mix-in Tables that were used to make this class and returns
a list of their names.</p>
</div>


                            </div>
                            <div id="DatabaseTable.get_extra_columns" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.get_extra_columns">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">get_extra_columns</span><span class="signature">(cls) -&gt; List[str]</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.get_extra_columns-859"><a href="#DatabaseTable.get_extra_columns-859"><span class="linenos">859</span></a>    <span class="nd">@classmethod</span>
</span><span id="DatabaseTable.get_extra_columns-860"><a href="#DatabaseTable.get_extra_columns-860"><span class="linenos">860</span></a>    <span class="k">def</span> <span class="nf">get_extra_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DatabaseTable.get_extra_columns-861"><a href="#DatabaseTable.get_extra_columns-861"><span class="linenos">861</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_extra_columns-862"><a href="#DatabaseTable.get_extra_columns-862"><span class="linenos">862</span></a><span class="sd">        Finds all columns that aren&#39;t covered by the supported Table mix-ins.</span>
</span><span id="DatabaseTable.get_extra_columns-863"><a href="#DatabaseTable.get_extra_columns-863"><span class="linenos">863</span></a>
</span><span id="DatabaseTable.get_extra_columns-864"><a href="#DatabaseTable.get_extra_columns-864"><span class="linenos">864</span></a><span class="sd">        For example, a table made from...</span>
</span><span id="DatabaseTable.get_extra_columns-865"><a href="#DatabaseTable.get_extra_columns-865"><span class="linenos">865</span></a>
</span><span id="DatabaseTable.get_extra_columns-866"><a href="#DatabaseTable.get_extra_columns-866"><span class="linenos">866</span></a><span class="sd">        ``` python</span>
</span><span id="DatabaseTable.get_extra_columns-867"><a href="#DatabaseTable.get_extra_columns-867"><span class="linenos">867</span></a><span class="sd">        from simmate.database.base_data_types import (</span>
</span><span id="DatabaseTable.get_extra_columns-868"><a href="#DatabaseTable.get_extra_columns-868"><span class="linenos">868</span></a><span class="sd">            table_column,</span>
</span><span id="DatabaseTable.get_extra_columns-869"><a href="#DatabaseTable.get_extra_columns-869"><span class="linenos">869</span></a><span class="sd">            Structure,</span>
</span><span id="DatabaseTable.get_extra_columns-870"><a href="#DatabaseTable.get_extra_columns-870"><span class="linenos">870</span></a><span class="sd">            Forces,</span>
</span><span id="DatabaseTable.get_extra_columns-871"><a href="#DatabaseTable.get_extra_columns-871"><span class="linenos">871</span></a><span class="sd">        )</span>
</span><span id="DatabaseTable.get_extra_columns-872"><a href="#DatabaseTable.get_extra_columns-872"><span class="linenos">872</span></a>
</span><span id="DatabaseTable.get_extra_columns-873"><a href="#DatabaseTable.get_extra_columns-873"><span class="linenos">873</span></a><span class="sd">        class ExampleTable(Structure, Forces):</span>
</span><span id="DatabaseTable.get_extra_columns-874"><a href="#DatabaseTable.get_extra_columns-874"><span class="linenos">874</span></a><span class="sd">            custom_column1 = table_column.FloatField()</span>
</span><span id="DatabaseTable.get_extra_columns-875"><a href="#DatabaseTable.get_extra_columns-875"><span class="linenos">875</span></a><span class="sd">            custom_column2 = table_column.FloatField()</span>
</span><span id="DatabaseTable.get_extra_columns-876"><a href="#DatabaseTable.get_extra_columns-876"><span class="linenos">876</span></a><span class="sd">        ```</span>
</span><span id="DatabaseTable.get_extra_columns-877"><a href="#DatabaseTable.get_extra_columns-877"><span class="linenos">877</span></a>
</span><span id="DatabaseTable.get_extra_columns-878"><a href="#DatabaseTable.get_extra_columns-878"><span class="linenos">878</span></a><span class="sd">        ... would return ...</span>
</span><span id="DatabaseTable.get_extra_columns-879"><a href="#DatabaseTable.get_extra_columns-879"><span class="linenos">879</span></a>
</span><span id="DatabaseTable.get_extra_columns-880"><a href="#DatabaseTable.get_extra_columns-880"><span class="linenos">880</span></a><span class="sd">        ``` python</span>
</span><span id="DatabaseTable.get_extra_columns-881"><a href="#DatabaseTable.get_extra_columns-881"><span class="linenos">881</span></a><span class="sd">        [&quot;custom_column1&quot;, &quot;custom_column2&quot;]</span>
</span><span id="DatabaseTable.get_extra_columns-882"><a href="#DatabaseTable.get_extra_columns-882"><span class="linenos">882</span></a><span class="sd">        ```</span>
</span><span id="DatabaseTable.get_extra_columns-883"><a href="#DatabaseTable.get_extra_columns-883"><span class="linenos">883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatabaseTable.get_extra_columns-884"><a href="#DatabaseTable.get_extra_columns-884"><span class="linenos">884</span></a>
</span><span id="DatabaseTable.get_extra_columns-885"><a href="#DatabaseTable.get_extra_columns-885"><span class="linenos">885</span></a>        <span class="n">all_columns</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">()</span>
</span><span id="DatabaseTable.get_extra_columns-886"><a href="#DatabaseTable.get_extra_columns-886"><span class="linenos">886</span></a>        <span class="n">columns_w_mixin</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DatabaseTable.get_extra_columns-887"><a href="#DatabaseTable.get_extra_columns-887"><span class="linenos">887</span></a>            <span class="n">column</span> <span class="k">for</span> <span class="n">mixin</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_mixins</span><span class="p">()</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">mixin</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">()</span>
</span><span id="DatabaseTable.get_extra_columns-888"><a href="#DatabaseTable.get_extra_columns-888"><span class="linenos">888</span></a>        <span class="p">]</span>
</span><span id="DatabaseTable.get_extra_columns-889"><a href="#DatabaseTable.get_extra_columns-889"><span class="linenos">889</span></a>        <span class="n">extra_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DatabaseTable.get_extra_columns-890"><a href="#DatabaseTable.get_extra_columns-890"><span class="linenos">890</span></a>            <span class="n">column</span>
</span><span id="DatabaseTable.get_extra_columns-891"><a href="#DatabaseTable.get_extra_columns-891"><span class="linenos">891</span></a>            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">all_columns</span>
</span><span id="DatabaseTable.get_extra_columns-892"><a href="#DatabaseTable.get_extra_columns-892"><span class="linenos">892</span></a>            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns_w_mixin</span> <span class="ow">and</span> <span class="n">column</span> <span class="o">!=</span> <span class="s2">&quot;id&quot;</span>
</span><span id="DatabaseTable.get_extra_columns-893"><a href="#DatabaseTable.get_extra_columns-893"><span class="linenos">893</span></a>        <span class="p">]</span>
</span><span id="DatabaseTable.get_extra_columns-894"><a href="#DatabaseTable.get_extra_columns-894"><span class="linenos">894</span></a>        <span class="k">return</span> <span class="n">extra_columns</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Finds all columns that aren't covered by the supported Table mix-ins.</p>

<p>For example, a table made from...</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="../base_data_types.html">simmate.database.base_data_types</a></span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">table_column</span><span class="p">,</span>
    <span class="n">Structure</span><span class="p">,</span>
    <span class="n">Forces</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">ExampleTable</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Forces</span><span class="p">):</span>
    <span class="n">custom_column1</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">custom_column2</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
</code></pre></div>

<p>... would return ...</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="p">[</span><span class="s2">&quot;custom_column1&quot;</span><span class="p">,</span> <span class="s2">&quot;custom_column2&quot;</span><span class="p">]</span>
</code></pre></div>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>django.db.models.base.Model</dt>
                                <dd id="DatabaseTable.__init__" class="function">Model</dd>
                <dd id="DatabaseTable.from_db" class="function">from_db</dd>
                <dd id="DatabaseTable.pk" class="variable">pk</dd>
                <dd id="DatabaseTable.get_deferred_fields" class="function">get_deferred_fields</dd>
                <dd id="DatabaseTable.refresh_from_db" class="function">refresh_from_db</dd>
                <dd id="DatabaseTable.serializable_value" class="function">serializable_value</dd>
                <dd id="DatabaseTable.save" class="function">save</dd>
                <dd id="DatabaseTable.save_base" class="function">save_base</dd>
                <dd id="DatabaseTable.delete" class="function">delete</dd>
                <dd id="DatabaseTable.prepare_database_save" class="function">prepare_database_save</dd>
                <dd id="DatabaseTable.clean" class="function">clean</dd>
                <dd id="DatabaseTable.validate_unique" class="function">validate_unique</dd>
                <dd id="DatabaseTable.date_error_message" class="function">date_error_message</dd>
                <dd id="DatabaseTable.unique_error_message" class="function">unique_error_message</dd>
                <dd id="DatabaseTable.full_clean" class="function">full_clean</dd>
                <dd id="DatabaseTable.clean_fields" class="function">clean_fields</dd>
                <dd id="DatabaseTable.check" class="function">check</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DatabaseTable.Meta">
                                <div class="attr class">
        <a class="headerlink" href="#DatabaseTable.Meta">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">DatabaseTable.Meta</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatabaseTable.Meta-243"><a href="#DatabaseTable.Meta-243"><span class="linenos">243</span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span id="DatabaseTable.Meta-244"><a href="#DatabaseTable.Meta-244"><span class="linenos">244</span></a>        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>

        </details>

    

                            <div id="DatabaseTable.Meta.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DatabaseTable.Meta.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">DatabaseTable.Meta</span><span class="signature">()</span>
    </div>

    
    

                            </div>
                            <div id="DatabaseTable.Meta.abstract" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DatabaseTable.Meta.abstract">#&nbsp;&nbsp</a>

        <span class="name">abstract</span><span class="default_value"> = False</span>
    </div>

    
    

                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>