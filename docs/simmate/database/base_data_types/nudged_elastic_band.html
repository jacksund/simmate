<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 10.0.1"/>
    <title>simmate.database.base_data_types.nudged_elastic_band API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../base_data_types.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simmate.database.base_data_types</a>

<a href="https://github.com/jacksund/simmate">            <img src="https://github.com/jacksund/simmate/blob/main/logo/simmate.svg?raw=true" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#DiffusionAnalysis">DiffusionAnalysis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="class" href="#DiffusionAnalysis.Meta">DiffusionAnalysis.Meta</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#DiffusionAnalysis.Meta.__init__">Meta</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#DiffusionAnalysis.Meta.abstract">abstract</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#DiffusionAnalysis.Meta.app_label">app_label</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.migrating_specie">migrating_specie</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.vacancy_mode">vacancy_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.atomic_fraction">atomic_fraction</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.barrier_cell">barrier_cell</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.paths_involved">paths_involved</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.npaths_involved">npaths_involved</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.from_toolkit">from_toolkit</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.from_directory">from_directory</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.create_subclasses">create_subclasses</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.structure_string">structure_string</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.nsites">nsites</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.nelements">nelements</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.elements">elements</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.chemical_system">chemical_system</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.density">density</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.density_atomic">density_atomic</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.volume">volume</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.volume_molar">volume_molar</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.formula_full">formula_full</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.formula_reduced">formula_reduced</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.formula_anonymous">formula_anonymous</a>
                        </li>
                        <li>
                                <a class="variable" href="#DiffusionAnalysis.spacegroup">spacegroup</a>
                        </li>
                        <li>
                                <a class="function" href="#DiffusionAnalysis.source">source</a>
                        </li>
                        <li>
                                <a class="variable" href="#DiffusionAnalysis.spacegroup_id">spacegroup_id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MigrationHop">MigrationHop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="class" href="#MigrationHop.Meta">MigrationHop.Meta</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#MigrationHop.Meta.__init__">Meta</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#MigrationHop.Meta.abstract">abstract</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#MigrationHop.Meta.app_label">app_label</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="variable" href="#MigrationHop.base_info">base_info</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.site_start">site_start</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.site_end">site_end</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.index_start">index_start</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.index_end">index_end</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.number">number</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.length">length</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.dimension_path">dimension_path</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.dimension_host_lattice">dimension_host_lattice</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.energy_barrier">energy_barrier</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.to_toolkit">to_toolkit</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.from_directory">from_directory</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.from_pymatgen">from_pymatgen</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.create_subclasses_from_diffusion_analysis">create_subclasses_from_diffusion_analysis</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationHop.source">source</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MigrationImage">MigrationImage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="class" href="#MigrationImage.Meta">MigrationImage.Meta</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#MigrationImage.Meta.__init__">Meta</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#MigrationImage.Meta.abstract">abstract</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#MigrationImage.Meta.app_label">app_label</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="variable" href="#MigrationImage.base_info">base_info</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.number">number</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.force_tangent">force_tangent</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.energy">energy</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.structure_distance">structure_distance</a>
                        </li>
                        <li>
                                <a class="variable" href="#MigrationImage.source">source</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.create_subclass_from_migration_hop">create_subclass_from_migration_hop</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.structure_string">structure_string</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.nsites">nsites</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.nelements">nelements</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.elements">elements</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.chemical_system">chemical_system</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.density">density</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.density_atomic">density_atomic</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.volume">volume</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.volume_molar">volume_molar</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.formula_full">formula_full</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.formula_reduced">formula_reduced</a>
                        </li>
                        <li>
                                <a class="function" href="#MigrationImage.formula_anonymous">formula_anonymous</a>
                        </li>
                        <li>
                                <a class="variable" href="#MigrationImage.spacegroup">spacegroup</a>
                        </li>
                        <li>
                                <a class="variable" href="#MigrationImage.spacegroup_id">spacegroup_id</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/database/base_data_types/nudged_elastic_band.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../simmate.html">simmate</a><wbr>.<a href="./../../database.html">database</a><wbr>.<a href="./../base_data_types.html">base_data_types</a><wbr>.nudged_elastic_band    </h1>

                        <div class="docstring"><p>WARNING: This module is experimental and subject to change.</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">WARNING: This module is experimental and subject to change.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">pymatgen.core.sites</span> <span class="kn">import</span> <span class="n">PeriodicSite</span>
<span class="kn">from</span> <span class="nn">pymatgen.symmetry.analyzer</span> <span class="kn">import</span> <span class="n">SpacegroupAnalyzer</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.transition_state</span> <span class="kn">import</span> <span class="n">NEBAnalysis</span>

<span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span> <span class="k">as</span> <span class="n">ToolkitStructure</span>
<span class="kn">from</span> <span class="nn">simmate.toolkit.diffusion</span> <span class="kn">import</span> <span class="n">MigrationHop</span> <span class="k">as</span> <span class="n">ToolkitMigrationHop</span>
<span class="kn">from</span> <span class="nn">simmate.database.base_data_types</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">table_column</span><span class="p">,</span>
    <span class="n">DatabaseTable</span><span class="p">,</span>
    <span class="n">Structure</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># TODO: consider making a NestedCalculation</span>
<span class="k">class</span> <span class="nc">DiffusionAnalysis</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>

    <span class="n">migrating_specie</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The element of the diffusion atom (e.g. &quot;Li&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">vacancy_mode</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (if relevent) Whether vacancy or interstitial diffusion was used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">atomic_fraction</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Atomic fraction of the diffusion ion in the bulk structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># NOTE: barrier_cell, paths_involved, and npaths_involved need to be updated</span>
    <span class="c1"># by evaluating all MigrationHops.</span>

    <span class="n">barrier_cell</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The energy barrier corresponding to the lowest-barrier percolation network</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">paths_involved</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The symmetrically-unqiue pathways involved in the lowest-barrier </span>
<span class="sd">    percolation network. This is given as a list of IDs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: consider making this a relationship to MigrationPathways</span>

    <span class="n">npaths_involved</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The number of symmetrically-unqiue pathways involved in the lowest-barrier </span>
<span class="sd">    percolation network</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_toolkit</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">migrating_specie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vacancy_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># the algorithm doesn&#39;t change for this method, but we do want to add</span>
        <span class="c1"># a few extra columns. Therefore we make the dictionary as normal and</span>
        <span class="c1"># then add those extra columns here.</span>
        <span class="n">structure_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># now add the two extra columns</span>
        <span class="n">structure_dict</span><span class="p">[</span><span class="s2">&quot;migrating_specie&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">migrating_specie</span>
        <span class="c1"># Structure should be present -- otherwise an error would have been</span>
        <span class="c1"># raised by the call to super()</span>
        <span class="n">structure_dict</span><span class="p">[</span><span class="s2">&quot;atomic_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_atomic_fraction</span><span class="p">(</span><span class="n">migrating_specie</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">migrating_specie</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
        <span class="c1"># return the dictionary</span>
        <span class="k">return</span> <span class="n">structure_dict</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">structure_dict</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new database entry from a directory that holds diffusion analysis</span>
<span class="sd">        results. For now, this assumes the directory holds vasp output files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># I assume the directory is from a vasp calculation, but I need to update</span>
        <span class="c1"># this when I begin adding new calculators.</span>

        <span class="c1"># TODO: It there a way I can figure out which tables the other calculations</span>
        <span class="c1"># are linked to? Specifically, the bulk relaxation, bulk static energy,</span>
        <span class="c1"># and the supercell relaxations. They are all in these directories too</span>
        <span class="c1"># but I can&#39;t save those results until I know where they belong.</span>
        <span class="c1"># Consider adding an attribute that points to those tables...? Or</span>
        <span class="c1"># maybe a relationship (which I&#39;d rather avoid bc it makes things very</span>
        <span class="c1"># messy for users)</span>
        <span class="c1"># For now, I only grab the structure from the static-energy and store</span>
        <span class="c1"># it in the DiffusionAnalysis table.</span>
        <span class="n">bulk_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;bulk_static_energy&quot;</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
        <span class="n">bulk_structure</span> <span class="o">=</span> <span class="n">ToolkitStructure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">bulk_filename</span><span class="p">)</span>

        <span class="c1"># Save a diffusion analysis object so we can connect all other data</span>
        <span class="c1"># to it.</span>
        <span class="n">analysis_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
            <span class="n">structure</span><span class="o">=</span><span class="n">bulk_structure</span><span class="p">,</span>
            <span class="n">vacancy_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># assume this for now</span>
        <span class="p">)</span>
        <span class="n">analysis_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># Iterate through all the subdirectories that start with &quot;migration_hop*&quot;.</span>
        <span class="c1"># We also need to make sure we only grab directories because there are</span>
        <span class="c1"># also cifs present that match this naming convention.</span>
        <span class="c1"># We ignore the number when saving to avoid overwriting data.</span>
        <span class="n">migration_directories</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;migration_hop_&quot;</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># now save each migration hop present</span>
        <span class="k">for</span> <span class="n">migration_dir</span> <span class="ow">in</span> <span class="n">migration_directories</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">migration_hops</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">from_directory</span><span class="p">(</span>
                <span class="n">directory</span><span class="o">=</span><span class="n">migration_dir</span><span class="p">,</span>
                <span class="n">diffusion_analysis_id</span><span class="o">=</span><span class="n">analysis_db</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">analysis_db</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclasses</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically creates a subclass of Relaxation as well as a separate IonicStep</span>
<span class="sd">        table for it. These tables are linked together.</span>

<span class="sd">        Example use:</span>

<span class="sd">        ``` python</span>
<span class="sd">        from simmate.database.base_data_types import Relaxation</span>

<span class="sd">        # note the odd formatting here is just because we are parsing three</span>
<span class="sd">        # outputs from this method to three variables.</span>
<span class="sd">        (</span>
<span class="sd">            ExampleDiffusionAnalysis,</span>
<span class="sd">            ExampleMigrationHop,</span>
<span class="sd">            ExampleMigrationImage,</span>
<span class="sd">        ) = DiffusionAnalysis.create_subclasses(</span>
<span class="sd">            &quot;Example&quot;,</span>
<span class="sd">            module=__name__,</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `name` :</span>
<span class="sd">            The prefix name of the subclasses that are output. &quot;Relaxation&quot; and</span>
<span class="sd">            &quot;IonicStep&quot; will be attached to the end of this prefix.</span>

<span class="sd">        - `module` :</span>
<span class="sd">            name of the module this subclass should be associated with. Typically,</span>
<span class="sd">            you should pass __name__ to this.</span>

<span class="sd">        - `**extra_columns` :</span>
<span class="sd">            Additional columns to add to the table. The keyword will be the</span>
<span class="sd">            column name and the value should match django options</span>
<span class="sd">            (e.g. table_column.FloatField())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - `NewDiffusionAnalysisClass` :</span>
<span class="sd">            A subclass of DiffusionAnalysis.</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># For convience, we add columns that point to the start and end structures</span>
        <span class="n">NewDiffusionAnalysisClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">DiffusionAnalysis&quot;</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="p">(</span>
            <span class="n">NewMigrationHopClass</span><span class="p">,</span>
            <span class="n">NewMigrationImageClass</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">MigrationHop</span><span class="o">.</span><span class="n">create_subclasses_from_diffusion_analysis</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">NewDiffusionAnalysisClass</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># we now have a new child class and avoided writing some boilerplate code!</span>
        <span class="k">return</span> <span class="n">NewDiffusionAnalysisClass</span><span class="p">,</span> <span class="n">NewMigrationHopClass</span><span class="p">,</span> <span class="n">NewMigrationImageClass</span>


<span class="c1"># TODO: consider making a Calculation bc this is what the corrections/directory</span>
<span class="c1"># information should be attached to.</span>
<span class="k">class</span> <span class="nc">MigrationHop</span><span class="p">(</span><span class="n">DatabaseTable</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>

    <span class="n">base_info</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;site_start&quot;</span><span class="p">,</span>
        <span class="s2">&quot;site_end&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index_start&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index_end&quot;</span><span class="p">,</span>
        <span class="s2">&quot;number&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># OPTIMIZE: site_start and site_end</span>
    <span class="c1"># Really, this is a list of float values, but I save it as a string.</span>
    <span class="c1"># For robustness, should I save cartesian coordinates and/or lattice as well?</span>
    <span class="c1"># Does the max length make sense here and below?</span>
    <span class="c1"># I could also store as JSON since it&#39;s a list of coords.</span>

    <span class="n">site_start</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The starting fractional coordinates of the diffusing site.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">site_end</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ending fractional coordinates of the diffusing site.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># BUG: the init script for MigrationHop can&#39;t identify the site indexes</span>
    <span class="c1"># properly but they should be the same as before because it is a symmetrized</span>
    <span class="c1"># structure. Note that even if I&#39;m wrong in some case -- this will have</span>
    <span class="c1"># no effect because iindex and eindex are only used in one portion of</span>
    <span class="c1"># the hash as well as for printing the __str__ of the object.</span>

    <span class="n">index_start</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The starting site index of the diffusing site.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index_end</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ending site index of the diffusing site.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The expected index in DistinctPathFinder.get_paths. The shortest path is index 0</span>
<span class="sd">    and they are all ordered by increasing length.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">length</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The length/distance of the pathway from start to end. Note, this is </span>
<span class="sd">    linear measurement -- i.e. is it the length of the linear interpolated path.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dimension_path</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pathway dimensionality using the Larson scoring parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dimension_host_lattice</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ignoring all atoms of the diffusing species, this is the dimensionality</span>
<span class="sd">    of the remaining atoms of the lattice using the Larson scoring parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">energy_barrier</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The energy barrier in eV. This evaluates all images of the diffusion pathway</span>
<span class="sd">    and find the difference between the maximum and minimum image energies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO:</span>
    <span class="c1"># Distance of the pathway relative to the shortest pathway distance</span>
    <span class="c1"># in the structure using the formula: (D - Dmin)/Dmin</span>
    <span class="c1"># distance_rel_min = models.FloatField()</span>

    <span class="sd">&quot;&quot;&quot; Relationships &quot;&quot;&quot;</span>
    <span class="c1"># Each MigrationHop corresponds to the full analysis of one Structure, which</span>
    <span class="c1"># can have many MigrationHop(s)</span>
    <span class="c1"># diffusion_analysis = table_column.ForeignKey(</span>
    <span class="c1">#     # DiffusionAnalysis,</span>
    <span class="c1">#     on_delete=table_column.PROTECT,</span>
    <span class="c1">#     related_name=&quot;migration_hops&quot;,</span>
    <span class="c1"># )</span>

    <span class="c1"># TODO:</span>
    <span class="c1"># image_start --&gt; OneToOneField for specific MigrationHop</span>
    <span class="c1"># image_end --&gt; OneToOneField for specific MigrationHop</span>
    <span class="c1"># image_transition_state --&gt; OneToOneField for specific MigrationHop</span>

    <span class="c1"># Just like Relaxation points to IonicSteps, NEB will point to MigrationImages</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_toolkit</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">migration_hop</span><span class="p">:</span> <span class="n">ToolkitMigrationHop</span><span class="p">,</span>
        <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="c1"># convert the pathway object into the database table format</span>
        <span class="n">hop_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">site_start</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">migration_hop</span><span class="o">.</span><span class="n">isite</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">),</span>
            <span class="n">site_end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">migration_hop</span><span class="o">.</span><span class="n">esite</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">),</span>
            <span class="n">index_start</span><span class="o">=</span><span class="n">migration_hop</span><span class="o">.</span><span class="n">iindex</span><span class="p">,</span>
            <span class="n">index_end</span><span class="o">=</span><span class="n">migration_hop</span><span class="o">.</span><span class="n">eindex</span><span class="p">,</span>
            <span class="n">length</span><span class="o">=</span><span class="n">migration_hop</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>
            <span class="c1"># diffusion_analysis_id=diffusion_analysis_id,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
        <span class="c1"># return the dictionary</span>
        <span class="k">return</span> <span class="n">hop_dict</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">hop_dict</span><span class="p">)</span>

    <span class="c1"># BUG: because of rounding in the from_toolkit method, the get_sc_structures</span>
    <span class="c1"># is unable to identify equivalent sites. I opened an issue for this</span>
    <span class="c1"># with their team:</span>
    <span class="c1">#   https://github.com/materialsvirtuallab/pymatgen-analysis-diffusion/issues/296</span>
    <span class="k">def</span> <span class="nf">to_toolkit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToolkitMigrationHop</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts the database MigrationHop to a toolkit MigrationHop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The bulk crystal structure is stored in the diffusion analysis table</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span>

        <span class="c1"># pathways require a symmetrized structure</span>
        <span class="c1"># BUG: I need to ensure the symmetrized structure comes out the same</span>
        <span class="c1"># as before, so I need to be careful with updates and hardcoding here.</span>
        <span class="n">sga</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">symprec</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">symm_structure</span> <span class="o">=</span> <span class="n">sga</span><span class="o">.</span><span class="n">get_symmetrized_structure</span><span class="p">()</span>

        <span class="n">isite_new</span> <span class="o">=</span> <span class="n">PeriodicSite</span><span class="p">(</span>
            <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">migrating_specie</span><span class="p">,</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_start</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)],</span>
            <span class="n">lattice</span><span class="o">=</span><span class="n">symm_structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">esite_new</span> <span class="o">=</span> <span class="n">PeriodicSite</span><span class="p">(</span>
            <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">migrating_specie</span><span class="p">,</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_end</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)],</span>
            <span class="n">lattice</span><span class="o">=</span><span class="n">symm_structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">ToolkitMigrationHop</span><span class="p">(</span><span class="n">isite_new</span><span class="p">,</span> <span class="n">esite_new</span><span class="p">,</span> <span class="n">symm_structure</span><span class="p">)</span>
        <span class="c1"># BUG: see comment attached to definition of these fields</span>
        <span class="n">path</span><span class="o">.</span><span class="n">iindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_start</span>
        <span class="n">path</span><span class="o">.</span><span class="n">eindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_end</span>

        <span class="c1"># if the pathways match, then we can return the pathway object!</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="c1">#######</span>
    <span class="c1"># BUG: I need to distinguish between the from_toolkit/to_toolkit methods</span>
    <span class="c1"># above that just load a MigrationImages object vs. the from_directory and</span>
    <span class="c1"># from_pymatgen methods below that include results. As-is these similar</span>
    <span class="c1"># names but very different use cases makes things confusing for users.</span>
    <span class="c1">#######</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># I assume the directory is from a vasp calculation, but I need to update</span>
        <span class="c1"># this when I begin adding new calculators.</span>

        <span class="c1"># BUG: A fix is make during the workup() method that may be relevant here.</span>
        <span class="c1"># simmate.calculators.vasp.tasks.nudged_elastic_band.MITNudgedElasticBand.workup</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">NEBAnalysis</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_pymatgen</span><span class="p">(</span><span class="n">analysis</span><span class="o">=</span><span class="n">analysis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pymatgen</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">analysis</span><span class="p">:</span> <span class="n">NEBAnalysis</span><span class="p">,</span>
        <span class="n">diffusion_analysis_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># only used if updating</span>
        <span class="n">migration_hop_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># only used if updating</span>
    <span class="p">):</span>
        <span class="c1"># We reference these related tables frequently below so it easier to</span>
        <span class="c1"># grab them up front.</span>
        <span class="n">diffusion_analysis_table</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">related_model</span>
        <span class="n">migration_image_table</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">migration_images</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">model</span>

        <span class="c1"># First, we need a migration_hop database object.</span>
        <span class="c1"># All of hops should link to a diffusion_analysis entry, so we check</span>
        <span class="c1"># for that here too. The key thing of these statements is that we</span>
        <span class="c1"># have a migration_hop_id at the end.</span>

        <span class="c1"># If no ids were given, then we make a new entries for each.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">diffusion_analysis_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">migration_hop_id</span><span class="p">:</span>
            <span class="c1"># Note, we have minimal information if this is the case, so these</span>
            <span class="c1"># table entries will have a bunch of empty columns.</span>

            <span class="c1"># We don&#39;t have a bulk structure to use for this class, so we use</span>
            <span class="c1"># the first image</span>
            <span class="n">analysis_db</span> <span class="o">=</span> <span class="n">diffusion_analysis_table</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
                <span class="n">structure</span><span class="o">=</span><span class="n">analysis</span><span class="o">.</span><span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">vacancy_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># assume this for now</span>
            <span class="p">)</span>
            <span class="n">analysis_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># This table entry will actually be completely empty... It only</span>
            <span class="c1"># serves to link the MigrationImages together</span>
            <span class="n">hop_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">diffusion_analysis_id</span><span class="o">=</span><span class="n">analysis_db</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">hop_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">migration_hop_id</span> <span class="o">=</span> <span class="n">hop_db</span><span class="o">.</span><span class="n">id</span>

        <span class="k">elif</span> <span class="n">diffusion_analysis_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">migration_hop_id</span><span class="p">:</span>
            <span class="c1"># This table entry will actually be completely empty... It only</span>
            <span class="c1"># serves to link the MigrationImages together</span>
            <span class="n">hop_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">diffusion_analysis_id</span><span class="o">=</span><span class="n">diffusion_analysis_id</span><span class="p">)</span>
            <span class="n">hop_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">migration_hop_id</span> <span class="o">=</span> <span class="n">hop_db</span><span class="o">.</span><span class="n">id</span>

        <span class="k">elif</span> <span class="n">migration_hop_id</span><span class="p">:</span>
            <span class="c1"># We don&#39;t use the hop_id, but making this query ensures it exists.</span>
            <span class="n">hop_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">migration_hop_id</span><span class="p">)</span>
            <span class="c1"># Even though it&#39;s not required, we make sure the id given for the</span>
            <span class="c1"># diffusion analysis table matches this existing hop id.</span>
            <span class="k">if</span> <span class="n">diffusion_analysis_id</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">hop_db</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">diffusion_analysis_id</span>

        <span class="c1"># Now same migration images and link them to this parent object.</span>
        <span class="c1"># Note, the start/end Migration images will exist already in the</span>
        <span class="c1"># relaxation database table. We still want to save them again here for</span>
        <span class="c1"># easy access.</span>
        <span class="k">for</span> <span class="n">image_number</span><span class="p">,</span> <span class="n">image_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">structures</span><span class="p">,</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">forces</span><span class="p">,</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">force</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">image_data</span>
            <span class="n">image_db</span> <span class="o">=</span> <span class="n">migration_image_table</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
                <span class="n">structure</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
                <span class="n">number</span><span class="o">=</span><span class="n">image_number</span><span class="p">,</span>
                <span class="n">force_tangent</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                <span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span>
                <span class="n">structure_distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                <span class="n">migration_hop_id</span><span class="o">=</span><span class="n">migration_hop_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">hop_db</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclasses_from_diffusion_analysis</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">diffusion_analysis</span><span class="p">:</span> <span class="n">DiffusionAnalysis</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically creates subclass of MigrationHop and MigrationImage, then</span>
<span class="sd">        links them to the DiffusionAnalysis table.</span>

<span class="sd">        This method should NOT be called directly because it is instead used by</span>
<span class="sd">        `DiffusionAnalysis.create_subclasses`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `name` :</span>
<span class="sd">            Name of the subclass that is output.</span>
<span class="sd">        - `diffusion_analysis` :</span>
<span class="sd">            DiffusionAnalysis table that these subclasses should be associated with.</span>
<span class="sd">        - `module` :</span>
<span class="sd">            name of the module this subclass should be associated with. Typically,</span>
<span class="sd">            you should pass __name__ to this.</span>
<span class="sd">        - `**extra_columns` :</span>
<span class="sd">            Additional columns to add to the table. The keyword will be the</span>
<span class="sd">            column name and the value should match django options</span>
<span class="sd">            (e.g. table_column.FloatField())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NewMigrationHopClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">MigrationHop&quot;</span><span class="p">,</span>
            <span class="n">diffusion_analysis</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
                <span class="n">diffusion_analysis</span><span class="p">,</span>
                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;migration_hops&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">NewMigrationImageClass</span> <span class="o">=</span> <span class="n">MigrationImage</span><span class="o">.</span><span class="n">create_subclass_from_migration_hop</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">NewMigrationHopClass</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">NewMigrationHopClass</span><span class="p">,</span> <span class="n">NewMigrationImageClass</span>


<span class="k">class</span> <span class="nc">MigrationImage</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>

    <span class="n">base_info</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;structure_string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;force_tangent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;structure_distance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;energy&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">number</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The image number. Note, the starting image is always 0 and the ending</span>
<span class="sd">    image is always -1. The choice of -1 is because we often add the ending</span>
<span class="sd">    image to the database table before knowing how many midpoint images we</span>
<span class="sd">    are going to create.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">force_tangent</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The tangent force of image. Not to be confused with forces from the Forces mix-in.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Note, we only care about the total energy for NEB images -- not the other</span>
    <span class="c1"># fields that the Thermodynamics mix-in provides. This is why we set this</span>
    <span class="c1"># field directly, rather than using the mix-in.</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The calculated total energy. Units are in eV. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">structure_distance</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fingerprint distance of the image from the starting image. A smaller</span>
<span class="sd">    means the structures are more similar, with 0 being an exact match.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># We don&#39;t need the source column for the MigrationImage class because we</span>
    <span class="c1"># instead stored the source on the DiffusionAnalysis object. This line</span>
    <span class="c1"># deletes the source column from our Structure mix-in.</span>
    <span class="n">source</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclass_from_migration_hop</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">migration_hop</span><span class="p">:</span> <span class="n">MigrationHop</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically creates subclass of MigrationImage, then links it to the</span>
<span class="sd">        MigrationHop table.</span>

<span class="sd">        This method should NOT be called directly because it is instead used by</span>
<span class="sd">        `DiffusionAnalysis.create_subclasses`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `name` :</span>
<span class="sd">            Name of the subclass that is output.</span>
<span class="sd">        - `migration_hop` :</span>
<span class="sd">            MigrationHop table that these images should be associated with.</span>
<span class="sd">        - `module` :</span>
<span class="sd">            name of the module this subclass should be associated with. Typically,</span>
<span class="sd">            you should pass __name__ to this.</span>
<span class="sd">        - `**extra_columns` :</span>
<span class="sd">            Additional columns to add to the table. The keyword will be the</span>
<span class="sd">            column name and the value should match django options</span>
<span class="sd">            (e.g. table_column.FloatField())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - `NewClass` :</span>
<span class="sd">            A subclass of MigrationImage.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NewClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">MigrationImage&quot;</span><span class="p">,</span>
            <span class="n">migration_hop</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
                <span class="n">migration_hop</span><span class="p">,</span>
                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;migration_images&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">NewClass</span>
</pre></div>

        </details>

            </section>
                <section id="DiffusionAnalysis">
                                <div class="attr class">
        <a class="headerlink" href="#DiffusionAnalysis">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">DiffusionAnalysis</span><wbr>(<span class="base"><a href="structure.html#Structure">simmate.database.base_data_types.structure.Structure</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DiffusionAnalysis</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>

    <span class="n">migrating_specie</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The element of the diffusion atom (e.g. &quot;Li&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">vacancy_mode</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (if relevent) Whether vacancy or interstitial diffusion was used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">atomic_fraction</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Atomic fraction of the diffusion ion in the bulk structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># NOTE: barrier_cell, paths_involved, and npaths_involved need to be updated</span>
    <span class="c1"># by evaluating all MigrationHops.</span>

    <span class="n">barrier_cell</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The energy barrier corresponding to the lowest-barrier percolation network</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">paths_involved</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The symmetrically-unqiue pathways involved in the lowest-barrier </span>
<span class="sd">    percolation network. This is given as a list of IDs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: consider making this a relationship to MigrationPathways</span>

    <span class="n">npaths_involved</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The number of symmetrically-unqiue pathways involved in the lowest-barrier </span>
<span class="sd">    percolation network</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_toolkit</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">migrating_specie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vacancy_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># the algorithm doesn&#39;t change for this method, but we do want to add</span>
        <span class="c1"># a few extra columns. Therefore we make the dictionary as normal and</span>
        <span class="c1"># then add those extra columns here.</span>
        <span class="n">structure_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># now add the two extra columns</span>
        <span class="n">structure_dict</span><span class="p">[</span><span class="s2">&quot;migrating_specie&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">migrating_specie</span>
        <span class="c1"># Structure should be present -- otherwise an error would have been</span>
        <span class="c1"># raised by the call to super()</span>
        <span class="n">structure_dict</span><span class="p">[</span><span class="s2">&quot;atomic_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_atomic_fraction</span><span class="p">(</span><span class="n">migrating_specie</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">migrating_specie</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
        <span class="c1"># return the dictionary</span>
        <span class="k">return</span> <span class="n">structure_dict</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">structure_dict</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new database entry from a directory that holds diffusion analysis</span>
<span class="sd">        results. For now, this assumes the directory holds vasp output files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># I assume the directory is from a vasp calculation, but I need to update</span>
        <span class="c1"># this when I begin adding new calculators.</span>

        <span class="c1"># TODO: It there a way I can figure out which tables the other calculations</span>
        <span class="c1"># are linked to? Specifically, the bulk relaxation, bulk static energy,</span>
        <span class="c1"># and the supercell relaxations. They are all in these directories too</span>
        <span class="c1"># but I can&#39;t save those results until I know where they belong.</span>
        <span class="c1"># Consider adding an attribute that points to those tables...? Or</span>
        <span class="c1"># maybe a relationship (which I&#39;d rather avoid bc it makes things very</span>
        <span class="c1"># messy for users)</span>
        <span class="c1"># For now, I only grab the structure from the static-energy and store</span>
        <span class="c1"># it in the DiffusionAnalysis table.</span>
        <span class="n">bulk_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;bulk_static_energy&quot;</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
        <span class="n">bulk_structure</span> <span class="o">=</span> <span class="n">ToolkitStructure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">bulk_filename</span><span class="p">)</span>

        <span class="c1"># Save a diffusion analysis object so we can connect all other data</span>
        <span class="c1"># to it.</span>
        <span class="n">analysis_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
            <span class="n">structure</span><span class="o">=</span><span class="n">bulk_structure</span><span class="p">,</span>
            <span class="n">vacancy_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># assume this for now</span>
        <span class="p">)</span>
        <span class="n">analysis_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># Iterate through all the subdirectories that start with &quot;migration_hop*&quot;.</span>
        <span class="c1"># We also need to make sure we only grab directories because there are</span>
        <span class="c1"># also cifs present that match this naming convention.</span>
        <span class="c1"># We ignore the number when saving to avoid overwriting data.</span>
        <span class="n">migration_directories</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;migration_hop_&quot;</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># now save each migration hop present</span>
        <span class="k">for</span> <span class="n">migration_dir</span> <span class="ow">in</span> <span class="n">migration_directories</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">migration_hops</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">from_directory</span><span class="p">(</span>
                <span class="n">directory</span><span class="o">=</span><span class="n">migration_dir</span><span class="p">,</span>
                <span class="n">diffusion_analysis_id</span><span class="o">=</span><span class="n">analysis_db</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">analysis_db</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclasses</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically creates a subclass of Relaxation as well as a separate IonicStep</span>
<span class="sd">        table for it. These tables are linked together.</span>

<span class="sd">        Example use:</span>

<span class="sd">        ``` python</span>
<span class="sd">        from simmate.database.base_data_types import Relaxation</span>

<span class="sd">        # note the odd formatting here is just because we are parsing three</span>
<span class="sd">        # outputs from this method to three variables.</span>
<span class="sd">        (</span>
<span class="sd">            ExampleDiffusionAnalysis,</span>
<span class="sd">            ExampleMigrationHop,</span>
<span class="sd">            ExampleMigrationImage,</span>
<span class="sd">        ) = DiffusionAnalysis.create_subclasses(</span>
<span class="sd">            &quot;Example&quot;,</span>
<span class="sd">            module=__name__,</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `name` :</span>
<span class="sd">            The prefix name of the subclasses that are output. &quot;Relaxation&quot; and</span>
<span class="sd">            &quot;IonicStep&quot; will be attached to the end of this prefix.</span>

<span class="sd">        - `module` :</span>
<span class="sd">            name of the module this subclass should be associated with. Typically,</span>
<span class="sd">            you should pass __name__ to this.</span>

<span class="sd">        - `**extra_columns` :</span>
<span class="sd">            Additional columns to add to the table. The keyword will be the</span>
<span class="sd">            column name and the value should match django options</span>
<span class="sd">            (e.g. table_column.FloatField())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - `NewDiffusionAnalysisClass` :</span>
<span class="sd">            A subclass of DiffusionAnalysis.</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># For convience, we add columns that point to the start and end structures</span>
        <span class="n">NewDiffusionAnalysisClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">DiffusionAnalysis&quot;</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="p">(</span>
            <span class="n">NewMigrationHopClass</span><span class="p">,</span>
            <span class="n">NewMigrationImageClass</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">MigrationHop</span><span class="o">.</span><span class="n">create_subclasses_from_diffusion_analysis</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">NewDiffusionAnalysisClass</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># we now have a new child class and avoided writing some boilerplate code!</span>
        <span class="k">return</span> <span class="n">NewDiffusionAnalysisClass</span><span class="p">,</span> <span class="n">NewMigrationHopClass</span><span class="p">,</span> <span class="n">NewMigrationImageClass</span>
</pre></div>

        </details>

            <div class="docstring"><p>The base class for defining a table in the Simmate database. All tables and
mixins inherit from this class.</p>

<p>Usage is identical to
<a href="https://docs.djangoproject.com/en/4.0/#the-model-layer">models in Django</a>
where this class only adds extra methods for convenience.</p>
</div>


                            <div id="DiffusionAnalysis.migrating_specie" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.migrating_specie">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">migrating_specie</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The element of the diffusion atom (e.g. "Li")</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.vacancy_mode" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.vacancy_mode">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">vacancy_mode</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>(if relevent) Whether vacancy or interstitial diffusion was used.</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.atomic_fraction" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.atomic_fraction">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">atomic_fraction</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>Atomic fraction of the diffusion ion in the bulk structure.</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.barrier_cell" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.barrier_cell">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">barrier_cell</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The energy barrier corresponding to the lowest-barrier percolation network</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.paths_involved" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.paths_involved">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">paths_involved</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The symmetrically-unqiue pathways involved in the lowest-barrier 
percolation network. This is given as a list of IDs.</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.npaths_involved" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.npaths_involved">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">npaths_involved</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The number of symmetrically-unqiue pathways involved in the lowest-barrier 
percolation network</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.from_toolkit" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.from_toolkit">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">from_toolkit</span><span class="signature">(
    cls,
    migrating_specie: str = None,
    vacancy_mode: bool = None,
    as_dict: bool = False,
    **kwargs
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_toolkit</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">migrating_specie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vacancy_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># the algorithm doesn&#39;t change for this method, but we do want to add</span>
        <span class="c1"># a few extra columns. Therefore we make the dictionary as normal and</span>
        <span class="c1"># then add those extra columns here.</span>
        <span class="n">structure_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># now add the two extra columns</span>
        <span class="n">structure_dict</span><span class="p">[</span><span class="s2">&quot;migrating_specie&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">migrating_specie</span>
        <span class="c1"># Structure should be present -- otherwise an error would have been</span>
        <span class="c1"># raised by the call to super()</span>
        <span class="n">structure_dict</span><span class="p">[</span><span class="s2">&quot;atomic_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_atomic_fraction</span><span class="p">(</span><span class="n">migrating_specie</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">migrating_specie</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
        <span class="c1"># return the dictionary</span>
        <span class="k">return</span> <span class="n">structure_dict</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">structure_dict</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Given fundamental "base_info" and toolkit objects, this method will populate
all relevant columns.</p>

<p>If the table is made up of multiple mix-ins, this method iterates through
each of the <code>_from_toolkit</code> methods of those mixins and combines the results.
Therefore, you must view this method for each mix-ins to determine which
kwargs must be passed.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><code>as_dict</code> :
Whether to return the populated data as a dictionary or to initialize
it as a database object. Defaults to False.</li>
<li><code>**kwargs</code> :
All fields required in order to initialize the database entry. For
example, a Structure table would require a toolkit structure, while
a Thermodynamics table would require an energy.</li>
</ul>

<h2 id="returns">Returns</h2>

<p>a dictionary if as_dict is True; and a database object if as_dict is False</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.from_directory" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.from_directory">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">from_directory</span><span class="signature">(cls, directory: str, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new database entry from a directory that holds diffusion analysis</span>
<span class="sd">        results. For now, this assumes the directory holds vasp output files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># I assume the directory is from a vasp calculation, but I need to update</span>
        <span class="c1"># this when I begin adding new calculators.</span>

        <span class="c1"># TODO: It there a way I can figure out which tables the other calculations</span>
        <span class="c1"># are linked to? Specifically, the bulk relaxation, bulk static energy,</span>
        <span class="c1"># and the supercell relaxations. They are all in these directories too</span>
        <span class="c1"># but I can&#39;t save those results until I know where they belong.</span>
        <span class="c1"># Consider adding an attribute that points to those tables...? Or</span>
        <span class="c1"># maybe a relationship (which I&#39;d rather avoid bc it makes things very</span>
        <span class="c1"># messy for users)</span>
        <span class="c1"># For now, I only grab the structure from the static-energy and store</span>
        <span class="c1"># it in the DiffusionAnalysis table.</span>
        <span class="n">bulk_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;bulk_static_energy&quot;</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
        <span class="n">bulk_structure</span> <span class="o">=</span> <span class="n">ToolkitStructure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">bulk_filename</span><span class="p">)</span>

        <span class="c1"># Save a diffusion analysis object so we can connect all other data</span>
        <span class="c1"># to it.</span>
        <span class="n">analysis_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
            <span class="n">structure</span><span class="o">=</span><span class="n">bulk_structure</span><span class="p">,</span>
            <span class="n">vacancy_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># assume this for now</span>
        <span class="p">)</span>
        <span class="n">analysis_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># Iterate through all the subdirectories that start with &quot;migration_hop*&quot;.</span>
        <span class="c1"># We also need to make sure we only grab directories because there are</span>
        <span class="c1"># also cifs present that match this naming convention.</span>
        <span class="c1"># We ignore the number when saving to avoid overwriting data.</span>
        <span class="n">migration_directories</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;migration_hop_&quot;</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># now save each migration hop present</span>
        <span class="k">for</span> <span class="n">migration_dir</span> <span class="ow">in</span> <span class="n">migration_directories</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">migration_hops</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">from_directory</span><span class="p">(</span>
                <span class="n">directory</span><span class="o">=</span><span class="n">migration_dir</span><span class="p">,</span>
                <span class="n">diffusion_analysis_id</span><span class="o">=</span><span class="n">analysis_db</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">analysis_db</span>
</pre></div>

        </details>

            <div class="docstring"><p>Creates a new database entry from a directory that holds diffusion analysis
results. For now, this assumes the directory holds vasp output files.</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.create_subclasses" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.create_subclasses">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">create_subclasses</span><span class="signature">(cls, name: str, module: str, **extra_columns)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclasses</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically creates a subclass of Relaxation as well as a separate IonicStep</span>
<span class="sd">        table for it. These tables are linked together.</span>

<span class="sd">        Example use:</span>

<span class="sd">        ``` python</span>
<span class="sd">        from simmate.database.base_data_types import Relaxation</span>

<span class="sd">        # note the odd formatting here is just because we are parsing three</span>
<span class="sd">        # outputs from this method to three variables.</span>
<span class="sd">        (</span>
<span class="sd">            ExampleDiffusionAnalysis,</span>
<span class="sd">            ExampleMigrationHop,</span>
<span class="sd">            ExampleMigrationImage,</span>
<span class="sd">        ) = DiffusionAnalysis.create_subclasses(</span>
<span class="sd">            &quot;Example&quot;,</span>
<span class="sd">            module=__name__,</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `name` :</span>
<span class="sd">            The prefix name of the subclasses that are output. &quot;Relaxation&quot; and</span>
<span class="sd">            &quot;IonicStep&quot; will be attached to the end of this prefix.</span>

<span class="sd">        - `module` :</span>
<span class="sd">            name of the module this subclass should be associated with. Typically,</span>
<span class="sd">            you should pass __name__ to this.</span>

<span class="sd">        - `**extra_columns` :</span>
<span class="sd">            Additional columns to add to the table. The keyword will be the</span>
<span class="sd">            column name and the value should match django options</span>
<span class="sd">            (e.g. table_column.FloatField())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - `NewDiffusionAnalysisClass` :</span>
<span class="sd">            A subclass of DiffusionAnalysis.</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># For convience, we add columns that point to the start and end structures</span>
        <span class="n">NewDiffusionAnalysisClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">DiffusionAnalysis&quot;</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="p">(</span>
            <span class="n">NewMigrationHopClass</span><span class="p">,</span>
            <span class="n">NewMigrationImageClass</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">MigrationHop</span><span class="o">.</span><span class="n">create_subclasses_from_diffusion_analysis</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">NewDiffusionAnalysisClass</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># we now have a new child class and avoided writing some boilerplate code!</span>
        <span class="k">return</span> <span class="n">NewDiffusionAnalysisClass</span><span class="p">,</span> <span class="n">NewMigrationHopClass</span><span class="p">,</span> <span class="n">NewMigrationImageClass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Dynamically creates a subclass of Relaxation as well as a separate IonicStep
table for it. These tables are linked together.</p>

<p>Example use:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="../base_data_types.html">simmate.database.base_data_types</a></span> <span class="kn">import</span> <span class="n">Relaxation</span>

<span class="c1"># note the odd formatting here is just because we are parsing three</span>
<span class="c1"># outputs from this method to three variables.</span>
<span class="p">(</span>
    <span class="n">ExampleDiffusionAnalysis</span><span class="p">,</span>
    <span class="n">ExampleMigrationHop</span><span class="p">,</span>
    <span class="n">ExampleMigrationImage</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">DiffusionAnalysis</span><span class="o">.</span><span class="n">create_subclasses</span><span class="p">(</span>
    <span class="s2">&quot;Example&quot;</span><span class="p">,</span>
    <span class="n">module</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="parameters">Parameters</h2>

<ul>
<li><p><code>name</code> :
The prefix name of the subclasses that are output. "Relaxation" and
"IonicStep" will be attached to the end of this prefix.</p></li>
<li><p><code>module</code> :
name of the module this subclass should be associated with. Typically,
you should pass __name__ to this.</p></li>
<li><p><code>**extra_columns</code> :
Additional columns to add to the table. The keyword will be the
column name and the value should match django options
(e.g. table_column.FloatField())</p></li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li><code>NewDiffusionAnalysisClass</code> :
A subclass of DiffusionAnalysis.</li>
<li><code>NewMigrationHopClass</code>:
A subclass of MigrationHop.</li>
<li><code>NewMigrationHopClass</code>:
A subclass of MigrationHop.</li>
</ul>
</div>


                            </div>
                            <div id="DiffusionAnalysis.structure_string" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.structure_string">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">structure_string</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The core structure information, which is written to a string and in a 
compressed format using the <code><a href="#DiffusionAnalysis.from_toolkit">from_toolkit</a></code> method. To get back to our toolkit
structure object, use the <code><a href="#DiffusionAnalysis.to_toolkit">to_toolkit</a></code> method.</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.nsites" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.nsites">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">nsites</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The total number of sites in the unitcell. (e.g. Y2CF2 has 5 sites)</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.nelements" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.nelements">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">nelements</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The total number of unique elements. (e.g. Y2CF2 has 3 elements)</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.elements" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.elements">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">elements</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>List of elements in the structure (ex: ["Y", "C", "F"])</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.chemical_system" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.chemical_system">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">chemical_system</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>the base chemical system (ex: "Y-C-F")</p>

<p>Note: be careful when searching for elements! Running chemical_system__contains="C"
on this field won't do what you expect -- because it will return structures
containing Ca, Cs, Ce, Cl, and so on. If you want to search for structures
that contain a specific element, use elements__contains='"C"' instead. The
odd use of quotes '"C"' is required here!</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.density" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.density">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">density</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The density of the crystal in g/cm^3</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.density_atomic" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.density_atomic">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">density_atomic</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The density of atoms in the crystal in atoms/Angstom^3</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.volume" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.volume">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">volume</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The volume of the unitcell in Angstom^3</p>

<p>Note: in most cases, <code><a href="#DiffusionAnalysis.volume_molar">volume_molar</a></code> should be used instead! This is because
volumne is highly dependent on the symmetry and the arbitray unitcell. If 
you are truly after small volumes of the unitcell, it is likely you really 
just want to search by spacegroup.</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.volume_molar" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.volume_molar">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">volume_molar</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The molar volume of the crystal in cm^3/mol</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.formula_full" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.formula_full">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">formula_full</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The chemical formula with elements sorted by electronegativity (ex: Li4 Fe4 P4 O16)</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.formula_reduced" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.formula_reduced">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">formula_reduced</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The reduced chemical formula. (ex: Li4Fe4P4O16 --> LiFePO4)</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.formula_anonymous" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.formula_anonymous">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">formula_anonymous</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>An anonymized formula. Unique species are arranged in ordering of 
amounts and assigned ascending alphabets. Useful for prototyping formulas. 
For example, all stoichiometric perovskites have anonymized_formula ABC3.</p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.spacegroup" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DiffusionAnalysis.spacegroup">#&nbsp;&nbsp</a>

        <span class="name">spacegroup</span>
    </div>

    
            <div class="docstring"><p>Spacegroup information. Points to a separate database table that has additional
columns:
<code><a href="symmetry.html#Spacegroup">simmate.database.base_data_types.symmetry.Spacegroup</a></code></p>
</div>


                            </div>
                            <div id="DiffusionAnalysis.source" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.source">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">source</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><blockquote>
  <p>Note, this field is highly experimental at the moment and subject to
  change.</p>
</blockquote>

<p>This column indicates where the data came from, and it could be a number 
of things including...</p>

<ul>
<li>a third party id</li>
<li>a structure from a different Simmate datbase table</li>
<li>a transformation of another structure</li>
<li>a creation method</li>
<li>a custom submission by the user</li>
</ul>

<p>By default, this is a JSON field to account for all scenarios, but some
tables (such as those in <code><a href="../third_parties.html">simmate.database.third_parties</a></code>) this is value
should be the same for ALL entries in the table and therefore the column is
overwritten as an attribute.</p>

<p>For other tables where this is not a constant, here are some examples of
values used in this column:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># from a thirdparty database or separate table</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a random structure creator</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PyXtalStructure&quot;</span><span class="p">}</span>

<span class="c1"># from a templated structure creator (e.g. substituition or prototypes)</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PrototypeStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;AFLOWPrototypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;MirrorMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a multi-structure transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;HereditaryMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mp-123&quot;</span><span class="p">,</span> <span class="s2">&quot;mp-321&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>
</div>


                            </div>
                            <div id="DiffusionAnalysis.spacegroup_id" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DiffusionAnalysis.spacegroup_id">#&nbsp;&nbsp</a>

        <span class="name">spacegroup_id</span>
    </div>

    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>django.db.models.base.Model</dt>
                                <dd id="DiffusionAnalysis.__init__" class="function">Model</dd>
                <dd id="DiffusionAnalysis.from_db" class="function">from_db</dd>
                <dd id="DiffusionAnalysis.pk" class="variable">pk</dd>
                <dd id="DiffusionAnalysis.get_deferred_fields" class="function">get_deferred_fields</dd>
                <dd id="DiffusionAnalysis.refresh_from_db" class="function">refresh_from_db</dd>
                <dd id="DiffusionAnalysis.serializable_value" class="function">serializable_value</dd>
                <dd id="DiffusionAnalysis.save" class="function">save</dd>
                <dd id="DiffusionAnalysis.save_base" class="function">save_base</dd>
                <dd id="DiffusionAnalysis.delete" class="function">delete</dd>
                <dd id="DiffusionAnalysis.prepare_database_save" class="function">prepare_database_save</dd>
                <dd id="DiffusionAnalysis.clean" class="function">clean</dd>
                <dd id="DiffusionAnalysis.validate_unique" class="function">validate_unique</dd>
                <dd id="DiffusionAnalysis.date_error_message" class="function">date_error_message</dd>
                <dd id="DiffusionAnalysis.unique_error_message" class="function">unique_error_message</dd>
                <dd id="DiffusionAnalysis.full_clean" class="function">full_clean</dd>
                <dd id="DiffusionAnalysis.clean_fields" class="function">clean_fields</dd>
                <dd id="DiffusionAnalysis.check" class="function">check</dd>

            </div>
            <div><dt><a href="structure.html#Structure">simmate.database.base_data_types.structure.Structure</a></dt>
                                <dd id="DiffusionAnalysis.base_info" class="variable"><a href="structure.html#Structure.base_info">base_info</a></dd>
                <dd id="DiffusionAnalysis.to_toolkit" class="function"><a href="structure.html#Structure.to_toolkit">to_toolkit</a></dd>

            </div>
            <div><dt><a href="base.html#DatabaseTable">simmate.database.base_data_types.base.DatabaseTable</a></dt>
                                <dd id="DiffusionAnalysis.source_doi" class="variable"><a href="base.html#DatabaseTable.source_doi">source_doi</a></dd>
                <dd id="DiffusionAnalysis.remote_archive_link" class="variable"><a href="base.html#DatabaseTable.remote_archive_link">remote_archive_link</a></dd>
                <dd id="DiffusionAnalysis.objects" class="function"><a href="base.html#DatabaseTable.objects">objects</a></dd>
                <dd id="DiffusionAnalysis.create_subclass" class="function"><a href="base.html#DatabaseTable.create_subclass">create_subclass</a></dd>
                <dd id="DiffusionAnalysis.load_archive" class="function"><a href="base.html#DatabaseTable.load_archive">load_archive</a></dd>
                <dd id="DiffusionAnalysis.load_remote_archive" class="function"><a href="base.html#DatabaseTable.load_remote_archive">load_remote_archive</a></dd>
                <dd id="DiffusionAnalysis.get_column_names" class="function"><a href="base.html#DatabaseTable.get_column_names">get_column_names</a></dd>
                <dd id="DiffusionAnalysis.show_columns" class="function"><a href="base.html#DatabaseTable.show_columns">show_columns</a></dd>
                <dd id="DiffusionAnalysis.get_mixins" class="function"><a href="base.html#DatabaseTable.get_mixins">get_mixins</a></dd>
                <dd id="DiffusionAnalysis.get_mixin_names" class="function"><a href="base.html#DatabaseTable.get_mixin_names">get_mixin_names</a></dd>
                <dd id="DiffusionAnalysis.get_extra_columns" class="function"><a href="base.html#DatabaseTable.get_extra_columns">get_extra_columns</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DiffusionAnalysis.Meta">
                                <div class="attr class">
        <a class="headerlink" href="#DiffusionAnalysis.Meta">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">DiffusionAnalysis.Meta</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>
</pre></div>

        </details>

    

                            <div id="DiffusionAnalysis.Meta.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DiffusionAnalysis.Meta.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">DiffusionAnalysis.Meta</span><span class="signature">()</span>
    </div>

    
    

                            </div>
                            <div id="DiffusionAnalysis.Meta.abstract" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DiffusionAnalysis.Meta.abstract">#&nbsp;&nbsp</a>

        <span class="name">abstract</span><span class="default_value"> = False</span>
    </div>

    
    

                            </div>
                            <div id="DiffusionAnalysis.Meta.app_label" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#DiffusionAnalysis.Meta.app_label">#&nbsp;&nbsp</a>

        <span class="name">app_label</span><span class="default_value"> = &#39;workflows&#39;</span>
    </div>

    
    

                            </div>
                </section>
                <section id="MigrationHop">
                                <div class="attr class">
        <a class="headerlink" href="#MigrationHop">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">MigrationHop</span><wbr>(<span class="base"><a href="base.html#DatabaseTable">simmate.database.base_data_types.base.DatabaseTable</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MigrationHop</span><span class="p">(</span><span class="n">DatabaseTable</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>

    <span class="n">base_info</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;site_start&quot;</span><span class="p">,</span>
        <span class="s2">&quot;site_end&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index_start&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index_end&quot;</span><span class="p">,</span>
        <span class="s2">&quot;number&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># OPTIMIZE: site_start and site_end</span>
    <span class="c1"># Really, this is a list of float values, but I save it as a string.</span>
    <span class="c1"># For robustness, should I save cartesian coordinates and/or lattice as well?</span>
    <span class="c1"># Does the max length make sense here and below?</span>
    <span class="c1"># I could also store as JSON since it&#39;s a list of coords.</span>

    <span class="n">site_start</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The starting fractional coordinates of the diffusing site.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">site_end</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ending fractional coordinates of the diffusing site.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># BUG: the init script for MigrationHop can&#39;t identify the site indexes</span>
    <span class="c1"># properly but they should be the same as before because it is a symmetrized</span>
    <span class="c1"># structure. Note that even if I&#39;m wrong in some case -- this will have</span>
    <span class="c1"># no effect because iindex and eindex are only used in one portion of</span>
    <span class="c1"># the hash as well as for printing the __str__ of the object.</span>

    <span class="n">index_start</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The starting site index of the diffusing site.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index_end</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ending site index of the diffusing site.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The expected index in DistinctPathFinder.get_paths. The shortest path is index 0</span>
<span class="sd">    and they are all ordered by increasing length.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">length</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The length/distance of the pathway from start to end. Note, this is </span>
<span class="sd">    linear measurement -- i.e. is it the length of the linear interpolated path.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dimension_path</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pathway dimensionality using the Larson scoring parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dimension_host_lattice</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ignoring all atoms of the diffusing species, this is the dimensionality</span>
<span class="sd">    of the remaining atoms of the lattice using the Larson scoring parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">energy_barrier</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The energy barrier in eV. This evaluates all images of the diffusion pathway</span>
<span class="sd">    and find the difference between the maximum and minimum image energies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO:</span>
    <span class="c1"># Distance of the pathway relative to the shortest pathway distance</span>
    <span class="c1"># in the structure using the formula: (D - Dmin)/Dmin</span>
    <span class="c1"># distance_rel_min = models.FloatField()</span>

    <span class="sd">&quot;&quot;&quot; Relationships &quot;&quot;&quot;</span>
    <span class="c1"># Each MigrationHop corresponds to the full analysis of one Structure, which</span>
    <span class="c1"># can have many MigrationHop(s)</span>
    <span class="c1"># diffusion_analysis = table_column.ForeignKey(</span>
    <span class="c1">#     # DiffusionAnalysis,</span>
    <span class="c1">#     on_delete=table_column.PROTECT,</span>
    <span class="c1">#     related_name=&quot;migration_hops&quot;,</span>
    <span class="c1"># )</span>

    <span class="c1"># TODO:</span>
    <span class="c1"># image_start --&gt; OneToOneField for specific MigrationHop</span>
    <span class="c1"># image_end --&gt; OneToOneField for specific MigrationHop</span>
    <span class="c1"># image_transition_state --&gt; OneToOneField for specific MigrationHop</span>

    <span class="c1"># Just like Relaxation points to IonicSteps, NEB will point to MigrationImages</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_toolkit</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">migration_hop</span><span class="p">:</span> <span class="n">ToolkitMigrationHop</span><span class="p">,</span>
        <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="c1"># convert the pathway object into the database table format</span>
        <span class="n">hop_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">site_start</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">migration_hop</span><span class="o">.</span><span class="n">isite</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">),</span>
            <span class="n">site_end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">migration_hop</span><span class="o">.</span><span class="n">esite</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">),</span>
            <span class="n">index_start</span><span class="o">=</span><span class="n">migration_hop</span><span class="o">.</span><span class="n">iindex</span><span class="p">,</span>
            <span class="n">index_end</span><span class="o">=</span><span class="n">migration_hop</span><span class="o">.</span><span class="n">eindex</span><span class="p">,</span>
            <span class="n">length</span><span class="o">=</span><span class="n">migration_hop</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>
            <span class="c1"># diffusion_analysis_id=diffusion_analysis_id,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># If as_dict is false, we build this into an Object. Otherwise, just</span>
        <span class="c1"># return the dictionary</span>
        <span class="k">return</span> <span class="n">hop_dict</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">hop_dict</span><span class="p">)</span>

    <span class="c1"># BUG: because of rounding in the from_toolkit method, the get_sc_structures</span>
    <span class="c1"># is unable to identify equivalent sites. I opened an issue for this</span>
    <span class="c1"># with their team:</span>
    <span class="c1">#   https://github.com/materialsvirtuallab/pymatgen-analysis-diffusion/issues/296</span>
    <span class="k">def</span> <span class="nf">to_toolkit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToolkitMigrationHop</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts the database MigrationHop to a toolkit MigrationHop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The bulk crystal structure is stored in the diffusion analysis table</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span>

        <span class="c1"># pathways require a symmetrized structure</span>
        <span class="c1"># BUG: I need to ensure the symmetrized structure comes out the same</span>
        <span class="c1"># as before, so I need to be careful with updates and hardcoding here.</span>
        <span class="n">sga</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">symprec</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">symm_structure</span> <span class="o">=</span> <span class="n">sga</span><span class="o">.</span><span class="n">get_symmetrized_structure</span><span class="p">()</span>

        <span class="n">isite_new</span> <span class="o">=</span> <span class="n">PeriodicSite</span><span class="p">(</span>
            <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">migrating_specie</span><span class="p">,</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_start</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)],</span>
            <span class="n">lattice</span><span class="o">=</span><span class="n">symm_structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">esite_new</span> <span class="o">=</span> <span class="n">PeriodicSite</span><span class="p">(</span>
            <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">migrating_specie</span><span class="p">,</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_end</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)],</span>
            <span class="n">lattice</span><span class="o">=</span><span class="n">symm_structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">ToolkitMigrationHop</span><span class="p">(</span><span class="n">isite_new</span><span class="p">,</span> <span class="n">esite_new</span><span class="p">,</span> <span class="n">symm_structure</span><span class="p">)</span>
        <span class="c1"># BUG: see comment attached to definition of these fields</span>
        <span class="n">path</span><span class="o">.</span><span class="n">iindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_start</span>
        <span class="n">path</span><span class="o">.</span><span class="n">eindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_end</span>

        <span class="c1"># if the pathways match, then we can return the pathway object!</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="c1">#######</span>
    <span class="c1"># BUG: I need to distinguish between the from_toolkit/to_toolkit methods</span>
    <span class="c1"># above that just load a MigrationImages object vs. the from_directory and</span>
    <span class="c1"># from_pymatgen methods below that include results. As-is these similar</span>
    <span class="c1"># names but very different use cases makes things confusing for users.</span>
    <span class="c1">#######</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># I assume the directory is from a vasp calculation, but I need to update</span>
        <span class="c1"># this when I begin adding new calculators.</span>

        <span class="c1"># BUG: A fix is make during the workup() method that may be relevant here.</span>
        <span class="c1"># simmate.calculators.vasp.tasks.nudged_elastic_band.MITNudgedElasticBand.workup</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">NEBAnalysis</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_pymatgen</span><span class="p">(</span><span class="n">analysis</span><span class="o">=</span><span class="n">analysis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pymatgen</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">analysis</span><span class="p">:</span> <span class="n">NEBAnalysis</span><span class="p">,</span>
        <span class="n">diffusion_analysis_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># only used if updating</span>
        <span class="n">migration_hop_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># only used if updating</span>
    <span class="p">):</span>
        <span class="c1"># We reference these related tables frequently below so it easier to</span>
        <span class="c1"># grab them up front.</span>
        <span class="n">diffusion_analysis_table</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">related_model</span>
        <span class="n">migration_image_table</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">migration_images</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">model</span>

        <span class="c1"># First, we need a migration_hop database object.</span>
        <span class="c1"># All of hops should link to a diffusion_analysis entry, so we check</span>
        <span class="c1"># for that here too. The key thing of these statements is that we</span>
        <span class="c1"># have a migration_hop_id at the end.</span>

        <span class="c1"># If no ids were given, then we make a new entries for each.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">diffusion_analysis_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">migration_hop_id</span><span class="p">:</span>
            <span class="c1"># Note, we have minimal information if this is the case, so these</span>
            <span class="c1"># table entries will have a bunch of empty columns.</span>

            <span class="c1"># We don&#39;t have a bulk structure to use for this class, so we use</span>
            <span class="c1"># the first image</span>
            <span class="n">analysis_db</span> <span class="o">=</span> <span class="n">diffusion_analysis_table</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
                <span class="n">structure</span><span class="o">=</span><span class="n">analysis</span><span class="o">.</span><span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">vacancy_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># assume this for now</span>
            <span class="p">)</span>
            <span class="n">analysis_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># This table entry will actually be completely empty... It only</span>
            <span class="c1"># serves to link the MigrationImages together</span>
            <span class="n">hop_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">diffusion_analysis_id</span><span class="o">=</span><span class="n">analysis_db</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">hop_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">migration_hop_id</span> <span class="o">=</span> <span class="n">hop_db</span><span class="o">.</span><span class="n">id</span>

        <span class="k">elif</span> <span class="n">diffusion_analysis_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">migration_hop_id</span><span class="p">:</span>
            <span class="c1"># This table entry will actually be completely empty... It only</span>
            <span class="c1"># serves to link the MigrationImages together</span>
            <span class="n">hop_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">diffusion_analysis_id</span><span class="o">=</span><span class="n">diffusion_analysis_id</span><span class="p">)</span>
            <span class="n">hop_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">migration_hop_id</span> <span class="o">=</span> <span class="n">hop_db</span><span class="o">.</span><span class="n">id</span>

        <span class="k">elif</span> <span class="n">migration_hop_id</span><span class="p">:</span>
            <span class="c1"># We don&#39;t use the hop_id, but making this query ensures it exists.</span>
            <span class="n">hop_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">migration_hop_id</span><span class="p">)</span>
            <span class="c1"># Even though it&#39;s not required, we make sure the id given for the</span>
            <span class="c1"># diffusion analysis table matches this existing hop id.</span>
            <span class="k">if</span> <span class="n">diffusion_analysis_id</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">hop_db</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">diffusion_analysis_id</span>

        <span class="c1"># Now same migration images and link them to this parent object.</span>
        <span class="c1"># Note, the start/end Migration images will exist already in the</span>
        <span class="c1"># relaxation database table. We still want to save them again here for</span>
        <span class="c1"># easy access.</span>
        <span class="k">for</span> <span class="n">image_number</span><span class="p">,</span> <span class="n">image_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">structures</span><span class="p">,</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">forces</span><span class="p">,</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">force</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">image_data</span>
            <span class="n">image_db</span> <span class="o">=</span> <span class="n">migration_image_table</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
                <span class="n">structure</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
                <span class="n">number</span><span class="o">=</span><span class="n">image_number</span><span class="p">,</span>
                <span class="n">force_tangent</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                <span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span>
                <span class="n">structure_distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                <span class="n">migration_hop_id</span><span class="o">=</span><span class="n">migration_hop_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">hop_db</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclasses_from_diffusion_analysis</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">diffusion_analysis</span><span class="p">:</span> <span class="n">DiffusionAnalysis</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically creates subclass of MigrationHop and MigrationImage, then</span>
<span class="sd">        links them to the DiffusionAnalysis table.</span>

<span class="sd">        This method should NOT be called directly because it is instead used by</span>
<span class="sd">        `DiffusionAnalysis.create_subclasses`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `name` :</span>
<span class="sd">            Name of the subclass that is output.</span>
<span class="sd">        - `diffusion_analysis` :</span>
<span class="sd">            DiffusionAnalysis table that these subclasses should be associated with.</span>
<span class="sd">        - `module` :</span>
<span class="sd">            name of the module this subclass should be associated with. Typically,</span>
<span class="sd">            you should pass __name__ to this.</span>
<span class="sd">        - `**extra_columns` :</span>
<span class="sd">            Additional columns to add to the table. The keyword will be the</span>
<span class="sd">            column name and the value should match django options</span>
<span class="sd">            (e.g. table_column.FloatField())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NewMigrationHopClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">MigrationHop&quot;</span><span class="p">,</span>
            <span class="n">diffusion_analysis</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
                <span class="n">diffusion_analysis</span><span class="p">,</span>
                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;migration_hops&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">NewMigrationImageClass</span> <span class="o">=</span> <span class="n">MigrationImage</span><span class="o">.</span><span class="n">create_subclass_from_migration_hop</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">NewMigrationHopClass</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">NewMigrationHopClass</span><span class="p">,</span> <span class="n">NewMigrationImageClass</span>
</pre></div>

        </details>

            <div class="docstring"><p>The base class for defining a table in the Simmate database. All tables and
mixins inherit from this class.</p>

<p>Usage is identical to
<a href="https://docs.djangoproject.com/en/4.0/#the-model-layer">models in Django</a>
where this class only adds extra methods for convenience.</p>
</div>


                            <div id="MigrationHop.base_info" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MigrationHop.base_info">#&nbsp;&nbsp</a>

        <span class="name">base_info</span><span class="annotation">: List[str]</span><span class="default_value"> = [&#39;site_start&#39;, &#39;site_end&#39;, &#39;index_start&#39;, &#39;index_end&#39;, &#39;number&#39;]</span>
    </div>

    
            <div class="docstring"><p>The base information for this database table and only these fields are stored
when the <code>to_archive</code> method is used. Using the columns in this list, all 
other columns for this table can be calculated, so the columns in this list 
are effectively the "raw data".</p>
</div>


                            </div>
                            <div id="MigrationHop.site_start" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.site_start">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">site_start</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The starting fractional coordinates of the diffusing site.</p>
</div>


                            </div>
                            <div id="MigrationHop.site_end" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.site_end">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">site_end</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The ending fractional coordinates of the diffusing site.</p>
</div>


                            </div>
                            <div id="MigrationHop.index_start" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.index_start">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">index_start</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The starting site index of the diffusing site.</p>
</div>


                            </div>
                            <div id="MigrationHop.index_end" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.index_end">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">index_end</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The ending site index of the diffusing site.</p>
</div>


                            </div>
                            <div id="MigrationHop.number" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.number">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">number</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The expected index in DistinctPathFinder.get_paths. The shortest path is index 0
and they are all ordered by increasing length.</p>
</div>


                            </div>
                            <div id="MigrationHop.length" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.length">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">length</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The length/distance of the pathway from start to end. Note, this is 
linear measurement -- i.e. is it the length of the linear interpolated path.</p>
</div>


                            </div>
                            <div id="MigrationHop.dimension_path" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.dimension_path">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">dimension_path</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The pathway dimensionality using the Larson scoring parameter.</p>
</div>


                            </div>
                            <div id="MigrationHop.dimension_host_lattice" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.dimension_host_lattice">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">dimension_host_lattice</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>Ignoring all atoms of the diffusing species, this is the dimensionality
of the remaining atoms of the lattice using the Larson scoring parameter.</p>
</div>


                            </div>
                            <div id="MigrationHop.energy_barrier" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.energy_barrier">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">energy_barrier</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The energy barrier in eV. This evaluates all images of the diffusion pathway
and find the difference between the maximum and minimum image energies.</p>
</div>


                            </div>
                            <div id="MigrationHop.to_toolkit" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.to_toolkit">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_toolkit</span><span class="signature">(self) -&gt; <a href="../../toolkit/diffusion.html#MigrationHop">simmate.toolkit.diffusion.MigrationHop</a></span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">to_toolkit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToolkitMigrationHop</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts the database MigrationHop to a toolkit MigrationHop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The bulk crystal structure is stored in the diffusion analysis table</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">to_toolkit</span><span class="p">()</span>

        <span class="c1"># pathways require a symmetrized structure</span>
        <span class="c1"># BUG: I need to ensure the symmetrized structure comes out the same</span>
        <span class="c1"># as before, so I need to be careful with updates and hardcoding here.</span>
        <span class="n">sga</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">symprec</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">symm_structure</span> <span class="o">=</span> <span class="n">sga</span><span class="o">.</span><span class="n">get_symmetrized_structure</span><span class="p">()</span>

        <span class="n">isite_new</span> <span class="o">=</span> <span class="n">PeriodicSite</span><span class="p">(</span>
            <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">migrating_specie</span><span class="p">,</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_start</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)],</span>
            <span class="n">lattice</span><span class="o">=</span><span class="n">symm_structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">esite_new</span> <span class="o">=</span> <span class="n">PeriodicSite</span><span class="p">(</span>
            <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">migrating_specie</span><span class="p">,</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_end</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)],</span>
            <span class="n">lattice</span><span class="o">=</span><span class="n">symm_structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">ToolkitMigrationHop</span><span class="p">(</span><span class="n">isite_new</span><span class="p">,</span> <span class="n">esite_new</span><span class="p">,</span> <span class="n">symm_structure</span><span class="p">)</span>
        <span class="c1"># BUG: see comment attached to definition of these fields</span>
        <span class="n">path</span><span class="o">.</span><span class="n">iindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_start</span>
        <span class="n">path</span><span class="o">.</span><span class="n">eindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_end</span>

        <span class="c1"># if the pathways match, then we can return the pathway object!</span>
        <span class="k">return</span> <span class="n">path</span>
</pre></div>

        </details>

            <div class="docstring"><p>converts the database MigrationHop to a toolkit MigrationHop</p>
</div>


                            </div>
                            <div id="MigrationHop.from_directory" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.from_directory">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">from_directory</span><span class="signature">(cls, directory: str, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># I assume the directory is from a vasp calculation, but I need to update</span>
        <span class="c1"># this when I begin adding new calculators.</span>

        <span class="c1"># BUG: A fix is make during the workup() method that may be relevant here.</span>
        <span class="c1"># simmate.calculators.vasp.tasks.nudged_elastic_band.MITNudgedElasticBand.workup</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">NEBAnalysis</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_pymatgen</span><span class="p">(</span><span class="n">analysis</span><span class="o">=</span><span class="n">analysis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="MigrationHop.from_pymatgen" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.from_pymatgen">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">from_pymatgen</span><span class="signature">(
    cls,
    analysis: pymatgen.analysis.transition_state.NEBAnalysis,
    diffusion_analysis_id: int = None,
    migration_hop_id: int = None
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pymatgen</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">analysis</span><span class="p">:</span> <span class="n">NEBAnalysis</span><span class="p">,</span>
        <span class="n">diffusion_analysis_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># only used if updating</span>
        <span class="n">migration_hop_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># only used if updating</span>
    <span class="p">):</span>
        <span class="c1"># We reference these related tables frequently below so it easier to</span>
        <span class="c1"># grab them up front.</span>
        <span class="n">diffusion_analysis_table</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">related_model</span>
        <span class="n">migration_image_table</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">migration_images</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">model</span>

        <span class="c1"># First, we need a migration_hop database object.</span>
        <span class="c1"># All of hops should link to a diffusion_analysis entry, so we check</span>
        <span class="c1"># for that here too. The key thing of these statements is that we</span>
        <span class="c1"># have a migration_hop_id at the end.</span>

        <span class="c1"># If no ids were given, then we make a new entries for each.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">diffusion_analysis_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">migration_hop_id</span><span class="p">:</span>
            <span class="c1"># Note, we have minimal information if this is the case, so these</span>
            <span class="c1"># table entries will have a bunch of empty columns.</span>

            <span class="c1"># We don&#39;t have a bulk structure to use for this class, so we use</span>
            <span class="c1"># the first image</span>
            <span class="n">analysis_db</span> <span class="o">=</span> <span class="n">diffusion_analysis_table</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
                <span class="n">structure</span><span class="o">=</span><span class="n">analysis</span><span class="o">.</span><span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">vacancy_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># assume this for now</span>
            <span class="p">)</span>
            <span class="n">analysis_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># This table entry will actually be completely empty... It only</span>
            <span class="c1"># serves to link the MigrationImages together</span>
            <span class="n">hop_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">diffusion_analysis_id</span><span class="o">=</span><span class="n">analysis_db</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">hop_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">migration_hop_id</span> <span class="o">=</span> <span class="n">hop_db</span><span class="o">.</span><span class="n">id</span>

        <span class="k">elif</span> <span class="n">diffusion_analysis_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">migration_hop_id</span><span class="p">:</span>
            <span class="c1"># This table entry will actually be completely empty... It only</span>
            <span class="c1"># serves to link the MigrationImages together</span>
            <span class="n">hop_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">diffusion_analysis_id</span><span class="o">=</span><span class="n">diffusion_analysis_id</span><span class="p">)</span>
            <span class="n">hop_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">migration_hop_id</span> <span class="o">=</span> <span class="n">hop_db</span><span class="o">.</span><span class="n">id</span>

        <span class="k">elif</span> <span class="n">migration_hop_id</span><span class="p">:</span>
            <span class="c1"># We don&#39;t use the hop_id, but making this query ensures it exists.</span>
            <span class="n">hop_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">migration_hop_id</span><span class="p">)</span>
            <span class="c1"># Even though it&#39;s not required, we make sure the id given for the</span>
            <span class="c1"># diffusion analysis table matches this existing hop id.</span>
            <span class="k">if</span> <span class="n">diffusion_analysis_id</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">hop_db</span><span class="o">.</span><span class="n">diffusion_analysis</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">diffusion_analysis_id</span>

        <span class="c1"># Now same migration images and link them to this parent object.</span>
        <span class="c1"># Note, the start/end Migration images will exist already in the</span>
        <span class="c1"># relaxation database table. We still want to save them again here for</span>
        <span class="c1"># easy access.</span>
        <span class="k">for</span> <span class="n">image_number</span><span class="p">,</span> <span class="n">image_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">structures</span><span class="p">,</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">forces</span><span class="p">,</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">force</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">image_data</span>
            <span class="n">image_db</span> <span class="o">=</span> <span class="n">migration_image_table</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
                <span class="n">structure</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
                <span class="n">number</span><span class="o">=</span><span class="n">image_number</span><span class="p">,</span>
                <span class="n">force_tangent</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                <span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span>
                <span class="n">structure_distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                <span class="n">migration_hop_id</span><span class="o">=</span><span class="n">migration_hop_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">hop_db</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="MigrationHop.create_subclasses_from_diffusion_analysis" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.create_subclasses_from_diffusion_analysis">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">create_subclasses_from_diffusion_analysis</span><span class="signature">(
    cls,
    name: str,
    diffusion_analysis: <a href="#DiffusionAnalysis">simmate.database.base_data_types.nudged_elastic_band.DiffusionAnalysis</a>,
    module: str,
    **extra_columns
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclasses_from_diffusion_analysis</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">diffusion_analysis</span><span class="p">:</span> <span class="n">DiffusionAnalysis</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically creates subclass of MigrationHop and MigrationImage, then</span>
<span class="sd">        links them to the DiffusionAnalysis table.</span>

<span class="sd">        This method should NOT be called directly because it is instead used by</span>
<span class="sd">        `DiffusionAnalysis.create_subclasses`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `name` :</span>
<span class="sd">            Name of the subclass that is output.</span>
<span class="sd">        - `diffusion_analysis` :</span>
<span class="sd">            DiffusionAnalysis table that these subclasses should be associated with.</span>
<span class="sd">        - `module` :</span>
<span class="sd">            name of the module this subclass should be associated with. Typically,</span>
<span class="sd">            you should pass __name__ to this.</span>
<span class="sd">        - `**extra_columns` :</span>
<span class="sd">            Additional columns to add to the table. The keyword will be the</span>
<span class="sd">            column name and the value should match django options</span>
<span class="sd">            (e.g. table_column.FloatField())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        - `NewMigrationHopClass`:</span>
<span class="sd">            A subclass of MigrationHop.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NewMigrationHopClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">MigrationHop&quot;</span><span class="p">,</span>
            <span class="n">diffusion_analysis</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
                <span class="n">diffusion_analysis</span><span class="p">,</span>
                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;migration_hops&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">NewMigrationImageClass</span> <span class="o">=</span> <span class="n">MigrationImage</span><span class="o">.</span><span class="n">create_subclass_from_migration_hop</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">NewMigrationHopClass</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">NewMigrationHopClass</span><span class="p">,</span> <span class="n">NewMigrationImageClass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Dynamically creates subclass of MigrationHop and MigrationImage, then
links them to the DiffusionAnalysis table.</p>

<p>This method should NOT be called directly because it is instead used by
<code><a href="#DiffusionAnalysis.create_subclasses">DiffusionAnalysis.create_subclasses</a></code>.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><code>name</code> :
Name of the subclass that is output.</li>
<li><code>diffusion_analysis</code> :
DiffusionAnalysis table that these subclasses should be associated with.</li>
<li><code>module</code> :
name of the module this subclass should be associated with. Typically,
you should pass __name__ to this.</li>
<li><code>**extra_columns</code> :
Additional columns to add to the table. The keyword will be the
column name and the value should match django options
(e.g. table_column.FloatField())</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li><code>NewMigrationHopClass</code>:
A subclass of MigrationHop.</li>
<li><code>NewMigrationHopClass</code>:
A subclass of MigrationHop.</li>
</ul>
</div>


                            </div>
                            <div id="MigrationHop.source" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.source">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">source</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><blockquote>
  <p>Note, this field is highly experimental at the moment and subject to
  change.</p>
</blockquote>

<p>This column indicates where the data came from, and it could be a number 
of things including...</p>

<ul>
<li>a third party id</li>
<li>a structure from a different Simmate datbase table</li>
<li>a transformation of another structure</li>
<li>a creation method</li>
<li>a custom submission by the user</li>
</ul>

<p>By default, this is a JSON field to account for all scenarios, but some
tables (such as those in <code><a href="../third_parties.html">simmate.database.third_parties</a></code>) this is value
should be the same for ALL entries in the table and therefore the column is
overwritten as an attribute.</p>

<p>For other tables where this is not a constant, here are some examples of
values used in this column:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># from a thirdparty database or separate table</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a random structure creator</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PyXtalStructure&quot;</span><span class="p">}</span>

<span class="c1"># from a templated structure creator (e.g. substituition or prototypes)</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PrototypeStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;AFLOWPrototypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;MirrorMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a multi-structure transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;HereditaryMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mp-123&quot;</span><span class="p">,</span> <span class="s2">&quot;mp-321&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>django.db.models.base.Model</dt>
                                <dd id="MigrationHop.__init__" class="function">Model</dd>
                <dd id="MigrationHop.from_db" class="function">from_db</dd>
                <dd id="MigrationHop.pk" class="variable">pk</dd>
                <dd id="MigrationHop.get_deferred_fields" class="function">get_deferred_fields</dd>
                <dd id="MigrationHop.refresh_from_db" class="function">refresh_from_db</dd>
                <dd id="MigrationHop.serializable_value" class="function">serializable_value</dd>
                <dd id="MigrationHop.save" class="function">save</dd>
                <dd id="MigrationHop.save_base" class="function">save_base</dd>
                <dd id="MigrationHop.delete" class="function">delete</dd>
                <dd id="MigrationHop.prepare_database_save" class="function">prepare_database_save</dd>
                <dd id="MigrationHop.clean" class="function">clean</dd>
                <dd id="MigrationHop.validate_unique" class="function">validate_unique</dd>
                <dd id="MigrationHop.date_error_message" class="function">date_error_message</dd>
                <dd id="MigrationHop.unique_error_message" class="function">unique_error_message</dd>
                <dd id="MigrationHop.full_clean" class="function">full_clean</dd>
                <dd id="MigrationHop.clean_fields" class="function">clean_fields</dd>
                <dd id="MigrationHop.check" class="function">check</dd>

            </div>
            <div><dt><a href="base.html#DatabaseTable">simmate.database.base_data_types.base.DatabaseTable</a></dt>
                                <dd id="MigrationHop.source_doi" class="variable"><a href="base.html#DatabaseTable.source_doi">source_doi</a></dd>
                <dd id="MigrationHop.remote_archive_link" class="variable"><a href="base.html#DatabaseTable.remote_archive_link">remote_archive_link</a></dd>
                <dd id="MigrationHop.objects" class="function"><a href="base.html#DatabaseTable.objects">objects</a></dd>
                <dd id="MigrationHop.create_subclass" class="function"><a href="base.html#DatabaseTable.create_subclass">create_subclass</a></dd>
                <dd id="MigrationHop.from_toolkit" class="function"><a href="base.html#DatabaseTable.from_toolkit">from_toolkit</a></dd>
                <dd id="MigrationHop.load_archive" class="function"><a href="base.html#DatabaseTable.load_archive">load_archive</a></dd>
                <dd id="MigrationHop.load_remote_archive" class="function"><a href="base.html#DatabaseTable.load_remote_archive">load_remote_archive</a></dd>
                <dd id="MigrationHop.get_column_names" class="function"><a href="base.html#DatabaseTable.get_column_names">get_column_names</a></dd>
                <dd id="MigrationHop.show_columns" class="function"><a href="base.html#DatabaseTable.show_columns">show_columns</a></dd>
                <dd id="MigrationHop.get_mixins" class="function"><a href="base.html#DatabaseTable.get_mixins">get_mixins</a></dd>
                <dd id="MigrationHop.get_mixin_names" class="function"><a href="base.html#DatabaseTable.get_mixin_names">get_mixin_names</a></dd>
                <dd id="MigrationHop.get_extra_columns" class="function"><a href="base.html#DatabaseTable.get_extra_columns">get_extra_columns</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MigrationHop.Meta">
                                <div class="attr class">
        <a class="headerlink" href="#MigrationHop.Meta">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">MigrationHop.Meta</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>
</pre></div>

        </details>

    

                            <div id="MigrationHop.Meta.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationHop.Meta.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">MigrationHop.Meta</span><span class="signature">()</span>
    </div>

    
    

                            </div>
                            <div id="MigrationHop.Meta.abstract" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MigrationHop.Meta.abstract">#&nbsp;&nbsp</a>

        <span class="name">abstract</span><span class="default_value"> = False</span>
    </div>

    
    

                            </div>
                            <div id="MigrationHop.Meta.app_label" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MigrationHop.Meta.app_label">#&nbsp;&nbsp</a>

        <span class="name">app_label</span><span class="default_value"> = &#39;workflows&#39;</span>
    </div>

    
    

                            </div>
                </section>
                <section id="MigrationImage">
                                <div class="attr class">
        <a class="headerlink" href="#MigrationImage">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">MigrationImage</span><wbr>(<span class="base"><a href="structure.html#Structure">simmate.database.base_data_types.structure.Structure</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MigrationImage</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>

    <span class="n">base_info</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;structure_string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;force_tangent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;structure_distance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;energy&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">number</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The image number. Note, the starting image is always 0 and the ending</span>
<span class="sd">    image is always -1. The choice of -1 is because we often add the ending</span>
<span class="sd">    image to the database table before knowing how many midpoint images we</span>
<span class="sd">    are going to create.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">force_tangent</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The tangent force of image. Not to be confused with forces from the Forces mix-in.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Note, we only care about the total energy for NEB images -- not the other</span>
    <span class="c1"># fields that the Thermodynamics mix-in provides. This is why we set this</span>
    <span class="c1"># field directly, rather than using the mix-in.</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The calculated total energy. Units are in eV. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">structure_distance</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fingerprint distance of the image from the starting image. A smaller</span>
<span class="sd">    means the structures are more similar, with 0 being an exact match.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># We don&#39;t need the source column for the MigrationImage class because we</span>
    <span class="c1"># instead stored the source on the DiffusionAnalysis object. This line</span>
    <span class="c1"># deletes the source column from our Structure mix-in.</span>
    <span class="n">source</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclass_from_migration_hop</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">migration_hop</span><span class="p">:</span> <span class="n">MigrationHop</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically creates subclass of MigrationImage, then links it to the</span>
<span class="sd">        MigrationHop table.</span>

<span class="sd">        This method should NOT be called directly because it is instead used by</span>
<span class="sd">        `DiffusionAnalysis.create_subclasses`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `name` :</span>
<span class="sd">            Name of the subclass that is output.</span>
<span class="sd">        - `migration_hop` :</span>
<span class="sd">            MigrationHop table that these images should be associated with.</span>
<span class="sd">        - `module` :</span>
<span class="sd">            name of the module this subclass should be associated with. Typically,</span>
<span class="sd">            you should pass __name__ to this.</span>
<span class="sd">        - `**extra_columns` :</span>
<span class="sd">            Additional columns to add to the table. The keyword will be the</span>
<span class="sd">            column name and the value should match django options</span>
<span class="sd">            (e.g. table_column.FloatField())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - `NewClass` :</span>
<span class="sd">            A subclass of MigrationImage.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NewClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">MigrationImage&quot;</span><span class="p">,</span>
            <span class="n">migration_hop</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
                <span class="n">migration_hop</span><span class="p">,</span>
                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;migration_images&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">NewClass</span>
</pre></div>

        </details>

            <div class="docstring"><p>The base class for defining a table in the Simmate database. All tables and
mixins inherit from this class.</p>

<p>Usage is identical to
<a href="https://docs.djangoproject.com/en/4.0/#the-model-layer">models in Django</a>
where this class only adds extra methods for convenience.</p>
</div>


                            <div id="MigrationImage.base_info" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MigrationImage.base_info">#&nbsp;&nbsp</a>

        <span class="name">base_info</span><span class="annotation">: List[str]</span><span class="default_value"> = [&#39;number&#39;, &#39;structure_string&#39;, &#39;force_tangent&#39;, &#39;structure_distance&#39;, &#39;energy&#39;]</span>
    </div>

    
            <div class="docstring"><p>The base information for this database table and only these fields are stored
when the <code>to_archive</code> method is used. Using the columns in this list, all 
other columns for this table can be calculated, so the columns in this list 
are effectively the "raw data".</p>
</div>


                            </div>
                            <div id="MigrationImage.number" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.number">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">number</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The image number. Note, the starting image is always 0 and the ending
image is always -1. The choice of -1 is because we often add the ending
image to the database table before knowing how many midpoint images we
are going to create.</p>
</div>


                            </div>
                            <div id="MigrationImage.force_tangent" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.force_tangent">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">force_tangent</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The tangent force of image. Not to be confused with forces from the Forces mix-in.</p>
</div>


                            </div>
                            <div id="MigrationImage.energy" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.energy">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">energy</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The calculated total energy. Units are in eV.</p>
</div>


                            </div>
                            <div id="MigrationImage.structure_distance" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.structure_distance">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">structure_distance</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The fingerprint distance of the image from the starting image. A smaller
means the structures are more similar, with 0 being an exact match.</p>
</div>


                            </div>
                            <div id="MigrationImage.source" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MigrationImage.source">#&nbsp;&nbsp</a>

        <span class="name">source</span><span class="default_value"> = None</span>
    </div>

    
            <div class="docstring"><blockquote>
  <p>Note, this field is highly experimental at the moment and subject to
  change.</p>
</blockquote>

<p>This column indicates where the data came from, and it could be a number 
of things including...</p>

<ul>
<li>a third party id</li>
<li>a structure from a different Simmate datbase table</li>
<li>a transformation of another structure</li>
<li>a creation method</li>
<li>a custom submission by the user</li>
</ul>

<p>By default, this is a JSON field to account for all scenarios, but some
tables (such as those in <code><a href="../third_parties.html">simmate.database.third_parties</a></code>) this is value
should be the same for ALL entries in the table and therefore the column is
overwritten as an attribute.</p>

<p>For other tables where this is not a constant, here are some examples of
values used in this column:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># from a thirdparty database or separate table</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a random structure creator</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PyXtalStructure&quot;</span><span class="p">}</span>

<span class="c1"># from a templated structure creator (e.g. substituition or prototypes)</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PrototypeStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;AFLOWPrototypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;MirrorMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a multi-structure transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;HereditaryMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mp-123&quot;</span><span class="p">,</span> <span class="s2">&quot;mp-321&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>
</div>


                            </div>
                            <div id="MigrationImage.create_subclass_from_migration_hop" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.create_subclass_from_migration_hop">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">create_subclass_from_migration_hop</span><span class="signature">(
    cls,
    name: str,
    migration_hop: <a href="#MigrationHop">simmate.database.base_data_types.nudged_elastic_band.MigrationHop</a>,
    module: str,
    **extra_columns
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_subclass_from_migration_hop</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">migration_hop</span><span class="p">:</span> <span class="n">MigrationHop</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically creates subclass of MigrationImage, then links it to the</span>
<span class="sd">        MigrationHop table.</span>

<span class="sd">        This method should NOT be called directly because it is instead used by</span>
<span class="sd">        `DiffusionAnalysis.create_subclasses`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - `name` :</span>
<span class="sd">            Name of the subclass that is output.</span>
<span class="sd">        - `migration_hop` :</span>
<span class="sd">            MigrationHop table that these images should be associated with.</span>
<span class="sd">        - `module` :</span>
<span class="sd">            name of the module this subclass should be associated with. Typically,</span>
<span class="sd">            you should pass __name__ to this.</span>
<span class="sd">        - `**extra_columns` :</span>
<span class="sd">            Additional columns to add to the table. The keyword will be the</span>
<span class="sd">            column name and the value should match django options</span>
<span class="sd">            (e.g. table_column.FloatField())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - `NewClass` :</span>
<span class="sd">            A subclass of MigrationImage.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NewClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">MigrationImage&quot;</span><span class="p">,</span>
            <span class="n">migration_hop</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
                <span class="n">migration_hop</span><span class="p">,</span>
                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;migration_images&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">NewClass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Dynamically creates subclass of MigrationImage, then links it to the
MigrationHop table.</p>

<p>This method should NOT be called directly because it is instead used by
<code><a href="#DiffusionAnalysis.create_subclasses">DiffusionAnalysis.create_subclasses</a></code>.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><code>name</code> :
Name of the subclass that is output.</li>
<li><code>migration_hop</code> :
MigrationHop table that these images should be associated with.</li>
<li><code>module</code> :
name of the module this subclass should be associated with. Typically,
you should pass __name__ to this.</li>
<li><code>**extra_columns</code> :
Additional columns to add to the table. The keyword will be the
column name and the value should match django options
(e.g. table_column.FloatField())</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li><code>NewClass</code> :
A subclass of MigrationImage.</li>
</ul>
</div>


                            </div>
                            <div id="MigrationImage.structure_string" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.structure_string">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">structure_string</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The core structure information, which is written to a string and in a 
compressed format using the <code><a href="#MigrationImage.from_toolkit">from_toolkit</a></code> method. To get back to our toolkit
structure object, use the <code><a href="#MigrationImage.to_toolkit">to_toolkit</a></code> method.</p>
</div>


                            </div>
                            <div id="MigrationImage.nsites" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.nsites">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">nsites</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The total number of sites in the unitcell. (e.g. Y2CF2 has 5 sites)</p>
</div>


                            </div>
                            <div id="MigrationImage.nelements" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.nelements">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">nelements</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The total number of unique elements. (e.g. Y2CF2 has 3 elements)</p>
</div>


                            </div>
                            <div id="MigrationImage.elements" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.elements">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">elements</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>List of elements in the structure (ex: ["Y", "C", "F"])</p>
</div>


                            </div>
                            <div id="MigrationImage.chemical_system" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.chemical_system">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">chemical_system</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>the base chemical system (ex: "Y-C-F")</p>

<p>Note: be careful when searching for elements! Running chemical_system__contains="C"
on this field won't do what you expect -- because it will return structures
containing Ca, Cs, Ce, Cl, and so on. If you want to search for structures
that contain a specific element, use elements__contains='"C"' instead. The
odd use of quotes '"C"' is required here!</p>
</div>


                            </div>
                            <div id="MigrationImage.density" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.density">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">density</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The density of the crystal in g/cm^3</p>
</div>


                            </div>
                            <div id="MigrationImage.density_atomic" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.density_atomic">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">density_atomic</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The density of atoms in the crystal in atoms/Angstom^3</p>
</div>


                            </div>
                            <div id="MigrationImage.volume" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.volume">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">volume</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The volume of the unitcell in Angstom^3</p>

<p>Note: in most cases, <code><a href="#MigrationImage.volume_molar">volume_molar</a></code> should be used instead! This is because
volumne is highly dependent on the symmetry and the arbitray unitcell. If 
you are truly after small volumes of the unitcell, it is likely you really 
just want to search by spacegroup.</p>
</div>


                            </div>
                            <div id="MigrationImage.volume_molar" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.volume_molar">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">volume_molar</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The molar volume of the crystal in cm^3/mol</p>
</div>


                            </div>
                            <div id="MigrationImage.formula_full" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.formula_full">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">formula_full</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The chemical formula with elements sorted by electronegativity (ex: Li4 Fe4 P4 O16)</p>
</div>


                            </div>
                            <div id="MigrationImage.formula_reduced" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.formula_reduced">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">formula_reduced</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>The reduced chemical formula. (ex: Li4Fe4P4O16 --> LiFePO4)</p>
</div>


                            </div>
                            <div id="MigrationImage.formula_anonymous" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.formula_anonymous">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">formula_anonymous</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>An anonymized formula. Unique species are arranged in ordering of 
amounts and assigned ascending alphabets. Useful for prototyping formulas. 
For example, all stoichiometric perovskites have anonymized_formula ABC3.</p>
</div>


                            </div>
                            <div id="MigrationImage.spacegroup" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MigrationImage.spacegroup">#&nbsp;&nbsp</a>

        <span class="name">spacegroup</span>
    </div>

    
            <div class="docstring"><p>Spacegroup information. Points to a separate database table that has additional
columns:
<code><a href="symmetry.html#Spacegroup">simmate.database.base_data_types.symmetry.Spacegroup</a></code></p>
</div>


                            </div>
                            <div id="MigrationImage.spacegroup_id" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MigrationImage.spacegroup_id">#&nbsp;&nbsp</a>

        <span class="name">spacegroup_id</span>
    </div>

    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>django.db.models.base.Model</dt>
                                <dd id="MigrationImage.__init__" class="function">Model</dd>
                <dd id="MigrationImage.from_db" class="function">from_db</dd>
                <dd id="MigrationImage.pk" class="variable">pk</dd>
                <dd id="MigrationImage.get_deferred_fields" class="function">get_deferred_fields</dd>
                <dd id="MigrationImage.refresh_from_db" class="function">refresh_from_db</dd>
                <dd id="MigrationImage.serializable_value" class="function">serializable_value</dd>
                <dd id="MigrationImage.save" class="function">save</dd>
                <dd id="MigrationImage.save_base" class="function">save_base</dd>
                <dd id="MigrationImage.delete" class="function">delete</dd>
                <dd id="MigrationImage.prepare_database_save" class="function">prepare_database_save</dd>
                <dd id="MigrationImage.clean" class="function">clean</dd>
                <dd id="MigrationImage.validate_unique" class="function">validate_unique</dd>
                <dd id="MigrationImage.date_error_message" class="function">date_error_message</dd>
                <dd id="MigrationImage.unique_error_message" class="function">unique_error_message</dd>
                <dd id="MigrationImage.full_clean" class="function">full_clean</dd>
                <dd id="MigrationImage.clean_fields" class="function">clean_fields</dd>
                <dd id="MigrationImage.check" class="function">check</dd>

            </div>
            <div><dt><a href="structure.html#Structure">simmate.database.base_data_types.structure.Structure</a></dt>
                                <dd id="MigrationImage.to_toolkit" class="function"><a href="structure.html#Structure.to_toolkit">to_toolkit</a></dd>

            </div>
            <div><dt><a href="base.html#DatabaseTable">simmate.database.base_data_types.base.DatabaseTable</a></dt>
                                <dd id="MigrationImage.source_doi" class="variable"><a href="base.html#DatabaseTable.source_doi">source_doi</a></dd>
                <dd id="MigrationImage.remote_archive_link" class="variable"><a href="base.html#DatabaseTable.remote_archive_link">remote_archive_link</a></dd>
                <dd id="MigrationImage.objects" class="function"><a href="base.html#DatabaseTable.objects">objects</a></dd>
                <dd id="MigrationImage.create_subclass" class="function"><a href="base.html#DatabaseTable.create_subclass">create_subclass</a></dd>
                <dd id="MigrationImage.from_toolkit" class="function"><a href="base.html#DatabaseTable.from_toolkit">from_toolkit</a></dd>
                <dd id="MigrationImage.load_archive" class="function"><a href="base.html#DatabaseTable.load_archive">load_archive</a></dd>
                <dd id="MigrationImage.load_remote_archive" class="function"><a href="base.html#DatabaseTable.load_remote_archive">load_remote_archive</a></dd>
                <dd id="MigrationImage.get_column_names" class="function"><a href="base.html#DatabaseTable.get_column_names">get_column_names</a></dd>
                <dd id="MigrationImage.show_columns" class="function"><a href="base.html#DatabaseTable.show_columns">show_columns</a></dd>
                <dd id="MigrationImage.get_mixins" class="function"><a href="base.html#DatabaseTable.get_mixins">get_mixins</a></dd>
                <dd id="MigrationImage.get_mixin_names" class="function"><a href="base.html#DatabaseTable.get_mixin_names">get_mixin_names</a></dd>
                <dd id="MigrationImage.get_extra_columns" class="function"><a href="base.html#DatabaseTable.get_extra_columns">get_extra_columns</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MigrationImage.Meta">
                                <div class="attr class">
        <a class="headerlink" href="#MigrationImage.Meta">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">MigrationImage.Meta</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>
</pre></div>

        </details>

    

                            <div id="MigrationImage.Meta.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MigrationImage.Meta.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">MigrationImage.Meta</span><span class="signature">()</span>
    </div>

    
    

                            </div>
                            <div id="MigrationImage.Meta.abstract" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MigrationImage.Meta.abstract">#&nbsp;&nbsp</a>

        <span class="name">abstract</span><span class="default_value"> = False</span>
    </div>

    
    

                            </div>
                            <div id="MigrationImage.Meta.app_label" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MigrationImage.Meta.app_label">#&nbsp;&nbsp</a>

        <span class="name">app_label</span><span class="default_value"> = &#39;workflows&#39;</span>
    </div>

    
    

                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>