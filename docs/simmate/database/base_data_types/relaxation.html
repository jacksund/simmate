<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.2"/>
    <title>simmate.database.base_data_types.relaxation API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../base_data_types.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simmate.database.base_data_types</a>

<a href="https://github.com/jacksund/simmate">            <img src="https://github.com/jacksund/simmate/blob/main/src/simmate/website/static_files/images/simmate-logo.svg?raw=true" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#Relaxation">Relaxation</a>
                            <ul class="memberlist">
                        <li>
                                <a class="class" href="#Relaxation.Meta">Relaxation.Meta</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Relaxation.Meta.__init__">Meta</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Relaxation.Meta.abstract">abstract</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Relaxation.Meta.app_label">app_label</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="variable" href="#Relaxation.base_info">base_info</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.band_gap">band_gap</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.is_gap_direct">is_gap_direct</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.energy_fermi">energy_fermi</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.conduction_band_minimum">conduction_band_minimum</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.valence_band_maximum">valence_band_maximum</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.volume_change">volume_change</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.create_subclasses">create_subclasses</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.from_directory">from_directory</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.from_vasp_run">from_vasp_run</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.update_from_vasp_run">update_from_vasp_run</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.get_convergence_plot">get_convergence_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.view_convergence_plot">view_convergence_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.get_convergence_plot_html">get_convergence_plot_html</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.structure_string">structure_string</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.nsites">nsites</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.nelements">nelements</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.elements">elements</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.chemical_system">chemical_system</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.density">density</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.density_atomic">density_atomic</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.volume">volume</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.volume_molar">volume_molar</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.formula_full">formula_full</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.formula_reduced">formula_reduced</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.formula_anonymous">formula_anonymous</a>
                        </li>
                        <li>
                                <a class="variable" href="#Relaxation.spacegroup">spacegroup</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.directory">directory</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.prefect_flow_run_id">prefect_flow_run_id</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.corrections">corrections</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.created_at">created_at</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.updated_at">updated_at</a>
                        </li>
                        <li>
                                <a class="function" href="#Relaxation.source">source</a>
                        </li>
                        <li>
                                <a class="variable" href="#Relaxation.spacegroup_id">spacegroup_id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IonicStep">IonicStep</a>
                            <ul class="memberlist">
                        <li>
                                <a class="class" href="#IonicStep.Meta">IonicStep.Meta</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#IonicStep.Meta.__init__">Meta</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#IonicStep.Meta.abstract">abstract</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#IonicStep.Meta.app_label">app_label</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="variable" href="#IonicStep.base_info">base_info</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.number">number</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.create_subclass_from_relaxation">create_subclass_from_relaxation</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.structure_string">structure_string</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.nsites">nsites</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.nelements">nelements</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.elements">elements</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.chemical_system">chemical_system</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.density">density</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.density_atomic">density_atomic</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.volume">volume</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.volume_molar">volume_molar</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.formula_full">formula_full</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.formula_reduced">formula_reduced</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.formula_anonymous">formula_anonymous</a>
                        </li>
                        <li>
                                <a class="variable" href="#IonicStep.spacegroup">spacegroup</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.energy">energy</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.energy_per_atom">energy_per_atom</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.energy_above_hull">energy_above_hull</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.is_stable">is_stable</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.decomposes_to">decomposes_to</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.formation_energy">formation_energy</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.formation_energy_per_atom">formation_energy_per_atom</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.site_forces">site_forces</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.lattice_stress">lattice_stress</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.site_force_norm_max">site_force_norm_max</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.site_forces_norm">site_forces_norm</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.site_forces_norm_per_atom">site_forces_norm_per_atom</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.lattice_stress_norm">lattice_stress_norm</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.lattice_stress_norm_per_atom">lattice_stress_norm_per_atom</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.created_at">created_at</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.updated_at">updated_at</a>
                        </li>
                        <li>
                                <a class="function" href="#IonicStep.source">source</a>
                        </li>
                        <li>
                                <a class="variable" href="#IonicStep.spacegroup_id">spacegroup_id</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/database/base_data_types/relaxation.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../simmate.html">simmate</a><wbr>.<a href="./../../database.html">database</a><wbr>.<a href="./../base_data_types.html">base_data_types</a><wbr>.relaxation    </h1>

                        <div class="docstring"><p>Structure Relaxations are made up of a series of ionic steps -- where each
ionic step can be thought of as a single energy calculation. This yields
energy, forces, and lattice stress for a given structure. In many cases,
users won't need all of this data because they're only after the final
structure. However, all ionic steps are useful in the case of confirming 
convergence as well as machine learning applications. We therefore store these
here.</p>

<p>This module helps you create tables to results from structure relaxations
(aka geometry optimizations). This will store all ionic steps and the forces/stress
associated with each step.</p>

<p>When creating new tables for Relaxations, you should use the <code><a href="#Relaxation.create_subclasses">Relaxation.create_subclasses</a></code> method, which helps remove all the 
boilerplate code needed. For Django users, it may be tricky to understand what's
happening behind the scenes, so here's an example:</p>

<p>These two lines...</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="../base_data_types.html">simmate.database.base_data_types</a></span> <span class="kn">import</span> <span class="n">Relaxation</span>

<span class="n">ExampleRelaxation</span><span class="p">,</span> <span class="n">ExampleIonicStep</span> <span class="o">=</span> <span class="n"><a href="#Relaxation.create_subclasses">Relaxation.create_subclasses</a></span><span class="p">(</span>
    <span class="s2">&quot;Example&quot;</span><span class="p">,</span>
    <span class="n">module</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<p>... do exactly the same thing as all of these lines...</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="../base_data_types.html">simmate.database.base_data_types</a></span> <span class="kn">import</span> <span class="n">table_column</span>
<span class="kn">from</span> <span class="nn"><a href="../base_data_types.html">simmate.database.base_data_types</a></span> <span class="kn">import</span> <span class="n">IonicStep</span><span class="p">,</span> <span class="n">Relaxation</span>

<span class="k">class</span> <span class="nc">ExampleIonicStep</span><span class="p">(</span><span class="n">IonicStep</span><span class="p">):</span>
    <span class="n">relaxation</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;ExampleRelaxation&quot;</span><span class="p">,</span>  <span class="c1"># in quotes becuase this is defined below</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;structures&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">class</span> <span class="nc">ExampleRelaxation</span><span class="p">(</span><span class="n">Relaxation</span><span class="p">):</span>
    <span class="n">structure_start</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
        <span class="n">ExampleIonicStep</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relaxations_as_start&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">structure_final</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
        <span class="n">ExampleIonicStep</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relaxations_as_final&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>

<p>Note there are two tables involved. One stores all of the ionic steps, and the
other connects all ionic steps to a specific calculation and result.</p>
</div>

                        <input id="relaxation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="relaxation-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">Structure Relaxations are made up of a series of ionic steps -- where each</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">ionic step can be thought of as a single energy calculation. This yields</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">energy, forces, and lattice stress for a given structure. In many cases,</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">users won&#39;t need all of this data because they&#39;re only after the final</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">structure. However, all ionic steps are useful in the case of confirming </span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">convergence as well as machine learning applications. We therefore store these</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">here.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">This module helps you create tables to results from structure relaxations</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">(aka geometry optimizations). This will store all ionic steps and the forces/stress</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">associated with each step.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">When creating new tables for Relaxations, you should use the `Relaxation.create_subclasses` method, which helps remove all the </span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">boilerplate code needed. For Django users, it may be tricky to understand what&#39;s</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">happening behind the scenes, so here&#39;s an example:</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    </span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">These two lines...</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">``` python </span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">from simmate.database.base_data_types import Relaxation</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">ExampleRelaxation, ExampleIonicStep = Relaxation.create_subclasses(</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    &quot;Example&quot;,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    module=__name__,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">```</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">... do exactly the same thing as all of these lines...</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">``` python</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">from simmate.database.base_data_types import table_column</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">from simmate.database.base_data_types import IonicStep, Relaxation</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">class ExampleIonicStep(IonicStep):</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    relaxation = table_column.ForeignKey(</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        &quot;ExampleRelaxation&quot;,  # in quotes becuase this is defined below</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">        on_delete=table_column.CASCADE,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        related_name=&quot;structures&quot;,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    )</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">class ExampleRelaxation(Relaxation):</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    structure_start = table_column.OneToOneField(</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        ExampleIonicStep,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        on_delete=table_column.CASCADE,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        related_name=&quot;relaxations_as_start&quot;,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        blank=True,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        null=True,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    )</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    structure_final = table_column.OneToOneField(</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        ExampleIonicStep,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        on_delete=table_column.CASCADE,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        related_name=&quot;relaxations_as_final&quot;,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">        blank=True,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        null=True,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    )</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">```</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">Note there are two tables involved. One stores all of the ionic steps, and the</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">other connects all ionic steps to a specific calculation and result.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="kn">from</span> <span class="nn">simmate.database.base_data_types</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="n">table_column</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">Structure</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="n">Forces</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="n">Thermodynamics</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="n">Calculation</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="p">)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">plotly_go</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="kn">from</span> <span class="nn">pymatgen.io.vasp.outputs</span> <span class="kn">import</span> <span class="n">Vasprun</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="k">class</span> <span class="nc">Relaxation</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Calculation</span><span class="p">):</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    This table holds all data from a structure relaxation and also links to</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    IonicStep table which holds all of the structure/energy/forces for each</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">    ionic step.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    WARNING: The Structure stored in this table here is the source structure</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    until the calculation completes. After completed, the structure will</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    be updated to the final structure. If you wish to ensure you&#39;re accessing</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    the correct structure, use the `structure_final` attribute, which gives</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    the final IonicStep.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>    <span class="n">base_info</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="p">[</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="s2">&quot;band_gap&quot;</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="s2">&quot;is_gap_direct&quot;</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>            <span class="s2">&quot;energy_fermi&quot;</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="s2">&quot;conduction_band_minimum&quot;</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>            <span class="s2">&quot;valence_band_maximum&quot;</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="p">]</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="o">+</span> <span class="n">Structure</span><span class="o">.</span><span class="n">base_info</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="o">+</span> <span class="n">Calculation</span><span class="o">.</span><span class="n">base_info</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="c1"># OPTIMIZE: should I include this electronic data?</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>    <span class="c1"># This data here is something we only get for the final structure, so it</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="c1"># may make sense to move this data into the IonicStepStructure table (and</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="c1"># allow null values for non-final steps). I instead keep this here because</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="c1"># I don&#39;t want columns above that are largely empty.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="c1"># Note: all entries are optional because there is no guaruntee the calculation</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="c1"># finishes successfully</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="n">band_gap</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">    The band gap energy in eV.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="n">is_gap_direct</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">    Whether the band gap is direct or indirect.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="n">energy_fermi</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">    The Fermi energy in eV.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="n">conduction_band_minimum</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">    The conduction band minimum in eV.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="n">valence_band_maximum</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">    The valence band maximum in eV.</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="n">volume_change</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">    The percent volume change during the relaxation. This is useful for checking</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">    if Pulay Stress may be significant or if the structure was highly unreasonable.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">    We store this as a ratio relative to the starting structure:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">    ```</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">    (volume_final - volume_start) / volume_start</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">    ```</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    <span class="sd">&quot;&quot;&quot; Relationships &quot;&quot;&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>    <span class="c1"># structure_start --&gt; points to first (0) IonicStep</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>    <span class="c1"># structure_final --&gt; points to final IonicStep</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>    <span class="c1"># structures --&gt; gives list of all IonicSteps</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">create_subclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_columns</span><span class="p">):</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        Dynamically creates a subclass of Relaxation as well as a separate IonicStep</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        table for it. These tables are linked together.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        Example use:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        ``` python</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        from simmate.database.base_data_types import Relaxation</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        ExampleRelaxation, ExampleIonicStep = Relaxation.create_subclasses(</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">            &quot;Example&quot;,</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">            module=__name__,</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        )</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        ```</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        #### Parameters</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        - `name` :</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">            The prefix name of the subclasses that are output. &quot;Relaxation&quot; and</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">            &quot;IonicStep&quot; will be attached to the end of this prefix.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        - `module` :</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">            name of the module this subclass should be associated with. Typically,</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">            you should pass __name__ to this.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        - `**extra_columns` :</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">            Additional columns to add to the table. The keyword will be the</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">            column name and the value should match django options</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">            (e.g. table_column.FloatField())</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        #### Returns</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        - `NewRelaxationClass` :</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">            A subclass of Relaxation.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        - `NewIonicStepClass`:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">            A subclass of IonicStep.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="c1"># For convience, we add columns that point to the start and end structures</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="n">NewRelaxationClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">Relaxation&quot;</span><span class="p">,</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>            <span class="n">structure_start</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">IonicStep&quot;</span><span class="p">,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relaxations_as_start&quot;</span><span class="p">,</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>                <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>                <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="p">),</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="n">structure_final</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">IonicStep&quot;</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relaxations_as_final&quot;</span><span class="p">,</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>            <span class="p">),</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="n">NewIonicStepClass</span> <span class="o">=</span> <span class="n">IonicStep</span><span class="o">.</span><span class="n">create_subclass_from_relaxation</span><span class="p">(</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="n">name</span><span class="p">,</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>            <span class="n">NewRelaxationClass</span><span class="p">,</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="c1"># we now have a new child class and avoided writing some boilerplate code!</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="n">NewRelaxationClass</span><span class="p">,</span> <span class="n">NewIonicStepClass</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="c1"># I assume the directory is from a vasp calculation, but I need to update</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="c1"># this when I begin adding new calculators.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="n">vasprun_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">vasprun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">vasprun_filename</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_vasp_run</span><span class="p">(</span><span class="n">vasprun</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">from_vasp_run</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span><span class="p">):</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="c1"># The data is actually easier to access as a dictionary and everything</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="c1"># we need is stored under the &quot;output&quot; key</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="c1"># The only other data we need to grab is the list of structures. We can</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="c1"># pull the structure for each ionic step from the vasprun class directly.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="n">structures</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">structures</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="c1"># Make the relaxation entry. Note we need to save this to the database</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="c1"># in order to link/save the ionic steps below. We save the structure</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="c1"># as the final one in the calculation.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="n">relaxation</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="n">structure</span><span class="o">=</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>            <span class="n">volume_change</span><span class="o">=</span><span class="p">(</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span> <span class="o">-</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="o">/</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="n">band_gap</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bandgap&quot;</span><span class="p">),</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="n">is_gap_direct</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_gap_direct&quot;</span><span class="p">),</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="n">energy_fermi</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;efermi&quot;</span><span class="p">),</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="n">conduction_band_minimum</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cbm&quot;</span><span class="p">),</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="n">valence_band_maximum</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">),</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="c1"># lastly, we also want to save the corrections made and directory it ran in</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="c1"># relaxation.corrections = corrections</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="c1"># relaxation.directory = directory</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="c1"># Now we have the relaxation data all loaded and can save it to the database</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="n">relaxation</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="c1"># Now let&#39;s iterate through the ionic steps and save these to the database.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ionic_step</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">structures</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ionic_steps&quot;</span><span class="p">])</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="p">):</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="c1"># first pull all the data together and save it to the database. We</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="c1"># are saving this to an IonicStepStructure datatable.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">structure_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>                <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>                <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                <span class="n">energy</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;e_wo_entrp&quot;</span><span class="p">],</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                <span class="n">site_forces</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">],</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                <span class="n">lattice_stress</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;stress&quot;</span><span class="p">],</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                <span class="n">relaxation</span><span class="o">=</span><span class="n">relaxation</span><span class="p">,</span>  <span class="c1"># this links the structure to this relaxation</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="n">structure_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="c1"># If this is the first structure, we want to link it as such</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>                <span class="n">relaxation</span><span class="o">.</span><span class="n">structure_start_id</span> <span class="o">=</span> <span class="n">structure_db</span><span class="o">.</span><span class="n">id</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="c1"># and same for the final structure. Note, we can&#39;t use elif becuase</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="c1"># there&#39;s a chance the start/end structure are the same, which occurs</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>            <span class="c1"># when the starting structure is found to be relaxed already.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                <span class="n">relaxation</span><span class="o">.</span><span class="n">structure_final_id</span> <span class="o">=</span> <span class="n">structure_db</span><span class="o">.</span><span class="n">id</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="k">return</span> <span class="n">relaxation</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>    <span class="k">def</span> <span class="nf">update_from_vasp_run</span><span class="p">(</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span><span class="p">,</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="n">corrections</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>    <span class="p">):</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        Given a Vasprun object from a finished relaxation, this will update the</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        Relaxation table entry and the corresponding IonicStep entries.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        #### Parameters</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        vasprun :</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">            The final Vasprun object from the relaxation outputs.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        corrections :</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            List of errors and corrections applied to during the relaxation.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        directory :</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">            name of the directory that relaxation was ran in. This is only used</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">            to reference the archive file if it&#39;s ever needed again.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="c1"># The data is actually easier to access as a dictionary and everything</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="c1"># we need is stored under the &quot;output&quot; key</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="c1"># The only other data we need to grab is the list of structures. We can</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="c1"># pull the structure for each ionic step from the vasprun class directly.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="n">structures</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">structures</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="c1"># Now let&#39;s iterate through the ionic steps and save these to the database.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ionic_step</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">structures</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ionic_steps&quot;</span><span class="p">])</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="p">):</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="c1"># first pull all the data together and save it to the database. We</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="c1"># are saving this to an IonicStepStructure datatable. To access this</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="c1"># model, we look need to use &quot;structures.model&quot;.</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>                <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                <span class="n">energy</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;e_wo_entrp&quot;</span><span class="p">],</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                <span class="n">site_forces</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">],</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>                <span class="n">lattice_stress</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;stress&quot;</span><span class="p">],</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>                <span class="n">relaxation</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>  <span class="c1"># this links the structure to this relaxation</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>            <span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="n">structure</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="c1"># If this is the first structure, we want to link it as such</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">structure_start_id</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">id</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="c1"># and same for the final structure. Note, we can&#39;t use elif becuase</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="c1"># there&#39;s a chance the start/end structure are the same, which occurs</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="c1"># when the starting structure is found to be relaxed already.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">structure_final_id</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">id</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="c1"># calculate extra data for storing</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_change</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span> <span class="o">-</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="c1"># There is also extra data for the final structure that we save directly</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="c1"># in the relaxation table.  We use .get() in case the key isn&#39;t provided.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">band_gap</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bandgap&quot;</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_gap_direct</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_gap_direct&quot;</span><span class="p">)</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">energy_fermi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;efermi&quot;</span><span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conduction_band_minimum</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cbm&quot;</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valence_band_maximum</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="c1"># lastly, we also want to save the corrections made and directory it ran in</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">corrections</span> <span class="o">=</span> <span class="n">corrections</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="c1"># Now we have the relaxation data all loaded and can save it to the database</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>    <span class="k">def</span> <span class="nf">get_convergence_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="c1"># Grab the calculation&#39;s structure and convert it to a dataframe</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">structures_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="c1"># We will be making a figure that consists of 3 stacked subplots that</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="c1"># all share the x-axis of ionic_step_number</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="n">figure</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="c1"># Generate a plot for Energy (per atom)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>            <span class="n">plotly_go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;energy_per_atom&quot;</span><span class="p">],</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>            <span class="p">),</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="c1"># Generate a plot for Forces (norm per atom)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="n">plotly_go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;site_forces_norm_per_atom&quot;</span><span class="p">],</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="p">),</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="c1"># Generate a plot for Stress (norm per atom)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="n">plotly_go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;lattice_stress_norm_per_atom&quot;</span><span class="p">],</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>            <span class="p">),</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="c1"># Now let&#39;s clean up some formatting and add the axes titles</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="n">xaxis3_title</span><span class="o">=</span><span class="s2">&quot;Ionic Step (#)&quot;</span><span class="p">,</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Energy (eV/atom)&quot;</span><span class="p">,</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="n">yaxis2_title</span><span class="o">=</span><span class="s2">&quot;Site Forces&quot;</span><span class="p">,</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="n">yaxis3_title</span><span class="o">=</span><span class="s2">&quot;Lattice Stress&quot;</span><span class="p">,</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="c1"># we return the figure object for the user</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="n">figure</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="k">def</span> <span class="nf">view_convergence_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_convergence_plot</span><span class="p">()</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;browser&quot;</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>    <span class="k">def</span> <span class="nf">get_convergence_plot_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="c1"># Make the convergence figure and convert it to an html div</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="n">figure_convergence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_convergence_plot</span><span class="p">()</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">figure_convergence_html</span> <span class="o">=</span> <span class="n">figure_convergence</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>            <span class="n">full_html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="n">include_plotlyjs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="p">)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="k">return</span> <span class="n">figure_convergence_html</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="k">class</span> <span class="nc">IonicStep</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Thermodynamics</span><span class="p">,</span> <span class="n">Forces</span><span class="p">):</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">    This database table that holds the data for each ionic step of a relaxation.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">    An ionic step can be viewed as a static energy calculation, but we keep these</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">    results separate because:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        1. Pulay stress can make these energies/forces inaccurate</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">        2. These results each have an associated Relaxation and ionic step number</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">    You will likely never access this table directly. Instead, data is better</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">    accessed through the `structures` attribute on appropiate Relaxation table.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">    For example:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">    ``` python</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">    from simmate.database import connect</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">    from simmate.database.workflow_results import MITRelaxation</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">    # grab your desired relaxation</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">    relax = MITRelaxation.objects.get(id=1)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">    # grab the associated ionic steps</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">    ionic_steps = relax.structures.all()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">    ```</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">    Note: we assume that only converged data is being stored! So there is no</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">    &quot;converged_electronic&quot; column here. ErrorHandlers and workups should</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">    ensure convergence.</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>    <span class="n">base_info</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Structure</span><span class="o">.</span><span class="n">base_info</span> <span class="o">+</span> <span class="n">Thermodynamics</span><span class="o">.</span><span class="n">base_info</span> <span class="o">+</span> <span class="n">Forces</span><span class="o">.</span><span class="n">base_info</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>    <span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>    <span class="n">number</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">    The ionic step number within the relaxation. This starts counting from 0.</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>    <span class="sd">&quot;&quot;&quot; Relationships &quot;&quot;&quot;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>    <span class="c1"># each of these will map to a Relaxation, so you should typically access this</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>    <span class="c1"># data through that class. The exception to this is when you want all ionic</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>    <span class="c1"># steps accross many relaxations for a machine learning input.</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>    <span class="c1"># These relationship can be found via...</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>    <span class="c1">#   relaxations</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>    <span class="c1">#   relaxations_as_start</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>    <span class="c1">#   relaxations_as_final</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>    <span class="k">def</span> <span class="nf">create_subclass_from_relaxation</span><span class="p">(</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="n">relaxation</span><span class="p">:</span> <span class="n">Relaxation</span><span class="p">,</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>    <span class="p">):</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">        Dynamically creates a subclass of IonicStep and links it to the Relaxation</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">        table.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        This method should NOT be called directly because it is instead used by</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">        `Relaxation.create_subclasses`.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        #### Parameters</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">        - `name` :</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">            Name of the subclass that is output.</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">        - `relaxation` :</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">            Relaxation table that these ionic steps should be associated with.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">        - `module` :</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">            name of the module this subclass should be associated with. Typically,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">            you should pass __name__ to this.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">        - `**extra_columns` :</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">            Additional columns to add to the table. The keyword will be the</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">            column name and the value should match django options</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">            (e.g. table_column.FloatField())</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        Returns</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        -------</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        - `NewClass` :</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">            A subclass of IonicStep.</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="c1"># All structures in this table come from relaxation calculations, where</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="c1"># there can be many structures (one for each ionic steps) linked to a</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="c1"># single relaxation. This means the start structure, end structure, and</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="c1"># those structure in-between are stored together here.</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="c1"># Therefore, there&#39;s just a simple column stating which relaxation it</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="c1"># belongs to.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="n">NewClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">IonicStep&quot;</span><span class="p">,</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>            <span class="n">relaxation</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>                <span class="n">relaxation</span><span class="p">,</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;structures&quot;</span><span class="p">,</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>            <span class="p">),</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="c1"># we now have a new child class and avoided writing some boilerplate code!</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="k">return</span> <span class="n">NewClass</span>
</span></pre></div>


            </section>
                <section id="Relaxation">
                            <input id="Relaxation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Relaxation</span><wbr>(<span class="base"><a href="structure.html#Structure">simmate.database.base_data_types.structure.Structure</a></span>, <span class="base"><a href="calculation.html#Calculation">simmate.database.base_data_types.calculation.Calculation</a></span>):

                <label class="view-source-button" for="Relaxation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relaxation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relaxation-84"><a href="#Relaxation-84"><span class="linenos"> 84</span></a><span class="k">class</span> <span class="nc">Relaxation</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Calculation</span><span class="p">):</span>
</span><span id="Relaxation-85"><a href="#Relaxation-85"><span class="linenos"> 85</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation-86"><a href="#Relaxation-86"><span class="linenos"> 86</span></a><span class="sd">    This table holds all data from a structure relaxation and also links to</span>
</span><span id="Relaxation-87"><a href="#Relaxation-87"><span class="linenos"> 87</span></a><span class="sd">    IonicStep table which holds all of the structure/energy/forces for each</span>
</span><span id="Relaxation-88"><a href="#Relaxation-88"><span class="linenos"> 88</span></a><span class="sd">    ionic step.</span>
</span><span id="Relaxation-89"><a href="#Relaxation-89"><span class="linenos"> 89</span></a>
</span><span id="Relaxation-90"><a href="#Relaxation-90"><span class="linenos"> 90</span></a><span class="sd">    WARNING: The Structure stored in this table here is the source structure</span>
</span><span id="Relaxation-91"><a href="#Relaxation-91"><span class="linenos"> 91</span></a><span class="sd">    until the calculation completes. After completed, the structure will</span>
</span><span id="Relaxation-92"><a href="#Relaxation-92"><span class="linenos"> 92</span></a><span class="sd">    be updated to the final structure. If you wish to ensure you&#39;re accessing</span>
</span><span id="Relaxation-93"><a href="#Relaxation-93"><span class="linenos"> 93</span></a><span class="sd">    the correct structure, use the `structure_final` attribute, which gives</span>
</span><span id="Relaxation-94"><a href="#Relaxation-94"><span class="linenos"> 94</span></a><span class="sd">    the final IonicStep.</span>
</span><span id="Relaxation-95"><a href="#Relaxation-95"><span class="linenos"> 95</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Relaxation-96"><a href="#Relaxation-96"><span class="linenos"> 96</span></a>
</span><span id="Relaxation-97"><a href="#Relaxation-97"><span class="linenos"> 97</span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span id="Relaxation-98"><a href="#Relaxation-98"><span class="linenos"> 98</span></a>        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Relaxation-99"><a href="#Relaxation-99"><span class="linenos"> 99</span></a>        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>
</span><span id="Relaxation-100"><a href="#Relaxation-100"><span class="linenos">100</span></a>
</span><span id="Relaxation-101"><a href="#Relaxation-101"><span class="linenos">101</span></a>    <span class="n">base_info</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Relaxation-102"><a href="#Relaxation-102"><span class="linenos">102</span></a>        <span class="p">[</span>
</span><span id="Relaxation-103"><a href="#Relaxation-103"><span class="linenos">103</span></a>            <span class="s2">&quot;band_gap&quot;</span><span class="p">,</span>
</span><span id="Relaxation-104"><a href="#Relaxation-104"><span class="linenos">104</span></a>            <span class="s2">&quot;is_gap_direct&quot;</span><span class="p">,</span>
</span><span id="Relaxation-105"><a href="#Relaxation-105"><span class="linenos">105</span></a>            <span class="s2">&quot;energy_fermi&quot;</span><span class="p">,</span>
</span><span id="Relaxation-106"><a href="#Relaxation-106"><span class="linenos">106</span></a>            <span class="s2">&quot;conduction_band_minimum&quot;</span><span class="p">,</span>
</span><span id="Relaxation-107"><a href="#Relaxation-107"><span class="linenos">107</span></a>            <span class="s2">&quot;valence_band_maximum&quot;</span><span class="p">,</span>
</span><span id="Relaxation-108"><a href="#Relaxation-108"><span class="linenos">108</span></a>        <span class="p">]</span>
</span><span id="Relaxation-109"><a href="#Relaxation-109"><span class="linenos">109</span></a>        <span class="o">+</span> <span class="n">Structure</span><span class="o">.</span><span class="n">base_info</span>
</span><span id="Relaxation-110"><a href="#Relaxation-110"><span class="linenos">110</span></a>        <span class="o">+</span> <span class="n">Calculation</span><span class="o">.</span><span class="n">base_info</span>
</span><span id="Relaxation-111"><a href="#Relaxation-111"><span class="linenos">111</span></a>    <span class="p">)</span>
</span><span id="Relaxation-112"><a href="#Relaxation-112"><span class="linenos">112</span></a>
</span><span id="Relaxation-113"><a href="#Relaxation-113"><span class="linenos">113</span></a>    <span class="c1"># OPTIMIZE: should I include this electronic data?</span>
</span><span id="Relaxation-114"><a href="#Relaxation-114"><span class="linenos">114</span></a>    <span class="c1"># This data here is something we only get for the final structure, so it</span>
</span><span id="Relaxation-115"><a href="#Relaxation-115"><span class="linenos">115</span></a>    <span class="c1"># may make sense to move this data into the IonicStepStructure table (and</span>
</span><span id="Relaxation-116"><a href="#Relaxation-116"><span class="linenos">116</span></a>    <span class="c1"># allow null values for non-final steps). I instead keep this here because</span>
</span><span id="Relaxation-117"><a href="#Relaxation-117"><span class="linenos">117</span></a>    <span class="c1"># I don&#39;t want columns above that are largely empty.</span>
</span><span id="Relaxation-118"><a href="#Relaxation-118"><span class="linenos">118</span></a>    <span class="c1"># Note: all entries are optional because there is no guaruntee the calculation</span>
</span><span id="Relaxation-119"><a href="#Relaxation-119"><span class="linenos">119</span></a>    <span class="c1"># finishes successfully</span>
</span><span id="Relaxation-120"><a href="#Relaxation-120"><span class="linenos">120</span></a>
</span><span id="Relaxation-121"><a href="#Relaxation-121"><span class="linenos">121</span></a>    <span class="n">band_gap</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Relaxation-122"><a href="#Relaxation-122"><span class="linenos">122</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation-123"><a href="#Relaxation-123"><span class="linenos">123</span></a><span class="sd">    The band gap energy in eV.</span>
</span><span id="Relaxation-124"><a href="#Relaxation-124"><span class="linenos">124</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Relaxation-125"><a href="#Relaxation-125"><span class="linenos">125</span></a>
</span><span id="Relaxation-126"><a href="#Relaxation-126"><span class="linenos">126</span></a>    <span class="n">is_gap_direct</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Relaxation-127"><a href="#Relaxation-127"><span class="linenos">127</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation-128"><a href="#Relaxation-128"><span class="linenos">128</span></a><span class="sd">    Whether the band gap is direct or indirect.</span>
</span><span id="Relaxation-129"><a href="#Relaxation-129"><span class="linenos">129</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Relaxation-130"><a href="#Relaxation-130"><span class="linenos">130</span></a>
</span><span id="Relaxation-131"><a href="#Relaxation-131"><span class="linenos">131</span></a>    <span class="n">energy_fermi</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Relaxation-132"><a href="#Relaxation-132"><span class="linenos">132</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation-133"><a href="#Relaxation-133"><span class="linenos">133</span></a><span class="sd">    The Fermi energy in eV.</span>
</span><span id="Relaxation-134"><a href="#Relaxation-134"><span class="linenos">134</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Relaxation-135"><a href="#Relaxation-135"><span class="linenos">135</span></a>
</span><span id="Relaxation-136"><a href="#Relaxation-136"><span class="linenos">136</span></a>    <span class="n">conduction_band_minimum</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Relaxation-137"><a href="#Relaxation-137"><span class="linenos">137</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation-138"><a href="#Relaxation-138"><span class="linenos">138</span></a><span class="sd">    The conduction band minimum in eV.</span>
</span><span id="Relaxation-139"><a href="#Relaxation-139"><span class="linenos">139</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Relaxation-140"><a href="#Relaxation-140"><span class="linenos">140</span></a>
</span><span id="Relaxation-141"><a href="#Relaxation-141"><span class="linenos">141</span></a>    <span class="n">valence_band_maximum</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Relaxation-142"><a href="#Relaxation-142"><span class="linenos">142</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation-143"><a href="#Relaxation-143"><span class="linenos">143</span></a><span class="sd">    The valence band maximum in eV.</span>
</span><span id="Relaxation-144"><a href="#Relaxation-144"><span class="linenos">144</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Relaxation-145"><a href="#Relaxation-145"><span class="linenos">145</span></a>
</span><span id="Relaxation-146"><a href="#Relaxation-146"><span class="linenos">146</span></a>    <span class="n">volume_change</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Relaxation-147"><a href="#Relaxation-147"><span class="linenos">147</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation-148"><a href="#Relaxation-148"><span class="linenos">148</span></a><span class="sd">    The percent volume change during the relaxation. This is useful for checking</span>
</span><span id="Relaxation-149"><a href="#Relaxation-149"><span class="linenos">149</span></a><span class="sd">    if Pulay Stress may be significant or if the structure was highly unreasonable.</span>
</span><span id="Relaxation-150"><a href="#Relaxation-150"><span class="linenos">150</span></a><span class="sd">    We store this as a ratio relative to the starting structure:</span>
</span><span id="Relaxation-151"><a href="#Relaxation-151"><span class="linenos">151</span></a><span class="sd">    ```</span>
</span><span id="Relaxation-152"><a href="#Relaxation-152"><span class="linenos">152</span></a><span class="sd">    (volume_final - volume_start) / volume_start</span>
</span><span id="Relaxation-153"><a href="#Relaxation-153"><span class="linenos">153</span></a><span class="sd">    ```</span>
</span><span id="Relaxation-154"><a href="#Relaxation-154"><span class="linenos">154</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Relaxation-155"><a href="#Relaxation-155"><span class="linenos">155</span></a>
</span><span id="Relaxation-156"><a href="#Relaxation-156"><span class="linenos">156</span></a>    <span class="sd">&quot;&quot;&quot; Relationships &quot;&quot;&quot;</span>
</span><span id="Relaxation-157"><a href="#Relaxation-157"><span class="linenos">157</span></a>    <span class="c1"># structure_start --&gt; points to first (0) IonicStep</span>
</span><span id="Relaxation-158"><a href="#Relaxation-158"><span class="linenos">158</span></a>    <span class="c1"># structure_final --&gt; points to final IonicStep</span>
</span><span id="Relaxation-159"><a href="#Relaxation-159"><span class="linenos">159</span></a>    <span class="c1"># structures --&gt; gives list of all IonicSteps</span>
</span><span id="Relaxation-160"><a href="#Relaxation-160"><span class="linenos">160</span></a>
</span><span id="Relaxation-161"><a href="#Relaxation-161"><span class="linenos">161</span></a>    <span class="nd">@classmethod</span>
</span><span id="Relaxation-162"><a href="#Relaxation-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">create_subclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_columns</span><span class="p">):</span>
</span><span id="Relaxation-163"><a href="#Relaxation-163"><span class="linenos">163</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation-164"><a href="#Relaxation-164"><span class="linenos">164</span></a><span class="sd">        Dynamically creates a subclass of Relaxation as well as a separate IonicStep</span>
</span><span id="Relaxation-165"><a href="#Relaxation-165"><span class="linenos">165</span></a><span class="sd">        table for it. These tables are linked together.</span>
</span><span id="Relaxation-166"><a href="#Relaxation-166"><span class="linenos">166</span></a>
</span><span id="Relaxation-167"><a href="#Relaxation-167"><span class="linenos">167</span></a><span class="sd">        Example use:</span>
</span><span id="Relaxation-168"><a href="#Relaxation-168"><span class="linenos">168</span></a>
</span><span id="Relaxation-169"><a href="#Relaxation-169"><span class="linenos">169</span></a><span class="sd">        ``` python</span>
</span><span id="Relaxation-170"><a href="#Relaxation-170"><span class="linenos">170</span></a><span class="sd">        from simmate.database.base_data_types import Relaxation</span>
</span><span id="Relaxation-171"><a href="#Relaxation-171"><span class="linenos">171</span></a>
</span><span id="Relaxation-172"><a href="#Relaxation-172"><span class="linenos">172</span></a><span class="sd">        ExampleRelaxation, ExampleIonicStep = Relaxation.create_subclasses(</span>
</span><span id="Relaxation-173"><a href="#Relaxation-173"><span class="linenos">173</span></a><span class="sd">            &quot;Example&quot;,</span>
</span><span id="Relaxation-174"><a href="#Relaxation-174"><span class="linenos">174</span></a><span class="sd">            module=__name__,</span>
</span><span id="Relaxation-175"><a href="#Relaxation-175"><span class="linenos">175</span></a><span class="sd">        )</span>
</span><span id="Relaxation-176"><a href="#Relaxation-176"><span class="linenos">176</span></a><span class="sd">        ```</span>
</span><span id="Relaxation-177"><a href="#Relaxation-177"><span class="linenos">177</span></a>
</span><span id="Relaxation-178"><a href="#Relaxation-178"><span class="linenos">178</span></a><span class="sd">        #### Parameters</span>
</span><span id="Relaxation-179"><a href="#Relaxation-179"><span class="linenos">179</span></a>
</span><span id="Relaxation-180"><a href="#Relaxation-180"><span class="linenos">180</span></a><span class="sd">        - `name` :</span>
</span><span id="Relaxation-181"><a href="#Relaxation-181"><span class="linenos">181</span></a><span class="sd">            The prefix name of the subclasses that are output. &quot;Relaxation&quot; and</span>
</span><span id="Relaxation-182"><a href="#Relaxation-182"><span class="linenos">182</span></a><span class="sd">            &quot;IonicStep&quot; will be attached to the end of this prefix.</span>
</span><span id="Relaxation-183"><a href="#Relaxation-183"><span class="linenos">183</span></a><span class="sd">        - `module` :</span>
</span><span id="Relaxation-184"><a href="#Relaxation-184"><span class="linenos">184</span></a><span class="sd">            name of the module this subclass should be associated with. Typically,</span>
</span><span id="Relaxation-185"><a href="#Relaxation-185"><span class="linenos">185</span></a><span class="sd">            you should pass __name__ to this.</span>
</span><span id="Relaxation-186"><a href="#Relaxation-186"><span class="linenos">186</span></a><span class="sd">        - `**extra_columns` :</span>
</span><span id="Relaxation-187"><a href="#Relaxation-187"><span class="linenos">187</span></a><span class="sd">            Additional columns to add to the table. The keyword will be the</span>
</span><span id="Relaxation-188"><a href="#Relaxation-188"><span class="linenos">188</span></a><span class="sd">            column name and the value should match django options</span>
</span><span id="Relaxation-189"><a href="#Relaxation-189"><span class="linenos">189</span></a><span class="sd">            (e.g. table_column.FloatField())</span>
</span><span id="Relaxation-190"><a href="#Relaxation-190"><span class="linenos">190</span></a>
</span><span id="Relaxation-191"><a href="#Relaxation-191"><span class="linenos">191</span></a><span class="sd">        #### Returns</span>
</span><span id="Relaxation-192"><a href="#Relaxation-192"><span class="linenos">192</span></a>
</span><span id="Relaxation-193"><a href="#Relaxation-193"><span class="linenos">193</span></a><span class="sd">        - `NewRelaxationClass` :</span>
</span><span id="Relaxation-194"><a href="#Relaxation-194"><span class="linenos">194</span></a><span class="sd">            A subclass of Relaxation.</span>
</span><span id="Relaxation-195"><a href="#Relaxation-195"><span class="linenos">195</span></a><span class="sd">        - `NewIonicStepClass`:</span>
</span><span id="Relaxation-196"><a href="#Relaxation-196"><span class="linenos">196</span></a><span class="sd">            A subclass of IonicStep.</span>
</span><span id="Relaxation-197"><a href="#Relaxation-197"><span class="linenos">197</span></a>
</span><span id="Relaxation-198"><a href="#Relaxation-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Relaxation-199"><a href="#Relaxation-199"><span class="linenos">199</span></a>
</span><span id="Relaxation-200"><a href="#Relaxation-200"><span class="linenos">200</span></a>        <span class="c1"># For convience, we add columns that point to the start and end structures</span>
</span><span id="Relaxation-201"><a href="#Relaxation-201"><span class="linenos">201</span></a>        <span class="n">NewRelaxationClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
</span><span id="Relaxation-202"><a href="#Relaxation-202"><span class="linenos">202</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">Relaxation&quot;</span><span class="p">,</span>
</span><span id="Relaxation-203"><a href="#Relaxation-203"><span class="linenos">203</span></a>            <span class="n">structure_start</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
</span><span id="Relaxation-204"><a href="#Relaxation-204"><span class="linenos">204</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">IonicStep&quot;</span><span class="p">,</span>
</span><span id="Relaxation-205"><a href="#Relaxation-205"><span class="linenos">205</span></a>                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
</span><span id="Relaxation-206"><a href="#Relaxation-206"><span class="linenos">206</span></a>                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relaxations_as_start&quot;</span><span class="p">,</span>
</span><span id="Relaxation-207"><a href="#Relaxation-207"><span class="linenos">207</span></a>                <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation-208"><a href="#Relaxation-208"><span class="linenos">208</span></a>                <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation-209"><a href="#Relaxation-209"><span class="linenos">209</span></a>            <span class="p">),</span>
</span><span id="Relaxation-210"><a href="#Relaxation-210"><span class="linenos">210</span></a>            <span class="n">structure_final</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
</span><span id="Relaxation-211"><a href="#Relaxation-211"><span class="linenos">211</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">IonicStep&quot;</span><span class="p">,</span>
</span><span id="Relaxation-212"><a href="#Relaxation-212"><span class="linenos">212</span></a>                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
</span><span id="Relaxation-213"><a href="#Relaxation-213"><span class="linenos">213</span></a>                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relaxations_as_final&quot;</span><span class="p">,</span>
</span><span id="Relaxation-214"><a href="#Relaxation-214"><span class="linenos">214</span></a>                <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation-215"><a href="#Relaxation-215"><span class="linenos">215</span></a>                <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation-216"><a href="#Relaxation-216"><span class="linenos">216</span></a>            <span class="p">),</span>
</span><span id="Relaxation-217"><a href="#Relaxation-217"><span class="linenos">217</span></a>            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
</span><span id="Relaxation-218"><a href="#Relaxation-218"><span class="linenos">218</span></a>            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="Relaxation-219"><a href="#Relaxation-219"><span class="linenos">219</span></a>        <span class="p">)</span>
</span><span id="Relaxation-220"><a href="#Relaxation-220"><span class="linenos">220</span></a>
</span><span id="Relaxation-221"><a href="#Relaxation-221"><span class="linenos">221</span></a>        <span class="n">NewIonicStepClass</span> <span class="o">=</span> <span class="n">IonicStep</span><span class="o">.</span><span class="n">create_subclass_from_relaxation</span><span class="p">(</span>
</span><span id="Relaxation-222"><a href="#Relaxation-222"><span class="linenos">222</span></a>            <span class="n">name</span><span class="p">,</span>
</span><span id="Relaxation-223"><a href="#Relaxation-223"><span class="linenos">223</span></a>            <span class="n">NewRelaxationClass</span><span class="p">,</span>
</span><span id="Relaxation-224"><a href="#Relaxation-224"><span class="linenos">224</span></a>            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
</span><span id="Relaxation-225"><a href="#Relaxation-225"><span class="linenos">225</span></a>            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="Relaxation-226"><a href="#Relaxation-226"><span class="linenos">226</span></a>        <span class="p">)</span>
</span><span id="Relaxation-227"><a href="#Relaxation-227"><span class="linenos">227</span></a>
</span><span id="Relaxation-228"><a href="#Relaxation-228"><span class="linenos">228</span></a>        <span class="c1"># we now have a new child class and avoided writing some boilerplate code!</span>
</span><span id="Relaxation-229"><a href="#Relaxation-229"><span class="linenos">229</span></a>        <span class="k">return</span> <span class="n">NewRelaxationClass</span><span class="p">,</span> <span class="n">NewIonicStepClass</span>
</span><span id="Relaxation-230"><a href="#Relaxation-230"><span class="linenos">230</span></a>
</span><span id="Relaxation-231"><a href="#Relaxation-231"><span class="linenos">231</span></a>    <span class="nd">@classmethod</span>
</span><span id="Relaxation-232"><a href="#Relaxation-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Relaxation-233"><a href="#Relaxation-233"><span class="linenos">233</span></a>        <span class="c1"># I assume the directory is from a vasp calculation, but I need to update</span>
</span><span id="Relaxation-234"><a href="#Relaxation-234"><span class="linenos">234</span></a>        <span class="c1"># this when I begin adding new calculators.</span>
</span><span id="Relaxation-235"><a href="#Relaxation-235"><span class="linenos">235</span></a>        <span class="n">vasprun_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">)</span>
</span><span id="Relaxation-236"><a href="#Relaxation-236"><span class="linenos">236</span></a>        <span class="n">vasprun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">vasprun_filename</span><span class="p">)</span>
</span><span id="Relaxation-237"><a href="#Relaxation-237"><span class="linenos">237</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_vasp_run</span><span class="p">(</span><span class="n">vasprun</span><span class="p">)</span>
</span><span id="Relaxation-238"><a href="#Relaxation-238"><span class="linenos">238</span></a>
</span><span id="Relaxation-239"><a href="#Relaxation-239"><span class="linenos">239</span></a>    <span class="nd">@classmethod</span>
</span><span id="Relaxation-240"><a href="#Relaxation-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">from_vasp_run</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span><span class="p">):</span>
</span><span id="Relaxation-241"><a href="#Relaxation-241"><span class="linenos">241</span></a>        <span class="c1"># The data is actually easier to access as a dictionary and everything</span>
</span><span id="Relaxation-242"><a href="#Relaxation-242"><span class="linenos">242</span></a>        <span class="c1"># we need is stored under the &quot;output&quot; key</span>
</span><span id="Relaxation-243"><a href="#Relaxation-243"><span class="linenos">243</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</span><span id="Relaxation-244"><a href="#Relaxation-244"><span class="linenos">244</span></a>
</span><span id="Relaxation-245"><a href="#Relaxation-245"><span class="linenos">245</span></a>        <span class="c1"># The only other data we need to grab is the list of structures. We can</span>
</span><span id="Relaxation-246"><a href="#Relaxation-246"><span class="linenos">246</span></a>        <span class="c1"># pull the structure for each ionic step from the vasprun class directly.</span>
</span><span id="Relaxation-247"><a href="#Relaxation-247"><span class="linenos">247</span></a>        <span class="n">structures</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">structures</span>
</span><span id="Relaxation-248"><a href="#Relaxation-248"><span class="linenos">248</span></a>
</span><span id="Relaxation-249"><a href="#Relaxation-249"><span class="linenos">249</span></a>        <span class="c1"># Make the relaxation entry. Note we need to save this to the database</span>
</span><span id="Relaxation-250"><a href="#Relaxation-250"><span class="linenos">250</span></a>        <span class="c1"># in order to link/save the ionic steps below. We save the structure</span>
</span><span id="Relaxation-251"><a href="#Relaxation-251"><span class="linenos">251</span></a>        <span class="c1"># as the final one in the calculation.</span>
</span><span id="Relaxation-252"><a href="#Relaxation-252"><span class="linenos">252</span></a>        <span class="n">relaxation</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
</span><span id="Relaxation-253"><a href="#Relaxation-253"><span class="linenos">253</span></a>            <span class="n">structure</span><span class="o">=</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Relaxation-254"><a href="#Relaxation-254"><span class="linenos">254</span></a>            <span class="n">volume_change</span><span class="o">=</span><span class="p">(</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span> <span class="o">-</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>
</span><span id="Relaxation-255"><a href="#Relaxation-255"><span class="linenos">255</span></a>            <span class="o">/</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
</span><span id="Relaxation-256"><a href="#Relaxation-256"><span class="linenos">256</span></a>            <span class="n">band_gap</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bandgap&quot;</span><span class="p">),</span>
</span><span id="Relaxation-257"><a href="#Relaxation-257"><span class="linenos">257</span></a>            <span class="n">is_gap_direct</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_gap_direct&quot;</span><span class="p">),</span>
</span><span id="Relaxation-258"><a href="#Relaxation-258"><span class="linenos">258</span></a>            <span class="n">energy_fermi</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;efermi&quot;</span><span class="p">),</span>
</span><span id="Relaxation-259"><a href="#Relaxation-259"><span class="linenos">259</span></a>            <span class="n">conduction_band_minimum</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cbm&quot;</span><span class="p">),</span>
</span><span id="Relaxation-260"><a href="#Relaxation-260"><span class="linenos">260</span></a>            <span class="n">valence_band_maximum</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">),</span>
</span><span id="Relaxation-261"><a href="#Relaxation-261"><span class="linenos">261</span></a>        <span class="p">)</span>
</span><span id="Relaxation-262"><a href="#Relaxation-262"><span class="linenos">262</span></a>
</span><span id="Relaxation-263"><a href="#Relaxation-263"><span class="linenos">263</span></a>        <span class="c1"># lastly, we also want to save the corrections made and directory it ran in</span>
</span><span id="Relaxation-264"><a href="#Relaxation-264"><span class="linenos">264</span></a>        <span class="c1"># relaxation.corrections = corrections</span>
</span><span id="Relaxation-265"><a href="#Relaxation-265"><span class="linenos">265</span></a>        <span class="c1"># relaxation.directory = directory</span>
</span><span id="Relaxation-266"><a href="#Relaxation-266"><span class="linenos">266</span></a>
</span><span id="Relaxation-267"><a href="#Relaxation-267"><span class="linenos">267</span></a>        <span class="c1"># Now we have the relaxation data all loaded and can save it to the database</span>
</span><span id="Relaxation-268"><a href="#Relaxation-268"><span class="linenos">268</span></a>        <span class="n">relaxation</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Relaxation-269"><a href="#Relaxation-269"><span class="linenos">269</span></a>
</span><span id="Relaxation-270"><a href="#Relaxation-270"><span class="linenos">270</span></a>        <span class="c1"># Now let&#39;s iterate through the ionic steps and save these to the database.</span>
</span><span id="Relaxation-271"><a href="#Relaxation-271"><span class="linenos">271</span></a>        <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ionic_step</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="Relaxation-272"><a href="#Relaxation-272"><span class="linenos">272</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">structures</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ionic_steps&quot;</span><span class="p">])</span>
</span><span id="Relaxation-273"><a href="#Relaxation-273"><span class="linenos">273</span></a>        <span class="p">):</span>
</span><span id="Relaxation-274"><a href="#Relaxation-274"><span class="linenos">274</span></a>            <span class="c1"># first pull all the data together and save it to the database. We</span>
</span><span id="Relaxation-275"><a href="#Relaxation-275"><span class="linenos">275</span></a>            <span class="c1"># are saving this to an IonicStepStructure datatable.</span>
</span><span id="Relaxation-276"><a href="#Relaxation-276"><span class="linenos">276</span></a>            <span class="n">structure_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
</span><span id="Relaxation-277"><a href="#Relaxation-277"><span class="linenos">277</span></a>                <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
</span><span id="Relaxation-278"><a href="#Relaxation-278"><span class="linenos">278</span></a>                <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
</span><span id="Relaxation-279"><a href="#Relaxation-279"><span class="linenos">279</span></a>                <span class="n">energy</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;e_wo_entrp&quot;</span><span class="p">],</span>
</span><span id="Relaxation-280"><a href="#Relaxation-280"><span class="linenos">280</span></a>                <span class="n">site_forces</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">],</span>
</span><span id="Relaxation-281"><a href="#Relaxation-281"><span class="linenos">281</span></a>                <span class="n">lattice_stress</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;stress&quot;</span><span class="p">],</span>
</span><span id="Relaxation-282"><a href="#Relaxation-282"><span class="linenos">282</span></a>                <span class="n">relaxation</span><span class="o">=</span><span class="n">relaxation</span><span class="p">,</span>  <span class="c1"># this links the structure to this relaxation</span>
</span><span id="Relaxation-283"><a href="#Relaxation-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="Relaxation-284"><a href="#Relaxation-284"><span class="linenos">284</span></a>            <span class="n">structure_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Relaxation-285"><a href="#Relaxation-285"><span class="linenos">285</span></a>
</span><span id="Relaxation-286"><a href="#Relaxation-286"><span class="linenos">286</span></a>            <span class="c1"># If this is the first structure, we want to link it as such</span>
</span><span id="Relaxation-287"><a href="#Relaxation-287"><span class="linenos">287</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Relaxation-288"><a href="#Relaxation-288"><span class="linenos">288</span></a>                <span class="n">relaxation</span><span class="o">.</span><span class="n">structure_start_id</span> <span class="o">=</span> <span class="n">structure_db</span><span class="o">.</span><span class="n">id</span>
</span><span id="Relaxation-289"><a href="#Relaxation-289"><span class="linenos">289</span></a>            <span class="c1"># and same for the final structure. Note, we can&#39;t use elif becuase</span>
</span><span id="Relaxation-290"><a href="#Relaxation-290"><span class="linenos">290</span></a>            <span class="c1"># there&#39;s a chance the start/end structure are the same, which occurs</span>
</span><span id="Relaxation-291"><a href="#Relaxation-291"><span class="linenos">291</span></a>            <span class="c1"># when the starting structure is found to be relaxed already.</span>
</span><span id="Relaxation-292"><a href="#Relaxation-292"><span class="linenos">292</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Relaxation-293"><a href="#Relaxation-293"><span class="linenos">293</span></a>                <span class="n">relaxation</span><span class="o">.</span><span class="n">structure_final_id</span> <span class="o">=</span> <span class="n">structure_db</span><span class="o">.</span><span class="n">id</span>
</span><span id="Relaxation-294"><a href="#Relaxation-294"><span class="linenos">294</span></a>
</span><span id="Relaxation-295"><a href="#Relaxation-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">relaxation</span>
</span><span id="Relaxation-296"><a href="#Relaxation-296"><span class="linenos">296</span></a>
</span><span id="Relaxation-297"><a href="#Relaxation-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">update_from_vasp_run</span><span class="p">(</span>
</span><span id="Relaxation-298"><a href="#Relaxation-298"><span class="linenos">298</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Relaxation-299"><a href="#Relaxation-299"><span class="linenos">299</span></a>        <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span><span class="p">,</span>
</span><span id="Relaxation-300"><a href="#Relaxation-300"><span class="linenos">300</span></a>        <span class="n">corrections</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Relaxation-301"><a href="#Relaxation-301"><span class="linenos">301</span></a>        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Relaxation-302"><a href="#Relaxation-302"><span class="linenos">302</span></a>    <span class="p">):</span>
</span><span id="Relaxation-303"><a href="#Relaxation-303"><span class="linenos">303</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation-304"><a href="#Relaxation-304"><span class="linenos">304</span></a><span class="sd">        Given a Vasprun object from a finished relaxation, this will update the</span>
</span><span id="Relaxation-305"><a href="#Relaxation-305"><span class="linenos">305</span></a><span class="sd">        Relaxation table entry and the corresponding IonicStep entries.</span>
</span><span id="Relaxation-306"><a href="#Relaxation-306"><span class="linenos">306</span></a>
</span><span id="Relaxation-307"><a href="#Relaxation-307"><span class="linenos">307</span></a><span class="sd">        #### Parameters</span>
</span><span id="Relaxation-308"><a href="#Relaxation-308"><span class="linenos">308</span></a>
</span><span id="Relaxation-309"><a href="#Relaxation-309"><span class="linenos">309</span></a><span class="sd">        vasprun :</span>
</span><span id="Relaxation-310"><a href="#Relaxation-310"><span class="linenos">310</span></a><span class="sd">            The final Vasprun object from the relaxation outputs.</span>
</span><span id="Relaxation-311"><a href="#Relaxation-311"><span class="linenos">311</span></a><span class="sd">        corrections :</span>
</span><span id="Relaxation-312"><a href="#Relaxation-312"><span class="linenos">312</span></a><span class="sd">            List of errors and corrections applied to during the relaxation.</span>
</span><span id="Relaxation-313"><a href="#Relaxation-313"><span class="linenos">313</span></a><span class="sd">        directory :</span>
</span><span id="Relaxation-314"><a href="#Relaxation-314"><span class="linenos">314</span></a><span class="sd">            name of the directory that relaxation was ran in. This is only used</span>
</span><span id="Relaxation-315"><a href="#Relaxation-315"><span class="linenos">315</span></a><span class="sd">            to reference the archive file if it&#39;s ever needed again.</span>
</span><span id="Relaxation-316"><a href="#Relaxation-316"><span class="linenos">316</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Relaxation-317"><a href="#Relaxation-317"><span class="linenos">317</span></a>
</span><span id="Relaxation-318"><a href="#Relaxation-318"><span class="linenos">318</span></a>        <span class="c1"># The data is actually easier to access as a dictionary and everything</span>
</span><span id="Relaxation-319"><a href="#Relaxation-319"><span class="linenos">319</span></a>        <span class="c1"># we need is stored under the &quot;output&quot; key</span>
</span><span id="Relaxation-320"><a href="#Relaxation-320"><span class="linenos">320</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</span><span id="Relaxation-321"><a href="#Relaxation-321"><span class="linenos">321</span></a>
</span><span id="Relaxation-322"><a href="#Relaxation-322"><span class="linenos">322</span></a>        <span class="c1"># The only other data we need to grab is the list of structures. We can</span>
</span><span id="Relaxation-323"><a href="#Relaxation-323"><span class="linenos">323</span></a>        <span class="c1"># pull the structure for each ionic step from the vasprun class directly.</span>
</span><span id="Relaxation-324"><a href="#Relaxation-324"><span class="linenos">324</span></a>        <span class="n">structures</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">structures</span>
</span><span id="Relaxation-325"><a href="#Relaxation-325"><span class="linenos">325</span></a>
</span><span id="Relaxation-326"><a href="#Relaxation-326"><span class="linenos">326</span></a>        <span class="c1"># Now let&#39;s iterate through the ionic steps and save these to the database.</span>
</span><span id="Relaxation-327"><a href="#Relaxation-327"><span class="linenos">327</span></a>        <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ionic_step</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="Relaxation-328"><a href="#Relaxation-328"><span class="linenos">328</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">structures</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ionic_steps&quot;</span><span class="p">])</span>
</span><span id="Relaxation-329"><a href="#Relaxation-329"><span class="linenos">329</span></a>        <span class="p">):</span>
</span><span id="Relaxation-330"><a href="#Relaxation-330"><span class="linenos">330</span></a>            <span class="c1"># first pull all the data together and save it to the database. We</span>
</span><span id="Relaxation-331"><a href="#Relaxation-331"><span class="linenos">331</span></a>            <span class="c1"># are saving this to an IonicStepStructure datatable. To access this</span>
</span><span id="Relaxation-332"><a href="#Relaxation-332"><span class="linenos">332</span></a>            <span class="c1"># model, we look need to use &quot;structures.model&quot;.</span>
</span><span id="Relaxation-333"><a href="#Relaxation-333"><span class="linenos">333</span></a>            <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
</span><span id="Relaxation-334"><a href="#Relaxation-334"><span class="linenos">334</span></a>                <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
</span><span id="Relaxation-335"><a href="#Relaxation-335"><span class="linenos">335</span></a>                <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
</span><span id="Relaxation-336"><a href="#Relaxation-336"><span class="linenos">336</span></a>                <span class="n">energy</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;e_wo_entrp&quot;</span><span class="p">],</span>
</span><span id="Relaxation-337"><a href="#Relaxation-337"><span class="linenos">337</span></a>                <span class="n">site_forces</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">],</span>
</span><span id="Relaxation-338"><a href="#Relaxation-338"><span class="linenos">338</span></a>                <span class="n">lattice_stress</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;stress&quot;</span><span class="p">],</span>
</span><span id="Relaxation-339"><a href="#Relaxation-339"><span class="linenos">339</span></a>                <span class="n">relaxation</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>  <span class="c1"># this links the structure to this relaxation</span>
</span><span id="Relaxation-340"><a href="#Relaxation-340"><span class="linenos">340</span></a>            <span class="p">)</span>
</span><span id="Relaxation-341"><a href="#Relaxation-341"><span class="linenos">341</span></a>            <span class="n">structure</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Relaxation-342"><a href="#Relaxation-342"><span class="linenos">342</span></a>
</span><span id="Relaxation-343"><a href="#Relaxation-343"><span class="linenos">343</span></a>            <span class="c1"># If this is the first structure, we want to link it as such</span>
</span><span id="Relaxation-344"><a href="#Relaxation-344"><span class="linenos">344</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Relaxation-345"><a href="#Relaxation-345"><span class="linenos">345</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">structure_start_id</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">id</span>
</span><span id="Relaxation-346"><a href="#Relaxation-346"><span class="linenos">346</span></a>            <span class="c1"># and same for the final structure. Note, we can&#39;t use elif becuase</span>
</span><span id="Relaxation-347"><a href="#Relaxation-347"><span class="linenos">347</span></a>            <span class="c1"># there&#39;s a chance the start/end structure are the same, which occurs</span>
</span><span id="Relaxation-348"><a href="#Relaxation-348"><span class="linenos">348</span></a>            <span class="c1"># when the starting structure is found to be relaxed already.</span>
</span><span id="Relaxation-349"><a href="#Relaxation-349"><span class="linenos">349</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Relaxation-350"><a href="#Relaxation-350"><span class="linenos">350</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">structure_final_id</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">id</span>
</span><span id="Relaxation-351"><a href="#Relaxation-351"><span class="linenos">351</span></a>        <span class="c1"># calculate extra data for storing</span>
</span><span id="Relaxation-352"><a href="#Relaxation-352"><span class="linenos">352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_change</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Relaxation-353"><a href="#Relaxation-353"><span class="linenos">353</span></a>            <span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span> <span class="o">-</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span>
</span><span id="Relaxation-354"><a href="#Relaxation-354"><span class="linenos">354</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span>
</span><span id="Relaxation-355"><a href="#Relaxation-355"><span class="linenos">355</span></a>
</span><span id="Relaxation-356"><a href="#Relaxation-356"><span class="linenos">356</span></a>        <span class="c1"># There is also extra data for the final structure that we save directly</span>
</span><span id="Relaxation-357"><a href="#Relaxation-357"><span class="linenos">357</span></a>        <span class="c1"># in the relaxation table.  We use .get() in case the key isn&#39;t provided.</span>
</span><span id="Relaxation-358"><a href="#Relaxation-358"><span class="linenos">358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">band_gap</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bandgap&quot;</span><span class="p">)</span>
</span><span id="Relaxation-359"><a href="#Relaxation-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_gap_direct</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_gap_direct&quot;</span><span class="p">)</span>
</span><span id="Relaxation-360"><a href="#Relaxation-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">energy_fermi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;efermi&quot;</span><span class="p">)</span>
</span><span id="Relaxation-361"><a href="#Relaxation-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conduction_band_minimum</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cbm&quot;</span><span class="p">)</span>
</span><span id="Relaxation-362"><a href="#Relaxation-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valence_band_maximum</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">)</span>
</span><span id="Relaxation-363"><a href="#Relaxation-363"><span class="linenos">363</span></a>
</span><span id="Relaxation-364"><a href="#Relaxation-364"><span class="linenos">364</span></a>        <span class="c1"># lastly, we also want to save the corrections made and directory it ran in</span>
</span><span id="Relaxation-365"><a href="#Relaxation-365"><span class="linenos">365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">corrections</span> <span class="o">=</span> <span class="n">corrections</span>
</span><span id="Relaxation-366"><a href="#Relaxation-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Relaxation-367"><a href="#Relaxation-367"><span class="linenos">367</span></a>
</span><span id="Relaxation-368"><a href="#Relaxation-368"><span class="linenos">368</span></a>        <span class="c1"># Now we have the relaxation data all loaded and can save it to the database</span>
</span><span id="Relaxation-369"><a href="#Relaxation-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Relaxation-370"><a href="#Relaxation-370"><span class="linenos">370</span></a>
</span><span id="Relaxation-371"><a href="#Relaxation-371"><span class="linenos">371</span></a>    <span class="k">def</span> <span class="nf">get_convergence_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Relaxation-372"><a href="#Relaxation-372"><span class="linenos">372</span></a>
</span><span id="Relaxation-373"><a href="#Relaxation-373"><span class="linenos">373</span></a>        <span class="c1"># Grab the calculation&#39;s structure and convert it to a dataframe</span>
</span><span id="Relaxation-374"><a href="#Relaxation-374"><span class="linenos">374</span></a>        <span class="n">structures_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="Relaxation-375"><a href="#Relaxation-375"><span class="linenos">375</span></a>
</span><span id="Relaxation-376"><a href="#Relaxation-376"><span class="linenos">376</span></a>        <span class="c1"># We will be making a figure that consists of 3 stacked subplots that</span>
</span><span id="Relaxation-377"><a href="#Relaxation-377"><span class="linenos">377</span></a>        <span class="c1"># all share the x-axis of ionic_step_number</span>
</span><span id="Relaxation-378"><a href="#Relaxation-378"><span class="linenos">378</span></a>        <span class="n">figure</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span>
</span><span id="Relaxation-379"><a href="#Relaxation-379"><span class="linenos">379</span></a>            <span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="Relaxation-380"><a href="#Relaxation-380"><span class="linenos">380</span></a>            <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation-381"><a href="#Relaxation-381"><span class="linenos">381</span></a>            <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation-382"><a href="#Relaxation-382"><span class="linenos">382</span></a>        <span class="p">)</span>
</span><span id="Relaxation-383"><a href="#Relaxation-383"><span class="linenos">383</span></a>
</span><span id="Relaxation-384"><a href="#Relaxation-384"><span class="linenos">384</span></a>        <span class="c1"># Generate a plot for Energy (per atom)</span>
</span><span id="Relaxation-385"><a href="#Relaxation-385"><span class="linenos">385</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="Relaxation-386"><a href="#Relaxation-386"><span class="linenos">386</span></a>            <span class="n">plotly_go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="Relaxation-387"><a href="#Relaxation-387"><span class="linenos">387</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="Relaxation-388"><a href="#Relaxation-388"><span class="linenos">388</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;energy_per_atom&quot;</span><span class="p">],</span>
</span><span id="Relaxation-389"><a href="#Relaxation-389"><span class="linenos">389</span></a>            <span class="p">),</span>
</span><span id="Relaxation-390"><a href="#Relaxation-390"><span class="linenos">390</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation-391"><a href="#Relaxation-391"><span class="linenos">391</span></a>            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation-392"><a href="#Relaxation-392"><span class="linenos">392</span></a>        <span class="p">)</span>
</span><span id="Relaxation-393"><a href="#Relaxation-393"><span class="linenos">393</span></a>
</span><span id="Relaxation-394"><a href="#Relaxation-394"><span class="linenos">394</span></a>        <span class="c1"># Generate a plot for Forces (norm per atom)</span>
</span><span id="Relaxation-395"><a href="#Relaxation-395"><span class="linenos">395</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="Relaxation-396"><a href="#Relaxation-396"><span class="linenos">396</span></a>            <span class="n">plotly_go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="Relaxation-397"><a href="#Relaxation-397"><span class="linenos">397</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="Relaxation-398"><a href="#Relaxation-398"><span class="linenos">398</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;site_forces_norm_per_atom&quot;</span><span class="p">],</span>
</span><span id="Relaxation-399"><a href="#Relaxation-399"><span class="linenos">399</span></a>            <span class="p">),</span>
</span><span id="Relaxation-400"><a href="#Relaxation-400"><span class="linenos">400</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Relaxation-401"><a href="#Relaxation-401"><span class="linenos">401</span></a>            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation-402"><a href="#Relaxation-402"><span class="linenos">402</span></a>        <span class="p">)</span>
</span><span id="Relaxation-403"><a href="#Relaxation-403"><span class="linenos">403</span></a>
</span><span id="Relaxation-404"><a href="#Relaxation-404"><span class="linenos">404</span></a>        <span class="c1"># Generate a plot for Stress (norm per atom)</span>
</span><span id="Relaxation-405"><a href="#Relaxation-405"><span class="linenos">405</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="Relaxation-406"><a href="#Relaxation-406"><span class="linenos">406</span></a>            <span class="n">plotly_go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="Relaxation-407"><a href="#Relaxation-407"><span class="linenos">407</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="Relaxation-408"><a href="#Relaxation-408"><span class="linenos">408</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;lattice_stress_norm_per_atom&quot;</span><span class="p">],</span>
</span><span id="Relaxation-409"><a href="#Relaxation-409"><span class="linenos">409</span></a>            <span class="p">),</span>
</span><span id="Relaxation-410"><a href="#Relaxation-410"><span class="linenos">410</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="Relaxation-411"><a href="#Relaxation-411"><span class="linenos">411</span></a>            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation-412"><a href="#Relaxation-412"><span class="linenos">412</span></a>        <span class="p">)</span>
</span><span id="Relaxation-413"><a href="#Relaxation-413"><span class="linenos">413</span></a>
</span><span id="Relaxation-414"><a href="#Relaxation-414"><span class="linenos">414</span></a>        <span class="c1"># Now let&#39;s clean up some formatting and add the axes titles</span>
</span><span id="Relaxation-415"><a href="#Relaxation-415"><span class="linenos">415</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="Relaxation-416"><a href="#Relaxation-416"><span class="linenos">416</span></a>            <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
</span><span id="Relaxation-417"><a href="#Relaxation-417"><span class="linenos">417</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
</span><span id="Relaxation-418"><a href="#Relaxation-418"><span class="linenos">418</span></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Relaxation-419"><a href="#Relaxation-419"><span class="linenos">419</span></a>            <span class="n">xaxis3_title</span><span class="o">=</span><span class="s2">&quot;Ionic Step (#)&quot;</span><span class="p">,</span>
</span><span id="Relaxation-420"><a href="#Relaxation-420"><span class="linenos">420</span></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Energy (eV/atom)&quot;</span><span class="p">,</span>
</span><span id="Relaxation-421"><a href="#Relaxation-421"><span class="linenos">421</span></a>            <span class="n">yaxis2_title</span><span class="o">=</span><span class="s2">&quot;Site Forces&quot;</span><span class="p">,</span>
</span><span id="Relaxation-422"><a href="#Relaxation-422"><span class="linenos">422</span></a>            <span class="n">yaxis3_title</span><span class="o">=</span><span class="s2">&quot;Lattice Stress&quot;</span><span class="p">,</span>
</span><span id="Relaxation-423"><a href="#Relaxation-423"><span class="linenos">423</span></a>        <span class="p">)</span>
</span><span id="Relaxation-424"><a href="#Relaxation-424"><span class="linenos">424</span></a>
</span><span id="Relaxation-425"><a href="#Relaxation-425"><span class="linenos">425</span></a>        <span class="c1"># we return the figure object for the user</span>
</span><span id="Relaxation-426"><a href="#Relaxation-426"><span class="linenos">426</span></a>        <span class="k">return</span> <span class="n">figure</span>
</span><span id="Relaxation-427"><a href="#Relaxation-427"><span class="linenos">427</span></a>
</span><span id="Relaxation-428"><a href="#Relaxation-428"><span class="linenos">428</span></a>    <span class="k">def</span> <span class="nf">view_convergence_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Relaxation-429"><a href="#Relaxation-429"><span class="linenos">429</span></a>        <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_convergence_plot</span><span class="p">()</span>
</span><span id="Relaxation-430"><a href="#Relaxation-430"><span class="linenos">430</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;browser&quot;</span><span class="p">)</span>
</span><span id="Relaxation-431"><a href="#Relaxation-431"><span class="linenos">431</span></a>
</span><span id="Relaxation-432"><a href="#Relaxation-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">get_convergence_plot_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Relaxation-433"><a href="#Relaxation-433"><span class="linenos">433</span></a>        <span class="c1"># Make the convergence figure and convert it to an html div</span>
</span><span id="Relaxation-434"><a href="#Relaxation-434"><span class="linenos">434</span></a>        <span class="n">figure_convergence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_convergence_plot</span><span class="p">()</span>
</span><span id="Relaxation-435"><a href="#Relaxation-435"><span class="linenos">435</span></a>        <span class="n">figure_convergence_html</span> <span class="o">=</span> <span class="n">figure_convergence</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span>
</span><span id="Relaxation-436"><a href="#Relaxation-436"><span class="linenos">436</span></a>            <span class="n">full_html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Relaxation-437"><a href="#Relaxation-437"><span class="linenos">437</span></a>            <span class="n">include_plotlyjs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Relaxation-438"><a href="#Relaxation-438"><span class="linenos">438</span></a>        <span class="p">)</span>
</span><span id="Relaxation-439"><a href="#Relaxation-439"><span class="linenos">439</span></a>        <span class="k">return</span> <span class="n">figure_convergence_html</span>
</span></pre></div>


            <div class="docstring"><p>This table holds all data from a structure relaxation and also links to
IonicStep table which holds all of the structure/energy/forces for each
ionic step.</p>

<p>WARNING: The Structure stored in this table here is the source structure
until the calculation completes. After completed, the structure will
be updated to the final structure. If you wish to ensure you're accessing
the correct structure, use the <code>structure_final</code> attribute, which gives
the final IonicStep.</p>
</div>


                            <div id="Relaxation.base_info" class="classattr">
                                <div class="attr variable">
            <span class="name">base_info</span><span class="annotation">: List[str]</span><span class="default_value"> = [&#39;band_gap&#39;, &#39;is_gap_direct&#39;, &#39;energy_fermi&#39;, &#39;conduction_band_minimum&#39;, &#39;valence_band_maximum&#39;, &#39;structure_string&#39;, &#39;directory&#39;, &#39;prefect_flow_run_id&#39;, &#39;created_at&#39;, &#39;updated_at&#39;, &#39;corrections&#39;]</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.base_info"></a>
    
            <div class="docstring"><p>The base information for this database table and only these fields are stored
when the <code>to_archive</code> method is used. Using the columns in this list, all 
other columns for this table can be calculated, so the columns in this list 
are effectively the "raw data".</p>
</div>


                            </div>
                            <div id="Relaxation.band_gap" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">band_gap</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.band_gap"></a>
    
            <div class="docstring"><p>The band gap energy in eV.</p>
</div>


                            </div>
                            <div id="Relaxation.is_gap_direct" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_gap_direct</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.is_gap_direct"></a>
    
            <div class="docstring"><p>Whether the band gap is direct or indirect.</p>
</div>


                            </div>
                            <div id="Relaxation.energy_fermi" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">energy_fermi</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.energy_fermi"></a>
    
            <div class="docstring"><p>The Fermi energy in eV.</p>
</div>


                            </div>
                            <div id="Relaxation.conduction_band_minimum" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">conduction_band_minimum</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.conduction_band_minimum"></a>
    
            <div class="docstring"><p>The conduction band minimum in eV.</p>
</div>


                            </div>
                            <div id="Relaxation.valence_band_maximum" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">valence_band_maximum</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.valence_band_maximum"></a>
    
            <div class="docstring"><p>The valence band maximum in eV.</p>
</div>


                            </div>
                            <div id="Relaxation.volume_change" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">volume_change</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.volume_change"></a>
    
            <div class="docstring"><p>The percent volume change during the relaxation. This is useful for checking
if Pulay Stress may be significant or if the structure was highly unreasonable.
We store this as a ratio relative to the starting structure:</p>

<pre><code>(volume_final - volume_start) / volume_start
</code></pre>
</div>


                            </div>
                            <div id="Relaxation.create_subclasses" class="classattr">
                                        <input id="Relaxation.create_subclasses-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">create_subclasses</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">module</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="o">**</span><span class="n">extra_columns</span></span>)</span>

                <label class="view-source-button" for="Relaxation.create_subclasses-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relaxation.create_subclasses"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relaxation.create_subclasses-161"><a href="#Relaxation.create_subclasses-161"><span class="linenos">161</span></a>    <span class="nd">@classmethod</span>
</span><span id="Relaxation.create_subclasses-162"><a href="#Relaxation.create_subclasses-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">create_subclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_columns</span><span class="p">):</span>
</span><span id="Relaxation.create_subclasses-163"><a href="#Relaxation.create_subclasses-163"><span class="linenos">163</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation.create_subclasses-164"><a href="#Relaxation.create_subclasses-164"><span class="linenos">164</span></a><span class="sd">        Dynamically creates a subclass of Relaxation as well as a separate IonicStep</span>
</span><span id="Relaxation.create_subclasses-165"><a href="#Relaxation.create_subclasses-165"><span class="linenos">165</span></a><span class="sd">        table for it. These tables are linked together.</span>
</span><span id="Relaxation.create_subclasses-166"><a href="#Relaxation.create_subclasses-166"><span class="linenos">166</span></a>
</span><span id="Relaxation.create_subclasses-167"><a href="#Relaxation.create_subclasses-167"><span class="linenos">167</span></a><span class="sd">        Example use:</span>
</span><span id="Relaxation.create_subclasses-168"><a href="#Relaxation.create_subclasses-168"><span class="linenos">168</span></a>
</span><span id="Relaxation.create_subclasses-169"><a href="#Relaxation.create_subclasses-169"><span class="linenos">169</span></a><span class="sd">        ``` python</span>
</span><span id="Relaxation.create_subclasses-170"><a href="#Relaxation.create_subclasses-170"><span class="linenos">170</span></a><span class="sd">        from simmate.database.base_data_types import Relaxation</span>
</span><span id="Relaxation.create_subclasses-171"><a href="#Relaxation.create_subclasses-171"><span class="linenos">171</span></a>
</span><span id="Relaxation.create_subclasses-172"><a href="#Relaxation.create_subclasses-172"><span class="linenos">172</span></a><span class="sd">        ExampleRelaxation, ExampleIonicStep = Relaxation.create_subclasses(</span>
</span><span id="Relaxation.create_subclasses-173"><a href="#Relaxation.create_subclasses-173"><span class="linenos">173</span></a><span class="sd">            &quot;Example&quot;,</span>
</span><span id="Relaxation.create_subclasses-174"><a href="#Relaxation.create_subclasses-174"><span class="linenos">174</span></a><span class="sd">            module=__name__,</span>
</span><span id="Relaxation.create_subclasses-175"><a href="#Relaxation.create_subclasses-175"><span class="linenos">175</span></a><span class="sd">        )</span>
</span><span id="Relaxation.create_subclasses-176"><a href="#Relaxation.create_subclasses-176"><span class="linenos">176</span></a><span class="sd">        ```</span>
</span><span id="Relaxation.create_subclasses-177"><a href="#Relaxation.create_subclasses-177"><span class="linenos">177</span></a>
</span><span id="Relaxation.create_subclasses-178"><a href="#Relaxation.create_subclasses-178"><span class="linenos">178</span></a><span class="sd">        #### Parameters</span>
</span><span id="Relaxation.create_subclasses-179"><a href="#Relaxation.create_subclasses-179"><span class="linenos">179</span></a>
</span><span id="Relaxation.create_subclasses-180"><a href="#Relaxation.create_subclasses-180"><span class="linenos">180</span></a><span class="sd">        - `name` :</span>
</span><span id="Relaxation.create_subclasses-181"><a href="#Relaxation.create_subclasses-181"><span class="linenos">181</span></a><span class="sd">            The prefix name of the subclasses that are output. &quot;Relaxation&quot; and</span>
</span><span id="Relaxation.create_subclasses-182"><a href="#Relaxation.create_subclasses-182"><span class="linenos">182</span></a><span class="sd">            &quot;IonicStep&quot; will be attached to the end of this prefix.</span>
</span><span id="Relaxation.create_subclasses-183"><a href="#Relaxation.create_subclasses-183"><span class="linenos">183</span></a><span class="sd">        - `module` :</span>
</span><span id="Relaxation.create_subclasses-184"><a href="#Relaxation.create_subclasses-184"><span class="linenos">184</span></a><span class="sd">            name of the module this subclass should be associated with. Typically,</span>
</span><span id="Relaxation.create_subclasses-185"><a href="#Relaxation.create_subclasses-185"><span class="linenos">185</span></a><span class="sd">            you should pass __name__ to this.</span>
</span><span id="Relaxation.create_subclasses-186"><a href="#Relaxation.create_subclasses-186"><span class="linenos">186</span></a><span class="sd">        - `**extra_columns` :</span>
</span><span id="Relaxation.create_subclasses-187"><a href="#Relaxation.create_subclasses-187"><span class="linenos">187</span></a><span class="sd">            Additional columns to add to the table. The keyword will be the</span>
</span><span id="Relaxation.create_subclasses-188"><a href="#Relaxation.create_subclasses-188"><span class="linenos">188</span></a><span class="sd">            column name and the value should match django options</span>
</span><span id="Relaxation.create_subclasses-189"><a href="#Relaxation.create_subclasses-189"><span class="linenos">189</span></a><span class="sd">            (e.g. table_column.FloatField())</span>
</span><span id="Relaxation.create_subclasses-190"><a href="#Relaxation.create_subclasses-190"><span class="linenos">190</span></a>
</span><span id="Relaxation.create_subclasses-191"><a href="#Relaxation.create_subclasses-191"><span class="linenos">191</span></a><span class="sd">        #### Returns</span>
</span><span id="Relaxation.create_subclasses-192"><a href="#Relaxation.create_subclasses-192"><span class="linenos">192</span></a>
</span><span id="Relaxation.create_subclasses-193"><a href="#Relaxation.create_subclasses-193"><span class="linenos">193</span></a><span class="sd">        - `NewRelaxationClass` :</span>
</span><span id="Relaxation.create_subclasses-194"><a href="#Relaxation.create_subclasses-194"><span class="linenos">194</span></a><span class="sd">            A subclass of Relaxation.</span>
</span><span id="Relaxation.create_subclasses-195"><a href="#Relaxation.create_subclasses-195"><span class="linenos">195</span></a><span class="sd">        - `NewIonicStepClass`:</span>
</span><span id="Relaxation.create_subclasses-196"><a href="#Relaxation.create_subclasses-196"><span class="linenos">196</span></a><span class="sd">            A subclass of IonicStep.</span>
</span><span id="Relaxation.create_subclasses-197"><a href="#Relaxation.create_subclasses-197"><span class="linenos">197</span></a>
</span><span id="Relaxation.create_subclasses-198"><a href="#Relaxation.create_subclasses-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Relaxation.create_subclasses-199"><a href="#Relaxation.create_subclasses-199"><span class="linenos">199</span></a>
</span><span id="Relaxation.create_subclasses-200"><a href="#Relaxation.create_subclasses-200"><span class="linenos">200</span></a>        <span class="c1"># For convience, we add columns that point to the start and end structures</span>
</span><span id="Relaxation.create_subclasses-201"><a href="#Relaxation.create_subclasses-201"><span class="linenos">201</span></a>        <span class="n">NewRelaxationClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
</span><span id="Relaxation.create_subclasses-202"><a href="#Relaxation.create_subclasses-202"><span class="linenos">202</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">Relaxation&quot;</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-203"><a href="#Relaxation.create_subclasses-203"><span class="linenos">203</span></a>            <span class="n">structure_start</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
</span><span id="Relaxation.create_subclasses-204"><a href="#Relaxation.create_subclasses-204"><span class="linenos">204</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">IonicStep&quot;</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-205"><a href="#Relaxation.create_subclasses-205"><span class="linenos">205</span></a>                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-206"><a href="#Relaxation.create_subclasses-206"><span class="linenos">206</span></a>                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relaxations_as_start&quot;</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-207"><a href="#Relaxation.create_subclasses-207"><span class="linenos">207</span></a>                <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-208"><a href="#Relaxation.create_subclasses-208"><span class="linenos">208</span></a>                <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-209"><a href="#Relaxation.create_subclasses-209"><span class="linenos">209</span></a>            <span class="p">),</span>
</span><span id="Relaxation.create_subclasses-210"><a href="#Relaxation.create_subclasses-210"><span class="linenos">210</span></a>            <span class="n">structure_final</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
</span><span id="Relaxation.create_subclasses-211"><a href="#Relaxation.create_subclasses-211"><span class="linenos">211</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">IonicStep&quot;</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-212"><a href="#Relaxation.create_subclasses-212"><span class="linenos">212</span></a>                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-213"><a href="#Relaxation.create_subclasses-213"><span class="linenos">213</span></a>                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;relaxations_as_final&quot;</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-214"><a href="#Relaxation.create_subclasses-214"><span class="linenos">214</span></a>                <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-215"><a href="#Relaxation.create_subclasses-215"><span class="linenos">215</span></a>                <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-216"><a href="#Relaxation.create_subclasses-216"><span class="linenos">216</span></a>            <span class="p">),</span>
</span><span id="Relaxation.create_subclasses-217"><a href="#Relaxation.create_subclasses-217"><span class="linenos">217</span></a>            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-218"><a href="#Relaxation.create_subclasses-218"><span class="linenos">218</span></a>            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-219"><a href="#Relaxation.create_subclasses-219"><span class="linenos">219</span></a>        <span class="p">)</span>
</span><span id="Relaxation.create_subclasses-220"><a href="#Relaxation.create_subclasses-220"><span class="linenos">220</span></a>
</span><span id="Relaxation.create_subclasses-221"><a href="#Relaxation.create_subclasses-221"><span class="linenos">221</span></a>        <span class="n">NewIonicStepClass</span> <span class="o">=</span> <span class="n">IonicStep</span><span class="o">.</span><span class="n">create_subclass_from_relaxation</span><span class="p">(</span>
</span><span id="Relaxation.create_subclasses-222"><a href="#Relaxation.create_subclasses-222"><span class="linenos">222</span></a>            <span class="n">name</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-223"><a href="#Relaxation.create_subclasses-223"><span class="linenos">223</span></a>            <span class="n">NewRelaxationClass</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-224"><a href="#Relaxation.create_subclasses-224"><span class="linenos">224</span></a>            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-225"><a href="#Relaxation.create_subclasses-225"><span class="linenos">225</span></a>            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="Relaxation.create_subclasses-226"><a href="#Relaxation.create_subclasses-226"><span class="linenos">226</span></a>        <span class="p">)</span>
</span><span id="Relaxation.create_subclasses-227"><a href="#Relaxation.create_subclasses-227"><span class="linenos">227</span></a>
</span><span id="Relaxation.create_subclasses-228"><a href="#Relaxation.create_subclasses-228"><span class="linenos">228</span></a>        <span class="c1"># we now have a new child class and avoided writing some boilerplate code!</span>
</span><span id="Relaxation.create_subclasses-229"><a href="#Relaxation.create_subclasses-229"><span class="linenos">229</span></a>        <span class="k">return</span> <span class="n">NewRelaxationClass</span><span class="p">,</span> <span class="n">NewIonicStepClass</span>
</span></pre></div>


            <div class="docstring"><p>Dynamically creates a subclass of Relaxation as well as a separate IonicStep
table for it. These tables are linked together.</p>

<p>Example use:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="../base_data_types.html">simmate.database.base_data_types</a></span> <span class="kn">import</span> <span class="n">Relaxation</span>

<span class="n">ExampleRelaxation</span><span class="p">,</span> <span class="n">ExampleIonicStep</span> <span class="o">=</span> <span class="n"><a href="#Relaxation.create_subclasses">Relaxation.create_subclasses</a></span><span class="p">(</span>
    <span class="s2">&quot;Example&quot;</span><span class="p">,</span>
    <span class="n">module</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="parameters">Parameters</h4>

<ul>
<li><code>name</code> :
The prefix name of the subclasses that are output. "Relaxation" and
"IonicStep" will be attached to the end of this prefix.</li>
<li><code>module</code> :
name of the module this subclass should be associated with. Typically,
you should pass __name__ to this.</li>
<li><code>**extra_columns</code> :
Additional columns to add to the table. The keyword will be the
column name and the value should match django options
(e.g. table_column.FloatField())</li>
</ul>

<h4 id="returns">Returns</h4>

<ul>
<li><code>NewRelaxationClass</code> :
A subclass of Relaxation.</li>
<li><code>NewIonicStepClass</code>:
A subclass of IonicStep.</li>
</ul>
</div>


                            </div>
                            <div id="Relaxation.from_directory" class="classattr">
                                        <input id="Relaxation.from_directory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_directory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="Relaxation.from_directory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relaxation.from_directory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relaxation.from_directory-231"><a href="#Relaxation.from_directory-231"><span class="linenos">231</span></a>    <span class="nd">@classmethod</span>
</span><span id="Relaxation.from_directory-232"><a href="#Relaxation.from_directory-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Relaxation.from_directory-233"><a href="#Relaxation.from_directory-233"><span class="linenos">233</span></a>        <span class="c1"># I assume the directory is from a vasp calculation, but I need to update</span>
</span><span id="Relaxation.from_directory-234"><a href="#Relaxation.from_directory-234"><span class="linenos">234</span></a>        <span class="c1"># this when I begin adding new calculators.</span>
</span><span id="Relaxation.from_directory-235"><a href="#Relaxation.from_directory-235"><span class="linenos">235</span></a>        <span class="n">vasprun_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">)</span>
</span><span id="Relaxation.from_directory-236"><a href="#Relaxation.from_directory-236"><span class="linenos">236</span></a>        <span class="n">vasprun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">vasprun_filename</span><span class="p">)</span>
</span><span id="Relaxation.from_directory-237"><a href="#Relaxation.from_directory-237"><span class="linenos">237</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_vasp_run</span><span class="p">(</span><span class="n">vasprun</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Relaxation.from_vasp_run" class="classattr">
                                        <input id="Relaxation.from_vasp_run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_vasp_run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">vasprun</span><span class="p">:</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">Vasprun</span></span>)</span>

                <label class="view-source-button" for="Relaxation.from_vasp_run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relaxation.from_vasp_run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relaxation.from_vasp_run-239"><a href="#Relaxation.from_vasp_run-239"><span class="linenos">239</span></a>    <span class="nd">@classmethod</span>
</span><span id="Relaxation.from_vasp_run-240"><a href="#Relaxation.from_vasp_run-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">from_vasp_run</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span><span class="p">):</span>
</span><span id="Relaxation.from_vasp_run-241"><a href="#Relaxation.from_vasp_run-241"><span class="linenos">241</span></a>        <span class="c1"># The data is actually easier to access as a dictionary and everything</span>
</span><span id="Relaxation.from_vasp_run-242"><a href="#Relaxation.from_vasp_run-242"><span class="linenos">242</span></a>        <span class="c1"># we need is stored under the &quot;output&quot; key</span>
</span><span id="Relaxation.from_vasp_run-243"><a href="#Relaxation.from_vasp_run-243"><span class="linenos">243</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</span><span id="Relaxation.from_vasp_run-244"><a href="#Relaxation.from_vasp_run-244"><span class="linenos">244</span></a>
</span><span id="Relaxation.from_vasp_run-245"><a href="#Relaxation.from_vasp_run-245"><span class="linenos">245</span></a>        <span class="c1"># The only other data we need to grab is the list of structures. We can</span>
</span><span id="Relaxation.from_vasp_run-246"><a href="#Relaxation.from_vasp_run-246"><span class="linenos">246</span></a>        <span class="c1"># pull the structure for each ionic step from the vasprun class directly.</span>
</span><span id="Relaxation.from_vasp_run-247"><a href="#Relaxation.from_vasp_run-247"><span class="linenos">247</span></a>        <span class="n">structures</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">structures</span>
</span><span id="Relaxation.from_vasp_run-248"><a href="#Relaxation.from_vasp_run-248"><span class="linenos">248</span></a>
</span><span id="Relaxation.from_vasp_run-249"><a href="#Relaxation.from_vasp_run-249"><span class="linenos">249</span></a>        <span class="c1"># Make the relaxation entry. Note we need to save this to the database</span>
</span><span id="Relaxation.from_vasp_run-250"><a href="#Relaxation.from_vasp_run-250"><span class="linenos">250</span></a>        <span class="c1"># in order to link/save the ionic steps below. We save the structure</span>
</span><span id="Relaxation.from_vasp_run-251"><a href="#Relaxation.from_vasp_run-251"><span class="linenos">251</span></a>        <span class="c1"># as the final one in the calculation.</span>
</span><span id="Relaxation.from_vasp_run-252"><a href="#Relaxation.from_vasp_run-252"><span class="linenos">252</span></a>        <span class="n">relaxation</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
</span><span id="Relaxation.from_vasp_run-253"><a href="#Relaxation.from_vasp_run-253"><span class="linenos">253</span></a>            <span class="n">structure</span><span class="o">=</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Relaxation.from_vasp_run-254"><a href="#Relaxation.from_vasp_run-254"><span class="linenos">254</span></a>            <span class="n">volume_change</span><span class="o">=</span><span class="p">(</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span> <span class="o">-</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>
</span><span id="Relaxation.from_vasp_run-255"><a href="#Relaxation.from_vasp_run-255"><span class="linenos">255</span></a>            <span class="o">/</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
</span><span id="Relaxation.from_vasp_run-256"><a href="#Relaxation.from_vasp_run-256"><span class="linenos">256</span></a>            <span class="n">band_gap</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bandgap&quot;</span><span class="p">),</span>
</span><span id="Relaxation.from_vasp_run-257"><a href="#Relaxation.from_vasp_run-257"><span class="linenos">257</span></a>            <span class="n">is_gap_direct</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_gap_direct&quot;</span><span class="p">),</span>
</span><span id="Relaxation.from_vasp_run-258"><a href="#Relaxation.from_vasp_run-258"><span class="linenos">258</span></a>            <span class="n">energy_fermi</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;efermi&quot;</span><span class="p">),</span>
</span><span id="Relaxation.from_vasp_run-259"><a href="#Relaxation.from_vasp_run-259"><span class="linenos">259</span></a>            <span class="n">conduction_band_minimum</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cbm&quot;</span><span class="p">),</span>
</span><span id="Relaxation.from_vasp_run-260"><a href="#Relaxation.from_vasp_run-260"><span class="linenos">260</span></a>            <span class="n">valence_band_maximum</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">),</span>
</span><span id="Relaxation.from_vasp_run-261"><a href="#Relaxation.from_vasp_run-261"><span class="linenos">261</span></a>        <span class="p">)</span>
</span><span id="Relaxation.from_vasp_run-262"><a href="#Relaxation.from_vasp_run-262"><span class="linenos">262</span></a>
</span><span id="Relaxation.from_vasp_run-263"><a href="#Relaxation.from_vasp_run-263"><span class="linenos">263</span></a>        <span class="c1"># lastly, we also want to save the corrections made and directory it ran in</span>
</span><span id="Relaxation.from_vasp_run-264"><a href="#Relaxation.from_vasp_run-264"><span class="linenos">264</span></a>        <span class="c1"># relaxation.corrections = corrections</span>
</span><span id="Relaxation.from_vasp_run-265"><a href="#Relaxation.from_vasp_run-265"><span class="linenos">265</span></a>        <span class="c1"># relaxation.directory = directory</span>
</span><span id="Relaxation.from_vasp_run-266"><a href="#Relaxation.from_vasp_run-266"><span class="linenos">266</span></a>
</span><span id="Relaxation.from_vasp_run-267"><a href="#Relaxation.from_vasp_run-267"><span class="linenos">267</span></a>        <span class="c1"># Now we have the relaxation data all loaded and can save it to the database</span>
</span><span id="Relaxation.from_vasp_run-268"><a href="#Relaxation.from_vasp_run-268"><span class="linenos">268</span></a>        <span class="n">relaxation</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Relaxation.from_vasp_run-269"><a href="#Relaxation.from_vasp_run-269"><span class="linenos">269</span></a>
</span><span id="Relaxation.from_vasp_run-270"><a href="#Relaxation.from_vasp_run-270"><span class="linenos">270</span></a>        <span class="c1"># Now let&#39;s iterate through the ionic steps and save these to the database.</span>
</span><span id="Relaxation.from_vasp_run-271"><a href="#Relaxation.from_vasp_run-271"><span class="linenos">271</span></a>        <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ionic_step</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="Relaxation.from_vasp_run-272"><a href="#Relaxation.from_vasp_run-272"><span class="linenos">272</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">structures</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ionic_steps&quot;</span><span class="p">])</span>
</span><span id="Relaxation.from_vasp_run-273"><a href="#Relaxation.from_vasp_run-273"><span class="linenos">273</span></a>        <span class="p">):</span>
</span><span id="Relaxation.from_vasp_run-274"><a href="#Relaxation.from_vasp_run-274"><span class="linenos">274</span></a>            <span class="c1"># first pull all the data together and save it to the database. We</span>
</span><span id="Relaxation.from_vasp_run-275"><a href="#Relaxation.from_vasp_run-275"><span class="linenos">275</span></a>            <span class="c1"># are saving this to an IonicStepStructure datatable.</span>
</span><span id="Relaxation.from_vasp_run-276"><a href="#Relaxation.from_vasp_run-276"><span class="linenos">276</span></a>            <span class="n">structure_db</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
</span><span id="Relaxation.from_vasp_run-277"><a href="#Relaxation.from_vasp_run-277"><span class="linenos">277</span></a>                <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
</span><span id="Relaxation.from_vasp_run-278"><a href="#Relaxation.from_vasp_run-278"><span class="linenos">278</span></a>                <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
</span><span id="Relaxation.from_vasp_run-279"><a href="#Relaxation.from_vasp_run-279"><span class="linenos">279</span></a>                <span class="n">energy</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;e_wo_entrp&quot;</span><span class="p">],</span>
</span><span id="Relaxation.from_vasp_run-280"><a href="#Relaxation.from_vasp_run-280"><span class="linenos">280</span></a>                <span class="n">site_forces</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">],</span>
</span><span id="Relaxation.from_vasp_run-281"><a href="#Relaxation.from_vasp_run-281"><span class="linenos">281</span></a>                <span class="n">lattice_stress</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;stress&quot;</span><span class="p">],</span>
</span><span id="Relaxation.from_vasp_run-282"><a href="#Relaxation.from_vasp_run-282"><span class="linenos">282</span></a>                <span class="n">relaxation</span><span class="o">=</span><span class="n">relaxation</span><span class="p">,</span>  <span class="c1"># this links the structure to this relaxation</span>
</span><span id="Relaxation.from_vasp_run-283"><a href="#Relaxation.from_vasp_run-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="Relaxation.from_vasp_run-284"><a href="#Relaxation.from_vasp_run-284"><span class="linenos">284</span></a>            <span class="n">structure_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Relaxation.from_vasp_run-285"><a href="#Relaxation.from_vasp_run-285"><span class="linenos">285</span></a>
</span><span id="Relaxation.from_vasp_run-286"><a href="#Relaxation.from_vasp_run-286"><span class="linenos">286</span></a>            <span class="c1"># If this is the first structure, we want to link it as such</span>
</span><span id="Relaxation.from_vasp_run-287"><a href="#Relaxation.from_vasp_run-287"><span class="linenos">287</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Relaxation.from_vasp_run-288"><a href="#Relaxation.from_vasp_run-288"><span class="linenos">288</span></a>                <span class="n">relaxation</span><span class="o">.</span><span class="n">structure_start_id</span> <span class="o">=</span> <span class="n">structure_db</span><span class="o">.</span><span class="n">id</span>
</span><span id="Relaxation.from_vasp_run-289"><a href="#Relaxation.from_vasp_run-289"><span class="linenos">289</span></a>            <span class="c1"># and same for the final structure. Note, we can&#39;t use elif becuase</span>
</span><span id="Relaxation.from_vasp_run-290"><a href="#Relaxation.from_vasp_run-290"><span class="linenos">290</span></a>            <span class="c1"># there&#39;s a chance the start/end structure are the same, which occurs</span>
</span><span id="Relaxation.from_vasp_run-291"><a href="#Relaxation.from_vasp_run-291"><span class="linenos">291</span></a>            <span class="c1"># when the starting structure is found to be relaxed already.</span>
</span><span id="Relaxation.from_vasp_run-292"><a href="#Relaxation.from_vasp_run-292"><span class="linenos">292</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Relaxation.from_vasp_run-293"><a href="#Relaxation.from_vasp_run-293"><span class="linenos">293</span></a>                <span class="n">relaxation</span><span class="o">.</span><span class="n">structure_final_id</span> <span class="o">=</span> <span class="n">structure_db</span><span class="o">.</span><span class="n">id</span>
</span><span id="Relaxation.from_vasp_run-294"><a href="#Relaxation.from_vasp_run-294"><span class="linenos">294</span></a>
</span><span id="Relaxation.from_vasp_run-295"><a href="#Relaxation.from_vasp_run-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">relaxation</span>
</span></pre></div>


    

                            </div>
                            <div id="Relaxation.update_from_vasp_run" class="classattr">
                                        <input id="Relaxation.update_from_vasp_run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_from_vasp_run</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vasprun</span><span class="p">:</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">Vasprun</span>,</span><span class="param">	<span class="n">corrections</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">directory</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="Relaxation.update_from_vasp_run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relaxation.update_from_vasp_run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relaxation.update_from_vasp_run-297"><a href="#Relaxation.update_from_vasp_run-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">update_from_vasp_run</span><span class="p">(</span>
</span><span id="Relaxation.update_from_vasp_run-298"><a href="#Relaxation.update_from_vasp_run-298"><span class="linenos">298</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Relaxation.update_from_vasp_run-299"><a href="#Relaxation.update_from_vasp_run-299"><span class="linenos">299</span></a>        <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span><span class="p">,</span>
</span><span id="Relaxation.update_from_vasp_run-300"><a href="#Relaxation.update_from_vasp_run-300"><span class="linenos">300</span></a>        <span class="n">corrections</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Relaxation.update_from_vasp_run-301"><a href="#Relaxation.update_from_vasp_run-301"><span class="linenos">301</span></a>        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Relaxation.update_from_vasp_run-302"><a href="#Relaxation.update_from_vasp_run-302"><span class="linenos">302</span></a>    <span class="p">):</span>
</span><span id="Relaxation.update_from_vasp_run-303"><a href="#Relaxation.update_from_vasp_run-303"><span class="linenos">303</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relaxation.update_from_vasp_run-304"><a href="#Relaxation.update_from_vasp_run-304"><span class="linenos">304</span></a><span class="sd">        Given a Vasprun object from a finished relaxation, this will update the</span>
</span><span id="Relaxation.update_from_vasp_run-305"><a href="#Relaxation.update_from_vasp_run-305"><span class="linenos">305</span></a><span class="sd">        Relaxation table entry and the corresponding IonicStep entries.</span>
</span><span id="Relaxation.update_from_vasp_run-306"><a href="#Relaxation.update_from_vasp_run-306"><span class="linenos">306</span></a>
</span><span id="Relaxation.update_from_vasp_run-307"><a href="#Relaxation.update_from_vasp_run-307"><span class="linenos">307</span></a><span class="sd">        #### Parameters</span>
</span><span id="Relaxation.update_from_vasp_run-308"><a href="#Relaxation.update_from_vasp_run-308"><span class="linenos">308</span></a>
</span><span id="Relaxation.update_from_vasp_run-309"><a href="#Relaxation.update_from_vasp_run-309"><span class="linenos">309</span></a><span class="sd">        vasprun :</span>
</span><span id="Relaxation.update_from_vasp_run-310"><a href="#Relaxation.update_from_vasp_run-310"><span class="linenos">310</span></a><span class="sd">            The final Vasprun object from the relaxation outputs.</span>
</span><span id="Relaxation.update_from_vasp_run-311"><a href="#Relaxation.update_from_vasp_run-311"><span class="linenos">311</span></a><span class="sd">        corrections :</span>
</span><span id="Relaxation.update_from_vasp_run-312"><a href="#Relaxation.update_from_vasp_run-312"><span class="linenos">312</span></a><span class="sd">            List of errors and corrections applied to during the relaxation.</span>
</span><span id="Relaxation.update_from_vasp_run-313"><a href="#Relaxation.update_from_vasp_run-313"><span class="linenos">313</span></a><span class="sd">        directory :</span>
</span><span id="Relaxation.update_from_vasp_run-314"><a href="#Relaxation.update_from_vasp_run-314"><span class="linenos">314</span></a><span class="sd">            name of the directory that relaxation was ran in. This is only used</span>
</span><span id="Relaxation.update_from_vasp_run-315"><a href="#Relaxation.update_from_vasp_run-315"><span class="linenos">315</span></a><span class="sd">            to reference the archive file if it&#39;s ever needed again.</span>
</span><span id="Relaxation.update_from_vasp_run-316"><a href="#Relaxation.update_from_vasp_run-316"><span class="linenos">316</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Relaxation.update_from_vasp_run-317"><a href="#Relaxation.update_from_vasp_run-317"><span class="linenos">317</span></a>
</span><span id="Relaxation.update_from_vasp_run-318"><a href="#Relaxation.update_from_vasp_run-318"><span class="linenos">318</span></a>        <span class="c1"># The data is actually easier to access as a dictionary and everything</span>
</span><span id="Relaxation.update_from_vasp_run-319"><a href="#Relaxation.update_from_vasp_run-319"><span class="linenos">319</span></a>        <span class="c1"># we need is stored under the &quot;output&quot; key</span>
</span><span id="Relaxation.update_from_vasp_run-320"><a href="#Relaxation.update_from_vasp_run-320"><span class="linenos">320</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</span><span id="Relaxation.update_from_vasp_run-321"><a href="#Relaxation.update_from_vasp_run-321"><span class="linenos">321</span></a>
</span><span id="Relaxation.update_from_vasp_run-322"><a href="#Relaxation.update_from_vasp_run-322"><span class="linenos">322</span></a>        <span class="c1"># The only other data we need to grab is the list of structures. We can</span>
</span><span id="Relaxation.update_from_vasp_run-323"><a href="#Relaxation.update_from_vasp_run-323"><span class="linenos">323</span></a>        <span class="c1"># pull the structure for each ionic step from the vasprun class directly.</span>
</span><span id="Relaxation.update_from_vasp_run-324"><a href="#Relaxation.update_from_vasp_run-324"><span class="linenos">324</span></a>        <span class="n">structures</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">structures</span>
</span><span id="Relaxation.update_from_vasp_run-325"><a href="#Relaxation.update_from_vasp_run-325"><span class="linenos">325</span></a>
</span><span id="Relaxation.update_from_vasp_run-326"><a href="#Relaxation.update_from_vasp_run-326"><span class="linenos">326</span></a>        <span class="c1"># Now let&#39;s iterate through the ionic steps and save these to the database.</span>
</span><span id="Relaxation.update_from_vasp_run-327"><a href="#Relaxation.update_from_vasp_run-327"><span class="linenos">327</span></a>        <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ionic_step</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="Relaxation.update_from_vasp_run-328"><a href="#Relaxation.update_from_vasp_run-328"><span class="linenos">328</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">structures</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ionic_steps&quot;</span><span class="p">])</span>
</span><span id="Relaxation.update_from_vasp_run-329"><a href="#Relaxation.update_from_vasp_run-329"><span class="linenos">329</span></a>        <span class="p">):</span>
</span><span id="Relaxation.update_from_vasp_run-330"><a href="#Relaxation.update_from_vasp_run-330"><span class="linenos">330</span></a>            <span class="c1"># first pull all the data together and save it to the database. We</span>
</span><span id="Relaxation.update_from_vasp_run-331"><a href="#Relaxation.update_from_vasp_run-331"><span class="linenos">331</span></a>            <span class="c1"># are saving this to an IonicStepStructure datatable. To access this</span>
</span><span id="Relaxation.update_from_vasp_run-332"><a href="#Relaxation.update_from_vasp_run-332"><span class="linenos">332</span></a>            <span class="c1"># model, we look need to use &quot;structures.model&quot;.</span>
</span><span id="Relaxation.update_from_vasp_run-333"><a href="#Relaxation.update_from_vasp_run-333"><span class="linenos">333</span></a>            <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span>
</span><span id="Relaxation.update_from_vasp_run-334"><a href="#Relaxation.update_from_vasp_run-334"><span class="linenos">334</span></a>                <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
</span><span id="Relaxation.update_from_vasp_run-335"><a href="#Relaxation.update_from_vasp_run-335"><span class="linenos">335</span></a>                <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
</span><span id="Relaxation.update_from_vasp_run-336"><a href="#Relaxation.update_from_vasp_run-336"><span class="linenos">336</span></a>                <span class="n">energy</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;e_wo_entrp&quot;</span><span class="p">],</span>
</span><span id="Relaxation.update_from_vasp_run-337"><a href="#Relaxation.update_from_vasp_run-337"><span class="linenos">337</span></a>                <span class="n">site_forces</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">],</span>
</span><span id="Relaxation.update_from_vasp_run-338"><a href="#Relaxation.update_from_vasp_run-338"><span class="linenos">338</span></a>                <span class="n">lattice_stress</span><span class="o">=</span><span class="n">ionic_step</span><span class="p">[</span><span class="s2">&quot;stress&quot;</span><span class="p">],</span>
</span><span id="Relaxation.update_from_vasp_run-339"><a href="#Relaxation.update_from_vasp_run-339"><span class="linenos">339</span></a>                <span class="n">relaxation</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>  <span class="c1"># this links the structure to this relaxation</span>
</span><span id="Relaxation.update_from_vasp_run-340"><a href="#Relaxation.update_from_vasp_run-340"><span class="linenos">340</span></a>            <span class="p">)</span>
</span><span id="Relaxation.update_from_vasp_run-341"><a href="#Relaxation.update_from_vasp_run-341"><span class="linenos">341</span></a>            <span class="n">structure</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Relaxation.update_from_vasp_run-342"><a href="#Relaxation.update_from_vasp_run-342"><span class="linenos">342</span></a>
</span><span id="Relaxation.update_from_vasp_run-343"><a href="#Relaxation.update_from_vasp_run-343"><span class="linenos">343</span></a>            <span class="c1"># If this is the first structure, we want to link it as such</span>
</span><span id="Relaxation.update_from_vasp_run-344"><a href="#Relaxation.update_from_vasp_run-344"><span class="linenos">344</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Relaxation.update_from_vasp_run-345"><a href="#Relaxation.update_from_vasp_run-345"><span class="linenos">345</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">structure_start_id</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">id</span>
</span><span id="Relaxation.update_from_vasp_run-346"><a href="#Relaxation.update_from_vasp_run-346"><span class="linenos">346</span></a>            <span class="c1"># and same for the final structure. Note, we can&#39;t use elif becuase</span>
</span><span id="Relaxation.update_from_vasp_run-347"><a href="#Relaxation.update_from_vasp_run-347"><span class="linenos">347</span></a>            <span class="c1"># there&#39;s a chance the start/end structure are the same, which occurs</span>
</span><span id="Relaxation.update_from_vasp_run-348"><a href="#Relaxation.update_from_vasp_run-348"><span class="linenos">348</span></a>            <span class="c1"># when the starting structure is found to be relaxed already.</span>
</span><span id="Relaxation.update_from_vasp_run-349"><a href="#Relaxation.update_from_vasp_run-349"><span class="linenos">349</span></a>            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Relaxation.update_from_vasp_run-350"><a href="#Relaxation.update_from_vasp_run-350"><span class="linenos">350</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">structure_final_id</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">id</span>
</span><span id="Relaxation.update_from_vasp_run-351"><a href="#Relaxation.update_from_vasp_run-351"><span class="linenos">351</span></a>        <span class="c1"># calculate extra data for storing</span>
</span><span id="Relaxation.update_from_vasp_run-352"><a href="#Relaxation.update_from_vasp_run-352"><span class="linenos">352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_change</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Relaxation.update_from_vasp_run-353"><a href="#Relaxation.update_from_vasp_run-353"><span class="linenos">353</span></a>            <span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span> <span class="o">-</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span>
</span><span id="Relaxation.update_from_vasp_run-354"><a href="#Relaxation.update_from_vasp_run-354"><span class="linenos">354</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volume</span>
</span><span id="Relaxation.update_from_vasp_run-355"><a href="#Relaxation.update_from_vasp_run-355"><span class="linenos">355</span></a>
</span><span id="Relaxation.update_from_vasp_run-356"><a href="#Relaxation.update_from_vasp_run-356"><span class="linenos">356</span></a>        <span class="c1"># There is also extra data for the final structure that we save directly</span>
</span><span id="Relaxation.update_from_vasp_run-357"><a href="#Relaxation.update_from_vasp_run-357"><span class="linenos">357</span></a>        <span class="c1"># in the relaxation table.  We use .get() in case the key isn&#39;t provided.</span>
</span><span id="Relaxation.update_from_vasp_run-358"><a href="#Relaxation.update_from_vasp_run-358"><span class="linenos">358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">band_gap</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bandgap&quot;</span><span class="p">)</span>
</span><span id="Relaxation.update_from_vasp_run-359"><a href="#Relaxation.update_from_vasp_run-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_gap_direct</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_gap_direct&quot;</span><span class="p">)</span>
</span><span id="Relaxation.update_from_vasp_run-360"><a href="#Relaxation.update_from_vasp_run-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">energy_fermi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;efermi&quot;</span><span class="p">)</span>
</span><span id="Relaxation.update_from_vasp_run-361"><a href="#Relaxation.update_from_vasp_run-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conduction_band_minimum</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cbm&quot;</span><span class="p">)</span>
</span><span id="Relaxation.update_from_vasp_run-362"><a href="#Relaxation.update_from_vasp_run-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valence_band_maximum</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">)</span>
</span><span id="Relaxation.update_from_vasp_run-363"><a href="#Relaxation.update_from_vasp_run-363"><span class="linenos">363</span></a>
</span><span id="Relaxation.update_from_vasp_run-364"><a href="#Relaxation.update_from_vasp_run-364"><span class="linenos">364</span></a>        <span class="c1"># lastly, we also want to save the corrections made and directory it ran in</span>
</span><span id="Relaxation.update_from_vasp_run-365"><a href="#Relaxation.update_from_vasp_run-365"><span class="linenos">365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">corrections</span> <span class="o">=</span> <span class="n">corrections</span>
</span><span id="Relaxation.update_from_vasp_run-366"><a href="#Relaxation.update_from_vasp_run-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Relaxation.update_from_vasp_run-367"><a href="#Relaxation.update_from_vasp_run-367"><span class="linenos">367</span></a>
</span><span id="Relaxation.update_from_vasp_run-368"><a href="#Relaxation.update_from_vasp_run-368"><span class="linenos">368</span></a>        <span class="c1"># Now we have the relaxation data all loaded and can save it to the database</span>
</span><span id="Relaxation.update_from_vasp_run-369"><a href="#Relaxation.update_from_vasp_run-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Given a Vasprun object from a finished relaxation, this will update the
Relaxation table entry and the corresponding IonicStep entries.</p>

<h4 id="parameters">Parameters</h4>

<p>vasprun :
    The final Vasprun object from the relaxation outputs.
corrections :
    List of errors and corrections applied to during the relaxation.
directory :
    name of the directory that relaxation was ran in. This is only used
    to reference the archive file if it's ever needed again.</p>
</div>


                            </div>
                            <div id="Relaxation.get_convergence_plot" class="classattr">
                                        <input id="Relaxation.get_convergence_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_convergence_plot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span>)</span>

                <label class="view-source-button" for="Relaxation.get_convergence_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relaxation.get_convergence_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relaxation.get_convergence_plot-371"><a href="#Relaxation.get_convergence_plot-371"><span class="linenos">371</span></a>    <span class="k">def</span> <span class="nf">get_convergence_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Relaxation.get_convergence_plot-372"><a href="#Relaxation.get_convergence_plot-372"><span class="linenos">372</span></a>
</span><span id="Relaxation.get_convergence_plot-373"><a href="#Relaxation.get_convergence_plot-373"><span class="linenos">373</span></a>        <span class="c1"># Grab the calculation&#39;s structure and convert it to a dataframe</span>
</span><span id="Relaxation.get_convergence_plot-374"><a href="#Relaxation.get_convergence_plot-374"><span class="linenos">374</span></a>        <span class="n">structures_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="Relaxation.get_convergence_plot-375"><a href="#Relaxation.get_convergence_plot-375"><span class="linenos">375</span></a>
</span><span id="Relaxation.get_convergence_plot-376"><a href="#Relaxation.get_convergence_plot-376"><span class="linenos">376</span></a>        <span class="c1"># We will be making a figure that consists of 3 stacked subplots that</span>
</span><span id="Relaxation.get_convergence_plot-377"><a href="#Relaxation.get_convergence_plot-377"><span class="linenos">377</span></a>        <span class="c1"># all share the x-axis of ionic_step_number</span>
</span><span id="Relaxation.get_convergence_plot-378"><a href="#Relaxation.get_convergence_plot-378"><span class="linenos">378</span></a>        <span class="n">figure</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span>
</span><span id="Relaxation.get_convergence_plot-379"><a href="#Relaxation.get_convergence_plot-379"><span class="linenos">379</span></a>            <span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-380"><a href="#Relaxation.get_convergence_plot-380"><span class="linenos">380</span></a>            <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-381"><a href="#Relaxation.get_convergence_plot-381"><span class="linenos">381</span></a>            <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-382"><a href="#Relaxation.get_convergence_plot-382"><span class="linenos">382</span></a>        <span class="p">)</span>
</span><span id="Relaxation.get_convergence_plot-383"><a href="#Relaxation.get_convergence_plot-383"><span class="linenos">383</span></a>
</span><span id="Relaxation.get_convergence_plot-384"><a href="#Relaxation.get_convergence_plot-384"><span class="linenos">384</span></a>        <span class="c1"># Generate a plot for Energy (per atom)</span>
</span><span id="Relaxation.get_convergence_plot-385"><a href="#Relaxation.get_convergence_plot-385"><span class="linenos">385</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="Relaxation.get_convergence_plot-386"><a href="#Relaxation.get_convergence_plot-386"><span class="linenos">386</span></a>            <span class="n">plotly_go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="Relaxation.get_convergence_plot-387"><a href="#Relaxation.get_convergence_plot-387"><span class="linenos">387</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="Relaxation.get_convergence_plot-388"><a href="#Relaxation.get_convergence_plot-388"><span class="linenos">388</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;energy_per_atom&quot;</span><span class="p">],</span>
</span><span id="Relaxation.get_convergence_plot-389"><a href="#Relaxation.get_convergence_plot-389"><span class="linenos">389</span></a>            <span class="p">),</span>
</span><span id="Relaxation.get_convergence_plot-390"><a href="#Relaxation.get_convergence_plot-390"><span class="linenos">390</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-391"><a href="#Relaxation.get_convergence_plot-391"><span class="linenos">391</span></a>            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-392"><a href="#Relaxation.get_convergence_plot-392"><span class="linenos">392</span></a>        <span class="p">)</span>
</span><span id="Relaxation.get_convergence_plot-393"><a href="#Relaxation.get_convergence_plot-393"><span class="linenos">393</span></a>
</span><span id="Relaxation.get_convergence_plot-394"><a href="#Relaxation.get_convergence_plot-394"><span class="linenos">394</span></a>        <span class="c1"># Generate a plot for Forces (norm per atom)</span>
</span><span id="Relaxation.get_convergence_plot-395"><a href="#Relaxation.get_convergence_plot-395"><span class="linenos">395</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="Relaxation.get_convergence_plot-396"><a href="#Relaxation.get_convergence_plot-396"><span class="linenos">396</span></a>            <span class="n">plotly_go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="Relaxation.get_convergence_plot-397"><a href="#Relaxation.get_convergence_plot-397"><span class="linenos">397</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="Relaxation.get_convergence_plot-398"><a href="#Relaxation.get_convergence_plot-398"><span class="linenos">398</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;site_forces_norm_per_atom&quot;</span><span class="p">],</span>
</span><span id="Relaxation.get_convergence_plot-399"><a href="#Relaxation.get_convergence_plot-399"><span class="linenos">399</span></a>            <span class="p">),</span>
</span><span id="Relaxation.get_convergence_plot-400"><a href="#Relaxation.get_convergence_plot-400"><span class="linenos">400</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-401"><a href="#Relaxation.get_convergence_plot-401"><span class="linenos">401</span></a>            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-402"><a href="#Relaxation.get_convergence_plot-402"><span class="linenos">402</span></a>        <span class="p">)</span>
</span><span id="Relaxation.get_convergence_plot-403"><a href="#Relaxation.get_convergence_plot-403"><span class="linenos">403</span></a>
</span><span id="Relaxation.get_convergence_plot-404"><a href="#Relaxation.get_convergence_plot-404"><span class="linenos">404</span></a>        <span class="c1"># Generate a plot for Stress (norm per atom)</span>
</span><span id="Relaxation.get_convergence_plot-405"><a href="#Relaxation.get_convergence_plot-405"><span class="linenos">405</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="Relaxation.get_convergence_plot-406"><a href="#Relaxation.get_convergence_plot-406"><span class="linenos">406</span></a>            <span class="n">plotly_go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="Relaxation.get_convergence_plot-407"><a href="#Relaxation.get_convergence_plot-407"><span class="linenos">407</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="Relaxation.get_convergence_plot-408"><a href="#Relaxation.get_convergence_plot-408"><span class="linenos">408</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">structures_dataframe</span><span class="p">[</span><span class="s2">&quot;lattice_stress_norm_per_atom&quot;</span><span class="p">],</span>
</span><span id="Relaxation.get_convergence_plot-409"><a href="#Relaxation.get_convergence_plot-409"><span class="linenos">409</span></a>            <span class="p">),</span>
</span><span id="Relaxation.get_convergence_plot-410"><a href="#Relaxation.get_convergence_plot-410"><span class="linenos">410</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-411"><a href="#Relaxation.get_convergence_plot-411"><span class="linenos">411</span></a>            <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-412"><a href="#Relaxation.get_convergence_plot-412"><span class="linenos">412</span></a>        <span class="p">)</span>
</span><span id="Relaxation.get_convergence_plot-413"><a href="#Relaxation.get_convergence_plot-413"><span class="linenos">413</span></a>
</span><span id="Relaxation.get_convergence_plot-414"><a href="#Relaxation.get_convergence_plot-414"><span class="linenos">414</span></a>        <span class="c1"># Now let&#39;s clean up some formatting and add the axes titles</span>
</span><span id="Relaxation.get_convergence_plot-415"><a href="#Relaxation.get_convergence_plot-415"><span class="linenos">415</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="Relaxation.get_convergence_plot-416"><a href="#Relaxation.get_convergence_plot-416"><span class="linenos">416</span></a>            <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-417"><a href="#Relaxation.get_convergence_plot-417"><span class="linenos">417</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-418"><a href="#Relaxation.get_convergence_plot-418"><span class="linenos">418</span></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-419"><a href="#Relaxation.get_convergence_plot-419"><span class="linenos">419</span></a>            <span class="n">xaxis3_title</span><span class="o">=</span><span class="s2">&quot;Ionic Step (#)&quot;</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-420"><a href="#Relaxation.get_convergence_plot-420"><span class="linenos">420</span></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Energy (eV/atom)&quot;</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-421"><a href="#Relaxation.get_convergence_plot-421"><span class="linenos">421</span></a>            <span class="n">yaxis2_title</span><span class="o">=</span><span class="s2">&quot;Site Forces&quot;</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-422"><a href="#Relaxation.get_convergence_plot-422"><span class="linenos">422</span></a>            <span class="n">yaxis3_title</span><span class="o">=</span><span class="s2">&quot;Lattice Stress&quot;</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot-423"><a href="#Relaxation.get_convergence_plot-423"><span class="linenos">423</span></a>        <span class="p">)</span>
</span><span id="Relaxation.get_convergence_plot-424"><a href="#Relaxation.get_convergence_plot-424"><span class="linenos">424</span></a>
</span><span id="Relaxation.get_convergence_plot-425"><a href="#Relaxation.get_convergence_plot-425"><span class="linenos">425</span></a>        <span class="c1"># we return the figure object for the user</span>
</span><span id="Relaxation.get_convergence_plot-426"><a href="#Relaxation.get_convergence_plot-426"><span class="linenos">426</span></a>        <span class="k">return</span> <span class="n">figure</span>
</span></pre></div>


    

                            </div>
                            <div id="Relaxation.view_convergence_plot" class="classattr">
                                        <input id="Relaxation.view_convergence_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">view_convergence_plot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span>)</span>

                <label class="view-source-button" for="Relaxation.view_convergence_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relaxation.view_convergence_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relaxation.view_convergence_plot-428"><a href="#Relaxation.view_convergence_plot-428"><span class="linenos">428</span></a>    <span class="k">def</span> <span class="nf">view_convergence_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Relaxation.view_convergence_plot-429"><a href="#Relaxation.view_convergence_plot-429"><span class="linenos">429</span></a>        <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_convergence_plot</span><span class="p">()</span>
</span><span id="Relaxation.view_convergence_plot-430"><a href="#Relaxation.view_convergence_plot-430"><span class="linenos">430</span></a>        <span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;browser&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Relaxation.get_convergence_plot_html" class="classattr">
                                        <input id="Relaxation.get_convergence_plot_html-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_convergence_plot_html</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span>)</span>

                <label class="view-source-button" for="Relaxation.get_convergence_plot_html-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relaxation.get_convergence_plot_html"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relaxation.get_convergence_plot_html-432"><a href="#Relaxation.get_convergence_plot_html-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">get_convergence_plot_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Relaxation.get_convergence_plot_html-433"><a href="#Relaxation.get_convergence_plot_html-433"><span class="linenos">433</span></a>        <span class="c1"># Make the convergence figure and convert it to an html div</span>
</span><span id="Relaxation.get_convergence_plot_html-434"><a href="#Relaxation.get_convergence_plot_html-434"><span class="linenos">434</span></a>        <span class="n">figure_convergence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_convergence_plot</span><span class="p">()</span>
</span><span id="Relaxation.get_convergence_plot_html-435"><a href="#Relaxation.get_convergence_plot_html-435"><span class="linenos">435</span></a>        <span class="n">figure_convergence_html</span> <span class="o">=</span> <span class="n">figure_convergence</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span>
</span><span id="Relaxation.get_convergence_plot_html-436"><a href="#Relaxation.get_convergence_plot_html-436"><span class="linenos">436</span></a>            <span class="n">full_html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot_html-437"><a href="#Relaxation.get_convergence_plot_html-437"><span class="linenos">437</span></a>            <span class="n">include_plotlyjs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Relaxation.get_convergence_plot_html-438"><a href="#Relaxation.get_convergence_plot_html-438"><span class="linenos">438</span></a>        <span class="p">)</span>
</span><span id="Relaxation.get_convergence_plot_html-439"><a href="#Relaxation.get_convergence_plot_html-439"><span class="linenos">439</span></a>        <span class="k">return</span> <span class="n">figure_convergence_html</span>
</span></pre></div>


    

                            </div>
                            <div id="Relaxation.structure_string" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">structure_string</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.structure_string"></a>
    
            <div class="docstring"><p>The core structure information, which is written to a string and in a 
compressed format using the <code><a href="#Relaxation.from_toolkit">from_toolkit</a></code> method. To get back to our toolkit
structure object, use the <code><a href="#Relaxation.to_toolkit">to_toolkit</a></code> method.</p>
</div>


                            </div>
                            <div id="Relaxation.nsites" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nsites</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.nsites"></a>
    
            <div class="docstring"><p>The total number of sites in the unitcell. (e.g. Y2CF2 has 5 sites)</p>
</div>


                            </div>
                            <div id="Relaxation.nelements" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nelements</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.nelements"></a>
    
            <div class="docstring"><p>The total number of unique elements. (e.g. Y2CF2 has 3 elements)</p>
</div>


                            </div>
                            <div id="Relaxation.elements" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">elements</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.elements"></a>
    
            <div class="docstring"><p>List of elements in the structure (ex: ["Y", "C", "F"])</p>
</div>


                            </div>
                            <div id="Relaxation.chemical_system" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">chemical_system</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.chemical_system"></a>
    
            <div class="docstring"><p>the base chemical system (ex: "Y-C-F")</p>

<p>Note: be careful when searching for elements! Running chemical_system__contains="C"
on this field won't do what you expect -- because it will return structures
containing Ca, Cs, Ce, Cl, and so on. If you want to search for structures
that contain a specific element, use elements__contains='"C"' instead. The
odd use of quotes '"C"' is required here!</p>
</div>


                            </div>
                            <div id="Relaxation.density" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">density</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.density"></a>
    
            <div class="docstring"><p>The density of the crystal in g/cm^3</p>
</div>


                            </div>
                            <div id="Relaxation.density_atomic" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">density_atomic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.density_atomic"></a>
    
            <div class="docstring"><p>The density of atoms in the crystal in atoms/Angstom^3</p>
</div>


                            </div>
                            <div id="Relaxation.volume" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">volume</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.volume"></a>
    
            <div class="docstring"><p>The volume of the unitcell in Angstom^3</p>

<p>Note: in most cases, <code><a href="#Relaxation.volume_molar">volume_molar</a></code> should be used instead! This is because
volumne is highly dependent on the symmetry and the arbitray unitcell. If 
you are truly after small volumes of the unitcell, it is likely you really 
just want to search by spacegroup.</p>
</div>


                            </div>
                            <div id="Relaxation.volume_molar" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">volume_molar</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.volume_molar"></a>
    
            <div class="docstring"><p>The molar volume of the crystal in cm^3/mol</p>
</div>


                            </div>
                            <div id="Relaxation.formula_full" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">formula_full</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.formula_full"></a>
    
            <div class="docstring"><p>The chemical formula with elements sorted by electronegativity (ex: Li4 Fe4 P4 O16)</p>
</div>


                            </div>
                            <div id="Relaxation.formula_reduced" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">formula_reduced</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.formula_reduced"></a>
    
            <div class="docstring"><p>The reduced chemical formula. (ex: Li4Fe4P4O16 --> LiFePO4)</p>
</div>


                            </div>
                            <div id="Relaxation.formula_anonymous" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">formula_anonymous</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.formula_anonymous"></a>
    
            <div class="docstring"><p>An anonymized formula. Unique species are arranged in ordering of 
amounts and assigned ascending alphabets. Useful for prototyping formulas. 
For example, all stoichiometric perovskites have anonymized_formula ABC3.</p>
</div>


                            </div>
                            <div id="Relaxation.spacegroup" class="classattr">
                                <div class="attr variable">
            <span class="name">spacegroup</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.spacegroup"></a>
    
            <div class="docstring"><p>Spacegroup information. Points to a separate database table that has additional
columns:
<code><a href="symmetry.html#Spacegroup">simmate.database.base_data_types.symmetry.Spacegroup</a></code></p>
</div>


                            </div>
                            <div id="Relaxation.directory" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">directory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.directory"></a>
    
            <div class="docstring"><p>This is the folder that the workflow was ran in. It will be something
like... "/path/to/simmate-task-abc123"</p>
</div>


                            </div>
                            <div id="Relaxation.prefect_flow_run_id" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prefect_flow_run_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.prefect_flow_run_id"></a>
    
            <div class="docstring"><p>If this was submitted through Prefect, there is a lot more metadata available
for this calculation. Simmate does not store this data directly, but instead
we store the flow-run-id so that the user may look this up in the Prefect
database if they wish.
An example id is... d8a785e1-e344-463a-bede-0e7b3da7bab6</p>
</div>


                            </div>
                            <div id="Relaxation.corrections" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">corrections</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.corrections"></a>
    
            <div class="docstring"><p>Simmate workflows often have ErrorHandlers that fix any issues while the
calaculation ran. This often involves changing settings, so we store
any of those changes here.</p>
</div>


                            </div>
                            <div id="Relaxation.created_at" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">created_at</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.created_at"></a>
    
            <div class="docstring"><p>Timestamp of when this row was first added to the database table</p>
</div>


                            </div>
                            <div id="Relaxation.updated_at" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">updated_at</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.updated_at"></a>
    
            <div class="docstring"><p>Timestamp of when this row was was lasted changed / updated</p>
</div>


                            </div>
                            <div id="Relaxation.source" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">source</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.source"></a>
    
            <div class="docstring"><blockquote>
  <p>Note, this field is highly experimental at the moment and subject to
  change.</p>
</blockquote>

<p>This column indicates where the data came from, and it could be a number 
of things including...</p>

<ul>
<li>a third party id</li>
<li>a structure from a different Simmate datbase table</li>
<li>a transformation of another structure</li>
<li>a creation method</li>
<li>a custom submission by the user</li>
</ul>

<p>By default, this is a JSON field to account for all scenarios, but some
tables (such as those in <code><a href="../third_parties.html">simmate.database.third_parties</a></code>) this is value
should be the same for ALL entries in the table and therefore the column is
overwritten as an attribute.</p>

<p>For other tables where this is not a constant, here are some examples of
values used in this column:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># from a thirdparty database or separate table</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a random structure creator</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PyXtalStructure&quot;</span><span class="p">}</span>

<span class="c1"># from a templated structure creator (e.g. substituition or prototypes)</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PrototypeStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;AFLOWPrototypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;MirrorMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a multi-structure transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;HereditaryMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mp-123&quot;</span><span class="p">,</span> <span class="s2">&quot;mp-321&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>
</div>


                            </div>
                            <div id="Relaxation.spacegroup_id" class="classattr">
                                <div class="attr variable">
            <span class="name">spacegroup_id</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.spacegroup_id"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>django.db.models.base.Model</dt>
                                <dd id="Relaxation.__init__" class="function">Model</dd>
                <dd id="Relaxation.from_db" class="function">from_db</dd>
                <dd id="Relaxation.pk" class="variable">pk</dd>
                <dd id="Relaxation.get_deferred_fields" class="function">get_deferred_fields</dd>
                <dd id="Relaxation.refresh_from_db" class="function">refresh_from_db</dd>
                <dd id="Relaxation.serializable_value" class="function">serializable_value</dd>
                <dd id="Relaxation.save" class="function">save</dd>
                <dd id="Relaxation.save_base" class="function">save_base</dd>
                <dd id="Relaxation.delete" class="function">delete</dd>
                <dd id="Relaxation.prepare_database_save" class="function">prepare_database_save</dd>
                <dd id="Relaxation.clean" class="function">clean</dd>
                <dd id="Relaxation.validate_unique" class="function">validate_unique</dd>
                <dd id="Relaxation.date_error_message" class="function">date_error_message</dd>
                <dd id="Relaxation.unique_error_message" class="function">unique_error_message</dd>
                <dd id="Relaxation.full_clean" class="function">full_clean</dd>
                <dd id="Relaxation.clean_fields" class="function">clean_fields</dd>
                <dd id="Relaxation.check" class="function">check</dd>

            </div>
            <div><dt><a href="structure.html#Structure">simmate.database.base_data_types.structure.Structure</a></dt>
                                <dd id="Relaxation.to_toolkit" class="function"><a href="structure.html#Structure.to_toolkit">to_toolkit</a></dd>

            </div>
            <div><dt><a href="calculation.html#Calculation">simmate.database.base_data_types.calculation.Calculation</a></dt>
                                <dd id="Relaxation.prefect_cloud_link" class="variable"><a href="calculation.html#Calculation.prefect_cloud_link">prefect_cloud_link</a></dd>
                <dd id="Relaxation.flow_run_view" class="variable"><a href="calculation.html#Calculation.flow_run_view">flow_run_view</a></dd>
                <dd id="Relaxation.prefect_flow_run_name" class="variable"><a href="calculation.html#Calculation.prefect_flow_run_name">prefect_flow_run_name</a></dd>
                <dd id="Relaxation.prefect_state" class="variable"><a href="calculation.html#Calculation.prefect_state">prefect_state</a></dd>
                <dd id="Relaxation.from_prefect_id" class="function"><a href="calculation.html#Calculation.from_prefect_id">from_prefect_id</a></dd>

            </div>
            <div><dt><a href="base.html#DatabaseTable">simmate.database.base_data_types.base.DatabaseTable</a></dt>
                                <dd id="Relaxation.source_doi" class="variable"><a href="base.html#DatabaseTable.source_doi">source_doi</a></dd>
                <dd id="Relaxation.remote_archive_link" class="variable"><a href="base.html#DatabaseTable.remote_archive_link">remote_archive_link</a></dd>
                <dd id="Relaxation.objects" class="function"><a href="base.html#DatabaseTable.objects">objects</a></dd>
                <dd id="Relaxation.get_table_name" class="function"><a href="base.html#DatabaseTable.get_table_name">get_table_name</a></dd>
                <dd id="Relaxation.create_subclass" class="function"><a href="base.html#DatabaseTable.create_subclass">create_subclass</a></dd>
                <dd id="Relaxation.from_toolkit" class="function"><a href="base.html#DatabaseTable.from_toolkit">from_toolkit</a></dd>
                <dd id="Relaxation.load_archive" class="function"><a href="base.html#DatabaseTable.load_archive">load_archive</a></dd>
                <dd id="Relaxation.load_remote_archive" class="function"><a href="base.html#DatabaseTable.load_remote_archive">load_remote_archive</a></dd>
                <dd id="Relaxation.get_column_names" class="function"><a href="base.html#DatabaseTable.get_column_names">get_column_names</a></dd>
                <dd id="Relaxation.show_columns" class="function"><a href="base.html#DatabaseTable.show_columns">show_columns</a></dd>
                <dd id="Relaxation.get_mixins" class="function"><a href="base.html#DatabaseTable.get_mixins">get_mixins</a></dd>
                <dd id="Relaxation.get_mixin_names" class="function"><a href="base.html#DatabaseTable.get_mixin_names">get_mixin_names</a></dd>
                <dd id="Relaxation.get_extra_columns" class="function"><a href="base.html#DatabaseTable.get_extra_columns">get_extra_columns</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Relaxation.Meta">
                            <input id="Relaxation.Meta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Relaxation.Meta</span>:

                <label class="view-source-button" for="Relaxation.Meta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relaxation.Meta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relaxation.Meta-97"><a href="#Relaxation.Meta-97"><span class="linenos">97</span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span id="Relaxation.Meta-98"><a href="#Relaxation.Meta-98"><span class="linenos">98</span></a>        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Relaxation.Meta-99"><a href="#Relaxation.Meta-99"><span class="linenos">99</span></a>        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>
</span></pre></div>


    

                            <div id="Relaxation.Meta.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Relaxation.Meta</span><span class="signature pdoc-code condensed">()</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.Meta.__init__"></a>
    
    

                            </div>
                            <div id="Relaxation.Meta.abstract" class="classattr">
                                <div class="attr variable">
            <span class="name">abstract</span><span class="default_value"> = False</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.Meta.abstract"></a>
    
    

                            </div>
                            <div id="Relaxation.Meta.app_label" class="classattr">
                                <div class="attr variable">
            <span class="name">app_label</span><span class="default_value"> = &#39;workflows&#39;</span>

        
    </div>
    <a class="headerlink" href="#Relaxation.Meta.app_label"></a>
    
    

                            </div>
                </section>
                <section id="IonicStep">
                            <input id="IonicStep-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IonicStep</span><wbr>(<span class="base"><a href="structure.html#Structure">simmate.database.base_data_types.structure.Structure</a></span>, <span class="base"><a href="thermodynamics.html#Thermodynamics">simmate.database.base_data_types.thermodynamics.Thermodynamics</a></span>, <span class="base"><a href="forces.html#Forces">simmate.database.base_data_types.forces.Forces</a></span>):

                <label class="view-source-button" for="IonicStep-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IonicStep"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IonicStep-442"><a href="#IonicStep-442"><span class="linenos">442</span></a><span class="k">class</span> <span class="nc">IonicStep</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Thermodynamics</span><span class="p">,</span> <span class="n">Forces</span><span class="p">):</span>
</span><span id="IonicStep-443"><a href="#IonicStep-443"><span class="linenos">443</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IonicStep-444"><a href="#IonicStep-444"><span class="linenos">444</span></a><span class="sd">    This database table that holds the data for each ionic step of a relaxation.</span>
</span><span id="IonicStep-445"><a href="#IonicStep-445"><span class="linenos">445</span></a>
</span><span id="IonicStep-446"><a href="#IonicStep-446"><span class="linenos">446</span></a><span class="sd">    An ionic step can be viewed as a static energy calculation, but we keep these</span>
</span><span id="IonicStep-447"><a href="#IonicStep-447"><span class="linenos">447</span></a><span class="sd">    results separate because:</span>
</span><span id="IonicStep-448"><a href="#IonicStep-448"><span class="linenos">448</span></a>
</span><span id="IonicStep-449"><a href="#IonicStep-449"><span class="linenos">449</span></a><span class="sd">        1. Pulay stress can make these energies/forces inaccurate</span>
</span><span id="IonicStep-450"><a href="#IonicStep-450"><span class="linenos">450</span></a><span class="sd">        2. These results each have an associated Relaxation and ionic step number</span>
</span><span id="IonicStep-451"><a href="#IonicStep-451"><span class="linenos">451</span></a>
</span><span id="IonicStep-452"><a href="#IonicStep-452"><span class="linenos">452</span></a><span class="sd">    You will likely never access this table directly. Instead, data is better</span>
</span><span id="IonicStep-453"><a href="#IonicStep-453"><span class="linenos">453</span></a><span class="sd">    accessed through the `structures` attribute on appropiate Relaxation table.</span>
</span><span id="IonicStep-454"><a href="#IonicStep-454"><span class="linenos">454</span></a>
</span><span id="IonicStep-455"><a href="#IonicStep-455"><span class="linenos">455</span></a><span class="sd">    For example:</span>
</span><span id="IonicStep-456"><a href="#IonicStep-456"><span class="linenos">456</span></a>
</span><span id="IonicStep-457"><a href="#IonicStep-457"><span class="linenos">457</span></a><span class="sd">    ``` python</span>
</span><span id="IonicStep-458"><a href="#IonicStep-458"><span class="linenos">458</span></a><span class="sd">    from simmate.database import connect</span>
</span><span id="IonicStep-459"><a href="#IonicStep-459"><span class="linenos">459</span></a><span class="sd">    from simmate.database.workflow_results import MITRelaxation</span>
</span><span id="IonicStep-460"><a href="#IonicStep-460"><span class="linenos">460</span></a>
</span><span id="IonicStep-461"><a href="#IonicStep-461"><span class="linenos">461</span></a><span class="sd">    # grab your desired relaxation</span>
</span><span id="IonicStep-462"><a href="#IonicStep-462"><span class="linenos">462</span></a><span class="sd">    relax = MITRelaxation.objects.get(id=1)</span>
</span><span id="IonicStep-463"><a href="#IonicStep-463"><span class="linenos">463</span></a>
</span><span id="IonicStep-464"><a href="#IonicStep-464"><span class="linenos">464</span></a><span class="sd">    # grab the associated ionic steps</span>
</span><span id="IonicStep-465"><a href="#IonicStep-465"><span class="linenos">465</span></a><span class="sd">    ionic_steps = relax.structures.all()</span>
</span><span id="IonicStep-466"><a href="#IonicStep-466"><span class="linenos">466</span></a><span class="sd">    ```</span>
</span><span id="IonicStep-467"><a href="#IonicStep-467"><span class="linenos">467</span></a>
</span><span id="IonicStep-468"><a href="#IonicStep-468"><span class="linenos">468</span></a><span class="sd">    Note: we assume that only converged data is being stored! So there is no</span>
</span><span id="IonicStep-469"><a href="#IonicStep-469"><span class="linenos">469</span></a><span class="sd">    &quot;converged_electronic&quot; column here. ErrorHandlers and workups should</span>
</span><span id="IonicStep-470"><a href="#IonicStep-470"><span class="linenos">470</span></a><span class="sd">    ensure convergence.</span>
</span><span id="IonicStep-471"><a href="#IonicStep-471"><span class="linenos">471</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="IonicStep-472"><a href="#IonicStep-472"><span class="linenos">472</span></a>
</span><span id="IonicStep-473"><a href="#IonicStep-473"><span class="linenos">473</span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span id="IonicStep-474"><a href="#IonicStep-474"><span class="linenos">474</span></a>        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="IonicStep-475"><a href="#IonicStep-475"><span class="linenos">475</span></a>        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>
</span><span id="IonicStep-476"><a href="#IonicStep-476"><span class="linenos">476</span></a>
</span><span id="IonicStep-477"><a href="#IonicStep-477"><span class="linenos">477</span></a>    <span class="n">base_info</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IonicStep-478"><a href="#IonicStep-478"><span class="linenos">478</span></a>        <span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Structure</span><span class="o">.</span><span class="n">base_info</span> <span class="o">+</span> <span class="n">Thermodynamics</span><span class="o">.</span><span class="n">base_info</span> <span class="o">+</span> <span class="n">Forces</span><span class="o">.</span><span class="n">base_info</span>
</span><span id="IonicStep-479"><a href="#IonicStep-479"><span class="linenos">479</span></a>    <span class="p">)</span>
</span><span id="IonicStep-480"><a href="#IonicStep-480"><span class="linenos">480</span></a>
</span><span id="IonicStep-481"><a href="#IonicStep-481"><span class="linenos">481</span></a>    <span class="n">number</span> <span class="o">=</span> <span class="n">table_column</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</span><span id="IonicStep-482"><a href="#IonicStep-482"><span class="linenos">482</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IonicStep-483"><a href="#IonicStep-483"><span class="linenos">483</span></a><span class="sd">    The ionic step number within the relaxation. This starts counting from 0.</span>
</span><span id="IonicStep-484"><a href="#IonicStep-484"><span class="linenos">484</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="IonicStep-485"><a href="#IonicStep-485"><span class="linenos">485</span></a>
</span><span id="IonicStep-486"><a href="#IonicStep-486"><span class="linenos">486</span></a>    <span class="sd">&quot;&quot;&quot; Relationships &quot;&quot;&quot;</span>
</span><span id="IonicStep-487"><a href="#IonicStep-487"><span class="linenos">487</span></a>    <span class="c1"># each of these will map to a Relaxation, so you should typically access this</span>
</span><span id="IonicStep-488"><a href="#IonicStep-488"><span class="linenos">488</span></a>    <span class="c1"># data through that class. The exception to this is when you want all ionic</span>
</span><span id="IonicStep-489"><a href="#IonicStep-489"><span class="linenos">489</span></a>    <span class="c1"># steps accross many relaxations for a machine learning input.</span>
</span><span id="IonicStep-490"><a href="#IonicStep-490"><span class="linenos">490</span></a>    <span class="c1"># These relationship can be found via...</span>
</span><span id="IonicStep-491"><a href="#IonicStep-491"><span class="linenos">491</span></a>    <span class="c1">#   relaxations</span>
</span><span id="IonicStep-492"><a href="#IonicStep-492"><span class="linenos">492</span></a>    <span class="c1">#   relaxations_as_start</span>
</span><span id="IonicStep-493"><a href="#IonicStep-493"><span class="linenos">493</span></a>    <span class="c1">#   relaxations_as_final</span>
</span><span id="IonicStep-494"><a href="#IonicStep-494"><span class="linenos">494</span></a>
</span><span id="IonicStep-495"><a href="#IonicStep-495"><span class="linenos">495</span></a>    <span class="nd">@classmethod</span>
</span><span id="IonicStep-496"><a href="#IonicStep-496"><span class="linenos">496</span></a>    <span class="k">def</span> <span class="nf">create_subclass_from_relaxation</span><span class="p">(</span>
</span><span id="IonicStep-497"><a href="#IonicStep-497"><span class="linenos">497</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="IonicStep-498"><a href="#IonicStep-498"><span class="linenos">498</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="IonicStep-499"><a href="#IonicStep-499"><span class="linenos">499</span></a>        <span class="n">relaxation</span><span class="p">:</span> <span class="n">Relaxation</span><span class="p">,</span>
</span><span id="IonicStep-500"><a href="#IonicStep-500"><span class="linenos">500</span></a>        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="IonicStep-501"><a href="#IonicStep-501"><span class="linenos">501</span></a>        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="IonicStep-502"><a href="#IonicStep-502"><span class="linenos">502</span></a>    <span class="p">):</span>
</span><span id="IonicStep-503"><a href="#IonicStep-503"><span class="linenos">503</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IonicStep-504"><a href="#IonicStep-504"><span class="linenos">504</span></a><span class="sd">        Dynamically creates a subclass of IonicStep and links it to the Relaxation</span>
</span><span id="IonicStep-505"><a href="#IonicStep-505"><span class="linenos">505</span></a><span class="sd">        table.</span>
</span><span id="IonicStep-506"><a href="#IonicStep-506"><span class="linenos">506</span></a>
</span><span id="IonicStep-507"><a href="#IonicStep-507"><span class="linenos">507</span></a><span class="sd">        This method should NOT be called directly because it is instead used by</span>
</span><span id="IonicStep-508"><a href="#IonicStep-508"><span class="linenos">508</span></a><span class="sd">        `Relaxation.create_subclasses`.</span>
</span><span id="IonicStep-509"><a href="#IonicStep-509"><span class="linenos">509</span></a>
</span><span id="IonicStep-510"><a href="#IonicStep-510"><span class="linenos">510</span></a><span class="sd">        #### Parameters</span>
</span><span id="IonicStep-511"><a href="#IonicStep-511"><span class="linenos">511</span></a>
</span><span id="IonicStep-512"><a href="#IonicStep-512"><span class="linenos">512</span></a><span class="sd">        - `name` :</span>
</span><span id="IonicStep-513"><a href="#IonicStep-513"><span class="linenos">513</span></a><span class="sd">            Name of the subclass that is output.</span>
</span><span id="IonicStep-514"><a href="#IonicStep-514"><span class="linenos">514</span></a><span class="sd">        - `relaxation` :</span>
</span><span id="IonicStep-515"><a href="#IonicStep-515"><span class="linenos">515</span></a><span class="sd">            Relaxation table that these ionic steps should be associated with.</span>
</span><span id="IonicStep-516"><a href="#IonicStep-516"><span class="linenos">516</span></a><span class="sd">        - `module` :</span>
</span><span id="IonicStep-517"><a href="#IonicStep-517"><span class="linenos">517</span></a><span class="sd">            name of the module this subclass should be associated with. Typically,</span>
</span><span id="IonicStep-518"><a href="#IonicStep-518"><span class="linenos">518</span></a><span class="sd">            you should pass __name__ to this.</span>
</span><span id="IonicStep-519"><a href="#IonicStep-519"><span class="linenos">519</span></a><span class="sd">        - `**extra_columns` :</span>
</span><span id="IonicStep-520"><a href="#IonicStep-520"><span class="linenos">520</span></a><span class="sd">            Additional columns to add to the table. The keyword will be the</span>
</span><span id="IonicStep-521"><a href="#IonicStep-521"><span class="linenos">521</span></a><span class="sd">            column name and the value should match django options</span>
</span><span id="IonicStep-522"><a href="#IonicStep-522"><span class="linenos">522</span></a><span class="sd">            (e.g. table_column.FloatField())</span>
</span><span id="IonicStep-523"><a href="#IonicStep-523"><span class="linenos">523</span></a>
</span><span id="IonicStep-524"><a href="#IonicStep-524"><span class="linenos">524</span></a><span class="sd">        Returns</span>
</span><span id="IonicStep-525"><a href="#IonicStep-525"><span class="linenos">525</span></a><span class="sd">        -------</span>
</span><span id="IonicStep-526"><a href="#IonicStep-526"><span class="linenos">526</span></a><span class="sd">        - `NewClass` :</span>
</span><span id="IonicStep-527"><a href="#IonicStep-527"><span class="linenos">527</span></a><span class="sd">            A subclass of IonicStep.</span>
</span><span id="IonicStep-528"><a href="#IonicStep-528"><span class="linenos">528</span></a>
</span><span id="IonicStep-529"><a href="#IonicStep-529"><span class="linenos">529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IonicStep-530"><a href="#IonicStep-530"><span class="linenos">530</span></a>
</span><span id="IonicStep-531"><a href="#IonicStep-531"><span class="linenos">531</span></a>        <span class="c1"># All structures in this table come from relaxation calculations, where</span>
</span><span id="IonicStep-532"><a href="#IonicStep-532"><span class="linenos">532</span></a>        <span class="c1"># there can be many structures (one for each ionic steps) linked to a</span>
</span><span id="IonicStep-533"><a href="#IonicStep-533"><span class="linenos">533</span></a>        <span class="c1"># single relaxation. This means the start structure, end structure, and</span>
</span><span id="IonicStep-534"><a href="#IonicStep-534"><span class="linenos">534</span></a>        <span class="c1"># those structure in-between are stored together here.</span>
</span><span id="IonicStep-535"><a href="#IonicStep-535"><span class="linenos">535</span></a>        <span class="c1"># Therefore, there&#39;s just a simple column stating which relaxation it</span>
</span><span id="IonicStep-536"><a href="#IonicStep-536"><span class="linenos">536</span></a>        <span class="c1"># belongs to.</span>
</span><span id="IonicStep-537"><a href="#IonicStep-537"><span class="linenos">537</span></a>        <span class="n">NewClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
</span><span id="IonicStep-538"><a href="#IonicStep-538"><span class="linenos">538</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">IonicStep&quot;</span><span class="p">,</span>
</span><span id="IonicStep-539"><a href="#IonicStep-539"><span class="linenos">539</span></a>            <span class="n">relaxation</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
</span><span id="IonicStep-540"><a href="#IonicStep-540"><span class="linenos">540</span></a>                <span class="n">relaxation</span><span class="p">,</span>
</span><span id="IonicStep-541"><a href="#IonicStep-541"><span class="linenos">541</span></a>                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
</span><span id="IonicStep-542"><a href="#IonicStep-542"><span class="linenos">542</span></a>                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;structures&quot;</span><span class="p">,</span>
</span><span id="IonicStep-543"><a href="#IonicStep-543"><span class="linenos">543</span></a>            <span class="p">),</span>
</span><span id="IonicStep-544"><a href="#IonicStep-544"><span class="linenos">544</span></a>            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
</span><span id="IonicStep-545"><a href="#IonicStep-545"><span class="linenos">545</span></a>            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="IonicStep-546"><a href="#IonicStep-546"><span class="linenos">546</span></a>        <span class="p">)</span>
</span><span id="IonicStep-547"><a href="#IonicStep-547"><span class="linenos">547</span></a>
</span><span id="IonicStep-548"><a href="#IonicStep-548"><span class="linenos">548</span></a>        <span class="c1"># we now have a new child class and avoided writing some boilerplate code!</span>
</span><span id="IonicStep-549"><a href="#IonicStep-549"><span class="linenos">549</span></a>        <span class="k">return</span> <span class="n">NewClass</span>
</span></pre></div>


            <div class="docstring"><p>This database table that holds the data for each ionic step of a relaxation.</p>

<p>An ionic step can be viewed as a static energy calculation, but we keep these
results separate because:</p>

<pre><code>1. Pulay stress can make these energies/forces inaccurate
2. These results each have an associated Relaxation and ionic step number
</code></pre>

<p>You will likely never access this table directly. Instead, data is better
accessed through the <code>structures</code> attribute on appropiate Relaxation table.</p>

<p>For example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="../../database.html">simmate.database</a></span> <span class="kn">import</span> <span class="n">connect</span>
<span class="kn">from</span> <span class="nn"><a href="../workflow_results.html">simmate.database.workflow_results</a></span> <span class="kn">import</span> <span class="n">MITRelaxation</span>

<span class="c1"># grab your desired relaxation</span>
<span class="n">relax</span> <span class="o">=</span> <span class="n">MITRelaxation</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># grab the associated ionic steps</span>
<span class="n">ionic_steps</span> <span class="o">=</span> <span class="n">relax</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div>

<p>Note: we assume that only converged data is being stored! So there is no
"converged_electronic" column here. ErrorHandlers and workups should
ensure convergence.</p>
</div>


                            <div id="IonicStep.base_info" class="classattr">
                                <div class="attr variable">
            <span class="name">base_info</span><span class="annotation">: List[str]</span><span class="default_value"> = [&#39;number&#39;, &#39;structure_string&#39;, &#39;energy&#39;, &#39;site_forces&#39;, &#39;lattice_stress&#39;]</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.base_info"></a>
    
            <div class="docstring"><p>The base information for this database table and only these fields are stored
when the <code>to_archive</code> method is used. Using the columns in this list, all 
other columns for this table can be calculated, so the columns in this list 
are effectively the "raw data".</p>
</div>


                            </div>
                            <div id="IonicStep.number" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">number</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.number"></a>
    
            <div class="docstring"><p>The ionic step number within the relaxation. This starts counting from 0.</p>
</div>


                            </div>
                            <div id="IonicStep.create_subclass_from_relaxation" class="classattr">
                                        <input id="IonicStep.create_subclass_from_relaxation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">create_subclass_from_relaxation</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">relaxation</span><span class="p">:</span> <span class="n"><a href="#Relaxation">simmate.database.base_data_types.relaxation.Relaxation</a></span>,</span><span class="param">	<span class="n">module</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="o">**</span><span class="n">extra_columns</span></span>)</span>

                <label class="view-source-button" for="IonicStep.create_subclass_from_relaxation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IonicStep.create_subclass_from_relaxation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IonicStep.create_subclass_from_relaxation-495"><a href="#IonicStep.create_subclass_from_relaxation-495"><span class="linenos">495</span></a>    <span class="nd">@classmethod</span>
</span><span id="IonicStep.create_subclass_from_relaxation-496"><a href="#IonicStep.create_subclass_from_relaxation-496"><span class="linenos">496</span></a>    <span class="k">def</span> <span class="nf">create_subclass_from_relaxation</span><span class="p">(</span>
</span><span id="IonicStep.create_subclass_from_relaxation-497"><a href="#IonicStep.create_subclass_from_relaxation-497"><span class="linenos">497</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-498"><a href="#IonicStep.create_subclass_from_relaxation-498"><span class="linenos">498</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-499"><a href="#IonicStep.create_subclass_from_relaxation-499"><span class="linenos">499</span></a>        <span class="n">relaxation</span><span class="p">:</span> <span class="n">Relaxation</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-500"><a href="#IonicStep.create_subclass_from_relaxation-500"><span class="linenos">500</span></a>        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-501"><a href="#IonicStep.create_subclass_from_relaxation-501"><span class="linenos">501</span></a>        <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-502"><a href="#IonicStep.create_subclass_from_relaxation-502"><span class="linenos">502</span></a>    <span class="p">):</span>
</span><span id="IonicStep.create_subclass_from_relaxation-503"><a href="#IonicStep.create_subclass_from_relaxation-503"><span class="linenos">503</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IonicStep.create_subclass_from_relaxation-504"><a href="#IonicStep.create_subclass_from_relaxation-504"><span class="linenos">504</span></a><span class="sd">        Dynamically creates a subclass of IonicStep and links it to the Relaxation</span>
</span><span id="IonicStep.create_subclass_from_relaxation-505"><a href="#IonicStep.create_subclass_from_relaxation-505"><span class="linenos">505</span></a><span class="sd">        table.</span>
</span><span id="IonicStep.create_subclass_from_relaxation-506"><a href="#IonicStep.create_subclass_from_relaxation-506"><span class="linenos">506</span></a>
</span><span id="IonicStep.create_subclass_from_relaxation-507"><a href="#IonicStep.create_subclass_from_relaxation-507"><span class="linenos">507</span></a><span class="sd">        This method should NOT be called directly because it is instead used by</span>
</span><span id="IonicStep.create_subclass_from_relaxation-508"><a href="#IonicStep.create_subclass_from_relaxation-508"><span class="linenos">508</span></a><span class="sd">        `Relaxation.create_subclasses`.</span>
</span><span id="IonicStep.create_subclass_from_relaxation-509"><a href="#IonicStep.create_subclass_from_relaxation-509"><span class="linenos">509</span></a>
</span><span id="IonicStep.create_subclass_from_relaxation-510"><a href="#IonicStep.create_subclass_from_relaxation-510"><span class="linenos">510</span></a><span class="sd">        #### Parameters</span>
</span><span id="IonicStep.create_subclass_from_relaxation-511"><a href="#IonicStep.create_subclass_from_relaxation-511"><span class="linenos">511</span></a>
</span><span id="IonicStep.create_subclass_from_relaxation-512"><a href="#IonicStep.create_subclass_from_relaxation-512"><span class="linenos">512</span></a><span class="sd">        - `name` :</span>
</span><span id="IonicStep.create_subclass_from_relaxation-513"><a href="#IonicStep.create_subclass_from_relaxation-513"><span class="linenos">513</span></a><span class="sd">            Name of the subclass that is output.</span>
</span><span id="IonicStep.create_subclass_from_relaxation-514"><a href="#IonicStep.create_subclass_from_relaxation-514"><span class="linenos">514</span></a><span class="sd">        - `relaxation` :</span>
</span><span id="IonicStep.create_subclass_from_relaxation-515"><a href="#IonicStep.create_subclass_from_relaxation-515"><span class="linenos">515</span></a><span class="sd">            Relaxation table that these ionic steps should be associated with.</span>
</span><span id="IonicStep.create_subclass_from_relaxation-516"><a href="#IonicStep.create_subclass_from_relaxation-516"><span class="linenos">516</span></a><span class="sd">        - `module` :</span>
</span><span id="IonicStep.create_subclass_from_relaxation-517"><a href="#IonicStep.create_subclass_from_relaxation-517"><span class="linenos">517</span></a><span class="sd">            name of the module this subclass should be associated with. Typically,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-518"><a href="#IonicStep.create_subclass_from_relaxation-518"><span class="linenos">518</span></a><span class="sd">            you should pass __name__ to this.</span>
</span><span id="IonicStep.create_subclass_from_relaxation-519"><a href="#IonicStep.create_subclass_from_relaxation-519"><span class="linenos">519</span></a><span class="sd">        - `**extra_columns` :</span>
</span><span id="IonicStep.create_subclass_from_relaxation-520"><a href="#IonicStep.create_subclass_from_relaxation-520"><span class="linenos">520</span></a><span class="sd">            Additional columns to add to the table. The keyword will be the</span>
</span><span id="IonicStep.create_subclass_from_relaxation-521"><a href="#IonicStep.create_subclass_from_relaxation-521"><span class="linenos">521</span></a><span class="sd">            column name and the value should match django options</span>
</span><span id="IonicStep.create_subclass_from_relaxation-522"><a href="#IonicStep.create_subclass_from_relaxation-522"><span class="linenos">522</span></a><span class="sd">            (e.g. table_column.FloatField())</span>
</span><span id="IonicStep.create_subclass_from_relaxation-523"><a href="#IonicStep.create_subclass_from_relaxation-523"><span class="linenos">523</span></a>
</span><span id="IonicStep.create_subclass_from_relaxation-524"><a href="#IonicStep.create_subclass_from_relaxation-524"><span class="linenos">524</span></a><span class="sd">        Returns</span>
</span><span id="IonicStep.create_subclass_from_relaxation-525"><a href="#IonicStep.create_subclass_from_relaxation-525"><span class="linenos">525</span></a><span class="sd">        -------</span>
</span><span id="IonicStep.create_subclass_from_relaxation-526"><a href="#IonicStep.create_subclass_from_relaxation-526"><span class="linenos">526</span></a><span class="sd">        - `NewClass` :</span>
</span><span id="IonicStep.create_subclass_from_relaxation-527"><a href="#IonicStep.create_subclass_from_relaxation-527"><span class="linenos">527</span></a><span class="sd">            A subclass of IonicStep.</span>
</span><span id="IonicStep.create_subclass_from_relaxation-528"><a href="#IonicStep.create_subclass_from_relaxation-528"><span class="linenos">528</span></a>
</span><span id="IonicStep.create_subclass_from_relaxation-529"><a href="#IonicStep.create_subclass_from_relaxation-529"><span class="linenos">529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IonicStep.create_subclass_from_relaxation-530"><a href="#IonicStep.create_subclass_from_relaxation-530"><span class="linenos">530</span></a>
</span><span id="IonicStep.create_subclass_from_relaxation-531"><a href="#IonicStep.create_subclass_from_relaxation-531"><span class="linenos">531</span></a>        <span class="c1"># All structures in this table come from relaxation calculations, where</span>
</span><span id="IonicStep.create_subclass_from_relaxation-532"><a href="#IonicStep.create_subclass_from_relaxation-532"><span class="linenos">532</span></a>        <span class="c1"># there can be many structures (one for each ionic steps) linked to a</span>
</span><span id="IonicStep.create_subclass_from_relaxation-533"><a href="#IonicStep.create_subclass_from_relaxation-533"><span class="linenos">533</span></a>        <span class="c1"># single relaxation. This means the start structure, end structure, and</span>
</span><span id="IonicStep.create_subclass_from_relaxation-534"><a href="#IonicStep.create_subclass_from_relaxation-534"><span class="linenos">534</span></a>        <span class="c1"># those structure in-between are stored together here.</span>
</span><span id="IonicStep.create_subclass_from_relaxation-535"><a href="#IonicStep.create_subclass_from_relaxation-535"><span class="linenos">535</span></a>        <span class="c1"># Therefore, there&#39;s just a simple column stating which relaxation it</span>
</span><span id="IonicStep.create_subclass_from_relaxation-536"><a href="#IonicStep.create_subclass_from_relaxation-536"><span class="linenos">536</span></a>        <span class="c1"># belongs to.</span>
</span><span id="IonicStep.create_subclass_from_relaxation-537"><a href="#IonicStep.create_subclass_from_relaxation-537"><span class="linenos">537</span></a>        <span class="n">NewClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_subclass</span><span class="p">(</span>
</span><span id="IonicStep.create_subclass_from_relaxation-538"><a href="#IonicStep.create_subclass_from_relaxation-538"><span class="linenos">538</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">IonicStep&quot;</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-539"><a href="#IonicStep.create_subclass_from_relaxation-539"><span class="linenos">539</span></a>            <span class="n">relaxation</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
</span><span id="IonicStep.create_subclass_from_relaxation-540"><a href="#IonicStep.create_subclass_from_relaxation-540"><span class="linenos">540</span></a>                <span class="n">relaxation</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-541"><a href="#IonicStep.create_subclass_from_relaxation-541"><span class="linenos">541</span></a>                <span class="n">on_delete</span><span class="o">=</span><span class="n">table_column</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-542"><a href="#IonicStep.create_subclass_from_relaxation-542"><span class="linenos">542</span></a>                <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;structures&quot;</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-543"><a href="#IonicStep.create_subclass_from_relaxation-543"><span class="linenos">543</span></a>            <span class="p">),</span>
</span><span id="IonicStep.create_subclass_from_relaxation-544"><a href="#IonicStep.create_subclass_from_relaxation-544"><span class="linenos">544</span></a>            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-545"><a href="#IonicStep.create_subclass_from_relaxation-545"><span class="linenos">545</span></a>            <span class="o">**</span><span class="n">extra_columns</span><span class="p">,</span>
</span><span id="IonicStep.create_subclass_from_relaxation-546"><a href="#IonicStep.create_subclass_from_relaxation-546"><span class="linenos">546</span></a>        <span class="p">)</span>
</span><span id="IonicStep.create_subclass_from_relaxation-547"><a href="#IonicStep.create_subclass_from_relaxation-547"><span class="linenos">547</span></a>
</span><span id="IonicStep.create_subclass_from_relaxation-548"><a href="#IonicStep.create_subclass_from_relaxation-548"><span class="linenos">548</span></a>        <span class="c1"># we now have a new child class and avoided writing some boilerplate code!</span>
</span><span id="IonicStep.create_subclass_from_relaxation-549"><a href="#IonicStep.create_subclass_from_relaxation-549"><span class="linenos">549</span></a>        <span class="k">return</span> <span class="n">NewClass</span>
</span></pre></div>


            <div class="docstring"><p>Dynamically creates a subclass of IonicStep and links it to the Relaxation
table.</p>

<p>This method should NOT be called directly because it is instead used by
<code><a href="#Relaxation.create_subclasses">Relaxation.create_subclasses</a></code>.</p>

<h4 id="parameters">Parameters</h4>

<ul>
<li><code>name</code> :
Name of the subclass that is output.</li>
<li><code>relaxation</code> :
Relaxation table that these ionic steps should be associated with.</li>
<li><code>module</code> :
name of the module this subclass should be associated with. Typically,
you should pass __name__ to this.</li>
<li><code>**extra_columns</code> :
Additional columns to add to the table. The keyword will be the
column name and the value should match django options
(e.g. table_column.FloatField())</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li><code>NewClass</code> :
A subclass of IonicStep.</li>
</ul>
</div>


                            </div>
                            <div id="IonicStep.structure_string" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">structure_string</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.structure_string"></a>
    
            <div class="docstring"><p>The core structure information, which is written to a string and in a 
compressed format using the <code><a href="#IonicStep.from_toolkit">from_toolkit</a></code> method. To get back to our toolkit
structure object, use the <code><a href="#IonicStep.to_toolkit">to_toolkit</a></code> method.</p>
</div>


                            </div>
                            <div id="IonicStep.nsites" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nsites</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.nsites"></a>
    
            <div class="docstring"><p>The total number of sites in the unitcell. (e.g. Y2CF2 has 5 sites)</p>
</div>


                            </div>
                            <div id="IonicStep.nelements" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nelements</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.nelements"></a>
    
            <div class="docstring"><p>The total number of unique elements. (e.g. Y2CF2 has 3 elements)</p>
</div>


                            </div>
                            <div id="IonicStep.elements" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">elements</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.elements"></a>
    
            <div class="docstring"><p>List of elements in the structure (ex: ["Y", "C", "F"])</p>
</div>


                            </div>
                            <div id="IonicStep.chemical_system" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">chemical_system</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.chemical_system"></a>
    
            <div class="docstring"><p>the base chemical system (ex: "Y-C-F")</p>

<p>Note: be careful when searching for elements! Running chemical_system__contains="C"
on this field won't do what you expect -- because it will return structures
containing Ca, Cs, Ce, Cl, and so on. If you want to search for structures
that contain a specific element, use elements__contains='"C"' instead. The
odd use of quotes '"C"' is required here!</p>
</div>


                            </div>
                            <div id="IonicStep.density" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">density</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.density"></a>
    
            <div class="docstring"><p>The density of the crystal in g/cm^3</p>
</div>


                            </div>
                            <div id="IonicStep.density_atomic" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">density_atomic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.density_atomic"></a>
    
            <div class="docstring"><p>The density of atoms in the crystal in atoms/Angstom^3</p>
</div>


                            </div>
                            <div id="IonicStep.volume" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">volume</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.volume"></a>
    
            <div class="docstring"><p>The volume of the unitcell in Angstom^3</p>

<p>Note: in most cases, <code><a href="#IonicStep.volume_molar">volume_molar</a></code> should be used instead! This is because
volumne is highly dependent on the symmetry and the arbitray unitcell. If 
you are truly after small volumes of the unitcell, it is likely you really 
just want to search by spacegroup.</p>
</div>


                            </div>
                            <div id="IonicStep.volume_molar" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">volume_molar</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.volume_molar"></a>
    
            <div class="docstring"><p>The molar volume of the crystal in cm^3/mol</p>
</div>


                            </div>
                            <div id="IonicStep.formula_full" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">formula_full</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.formula_full"></a>
    
            <div class="docstring"><p>The chemical formula with elements sorted by electronegativity (ex: Li4 Fe4 P4 O16)</p>
</div>


                            </div>
                            <div id="IonicStep.formula_reduced" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">formula_reduced</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.formula_reduced"></a>
    
            <div class="docstring"><p>The reduced chemical formula. (ex: Li4Fe4P4O16 --> LiFePO4)</p>
</div>


                            </div>
                            <div id="IonicStep.formula_anonymous" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">formula_anonymous</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.formula_anonymous"></a>
    
            <div class="docstring"><p>An anonymized formula. Unique species are arranged in ordering of 
amounts and assigned ascending alphabets. Useful for prototyping formulas. 
For example, all stoichiometric perovskites have anonymized_formula ABC3.</p>
</div>


                            </div>
                            <div id="IonicStep.spacegroup" class="classattr">
                                <div class="attr variable">
            <span class="name">spacegroup</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.spacegroup"></a>
    
            <div class="docstring"><p>Spacegroup information. Points to a separate database table that has additional
columns:
<code><a href="symmetry.html#Spacegroup">simmate.database.base_data_types.symmetry.Spacegroup</a></code></p>
</div>


                            </div>
                            <div id="IonicStep.energy" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">energy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.energy"></a>
    
            <div class="docstring"><p>The calculated total energy. Units are in eV.</p>
</div>


                            </div>
                            <div id="IonicStep.energy_per_atom" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">energy_per_atom</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.energy_per_atom"></a>
    
            <div class="docstring"><p>The <code><a href="#IonicStep.energy">energy</a></code> divided by <code><a href="#IonicStep.nsites">nsites</a></code>. Units are in eV.</p>
</div>


                            </div>
                            <div id="IonicStep.energy_above_hull" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">energy_above_hull</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.energy_above_hull"></a>
    
            <div class="docstring"><p>The hull energy (aka "stability") of this structure compared to all other
structures in this database table. Units are in eV.</p>
</div>


                            </div>
                            <div id="IonicStep.is_stable" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_stable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.is_stable"></a>
    
            <div class="docstring"><p>Whether <code><a href="#IonicStep.energy_above_hull">energy_above_hull</a></code> is 0 -- if so, this is considered stable.</p>
</div>


                            </div>
                            <div id="IonicStep.decomposes_to" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decomposes_to</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.decomposes_to"></a>
    
            <div class="docstring"><p>If <code><a href="#IonicStep.energy_above_hull">energy_above_hull</a></code> is above 0, these are the compositions that the 
structure will decompose to (e.g. ["Y2C", "C", "YF3"])</p>
</div>


                            </div>
                            <div id="IonicStep.formation_energy" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">formation_energy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.formation_energy"></a>
    
            <div class="docstring"><p>The formation energy of the structure relative to all other
structures in this database table. Units are in eV.</p>
</div>


                            </div>
                            <div id="IonicStep.formation_energy_per_atom" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">formation_energy_per_atom</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.formation_energy_per_atom"></a>
    
            <div class="docstring"><p>The <code><a href="#IonicStep.formation_energy">formation_energy</a></code> divided by <code><a href="#IonicStep.nsites">nsites</a></code>.</p>
</div>


                            </div>
                            <div id="IonicStep.site_forces" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">site_forces</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.site_forces"></a>
    
            <div class="docstring"><p>A list of forces for each atomic site (eV/AA). So this is a list like...</p>

<pre><code>[site1, site2, site3, ...] 
</code></pre>

<p>... where ...</p>

<pre><code>site1=[force_x, force_y, force_z]
</code></pre>
</div>


                            </div>
                            <div id="IonicStep.lattice_stress" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lattice_stress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.lattice_stress"></a>
    
            <div class="docstring"><p>The is 3x3 matrix that represents stress on the structure lattice</p>
</div>


                            </div>
                            <div id="IonicStep.site_force_norm_max" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">site_force_norm_max</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.site_force_norm_max"></a>
    
            <div class="docstring"><p>Reports the vector norm for the site with the highest forces on it</p>
</div>


                            </div>
                            <div id="IonicStep.site_forces_norm" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">site_forces_norm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.site_forces_norm"></a>
    
            <div class="docstring"><p>Takes the site forces and reports the vector norm for it.</p>

<p>See numpy.linalg.norm for how this is calculated.</p>
</div>


                            </div>
                            <div id="IonicStep.site_forces_norm_per_atom" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">site_forces_norm_per_atom</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.site_forces_norm_per_atom"></a>
    
            <div class="docstring"><p>site_forces_norm divided by nsites</p>
</div>


                            </div>
                            <div id="IonicStep.lattice_stress_norm" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lattice_stress_norm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.lattice_stress_norm"></a>
    
            <div class="docstring"><p>Takes the site forces and reports the vector norm for it.</p>

<p>See numpy.linalg.norm for how this is calculated.</p>
</div>


                            </div>
                            <div id="IonicStep.lattice_stress_norm_per_atom" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lattice_stress_norm_per_atom</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.lattice_stress_norm_per_atom"></a>
    
            <div class="docstring"><p>lattice_stress_norm divided by nsites</p>
</div>


                            </div>
                            <div id="IonicStep.created_at" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">created_at</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.created_at"></a>
    
            <div class="docstring"><p>Timestamp of when this row was first added to the database table</p>
</div>


                            </div>
                            <div id="IonicStep.updated_at" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">updated_at</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.updated_at"></a>
    
            <div class="docstring"><p>Timestamp of when this row was was lasted changed / updated</p>
</div>


                            </div>
                            <div id="IonicStep.source" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">source</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.source"></a>
    
            <div class="docstring"><blockquote>
  <p>Note, this field is highly experimental at the moment and subject to
  change.</p>
</blockquote>

<p>This column indicates where the data came from, and it could be a number 
of things including...</p>

<ul>
<li>a third party id</li>
<li>a structure from a different Simmate datbase table</li>
<li>a transformation of another structure</li>
<li>a creation method</li>
<li>a custom submission by the user</li>
</ul>

<p>By default, this is a JSON field to account for all scenarios, but some
tables (such as those in <code><a href="../third_parties.html">simmate.database.third_parties</a></code>) this is value
should be the same for ALL entries in the table and therefore the column is
overwritten as an attribute.</p>

<p>For other tables where this is not a constant, here are some examples of
values used in this column:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># from a thirdparty database or separate table</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a random structure creator</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PyXtalStructure&quot;</span><span class="p">}</span>

<span class="c1"># from a templated structure creator (e.g. substituition or prototypes)</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PrototypeStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;AFLOWPrototypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;MirrorMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mp-123&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># from a multi-structure transformation</span>
<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;HereditaryMutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;MatProjStructure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mp-123&quot;</span><span class="p">,</span> <span class="s2">&quot;mp-321&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>
</div>


                            </div>
                            <div id="IonicStep.spacegroup_id" class="classattr">
                                <div class="attr variable">
            <span class="name">spacegroup_id</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.spacegroup_id"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>django.db.models.base.Model</dt>
                                <dd id="IonicStep.__init__" class="function">Model</dd>
                <dd id="IonicStep.from_db" class="function">from_db</dd>
                <dd id="IonicStep.pk" class="variable">pk</dd>
                <dd id="IonicStep.get_deferred_fields" class="function">get_deferred_fields</dd>
                <dd id="IonicStep.refresh_from_db" class="function">refresh_from_db</dd>
                <dd id="IonicStep.serializable_value" class="function">serializable_value</dd>
                <dd id="IonicStep.save" class="function">save</dd>
                <dd id="IonicStep.save_base" class="function">save_base</dd>
                <dd id="IonicStep.delete" class="function">delete</dd>
                <dd id="IonicStep.prepare_database_save" class="function">prepare_database_save</dd>
                <dd id="IonicStep.clean" class="function">clean</dd>
                <dd id="IonicStep.validate_unique" class="function">validate_unique</dd>
                <dd id="IonicStep.date_error_message" class="function">date_error_message</dd>
                <dd id="IonicStep.unique_error_message" class="function">unique_error_message</dd>
                <dd id="IonicStep.full_clean" class="function">full_clean</dd>
                <dd id="IonicStep.clean_fields" class="function">clean_fields</dd>
                <dd id="IonicStep.check" class="function">check</dd>

            </div>
            <div><dt><a href="structure.html#Structure">simmate.database.base_data_types.structure.Structure</a></dt>
                                <dd id="IonicStep.to_toolkit" class="function"><a href="structure.html#Structure.to_toolkit">to_toolkit</a></dd>

            </div>
            <div><dt><a href="thermodynamics.html#Thermodynamics">simmate.database.base_data_types.thermodynamics.Thermodynamics</a></dt>
                                <dd id="IonicStep.update_chemical_system_stabilities" class="function"><a href="thermodynamics.html#Thermodynamics.update_chemical_system_stabilities">update_chemical_system_stabilities</a></dd>
                <dd id="IonicStep.update_all_stabilities" class="function"><a href="thermodynamics.html#Thermodynamics.update_all_stabilities">update_all_stabilities</a></dd>

            </div>
            <div><dt><a href="base.html#DatabaseTable">simmate.database.base_data_types.base.DatabaseTable</a></dt>
                                <dd id="IonicStep.source_doi" class="variable"><a href="base.html#DatabaseTable.source_doi">source_doi</a></dd>
                <dd id="IonicStep.remote_archive_link" class="variable"><a href="base.html#DatabaseTable.remote_archive_link">remote_archive_link</a></dd>
                <dd id="IonicStep.objects" class="function"><a href="base.html#DatabaseTable.objects">objects</a></dd>
                <dd id="IonicStep.get_table_name" class="function"><a href="base.html#DatabaseTable.get_table_name">get_table_name</a></dd>
                <dd id="IonicStep.create_subclass" class="function"><a href="base.html#DatabaseTable.create_subclass">create_subclass</a></dd>
                <dd id="IonicStep.from_toolkit" class="function"><a href="base.html#DatabaseTable.from_toolkit">from_toolkit</a></dd>
                <dd id="IonicStep.load_archive" class="function"><a href="base.html#DatabaseTable.load_archive">load_archive</a></dd>
                <dd id="IonicStep.load_remote_archive" class="function"><a href="base.html#DatabaseTable.load_remote_archive">load_remote_archive</a></dd>
                <dd id="IonicStep.get_column_names" class="function"><a href="base.html#DatabaseTable.get_column_names">get_column_names</a></dd>
                <dd id="IonicStep.show_columns" class="function"><a href="base.html#DatabaseTable.show_columns">show_columns</a></dd>
                <dd id="IonicStep.get_mixins" class="function"><a href="base.html#DatabaseTable.get_mixins">get_mixins</a></dd>
                <dd id="IonicStep.get_mixin_names" class="function"><a href="base.html#DatabaseTable.get_mixin_names">get_mixin_names</a></dd>
                <dd id="IonicStep.get_extra_columns" class="function"><a href="base.html#DatabaseTable.get_extra_columns">get_extra_columns</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="IonicStep.Meta">
                            <input id="IonicStep.Meta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IonicStep.Meta</span>:

                <label class="view-source-button" for="IonicStep.Meta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IonicStep.Meta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IonicStep.Meta-473"><a href="#IonicStep.Meta-473"><span class="linenos">473</span></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span id="IonicStep.Meta-474"><a href="#IonicStep.Meta-474"><span class="linenos">474</span></a>        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="IonicStep.Meta-475"><a href="#IonicStep.Meta-475"><span class="linenos">475</span></a>        <span class="n">app_label</span> <span class="o">=</span> <span class="s2">&quot;workflows&quot;</span>
</span></pre></div>


    

                            <div id="IonicStep.Meta.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">IonicStep.Meta</span><span class="signature pdoc-code condensed">()</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.Meta.__init__"></a>
    
    

                            </div>
                            <div id="IonicStep.Meta.abstract" class="classattr">
                                <div class="attr variable">
            <span class="name">abstract</span><span class="default_value"> = False</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.Meta.abstract"></a>
    
    

                            </div>
                            <div id="IonicStep.Meta.app_label" class="classattr">
                                <div class="attr variable">
            <span class="name">app_label</span><span class="default_value"> = &#39;workflows&#39;</span>

        
    </div>
    <a class="headerlink" href="#IonicStep.Meta.app_label"></a>
    
    

                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>