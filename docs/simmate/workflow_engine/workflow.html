<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.2"/>
    <title>simmate.workflow_engine.workflow API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../workflow_engine.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simmate.workflow_engine</a>

<a href="https://github.com/jacksund/simmate">            <img src="https://github.com/jacksund/simmate/blob/main/src/simmate/website/static_files/images/simmate-logo.svg?raw=true" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#Workflow">Workflow</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Workflow.result_task">result_task</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.project_name">project_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.s3task">s3task</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.database_table">database_table</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.description_doc_short">description_doc_short</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.register_kwargs">register_kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.name_short">name_short</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.description_doc">description_doc</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.parameter_names">parameter_names</a>
                        </li>
                        <li>
                                <a class="function" href="#Workflow.show_parameters">show_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#Workflow.run_cloud">run_cloud</a>
                        </li>
                        <li>
                                <a class="function" href="#Workflow.wait_for_flow_run">wait_for_flow_run</a>
                        </li>
                        <li>
                                <a class="variable" href="#Workflow.nflows_submitted">nflows_submitted</a>
                        </li>
                        <li>
                                <a class="function" href="#Workflow.to_workflow_task">to_workflow_task</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/workflow_engine/workflow.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../simmate.html">simmate</a><wbr>.<a href="./../workflow_engine.html">workflow_engine</a><wbr>.workflow    </h1>

                
                        <input id="workflow-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="workflow-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">cloudpickle</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">yaml</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1"># note: extra modules are imported from prefect for convenience imports elsewhere</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">prefect</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">prefect</span> <span class="kn">import</span> <span class="n">Client</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">prefect</span> <span class="kn">import</span> <span class="n">Flow</span> <span class="k">as</span> <span class="n">PrefectFlow</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">Task</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">prefect.storage</span> <span class="kn">import</span> <span class="n">Module</span> <span class="k">as</span> <span class="n">ModuleStorage</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">prefect.utilities.graphql</span> <span class="kn">import</span> <span class="n">with_args</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">prefect.backend</span> <span class="kn">import</span> <span class="n">FlowRunView</span><span class="p">,</span> <span class="n">FlowView</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1"># This import below is used to grab `watch_flow_run`, but we don&#39;t grab it directly</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="c1"># in order to support &quot;mocking&quot; this function in unit tests</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span> <span class="nn">prefect.backend</span> <span class="kn">import</span> <span class="n">flow_run</span> <span class="k">as</span> <span class="n">flow_run_module</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span> <span class="nn">simmate.database.base_data_types</span> <span class="kn">import</span> <span class="n">Calculation</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span> <span class="nn">simmate.workflow_engine</span> <span class="kn">import</span> <span class="n">S3Task</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="k">class</span> <span class="nc">Workflow</span><span class="p">(</span><span class="n">PrefectFlow</span><span class="p">):</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    This class behaves exactly like a normal Prefect workflow, where we add some</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    common utilities and pre-submit tasks. For example, there is the `run_cloud`</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    method, which allows us to register a calculation to a database table before</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    we submit the workflow to Prefect Cloud.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    To learn how to use this class, see</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    [prefect.core.flow.Flow](https://docs.prefect.io/api/latest/core/flow.html#flow-2)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="n">result_task</span><span class="p">:</span> <span class="n">Task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    In many ETL workflows, we may also want the result of the some terminating</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    task directly. This would save us from having to go find the result in</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    the database. So by setting `result_task`, we are able get access a specific task&#39;s</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    result -- directly as a python object(s). This is optional.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    The name of the project in Prefect Cloud that this workflow is associated with. This </span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    attribute is mainly just for organizing workflows in the web interface.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    <span class="n">s3task</span><span class="p">:</span> <span class="n">S3Task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    The supervised-staged-shell task (or S3Task) that this workflow uses to run.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    For understanding what the calculation does and the settings it uses, users</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    should start here. You can also use a workflows `s3task.run` to run the workflow</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    without storing results in the database.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="n">database_table</span><span class="p">:</span> <span class="n">Calculation</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    The database table where calculation information (such as the prefect_flow_run_id)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    is stored. The table should use `simmate.database.base_data_types.Calculation`</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    </span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    In many cases, this table will contain all of the results you need. However,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    pay special attention to NestedWorkflows, where your results are often tied</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    to a final task.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">description_doc_short</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    A quick description for this workflow. This will be shown in the website UI</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">    in the list-view of all different workflow presets.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="n">register_kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    (experimental feature)</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    A list of input parameters that should be used to register the calculation.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="nd">@property</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        Gives the workflow type of this workflow. For example the workflow named</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        &#39;static-energy/matproj&#39; would have the type `static-energy`.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="nd">@property</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">name_short</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        Gives the present name of the workflow. For example the workflow named</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        &#39;static-energy/matproj&#39; would have the shortname `matproj`</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="c1"># BUG: naming this `description` causes issues.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="c1"># See https://github.com/PrefectHQ/prefect/issues/3911</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    <span class="nd">@property</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">description_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        This simply returns the documentation string of this workflow -- so this</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        is the same as `__doc__`. This attribute is only defined for beginners</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        to python and for use in django templates for the website interface.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="nd">@property</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">parameter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        Prints a list of all the parameter names for this workflow.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="c1"># Iterate through and grab the columns. Note we don&#39;t use get_column_names</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="c1"># here because we are attaching relation data as well. We also</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="c1"># sort them alphabetically for consistent results.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">parameter</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">()]</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="n">parameter_names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="n">parameter_names</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">show_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        Prints a list of all the parameter names for this workflow.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="c1"># use yaml to make the printout pretty (no quotes and separate lines)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_names</span><span class="p">))</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">run_cloud</span><span class="p">(</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="n">wait_for_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        This schedules the workflow to run remotely on Prefect Cloud.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        #### Parameters</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        - `labels`:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">            a list of labels to schedule the workflow with</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        - `wait_for_run`:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">            whether to wait for the workflow to finish. If False, the workflow</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">            will simply be submitted and then exit. The default is True.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        - `**kwargs`:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">            all options that are normally passed to the workflow.run() method</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        #### Returns</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        - The flow run id that was used in prefect cloud.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        #### Usage</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        Make sure you have Prefect properly configured and have registered your</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        workflow with the backend.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        Note that this method can be viewed as a fork of:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">            - from prefect.tasks.prefect.flow_run import create_flow_run</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        It can also be viewed as a more convenient way to call to client.create_flow_run.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        I don&#39;t accept any other client.create_flow_run() inputs besides &#39;labels&#39;.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        This may change in the future if I need to set flow run names or schedules.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="c1"># Grab the logger as we will print useful information below.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="c1"># In some cases, there is no logger present, so we just set logger=None.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="c1"># This possibility is why we use `if logger else None` statements below.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">prefect</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s2">&quot;logger&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="c1"># Grab the Flow&#39;s ID from Prefect Cloud</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Looking up flow metadata...&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">logger</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="n">flow_view</span> <span class="o">=</span> <span class="n">FlowView</span><span class="o">.</span><span class="n">from_flow_name</span><span class="p">(</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="n">project_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="p">)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="c1"># Prefect does not properly deserialize objects that have</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="c1"># as as_dict or to_dict method, so we use a custom method to do that here</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="n">parameters_serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="c1"># BUG: What if we are submitting using a filename? We don&#39;t want to</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="c1"># submit to a cluster and have the job fail because it doesn&#39;t have</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="c1"># access to the file. One solution could be to deserialize right before</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="c1"># serializing in the next line in order to ensure parameters that</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="c1"># accept file names are submitted with all necessary data.</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="c1"># Now we submit the workflow</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating flow run for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">logger</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="n">flow_run_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_flow_run</span><span class="p">(</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="n">flow_id</span><span class="o">=</span><span class="n">flow_view</span><span class="o">.</span><span class="n">flow_id</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters_serialized</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="c1"># we log the website url to the flow for the user</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="n">run_url</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_cloud_url</span><span class="p">(</span><span class="s2">&quot;flow-run&quot;</span><span class="p">,</span> <span class="n">flow_run_id</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created flow run: </span><span class="si">{</span><span class="n">run_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">logger</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="c1"># -----------------------------------</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="c1"># This part is unique to Simmate. Because we often want to save some info</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="c1"># to our database even before the calculation starts/finishes, we do that</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="c1"># here. An example is storing the structure and prefect id that we just</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="c1"># submitted.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="c1"># BUG: Will there be a race condition here? What if the workflow finishes</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="c1"># and tries writing to the databse before this is done?</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="n">parameters_cleaned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register_calculation</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">,</span> <span class="n">parameters_cleaned</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="c1"># -----------------------------------</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="c1"># if we want to wait until the job is complete, we do that here</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="n">wait_for_run</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="n">flow_run_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_flow_run</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="c1"># return flow_run_view # !!! Should I return this instead?</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="c1"># return the flow_run_id for the user</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="k">return</span> <span class="n">flow_run_id</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="k">def</span> <span class="nf">wait_for_flow_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow_run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        Waits for a given flow run to complete</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">        This method is a direct fork of...</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">            from prefect.tasks.prefect.flow_run import wait_for_flow_run</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        It does exactly the same thing where I just assume I want to stream logs.</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="n">flow_run</span> <span class="o">=</span> <span class="n">FlowRunView</span><span class="o">.</span><span class="n">from_flow_run_id</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">flow_run_module</span><span class="o">.</span><span class="n">watch_flow_run</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">):</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Flow </span><span class="si">{</span><span class="n">flow_run</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="n">prefect</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="c1"># Return the final view of the flow run</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="k">return</span> <span class="n">flow_run</span><span class="o">.</span><span class="n">get_latest</span><span class="p">()</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>    <span class="k">def</span> <span class="nf">_register_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefect_flow_run_id</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        If the workflow is linked to a calculation table in the Simmate database,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        this adds the flow run to the database.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        Parameters passed should be deserialized and cleaned.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        This method should not be called directly as it is used within the</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        `run_cloud` method and `load_input_and_register` task.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="c1"># grab the registration kwargs from the parameters provided</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">register_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="n">key</span><span class="p">:</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_kwargs</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="p">}</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="c1"># SPECIAL CASE: for customized workflows we need to convert the inputs</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="c1"># back to json before saving to the database.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="s2">&quot;workflow_base&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="n">parameters_serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="n">calculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_table</span><span class="o">.</span><span class="n">from_prefect_id</span><span class="p">(</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="o">**</span><span class="n">parameters_serialized</span><span class="p">,</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="c1"># load/create the calculation for this workflow run</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">calculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_table</span><span class="o">.</span><span class="n">from_prefect_id</span><span class="p">(</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>                <span class="o">**</span><span class="n">register_kwargs</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>    <span class="k">def</span> <span class="nf">_serialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        Converts input parameters to json-sealiziable objects that Prefect can</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        use.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">        This method should not be called directly as it is used within the</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        run_cloud() method.</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="c1"># TODO: consider moving this into prefect&#39;s core code as a contribution.</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="c1"># Because many flows allow object-type inputs (such as structure object),</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="c1"># we need to serialize these inputs before scheduling them with prefect</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="c1"># cloud. To do this, I only check for two potential methods:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="c1">#     as_dict</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="c1">#     to_dict</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="c1"># These were chosen based on common pymatgen methods, but I may change</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="c1"># this in the future. As another alternative, I could also cloudpickle</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="c1"># input objects when they are not JSON serializable.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="c1"># OPTIMIZE: Prefect current tries to JSON serialize within their</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="c1"># client.create_flow_run method. In the future, we may want to move</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="c1"># this functionality there.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">parameters_serialized</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">for</span> <span class="n">parameter_key</span><span class="p">,</span> <span class="n">parameter_value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">,</span> <span class="s2">&quot;as_dict&quot;</span><span class="p">):</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">parameter_value</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">,</span> <span class="s2">&quot;to_dict&quot;</span><span class="p">):</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">parameter_value</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>                <span class="c1"># workflow_base and input_parameters are special cases that</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>                <span class="c1"># may require a refactor (for customized workflows)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>                <span class="k">elif</span> <span class="n">parameter_key</span> <span class="o">==</span> <span class="s2">&quot;workflow_base&quot;</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">parameter_value</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                <span class="k">elif</span> <span class="n">parameter_key</span> <span class="o">==</span> <span class="s2">&quot;input_parameters&quot;</span><span class="p">:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                    <span class="c1"># recursive call to this function</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_serialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">parameter_value</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">cloudpickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="n">parameters_serialized</span><span class="p">[</span><span class="n">parameter_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter_value</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="n">parameters_serialized</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="nf">_deserialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        converts all parameters to appropriate python objects</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="c1"># we don&#39;t want to pass arguments like command=None or structure=None if the</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="c1"># user didn&#39;t provide this input parameter. Instead, we want the workflow to</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="c1"># use its own default value. To do this, we first check if the parameter</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="c1"># is set in our kwargs dictionary and making sure the value is NOT None.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="c1"># If it is None, then we remove it from our final list of kwargs. This</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="c1"># is only done for command, directory, and structure inputs -- as these</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="c1"># are the three that are typically assumed to be present (see the CLI).</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="kn">from</span> <span class="nn">simmate.toolkit.diffusion</span> <span class="kn">import</span> <span class="n">MigrationHop</span><span class="p">,</span> <span class="n">MigrationImages</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">parameters_cleaned</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="c1">#######</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="c1"># SPECIAL CASE: customized workflows have their parameters stored under</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="c1"># &quot;input_parameters&quot; instead of the base dict</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="c1"># THIS INVOLVES A RECURSIVE CALL TO THIS SAME METHOD</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="s2">&quot;workflow_base&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>            <span class="c1"># This is a non-modular import that can cause issues and slower</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="c1"># run times. We therefore import lazily.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>            <span class="kn">from</span> <span class="nn">simmate.workflows.utilities</span> <span class="kn">import</span> <span class="n">get_workflow</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;workflow_base&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_workflow</span><span class="p">(</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;workflow_base&quot;</span><span class="p">]</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;input_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_deserialize_parameters</span><span class="p">(</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                <span class="o">**</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;input_parameters&quot;</span><span class="p">]</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="k">return</span> <span class="n">parameters_cleaned</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="c1">#######</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="n">parameters_cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="n">parameters_cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="n">structure</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="k">if</span> <span class="n">structure</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="n">parameters_cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="s2">&quot;structures&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="n">structure_filenames</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;structures&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;structures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                <span class="n">Structure</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">structure_filenames</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>            <span class="p">]</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="s2">&quot;migration_hop&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="n">migration_hop</span> <span class="o">=</span> <span class="n">MigrationHop</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">])</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">migration_hop</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="k">if</span> <span class="s2">&quot;migration_images&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>            <span class="n">migration_images</span> <span class="o">=</span> <span class="n">MigrationImages</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;migration_images&quot;</span><span class="p">]</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>            <span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;migration_images&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">migration_images</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="k">if</span> <span class="s2">&quot;supercell_start&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;supercell_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;supercell_start&quot;</span><span class="p">]</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>            <span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="k">if</span> <span class="s2">&quot;supercell_end&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;supercell_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;supercell_end&quot;</span><span class="p">]</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="k">return</span> <span class="n">parameters_cleaned</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>    <span class="nd">@property</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>    <span class="k">def</span> <span class="nf">nflows_submitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        Queries Prefect to see how many workflows are in a running or submitted</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        state. It will return a count (integer).</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        Note, your workflow must be registered with Prefect for this to work.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>                <span class="n">with_args</span><span class="p">(</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>                    <span class="s2">&quot;flow_run_aggregate&quot;</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                    <span class="p">{</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>                        <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>                            <span class="s2">&quot;flow&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_eq&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">}},</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_in&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Running&quot;</span><span class="p">,</span> <span class="s2">&quot;Scheduled&quot;</span><span class="p">]},</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                        <span class="p">},</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                    <span class="p">},</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>                <span class="p">):</span> <span class="p">{</span><span class="s2">&quot;aggregate&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">}}</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="p">}</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="p">}</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">graphql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;flow_run_aggregate&quot;</span><span class="p">][</span><span class="s2">&quot;aggregate&quot;</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>    <span class="k">def</span> <span class="nf">to_workflow_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        Converts a prefect workflow to a prefect task (aka a &quot;workflow task&quot;)</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">        See the documentation in workflow_engine.tasks.workflow_task for more.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="kn">from</span> <span class="nn">simmate.workflow_engine</span> <span class="kn">import</span> <span class="n">WorkflowTask</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        <span class="k">return</span> <span class="n">WorkflowTask</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>    <span class="c1"># @classmethod</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>    <span class="c1"># def get_all_ids_in_state(cls, states=[&quot;Completed&quot;, &quot;Scheduled&quot;]):</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="c1">#     # TODO: This is an example query where I grab all ids. This may be useful in the</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>    <span class="c1">#     # future.</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>    <span class="c1">#     query = {</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>    <span class="c1">#         &quot;query&quot;: {</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>    <span class="c1">#             with_args(</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>    <span class="c1">#                 &quot;flow_run&quot;,</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>    <span class="c1">#                 {</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="c1">#                     &quot;where&quot;: {</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>    <span class="c1">#                         &quot;flow&quot;: {&quot;name&quot;: {&quot;_eq&quot;: cls.name}},</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>    <span class="c1">#                         &quot;state&quot;: {&quot;_in&quot;: states},</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>    <span class="c1">#                     },</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>    <span class="c1">#                 },</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>    <span class="c1">#             ): [&quot;id&quot;]</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>    <span class="c1">#         }</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    <span class="c1">#     }</span>
</span></pre></div>


            </section>
                <section id="Workflow">
                            <input id="Workflow-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Workflow</span><wbr>(<span class="base">prefect.core.flow.Flow</span>):

                <label class="view-source-button" for="Workflow-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Workflow"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Workflow-25"><a href="#Workflow-25"><span class="linenos"> 25</span></a><span class="k">class</span> <span class="nc">Workflow</span><span class="p">(</span><span class="n">PrefectFlow</span><span class="p">):</span>
</span><span id="Workflow-26"><a href="#Workflow-26"><span class="linenos"> 26</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-27"><a href="#Workflow-27"><span class="linenos"> 27</span></a><span class="sd">    This class behaves exactly like a normal Prefect workflow, where we add some</span>
</span><span id="Workflow-28"><a href="#Workflow-28"><span class="linenos"> 28</span></a><span class="sd">    common utilities and pre-submit tasks. For example, there is the `run_cloud`</span>
</span><span id="Workflow-29"><a href="#Workflow-29"><span class="linenos"> 29</span></a><span class="sd">    method, which allows us to register a calculation to a database table before</span>
</span><span id="Workflow-30"><a href="#Workflow-30"><span class="linenos"> 30</span></a><span class="sd">    we submit the workflow to Prefect Cloud.</span>
</span><span id="Workflow-31"><a href="#Workflow-31"><span class="linenos"> 31</span></a>
</span><span id="Workflow-32"><a href="#Workflow-32"><span class="linenos"> 32</span></a><span class="sd">    To learn how to use this class, see</span>
</span><span id="Workflow-33"><a href="#Workflow-33"><span class="linenos"> 33</span></a><span class="sd">    [prefect.core.flow.Flow](https://docs.prefect.io/api/latest/core/flow.html#flow-2)</span>
</span><span id="Workflow-34"><a href="#Workflow-34"><span class="linenos"> 34</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Workflow-35"><a href="#Workflow-35"><span class="linenos"> 35</span></a>
</span><span id="Workflow-36"><a href="#Workflow-36"><span class="linenos"> 36</span></a>    <span class="n">result_task</span><span class="p">:</span> <span class="n">Task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Workflow-37"><a href="#Workflow-37"><span class="linenos"> 37</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-38"><a href="#Workflow-38"><span class="linenos"> 38</span></a><span class="sd">    In many ETL workflows, we may also want the result of the some terminating</span>
</span><span id="Workflow-39"><a href="#Workflow-39"><span class="linenos"> 39</span></a><span class="sd">    task directly. This would save us from having to go find the result in</span>
</span><span id="Workflow-40"><a href="#Workflow-40"><span class="linenos"> 40</span></a><span class="sd">    the database. So by setting `result_task`, we are able get access a specific task&#39;s</span>
</span><span id="Workflow-41"><a href="#Workflow-41"><span class="linenos"> 41</span></a><span class="sd">    result -- directly as a python object(s). This is optional.</span>
</span><span id="Workflow-42"><a href="#Workflow-42"><span class="linenos"> 42</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Workflow-43"><a href="#Workflow-43"><span class="linenos"> 43</span></a>
</span><span id="Workflow-44"><a href="#Workflow-44"><span class="linenos"> 44</span></a>    <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Workflow-45"><a href="#Workflow-45"><span class="linenos"> 45</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-46"><a href="#Workflow-46"><span class="linenos"> 46</span></a><span class="sd">    The name of the project in Prefect Cloud that this workflow is associated with. This </span>
</span><span id="Workflow-47"><a href="#Workflow-47"><span class="linenos"> 47</span></a><span class="sd">    attribute is mainly just for organizing workflows in the web interface.</span>
</span><span id="Workflow-48"><a href="#Workflow-48"><span class="linenos"> 48</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Workflow-49"><a href="#Workflow-49"><span class="linenos"> 49</span></a>
</span><span id="Workflow-50"><a href="#Workflow-50"><span class="linenos"> 50</span></a>    <span class="n">s3task</span><span class="p">:</span> <span class="n">S3Task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Workflow-51"><a href="#Workflow-51"><span class="linenos"> 51</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-52"><a href="#Workflow-52"><span class="linenos"> 52</span></a><span class="sd">    The supervised-staged-shell task (or S3Task) that this workflow uses to run.</span>
</span><span id="Workflow-53"><a href="#Workflow-53"><span class="linenos"> 53</span></a><span class="sd">    For understanding what the calculation does and the settings it uses, users</span>
</span><span id="Workflow-54"><a href="#Workflow-54"><span class="linenos"> 54</span></a><span class="sd">    should start here. You can also use a workflows `s3task.run` to run the workflow</span>
</span><span id="Workflow-55"><a href="#Workflow-55"><span class="linenos"> 55</span></a><span class="sd">    without storing results in the database.</span>
</span><span id="Workflow-56"><a href="#Workflow-56"><span class="linenos"> 56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Workflow-57"><a href="#Workflow-57"><span class="linenos"> 57</span></a>
</span><span id="Workflow-58"><a href="#Workflow-58"><span class="linenos"> 58</span></a>    <span class="n">database_table</span><span class="p">:</span> <span class="n">Calculation</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Workflow-59"><a href="#Workflow-59"><span class="linenos"> 59</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-60"><a href="#Workflow-60"><span class="linenos"> 60</span></a><span class="sd">    The database table where calculation information (such as the prefect_flow_run_id)</span>
</span><span id="Workflow-61"><a href="#Workflow-61"><span class="linenos"> 61</span></a><span class="sd">    is stored. The table should use `simmate.database.base_data_types.Calculation`</span>
</span><span id="Workflow-62"><a href="#Workflow-62"><span class="linenos"> 62</span></a><span class="sd">    </span>
</span><span id="Workflow-63"><a href="#Workflow-63"><span class="linenos"> 63</span></a><span class="sd">    In many cases, this table will contain all of the results you need. However,</span>
</span><span id="Workflow-64"><a href="#Workflow-64"><span class="linenos"> 64</span></a><span class="sd">    pay special attention to NestedWorkflows, where your results are often tied</span>
</span><span id="Workflow-65"><a href="#Workflow-65"><span class="linenos"> 65</span></a><span class="sd">    to a final task.</span>
</span><span id="Workflow-66"><a href="#Workflow-66"><span class="linenos"> 66</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Workflow-67"><a href="#Workflow-67"><span class="linenos"> 67</span></a>
</span><span id="Workflow-68"><a href="#Workflow-68"><span class="linenos"> 68</span></a>    <span class="n">description_doc_short</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Workflow-69"><a href="#Workflow-69"><span class="linenos"> 69</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-70"><a href="#Workflow-70"><span class="linenos"> 70</span></a><span class="sd">    A quick description for this workflow. This will be shown in the website UI</span>
</span><span id="Workflow-71"><a href="#Workflow-71"><span class="linenos"> 71</span></a><span class="sd">    in the list-view of all different workflow presets.</span>
</span><span id="Workflow-72"><a href="#Workflow-72"><span class="linenos"> 72</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Workflow-73"><a href="#Workflow-73"><span class="linenos"> 73</span></a>
</span><span id="Workflow-74"><a href="#Workflow-74"><span class="linenos"> 74</span></a>    <span class="n">register_kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Workflow-75"><a href="#Workflow-75"><span class="linenos"> 75</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-76"><a href="#Workflow-76"><span class="linenos"> 76</span></a><span class="sd">    (experimental feature)</span>
</span><span id="Workflow-77"><a href="#Workflow-77"><span class="linenos"> 77</span></a><span class="sd">    A list of input parameters that should be used to register the calculation.</span>
</span><span id="Workflow-78"><a href="#Workflow-78"><span class="linenos"> 78</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Workflow-79"><a href="#Workflow-79"><span class="linenos"> 79</span></a>
</span><span id="Workflow-80"><a href="#Workflow-80"><span class="linenos"> 80</span></a>    <span class="nd">@property</span>
</span><span id="Workflow-81"><a href="#Workflow-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Workflow-82"><a href="#Workflow-82"><span class="linenos"> 82</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-83"><a href="#Workflow-83"><span class="linenos"> 83</span></a><span class="sd">        Gives the workflow type of this workflow. For example the workflow named</span>
</span><span id="Workflow-84"><a href="#Workflow-84"><span class="linenos"> 84</span></a><span class="sd">        &#39;static-energy/matproj&#39; would have the type `static-energy`.</span>
</span><span id="Workflow-85"><a href="#Workflow-85"><span class="linenos"> 85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-86"><a href="#Workflow-86"><span class="linenos"> 86</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Workflow-87"><a href="#Workflow-87"><span class="linenos"> 87</span></a>
</span><span id="Workflow-88"><a href="#Workflow-88"><span class="linenos"> 88</span></a>    <span class="nd">@property</span>
</span><span id="Workflow-89"><a href="#Workflow-89"><span class="linenos"> 89</span></a>    <span class="k">def</span> <span class="nf">name_short</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Workflow-90"><a href="#Workflow-90"><span class="linenos"> 90</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-91"><a href="#Workflow-91"><span class="linenos"> 91</span></a><span class="sd">        Gives the present name of the workflow. For example the workflow named</span>
</span><span id="Workflow-92"><a href="#Workflow-92"><span class="linenos"> 92</span></a><span class="sd">        &#39;static-energy/matproj&#39; would have the shortname `matproj`</span>
</span><span id="Workflow-93"><a href="#Workflow-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-94"><a href="#Workflow-94"><span class="linenos"> 94</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Workflow-95"><a href="#Workflow-95"><span class="linenos"> 95</span></a>
</span><span id="Workflow-96"><a href="#Workflow-96"><span class="linenos"> 96</span></a>    <span class="c1"># BUG: naming this `description` causes issues.</span>
</span><span id="Workflow-97"><a href="#Workflow-97"><span class="linenos"> 97</span></a>    <span class="c1"># See https://github.com/PrefectHQ/prefect/issues/3911</span>
</span><span id="Workflow-98"><a href="#Workflow-98"><span class="linenos"> 98</span></a>    <span class="nd">@property</span>
</span><span id="Workflow-99"><a href="#Workflow-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">description_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Workflow-100"><a href="#Workflow-100"><span class="linenos">100</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-101"><a href="#Workflow-101"><span class="linenos">101</span></a><span class="sd">        This simply returns the documentation string of this workflow -- so this</span>
</span><span id="Workflow-102"><a href="#Workflow-102"><span class="linenos">102</span></a><span class="sd">        is the same as `__doc__`. This attribute is only defined for beginners</span>
</span><span id="Workflow-103"><a href="#Workflow-103"><span class="linenos">103</span></a><span class="sd">        to python and for use in django templates for the website interface.</span>
</span><span id="Workflow-104"><a href="#Workflow-104"><span class="linenos">104</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-105"><a href="#Workflow-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="Workflow-106"><a href="#Workflow-106"><span class="linenos">106</span></a>
</span><span id="Workflow-107"><a href="#Workflow-107"><span class="linenos">107</span></a>    <span class="nd">@property</span>
</span><span id="Workflow-108"><a href="#Workflow-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="nf">parameter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Workflow-109"><a href="#Workflow-109"><span class="linenos">109</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-110"><a href="#Workflow-110"><span class="linenos">110</span></a><span class="sd">        Prints a list of all the parameter names for this workflow.</span>
</span><span id="Workflow-111"><a href="#Workflow-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-112"><a href="#Workflow-112"><span class="linenos">112</span></a>        <span class="c1"># Iterate through and grab the columns. Note we don&#39;t use get_column_names</span>
</span><span id="Workflow-113"><a href="#Workflow-113"><span class="linenos">113</span></a>        <span class="c1"># here because we are attaching relation data as well. We also</span>
</span><span id="Workflow-114"><a href="#Workflow-114"><span class="linenos">114</span></a>        <span class="c1"># sort them alphabetically for consistent results.</span>
</span><span id="Workflow-115"><a href="#Workflow-115"><span class="linenos">115</span></a>        <span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">parameter</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">()]</span>
</span><span id="Workflow-116"><a href="#Workflow-116"><span class="linenos">116</span></a>        <span class="n">parameter_names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="Workflow-117"><a href="#Workflow-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="n">parameter_names</span>
</span><span id="Workflow-118"><a href="#Workflow-118"><span class="linenos">118</span></a>
</span><span id="Workflow-119"><a href="#Workflow-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">show_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Workflow-120"><a href="#Workflow-120"><span class="linenos">120</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-121"><a href="#Workflow-121"><span class="linenos">121</span></a><span class="sd">        Prints a list of all the parameter names for this workflow.</span>
</span><span id="Workflow-122"><a href="#Workflow-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-123"><a href="#Workflow-123"><span class="linenos">123</span></a>        <span class="c1"># use yaml to make the printout pretty (no quotes and separate lines)</span>
</span><span id="Workflow-124"><a href="#Workflow-124"><span class="linenos">124</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_names</span><span class="p">))</span>
</span><span id="Workflow-125"><a href="#Workflow-125"><span class="linenos">125</span></a>
</span><span id="Workflow-126"><a href="#Workflow-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">run_cloud</span><span class="p">(</span>
</span><span id="Workflow-127"><a href="#Workflow-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Workflow-128"><a href="#Workflow-128"><span class="linenos">128</span></a>        <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="Workflow-129"><a href="#Workflow-129"><span class="linenos">129</span></a>        <span class="n">wait_for_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Workflow-130"><a href="#Workflow-130"><span class="linenos">130</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="Workflow-131"><a href="#Workflow-131"><span class="linenos">131</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Workflow-132"><a href="#Workflow-132"><span class="linenos">132</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-133"><a href="#Workflow-133"><span class="linenos">133</span></a><span class="sd">        This schedules the workflow to run remotely on Prefect Cloud.</span>
</span><span id="Workflow-134"><a href="#Workflow-134"><span class="linenos">134</span></a>
</span><span id="Workflow-135"><a href="#Workflow-135"><span class="linenos">135</span></a><span class="sd">        #### Parameters</span>
</span><span id="Workflow-136"><a href="#Workflow-136"><span class="linenos">136</span></a>
</span><span id="Workflow-137"><a href="#Workflow-137"><span class="linenos">137</span></a><span class="sd">        - `labels`:</span>
</span><span id="Workflow-138"><a href="#Workflow-138"><span class="linenos">138</span></a><span class="sd">            a list of labels to schedule the workflow with</span>
</span><span id="Workflow-139"><a href="#Workflow-139"><span class="linenos">139</span></a>
</span><span id="Workflow-140"><a href="#Workflow-140"><span class="linenos">140</span></a><span class="sd">        - `wait_for_run`:</span>
</span><span id="Workflow-141"><a href="#Workflow-141"><span class="linenos">141</span></a><span class="sd">            whether to wait for the workflow to finish. If False, the workflow</span>
</span><span id="Workflow-142"><a href="#Workflow-142"><span class="linenos">142</span></a><span class="sd">            will simply be submitted and then exit. The default is True.</span>
</span><span id="Workflow-143"><a href="#Workflow-143"><span class="linenos">143</span></a>
</span><span id="Workflow-144"><a href="#Workflow-144"><span class="linenos">144</span></a><span class="sd">        - `**kwargs`:</span>
</span><span id="Workflow-145"><a href="#Workflow-145"><span class="linenos">145</span></a><span class="sd">            all options that are normally passed to the workflow.run() method</span>
</span><span id="Workflow-146"><a href="#Workflow-146"><span class="linenos">146</span></a>
</span><span id="Workflow-147"><a href="#Workflow-147"><span class="linenos">147</span></a><span class="sd">        #### Returns</span>
</span><span id="Workflow-148"><a href="#Workflow-148"><span class="linenos">148</span></a>
</span><span id="Workflow-149"><a href="#Workflow-149"><span class="linenos">149</span></a><span class="sd">        - The flow run id that was used in prefect cloud.</span>
</span><span id="Workflow-150"><a href="#Workflow-150"><span class="linenos">150</span></a>
</span><span id="Workflow-151"><a href="#Workflow-151"><span class="linenos">151</span></a>
</span><span id="Workflow-152"><a href="#Workflow-152"><span class="linenos">152</span></a><span class="sd">        #### Usage</span>
</span><span id="Workflow-153"><a href="#Workflow-153"><span class="linenos">153</span></a>
</span><span id="Workflow-154"><a href="#Workflow-154"><span class="linenos">154</span></a><span class="sd">        Make sure you have Prefect properly configured and have registered your</span>
</span><span id="Workflow-155"><a href="#Workflow-155"><span class="linenos">155</span></a><span class="sd">        workflow with the backend.</span>
</span><span id="Workflow-156"><a href="#Workflow-156"><span class="linenos">156</span></a>
</span><span id="Workflow-157"><a href="#Workflow-157"><span class="linenos">157</span></a><span class="sd">        Note that this method can be viewed as a fork of:</span>
</span><span id="Workflow-158"><a href="#Workflow-158"><span class="linenos">158</span></a><span class="sd">            - from prefect.tasks.prefect.flow_run import create_flow_run</span>
</span><span id="Workflow-159"><a href="#Workflow-159"><span class="linenos">159</span></a><span class="sd">        It can also be viewed as a more convenient way to call to client.create_flow_run.</span>
</span><span id="Workflow-160"><a href="#Workflow-160"><span class="linenos">160</span></a><span class="sd">        I don&#39;t accept any other client.create_flow_run() inputs besides &#39;labels&#39;.</span>
</span><span id="Workflow-161"><a href="#Workflow-161"><span class="linenos">161</span></a><span class="sd">        This may change in the future if I need to set flow run names or schedules.</span>
</span><span id="Workflow-162"><a href="#Workflow-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-163"><a href="#Workflow-163"><span class="linenos">163</span></a>
</span><span id="Workflow-164"><a href="#Workflow-164"><span class="linenos">164</span></a>        <span class="c1"># Grab the logger as we will print useful information below.</span>
</span><span id="Workflow-165"><a href="#Workflow-165"><span class="linenos">165</span></a>        <span class="c1"># In some cases, there is no logger present, so we just set logger=None.</span>
</span><span id="Workflow-166"><a href="#Workflow-166"><span class="linenos">166</span></a>        <span class="c1"># This possibility is why we use `if logger else None` statements below.</span>
</span><span id="Workflow-167"><a href="#Workflow-167"><span class="linenos">167</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">prefect</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s2">&quot;logger&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Workflow-168"><a href="#Workflow-168"><span class="linenos">168</span></a>
</span><span id="Workflow-169"><a href="#Workflow-169"><span class="linenos">169</span></a>        <span class="c1"># Grab the Flow&#39;s ID from Prefect Cloud</span>
</span><span id="Workflow-170"><a href="#Workflow-170"><span class="linenos">170</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Looking up flow metadata...&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">logger</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Workflow-171"><a href="#Workflow-171"><span class="linenos">171</span></a>        <span class="n">flow_view</span> <span class="o">=</span> <span class="n">FlowView</span><span class="o">.</span><span class="n">from_flow_name</span><span class="p">(</span>
</span><span id="Workflow-172"><a href="#Workflow-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Workflow-173"><a href="#Workflow-173"><span class="linenos">173</span></a>            <span class="n">project_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
</span><span id="Workflow-174"><a href="#Workflow-174"><span class="linenos">174</span></a>        <span class="p">)</span>
</span><span id="Workflow-175"><a href="#Workflow-175"><span class="linenos">175</span></a>
</span><span id="Workflow-176"><a href="#Workflow-176"><span class="linenos">176</span></a>        <span class="c1"># Prefect does not properly deserialize objects that have</span>
</span><span id="Workflow-177"><a href="#Workflow-177"><span class="linenos">177</span></a>        <span class="c1"># as as_dict or to_dict method, so we use a custom method to do that here</span>
</span><span id="Workflow-178"><a href="#Workflow-178"><span class="linenos">178</span></a>        <span class="n">parameters_serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Workflow-179"><a href="#Workflow-179"><span class="linenos">179</span></a>        <span class="c1"># BUG: What if we are submitting using a filename? We don&#39;t want to</span>
</span><span id="Workflow-180"><a href="#Workflow-180"><span class="linenos">180</span></a>        <span class="c1"># submit to a cluster and have the job fail because it doesn&#39;t have</span>
</span><span id="Workflow-181"><a href="#Workflow-181"><span class="linenos">181</span></a>        <span class="c1"># access to the file. One solution could be to deserialize right before</span>
</span><span id="Workflow-182"><a href="#Workflow-182"><span class="linenos">182</span></a>        <span class="c1"># serializing in the next line in order to ensure parameters that</span>
</span><span id="Workflow-183"><a href="#Workflow-183"><span class="linenos">183</span></a>        <span class="c1"># accept file names are submitted with all necessary data.</span>
</span><span id="Workflow-184"><a href="#Workflow-184"><span class="linenos">184</span></a>
</span><span id="Workflow-185"><a href="#Workflow-185"><span class="linenos">185</span></a>        <span class="c1"># Now we submit the workflow</span>
</span><span id="Workflow-186"><a href="#Workflow-186"><span class="linenos">186</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating flow run for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">logger</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Workflow-187"><a href="#Workflow-187"><span class="linenos">187</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span id="Workflow-188"><a href="#Workflow-188"><span class="linenos">188</span></a>        <span class="n">flow_run_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_flow_run</span><span class="p">(</span>
</span><span id="Workflow-189"><a href="#Workflow-189"><span class="linenos">189</span></a>            <span class="n">flow_id</span><span class="o">=</span><span class="n">flow_view</span><span class="o">.</span><span class="n">flow_id</span><span class="p">,</span>
</span><span id="Workflow-190"><a href="#Workflow-190"><span class="linenos">190</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters_serialized</span><span class="p">,</span>
</span><span id="Workflow-191"><a href="#Workflow-191"><span class="linenos">191</span></a>            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
</span><span id="Workflow-192"><a href="#Workflow-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="Workflow-193"><a href="#Workflow-193"><span class="linenos">193</span></a>
</span><span id="Workflow-194"><a href="#Workflow-194"><span class="linenos">194</span></a>        <span class="c1"># we log the website url to the flow for the user</span>
</span><span id="Workflow-195"><a href="#Workflow-195"><span class="linenos">195</span></a>        <span class="n">run_url</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_cloud_url</span><span class="p">(</span><span class="s2">&quot;flow-run&quot;</span><span class="p">,</span> <span class="n">flow_run_id</span><span class="p">)</span>
</span><span id="Workflow-196"><a href="#Workflow-196"><span class="linenos">196</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created flow run: </span><span class="si">{</span><span class="n">run_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">logger</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Workflow-197"><a href="#Workflow-197"><span class="linenos">197</span></a>
</span><span id="Workflow-198"><a href="#Workflow-198"><span class="linenos">198</span></a>        <span class="c1"># -----------------------------------</span>
</span><span id="Workflow-199"><a href="#Workflow-199"><span class="linenos">199</span></a>        <span class="c1"># This part is unique to Simmate. Because we often want to save some info</span>
</span><span id="Workflow-200"><a href="#Workflow-200"><span class="linenos">200</span></a>        <span class="c1"># to our database even before the calculation starts/finishes, we do that</span>
</span><span id="Workflow-201"><a href="#Workflow-201"><span class="linenos">201</span></a>        <span class="c1"># here. An example is storing the structure and prefect id that we just</span>
</span><span id="Workflow-202"><a href="#Workflow-202"><span class="linenos">202</span></a>        <span class="c1"># submitted.</span>
</span><span id="Workflow-203"><a href="#Workflow-203"><span class="linenos">203</span></a>        <span class="c1"># BUG: Will there be a race condition here? What if the workflow finishes</span>
</span><span id="Workflow-204"><a href="#Workflow-204"><span class="linenos">204</span></a>        <span class="c1"># and tries writing to the databse before this is done?</span>
</span><span id="Workflow-205"><a href="#Workflow-205"><span class="linenos">205</span></a>        <span class="n">parameters_cleaned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Workflow-206"><a href="#Workflow-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register_calculation</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">,</span> <span class="n">parameters_cleaned</span><span class="p">)</span>
</span><span id="Workflow-207"><a href="#Workflow-207"><span class="linenos">207</span></a>        <span class="c1"># -----------------------------------</span>
</span><span id="Workflow-208"><a href="#Workflow-208"><span class="linenos">208</span></a>
</span><span id="Workflow-209"><a href="#Workflow-209"><span class="linenos">209</span></a>        <span class="c1"># if we want to wait until the job is complete, we do that here</span>
</span><span id="Workflow-210"><a href="#Workflow-210"><span class="linenos">210</span></a>        <span class="k">if</span> <span class="n">wait_for_run</span><span class="p">:</span>
</span><span id="Workflow-211"><a href="#Workflow-211"><span class="linenos">211</span></a>            <span class="n">flow_run_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_flow_run</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">)</span>
</span><span id="Workflow-212"><a href="#Workflow-212"><span class="linenos">212</span></a>            <span class="c1"># return flow_run_view # !!! Should I return this instead?</span>
</span><span id="Workflow-213"><a href="#Workflow-213"><span class="linenos">213</span></a>
</span><span id="Workflow-214"><a href="#Workflow-214"><span class="linenos">214</span></a>        <span class="c1"># return the flow_run_id for the user</span>
</span><span id="Workflow-215"><a href="#Workflow-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="n">flow_run_id</span>
</span><span id="Workflow-216"><a href="#Workflow-216"><span class="linenos">216</span></a>
</span><span id="Workflow-217"><a href="#Workflow-217"><span class="linenos">217</span></a>    <span class="k">def</span> <span class="nf">wait_for_flow_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow_run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Workflow-218"><a href="#Workflow-218"><span class="linenos">218</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-219"><a href="#Workflow-219"><span class="linenos">219</span></a><span class="sd">        Waits for a given flow run to complete</span>
</span><span id="Workflow-220"><a href="#Workflow-220"><span class="linenos">220</span></a>
</span><span id="Workflow-221"><a href="#Workflow-221"><span class="linenos">221</span></a><span class="sd">        This method is a direct fork of...</span>
</span><span id="Workflow-222"><a href="#Workflow-222"><span class="linenos">222</span></a><span class="sd">            from prefect.tasks.prefect.flow_run import wait_for_flow_run</span>
</span><span id="Workflow-223"><a href="#Workflow-223"><span class="linenos">223</span></a>
</span><span id="Workflow-224"><a href="#Workflow-224"><span class="linenos">224</span></a><span class="sd">        It does exactly the same thing where I just assume I want to stream logs.</span>
</span><span id="Workflow-225"><a href="#Workflow-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-226"><a href="#Workflow-226"><span class="linenos">226</span></a>
</span><span id="Workflow-227"><a href="#Workflow-227"><span class="linenos">227</span></a>        <span class="n">flow_run</span> <span class="o">=</span> <span class="n">FlowRunView</span><span class="o">.</span><span class="n">from_flow_run_id</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">)</span>
</span><span id="Workflow-228"><a href="#Workflow-228"><span class="linenos">228</span></a>
</span><span id="Workflow-229"><a href="#Workflow-229"><span class="linenos">229</span></a>        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">flow_run_module</span><span class="o">.</span><span class="n">watch_flow_run</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">):</span>
</span><span id="Workflow-230"><a href="#Workflow-230"><span class="linenos">230</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Flow </span><span class="si">{</span><span class="n">flow_run</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Workflow-231"><a href="#Workflow-231"><span class="linenos">231</span></a>            <span class="n">prefect</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="Workflow-232"><a href="#Workflow-232"><span class="linenos">232</span></a>
</span><span id="Workflow-233"><a href="#Workflow-233"><span class="linenos">233</span></a>        <span class="c1"># Return the final view of the flow run</span>
</span><span id="Workflow-234"><a href="#Workflow-234"><span class="linenos">234</span></a>        <span class="k">return</span> <span class="n">flow_run</span><span class="o">.</span><span class="n">get_latest</span><span class="p">()</span>
</span><span id="Workflow-235"><a href="#Workflow-235"><span class="linenos">235</span></a>
</span><span id="Workflow-236"><a href="#Workflow-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="nf">_register_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefect_flow_run_id</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
</span><span id="Workflow-237"><a href="#Workflow-237"><span class="linenos">237</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-238"><a href="#Workflow-238"><span class="linenos">238</span></a><span class="sd">        If the workflow is linked to a calculation table in the Simmate database,</span>
</span><span id="Workflow-239"><a href="#Workflow-239"><span class="linenos">239</span></a><span class="sd">        this adds the flow run to the database.</span>
</span><span id="Workflow-240"><a href="#Workflow-240"><span class="linenos">240</span></a>
</span><span id="Workflow-241"><a href="#Workflow-241"><span class="linenos">241</span></a><span class="sd">        Parameters passed should be deserialized and cleaned.</span>
</span><span id="Workflow-242"><a href="#Workflow-242"><span class="linenos">242</span></a>
</span><span id="Workflow-243"><a href="#Workflow-243"><span class="linenos">243</span></a><span class="sd">        This method should not be called directly as it is used within the</span>
</span><span id="Workflow-244"><a href="#Workflow-244"><span class="linenos">244</span></a><span class="sd">        `run_cloud` method and `load_input_and_register` task.</span>
</span><span id="Workflow-245"><a href="#Workflow-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-246"><a href="#Workflow-246"><span class="linenos">246</span></a>
</span><span id="Workflow-247"><a href="#Workflow-247"><span class="linenos">247</span></a>        <span class="c1"># grab the registration kwargs from the parameters provided</span>
</span><span id="Workflow-248"><a href="#Workflow-248"><span class="linenos">248</span></a>        <span class="n">register_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Workflow-249"><a href="#Workflow-249"><span class="linenos">249</span></a>            <span class="n">key</span><span class="p">:</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_kwargs</span>
</span><span id="Workflow-250"><a href="#Workflow-250"><span class="linenos">250</span></a>        <span class="p">}</span>
</span><span id="Workflow-251"><a href="#Workflow-251"><span class="linenos">251</span></a>
</span><span id="Workflow-252"><a href="#Workflow-252"><span class="linenos">252</span></a>        <span class="c1"># SPECIAL CASE: for customized workflows we need to convert the inputs</span>
</span><span id="Workflow-253"><a href="#Workflow-253"><span class="linenos">253</span></a>        <span class="c1"># back to json before saving to the database.</span>
</span><span id="Workflow-254"><a href="#Workflow-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="s2">&quot;workflow_base&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
</span><span id="Workflow-255"><a href="#Workflow-255"><span class="linenos">255</span></a>            <span class="n">parameters_serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Workflow-256"><a href="#Workflow-256"><span class="linenos">256</span></a>            <span class="n">calculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_table</span><span class="o">.</span><span class="n">from_prefect_id</span><span class="p">(</span>
</span><span id="Workflow-257"><a href="#Workflow-257"><span class="linenos">257</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="Workflow-258"><a href="#Workflow-258"><span class="linenos">258</span></a>                <span class="o">**</span><span class="n">parameters_serialized</span><span class="p">,</span>
</span><span id="Workflow-259"><a href="#Workflow-259"><span class="linenos">259</span></a>            <span class="p">)</span>
</span><span id="Workflow-260"><a href="#Workflow-260"><span class="linenos">260</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Workflow-261"><a href="#Workflow-261"><span class="linenos">261</span></a>            <span class="c1"># load/create the calculation for this workflow run</span>
</span><span id="Workflow-262"><a href="#Workflow-262"><span class="linenos">262</span></a>            <span class="n">calculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_table</span><span class="o">.</span><span class="n">from_prefect_id</span><span class="p">(</span>
</span><span id="Workflow-263"><a href="#Workflow-263"><span class="linenos">263</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="Workflow-264"><a href="#Workflow-264"><span class="linenos">264</span></a>                <span class="o">**</span><span class="n">register_kwargs</span><span class="p">,</span>
</span><span id="Workflow-265"><a href="#Workflow-265"><span class="linenos">265</span></a>            <span class="p">)</span>
</span><span id="Workflow-266"><a href="#Workflow-266"><span class="linenos">266</span></a>
</span><span id="Workflow-267"><a href="#Workflow-267"><span class="linenos">267</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Workflow-268"><a href="#Workflow-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">_serialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="Workflow-269"><a href="#Workflow-269"><span class="linenos">269</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-270"><a href="#Workflow-270"><span class="linenos">270</span></a><span class="sd">        Converts input parameters to json-sealiziable objects that Prefect can</span>
</span><span id="Workflow-271"><a href="#Workflow-271"><span class="linenos">271</span></a><span class="sd">        use.</span>
</span><span id="Workflow-272"><a href="#Workflow-272"><span class="linenos">272</span></a>
</span><span id="Workflow-273"><a href="#Workflow-273"><span class="linenos">273</span></a><span class="sd">        This method should not be called directly as it is used within the</span>
</span><span id="Workflow-274"><a href="#Workflow-274"><span class="linenos">274</span></a><span class="sd">        run_cloud() method.</span>
</span><span id="Workflow-275"><a href="#Workflow-275"><span class="linenos">275</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-276"><a href="#Workflow-276"><span class="linenos">276</span></a>        <span class="c1"># TODO: consider moving this into prefect&#39;s core code as a contribution.</span>
</span><span id="Workflow-277"><a href="#Workflow-277"><span class="linenos">277</span></a>
</span><span id="Workflow-278"><a href="#Workflow-278"><span class="linenos">278</span></a>        <span class="c1"># Because many flows allow object-type inputs (such as structure object),</span>
</span><span id="Workflow-279"><a href="#Workflow-279"><span class="linenos">279</span></a>        <span class="c1"># we need to serialize these inputs before scheduling them with prefect</span>
</span><span id="Workflow-280"><a href="#Workflow-280"><span class="linenos">280</span></a>        <span class="c1"># cloud. To do this, I only check for two potential methods:</span>
</span><span id="Workflow-281"><a href="#Workflow-281"><span class="linenos">281</span></a>        <span class="c1">#     as_dict</span>
</span><span id="Workflow-282"><a href="#Workflow-282"><span class="linenos">282</span></a>        <span class="c1">#     to_dict</span>
</span><span id="Workflow-283"><a href="#Workflow-283"><span class="linenos">283</span></a>        <span class="c1"># These were chosen based on common pymatgen methods, but I may change</span>
</span><span id="Workflow-284"><a href="#Workflow-284"><span class="linenos">284</span></a>        <span class="c1"># this in the future. As another alternative, I could also cloudpickle</span>
</span><span id="Workflow-285"><a href="#Workflow-285"><span class="linenos">285</span></a>        <span class="c1"># input objects when they are not JSON serializable.</span>
</span><span id="Workflow-286"><a href="#Workflow-286"><span class="linenos">286</span></a>        <span class="c1"># OPTIMIZE: Prefect current tries to JSON serialize within their</span>
</span><span id="Workflow-287"><a href="#Workflow-287"><span class="linenos">287</span></a>        <span class="c1"># client.create_flow_run method. In the future, we may want to move</span>
</span><span id="Workflow-288"><a href="#Workflow-288"><span class="linenos">288</span></a>        <span class="c1"># this functionality there.</span>
</span><span id="Workflow-289"><a href="#Workflow-289"><span class="linenos">289</span></a>
</span><span id="Workflow-290"><a href="#Workflow-290"><span class="linenos">290</span></a>        <span class="n">parameters_serialized</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Workflow-291"><a href="#Workflow-291"><span class="linenos">291</span></a>        <span class="k">for</span> <span class="n">parameter_key</span><span class="p">,</span> <span class="n">parameter_value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Workflow-292"><a href="#Workflow-292"><span class="linenos">292</span></a>
</span><span id="Workflow-293"><a href="#Workflow-293"><span class="linenos">293</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Workflow-294"><a href="#Workflow-294"><span class="linenos">294</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">)</span>
</span><span id="Workflow-295"><a href="#Workflow-295"><span class="linenos">295</span></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="Workflow-296"><a href="#Workflow-296"><span class="linenos">296</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">,</span> <span class="s2">&quot;as_dict&quot;</span><span class="p">):</span>
</span><span id="Workflow-297"><a href="#Workflow-297"><span class="linenos">297</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">parameter_value</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</span><span id="Workflow-298"><a href="#Workflow-298"><span class="linenos">298</span></a>                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">,</span> <span class="s2">&quot;to_dict&quot;</span><span class="p">):</span>
</span><span id="Workflow-299"><a href="#Workflow-299"><span class="linenos">299</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">parameter_value</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="Workflow-300"><a href="#Workflow-300"><span class="linenos">300</span></a>
</span><span id="Workflow-301"><a href="#Workflow-301"><span class="linenos">301</span></a>                <span class="c1"># workflow_base and input_parameters are special cases that</span>
</span><span id="Workflow-302"><a href="#Workflow-302"><span class="linenos">302</span></a>                <span class="c1"># may require a refactor (for customized workflows)</span>
</span><span id="Workflow-303"><a href="#Workflow-303"><span class="linenos">303</span></a>                <span class="k">elif</span> <span class="n">parameter_key</span> <span class="o">==</span> <span class="s2">&quot;workflow_base&quot;</span><span class="p">:</span>
</span><span id="Workflow-304"><a href="#Workflow-304"><span class="linenos">304</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">parameter_value</span><span class="o">.</span><span class="n">name</span>
</span><span id="Workflow-305"><a href="#Workflow-305"><span class="linenos">305</span></a>                <span class="k">elif</span> <span class="n">parameter_key</span> <span class="o">==</span> <span class="s2">&quot;input_parameters&quot;</span><span class="p">:</span>
</span><span id="Workflow-306"><a href="#Workflow-306"><span class="linenos">306</span></a>                    <span class="c1"># recursive call to this function</span>
</span><span id="Workflow-307"><a href="#Workflow-307"><span class="linenos">307</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_serialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">parameter_value</span><span class="p">)</span>
</span><span id="Workflow-308"><a href="#Workflow-308"><span class="linenos">308</span></a>
</span><span id="Workflow-309"><a href="#Workflow-309"><span class="linenos">309</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Workflow-310"><a href="#Workflow-310"><span class="linenos">310</span></a>                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">cloudpickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">)</span>
</span><span id="Workflow-311"><a href="#Workflow-311"><span class="linenos">311</span></a>            <span class="n">parameters_serialized</span><span class="p">[</span><span class="n">parameter_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter_value</span>
</span><span id="Workflow-312"><a href="#Workflow-312"><span class="linenos">312</span></a>        <span class="k">return</span> <span class="n">parameters_serialized</span>
</span><span id="Workflow-313"><a href="#Workflow-313"><span class="linenos">313</span></a>
</span><span id="Workflow-314"><a href="#Workflow-314"><span class="linenos">314</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Workflow-315"><a href="#Workflow-315"><span class="linenos">315</span></a>    <span class="k">def</span> <span class="nf">_deserialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="Workflow-316"><a href="#Workflow-316"><span class="linenos">316</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-317"><a href="#Workflow-317"><span class="linenos">317</span></a><span class="sd">        converts all parameters to appropriate python objects</span>
</span><span id="Workflow-318"><a href="#Workflow-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-319"><a href="#Workflow-319"><span class="linenos">319</span></a>
</span><span id="Workflow-320"><a href="#Workflow-320"><span class="linenos">320</span></a>        <span class="c1"># we don&#39;t want to pass arguments like command=None or structure=None if the</span>
</span><span id="Workflow-321"><a href="#Workflow-321"><span class="linenos">321</span></a>        <span class="c1"># user didn&#39;t provide this input parameter. Instead, we want the workflow to</span>
</span><span id="Workflow-322"><a href="#Workflow-322"><span class="linenos">322</span></a>        <span class="c1"># use its own default value. To do this, we first check if the parameter</span>
</span><span id="Workflow-323"><a href="#Workflow-323"><span class="linenos">323</span></a>        <span class="c1"># is set in our kwargs dictionary and making sure the value is NOT None.</span>
</span><span id="Workflow-324"><a href="#Workflow-324"><span class="linenos">324</span></a>        <span class="c1"># If it is None, then we remove it from our final list of kwargs. This</span>
</span><span id="Workflow-325"><a href="#Workflow-325"><span class="linenos">325</span></a>        <span class="c1"># is only done for command, directory, and structure inputs -- as these</span>
</span><span id="Workflow-326"><a href="#Workflow-326"><span class="linenos">326</span></a>        <span class="c1"># are the three that are typically assumed to be present (see the CLI).</span>
</span><span id="Workflow-327"><a href="#Workflow-327"><span class="linenos">327</span></a>
</span><span id="Workflow-328"><a href="#Workflow-328"><span class="linenos">328</span></a>        <span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span>
</span><span id="Workflow-329"><a href="#Workflow-329"><span class="linenos">329</span></a>        <span class="kn">from</span> <span class="nn">simmate.toolkit.diffusion</span> <span class="kn">import</span> <span class="n">MigrationHop</span><span class="p">,</span> <span class="n">MigrationImages</span>
</span><span id="Workflow-330"><a href="#Workflow-330"><span class="linenos">330</span></a>
</span><span id="Workflow-331"><a href="#Workflow-331"><span class="linenos">331</span></a>        <span class="n">parameters_cleaned</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Workflow-332"><a href="#Workflow-332"><span class="linenos">332</span></a>
</span><span id="Workflow-333"><a href="#Workflow-333"><span class="linenos">333</span></a>        <span class="c1">#######</span>
</span><span id="Workflow-334"><a href="#Workflow-334"><span class="linenos">334</span></a>        <span class="c1"># SPECIAL CASE: customized workflows have their parameters stored under</span>
</span><span id="Workflow-335"><a href="#Workflow-335"><span class="linenos">335</span></a>        <span class="c1"># &quot;input_parameters&quot; instead of the base dict</span>
</span><span id="Workflow-336"><a href="#Workflow-336"><span class="linenos">336</span></a>        <span class="c1"># THIS INVOLVES A RECURSIVE CALL TO THIS SAME METHOD</span>
</span><span id="Workflow-337"><a href="#Workflow-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="s2">&quot;workflow_base&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Workflow-338"><a href="#Workflow-338"><span class="linenos">338</span></a>            <span class="c1"># This is a non-modular import that can cause issues and slower</span>
</span><span id="Workflow-339"><a href="#Workflow-339"><span class="linenos">339</span></a>            <span class="c1"># run times. We therefore import lazily.</span>
</span><span id="Workflow-340"><a href="#Workflow-340"><span class="linenos">340</span></a>            <span class="kn">from</span> <span class="nn">simmate.workflows.utilities</span> <span class="kn">import</span> <span class="n">get_workflow</span>
</span><span id="Workflow-341"><a href="#Workflow-341"><span class="linenos">341</span></a>
</span><span id="Workflow-342"><a href="#Workflow-342"><span class="linenos">342</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;workflow_base&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_workflow</span><span class="p">(</span>
</span><span id="Workflow-343"><a href="#Workflow-343"><span class="linenos">343</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;workflow_base&quot;</span><span class="p">]</span>
</span><span id="Workflow-344"><a href="#Workflow-344"><span class="linenos">344</span></a>            <span class="p">)</span>
</span><span id="Workflow-345"><a href="#Workflow-345"><span class="linenos">345</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;input_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_deserialize_parameters</span><span class="p">(</span>
</span><span id="Workflow-346"><a href="#Workflow-346"><span class="linenos">346</span></a>                <span class="o">**</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;input_parameters&quot;</span><span class="p">]</span>
</span><span id="Workflow-347"><a href="#Workflow-347"><span class="linenos">347</span></a>            <span class="p">)</span>
</span><span id="Workflow-348"><a href="#Workflow-348"><span class="linenos">348</span></a>            <span class="k">return</span> <span class="n">parameters_cleaned</span>
</span><span id="Workflow-349"><a href="#Workflow-349"><span class="linenos">349</span></a>        <span class="c1">#######</span>
</span><span id="Workflow-350"><a href="#Workflow-350"><span class="linenos">350</span></a>
</span><span id="Workflow-351"><a href="#Workflow-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Workflow-352"><a href="#Workflow-352"><span class="linenos">352</span></a>            <span class="n">parameters_cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Workflow-353"><a href="#Workflow-353"><span class="linenos">353</span></a>
</span><span id="Workflow-354"><a href="#Workflow-354"><span class="linenos">354</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Workflow-355"><a href="#Workflow-355"><span class="linenos">355</span></a>            <span class="n">parameters_cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Workflow-356"><a href="#Workflow-356"><span class="linenos">356</span></a>
</span><span id="Workflow-357"><a href="#Workflow-357"><span class="linenos">357</span></a>        <span class="n">structure</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Workflow-358"><a href="#Workflow-358"><span class="linenos">358</span></a>        <span class="k">if</span> <span class="n">structure</span><span class="p">:</span>
</span><span id="Workflow-359"><a href="#Workflow-359"><span class="linenos">359</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
</span><span id="Workflow-360"><a href="#Workflow-360"><span class="linenos">360</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Workflow-361"><a href="#Workflow-361"><span class="linenos">361</span></a>            <span class="n">parameters_cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Workflow-362"><a href="#Workflow-362"><span class="linenos">362</span></a>
</span><span id="Workflow-363"><a href="#Workflow-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="s2">&quot;structures&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Workflow-364"><a href="#Workflow-364"><span class="linenos">364</span></a>            <span class="n">structure_filenames</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;structures&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span id="Workflow-365"><a href="#Workflow-365"><span class="linenos">365</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;structures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Workflow-366"><a href="#Workflow-366"><span class="linenos">366</span></a>                <span class="n">Structure</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">structure_filenames</span>
</span><span id="Workflow-367"><a href="#Workflow-367"><span class="linenos">367</span></a>            <span class="p">]</span>
</span><span id="Workflow-368"><a href="#Workflow-368"><span class="linenos">368</span></a>
</span><span id="Workflow-369"><a href="#Workflow-369"><span class="linenos">369</span></a>        <span class="k">if</span> <span class="s2">&quot;migration_hop&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Workflow-370"><a href="#Workflow-370"><span class="linenos">370</span></a>            <span class="n">migration_hop</span> <span class="o">=</span> <span class="n">MigrationHop</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">])</span>
</span><span id="Workflow-371"><a href="#Workflow-371"><span class="linenos">371</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;migration_hop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">migration_hop</span>
</span><span id="Workflow-372"><a href="#Workflow-372"><span class="linenos">372</span></a>
</span><span id="Workflow-373"><a href="#Workflow-373"><span class="linenos">373</span></a>        <span class="k">if</span> <span class="s2">&quot;migration_images&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Workflow-374"><a href="#Workflow-374"><span class="linenos">374</span></a>            <span class="n">migration_images</span> <span class="o">=</span> <span class="n">MigrationImages</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span>
</span><span id="Workflow-375"><a href="#Workflow-375"><span class="linenos">375</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;migration_images&quot;</span><span class="p">]</span>
</span><span id="Workflow-376"><a href="#Workflow-376"><span class="linenos">376</span></a>            <span class="p">)</span>
</span><span id="Workflow-377"><a href="#Workflow-377"><span class="linenos">377</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;migration_images&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">migration_images</span>
</span><span id="Workflow-378"><a href="#Workflow-378"><span class="linenos">378</span></a>
</span><span id="Workflow-379"><a href="#Workflow-379"><span class="linenos">379</span></a>        <span class="k">if</span> <span class="s2">&quot;supercell_start&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Workflow-380"><a href="#Workflow-380"><span class="linenos">380</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;supercell_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span>
</span><span id="Workflow-381"><a href="#Workflow-381"><span class="linenos">381</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;supercell_start&quot;</span><span class="p">]</span>
</span><span id="Workflow-382"><a href="#Workflow-382"><span class="linenos">382</span></a>            <span class="p">)</span>
</span><span id="Workflow-383"><a href="#Workflow-383"><span class="linenos">383</span></a>
</span><span id="Workflow-384"><a href="#Workflow-384"><span class="linenos">384</span></a>        <span class="k">if</span> <span class="s2">&quot;supercell_end&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Workflow-385"><a href="#Workflow-385"><span class="linenos">385</span></a>            <span class="n">parameters_cleaned</span><span class="p">[</span><span class="s2">&quot;supercell_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span>
</span><span id="Workflow-386"><a href="#Workflow-386"><span class="linenos">386</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;supercell_end&quot;</span><span class="p">]</span>
</span><span id="Workflow-387"><a href="#Workflow-387"><span class="linenos">387</span></a>            <span class="p">)</span>
</span><span id="Workflow-388"><a href="#Workflow-388"><span class="linenos">388</span></a>
</span><span id="Workflow-389"><a href="#Workflow-389"><span class="linenos">389</span></a>        <span class="k">return</span> <span class="n">parameters_cleaned</span>
</span><span id="Workflow-390"><a href="#Workflow-390"><span class="linenos">390</span></a>
</span><span id="Workflow-391"><a href="#Workflow-391"><span class="linenos">391</span></a>    <span class="nd">@property</span>
</span><span id="Workflow-392"><a href="#Workflow-392"><span class="linenos">392</span></a>    <span class="k">def</span> <span class="nf">nflows_submitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Workflow-393"><a href="#Workflow-393"><span class="linenos">393</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-394"><a href="#Workflow-394"><span class="linenos">394</span></a><span class="sd">        Queries Prefect to see how many workflows are in a running or submitted</span>
</span><span id="Workflow-395"><a href="#Workflow-395"><span class="linenos">395</span></a><span class="sd">        state. It will return a count (integer).</span>
</span><span id="Workflow-396"><a href="#Workflow-396"><span class="linenos">396</span></a>
</span><span id="Workflow-397"><a href="#Workflow-397"><span class="linenos">397</span></a><span class="sd">        Note, your workflow must be registered with Prefect for this to work.</span>
</span><span id="Workflow-398"><a href="#Workflow-398"><span class="linenos">398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-399"><a href="#Workflow-399"><span class="linenos">399</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Workflow-400"><a href="#Workflow-400"><span class="linenos">400</span></a>            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="Workflow-401"><a href="#Workflow-401"><span class="linenos">401</span></a>                <span class="n">with_args</span><span class="p">(</span>
</span><span id="Workflow-402"><a href="#Workflow-402"><span class="linenos">402</span></a>                    <span class="s2">&quot;flow_run_aggregate&quot;</span><span class="p">,</span>
</span><span id="Workflow-403"><a href="#Workflow-403"><span class="linenos">403</span></a>                    <span class="p">{</span>
</span><span id="Workflow-404"><a href="#Workflow-404"><span class="linenos">404</span></a>                        <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="Workflow-405"><a href="#Workflow-405"><span class="linenos">405</span></a>                            <span class="s2">&quot;flow&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_eq&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">}},</span>
</span><span id="Workflow-406"><a href="#Workflow-406"><span class="linenos">406</span></a>                            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_in&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Running&quot;</span><span class="p">,</span> <span class="s2">&quot;Scheduled&quot;</span><span class="p">]},</span>
</span><span id="Workflow-407"><a href="#Workflow-407"><span class="linenos">407</span></a>                        <span class="p">},</span>
</span><span id="Workflow-408"><a href="#Workflow-408"><span class="linenos">408</span></a>                    <span class="p">},</span>
</span><span id="Workflow-409"><a href="#Workflow-409"><span class="linenos">409</span></a>                <span class="p">):</span> <span class="p">{</span><span class="s2">&quot;aggregate&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">}}</span>
</span><span id="Workflow-410"><a href="#Workflow-410"><span class="linenos">410</span></a>            <span class="p">}</span>
</span><span id="Workflow-411"><a href="#Workflow-411"><span class="linenos">411</span></a>        <span class="p">}</span>
</span><span id="Workflow-412"><a href="#Workflow-412"><span class="linenos">412</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span id="Workflow-413"><a href="#Workflow-413"><span class="linenos">413</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">graphql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="Workflow-414"><a href="#Workflow-414"><span class="linenos">414</span></a>        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;flow_run_aggregate&quot;</span><span class="p">][</span><span class="s2">&quot;aggregate&quot;</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="Workflow-415"><a href="#Workflow-415"><span class="linenos">415</span></a>
</span><span id="Workflow-416"><a href="#Workflow-416"><span class="linenos">416</span></a>    <span class="k">def</span> <span class="nf">to_workflow_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Workflow-417"><a href="#Workflow-417"><span class="linenos">417</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow-418"><a href="#Workflow-418"><span class="linenos">418</span></a><span class="sd">        Converts a prefect workflow to a prefect task (aka a &quot;workflow task&quot;)</span>
</span><span id="Workflow-419"><a href="#Workflow-419"><span class="linenos">419</span></a>
</span><span id="Workflow-420"><a href="#Workflow-420"><span class="linenos">420</span></a><span class="sd">        See the documentation in workflow_engine.tasks.workflow_task for more.</span>
</span><span id="Workflow-421"><a href="#Workflow-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow-422"><a href="#Workflow-422"><span class="linenos">422</span></a>        <span class="kn">from</span> <span class="nn">simmate.workflow_engine</span> <span class="kn">import</span> <span class="n">WorkflowTask</span>
</span><span id="Workflow-423"><a href="#Workflow-423"><span class="linenos">423</span></a>
</span><span id="Workflow-424"><a href="#Workflow-424"><span class="linenos">424</span></a>        <span class="k">return</span> <span class="n">WorkflowTask</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Workflow-425"><a href="#Workflow-425"><span class="linenos">425</span></a>
</span><span id="Workflow-426"><a href="#Workflow-426"><span class="linenos">426</span></a>    <span class="c1"># @classmethod</span>
</span><span id="Workflow-427"><a href="#Workflow-427"><span class="linenos">427</span></a>    <span class="c1"># def get_all_ids_in_state(cls, states=[&quot;Completed&quot;, &quot;Scheduled&quot;]):</span>
</span><span id="Workflow-428"><a href="#Workflow-428"><span class="linenos">428</span></a>    <span class="c1">#     # TODO: This is an example query where I grab all ids. This may be useful in the</span>
</span><span id="Workflow-429"><a href="#Workflow-429"><span class="linenos">429</span></a>    <span class="c1">#     # future.</span>
</span><span id="Workflow-430"><a href="#Workflow-430"><span class="linenos">430</span></a>    <span class="c1">#     query = {</span>
</span><span id="Workflow-431"><a href="#Workflow-431"><span class="linenos">431</span></a>    <span class="c1">#         &quot;query&quot;: {</span>
</span><span id="Workflow-432"><a href="#Workflow-432"><span class="linenos">432</span></a>    <span class="c1">#             with_args(</span>
</span><span id="Workflow-433"><a href="#Workflow-433"><span class="linenos">433</span></a>    <span class="c1">#                 &quot;flow_run&quot;,</span>
</span><span id="Workflow-434"><a href="#Workflow-434"><span class="linenos">434</span></a>    <span class="c1">#                 {</span>
</span><span id="Workflow-435"><a href="#Workflow-435"><span class="linenos">435</span></a>    <span class="c1">#                     &quot;where&quot;: {</span>
</span><span id="Workflow-436"><a href="#Workflow-436"><span class="linenos">436</span></a>    <span class="c1">#                         &quot;flow&quot;: {&quot;name&quot;: {&quot;_eq&quot;: cls.name}},</span>
</span><span id="Workflow-437"><a href="#Workflow-437"><span class="linenos">437</span></a>    <span class="c1">#                         &quot;state&quot;: {&quot;_in&quot;: states},</span>
</span><span id="Workflow-438"><a href="#Workflow-438"><span class="linenos">438</span></a>    <span class="c1">#                     },</span>
</span><span id="Workflow-439"><a href="#Workflow-439"><span class="linenos">439</span></a>    <span class="c1">#                 },</span>
</span><span id="Workflow-440"><a href="#Workflow-440"><span class="linenos">440</span></a>    <span class="c1">#             ): [&quot;id&quot;]</span>
</span><span id="Workflow-441"><a href="#Workflow-441"><span class="linenos">441</span></a>    <span class="c1">#         }</span>
</span><span id="Workflow-442"><a href="#Workflow-442"><span class="linenos">442</span></a>    <span class="c1">#     }</span>
</span></pre></div>


            <div class="docstring"><p>This class behaves exactly like a normal Prefect workflow, where we add some
common utilities and pre-submit tasks. For example, there is the <code><a href="#Workflow.run_cloud">run_cloud</a></code>
method, which allows us to register a calculation to a database table before
we submit the workflow to Prefect Cloud.</p>

<p>To learn how to use this class, see
<a href="https://docs.prefect.io/api/latest/core/flow.html#flow-2">prefect.core.flow.Flow</a></p>
</div>


                            <div id="Workflow.result_task" class="classattr">
                                <div class="attr variable">
            <span class="name">result_task</span><span class="annotation">: prefect.core.task.Task</span><span class="default_value"> = None</span>

        
    </div>
    <a class="headerlink" href="#Workflow.result_task"></a>
    
            <div class="docstring"><p>In many ETL workflows, we may also want the result of the some terminating
task directly. This would save us from having to go find the result in
the database. So by setting <code><a href="#Workflow.result_task">result_task</a></code>, we are able get access a specific task's
result -- directly as a python object(s). This is optional.</p>
</div>


                            </div>
                            <div id="Workflow.project_name" class="classattr">
                                <div class="attr variable">
            <span class="name">project_name</span><span class="annotation">: str</span><span class="default_value"> = None</span>

        
    </div>
    <a class="headerlink" href="#Workflow.project_name"></a>
    
            <div class="docstring"><p>The name of the project in Prefect Cloud that this workflow is associated with. This 
attribute is mainly just for organizing workflows in the web interface.</p>
</div>


                            </div>
                            <div id="Workflow.s3task" class="classattr">
                                <div class="attr variable">
            <span class="name">s3task</span><span class="annotation">: <a href="supervised_staged_shell_task.html#S3Task">simmate.workflow_engine.supervised_staged_shell_task.S3Task</a></span><span class="default_value"> = None</span>

        
    </div>
    <a class="headerlink" href="#Workflow.s3task"></a>
    
            <div class="docstring"><p>The supervised-staged-shell task (or S3Task) that this workflow uses to run.
For understanding what the calculation does and the settings it uses, users
should start here. You can also use a workflows <code>s3task.run</code> to run the workflow
without storing results in the database.</p>
</div>


                            </div>
                            <div id="Workflow.database_table" class="classattr">
                                <div class="attr variable">
            <span class="name">database_table</span><span class="annotation">: <a href="../database/base_data_types/calculation.html#Calculation">simmate.database.base_data_types.calculation.Calculation</a></span><span class="default_value"> = None</span>

        
    </div>
    <a class="headerlink" href="#Workflow.database_table"></a>
    
            <div class="docstring"><p>The database table where calculation information (such as the prefect_flow_run_id)
is stored. The table should use <code>simmate.database.base_data_types.Calculation</code></p>

<p>In many cases, this table will contain all of the results you need. However,
pay special attention to NestedWorkflows, where your results are often tied
to a final task.</p>
</div>


                            </div>
                            <div id="Workflow.description_doc_short" class="classattr">
                                <div class="attr variable">
            <span class="name">description_doc_short</span><span class="annotation">: str</span><span class="default_value"> = None</span>

        
    </div>
    <a class="headerlink" href="#Workflow.description_doc_short"></a>
    
            <div class="docstring"><p>A quick description for this workflow. This will be shown in the website UI
in the list-view of all different workflow presets.</p>
</div>


                            </div>
                            <div id="Workflow.register_kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">register_kwargs</span><span class="annotation">: List[str]</span><span class="default_value"> = []</span>

        
    </div>
    <a class="headerlink" href="#Workflow.register_kwargs"></a>
    
            <div class="docstring"><p>(experimental feature)
A list of input parameters that should be used to register the calculation.</p>
</div>


                            </div>
                            <div id="Workflow.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Workflow.type"></a>
    
            <div class="docstring"><p>Gives the workflow type of this workflow. For example the workflow named
'static-energy/matproj' would have the type <code>static-energy</code>.</p>
</div>


                            </div>
                            <div id="Workflow.name_short" class="classattr">
                                <div class="attr variable">
            <span class="name">name_short</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Workflow.name_short"></a>
    
            <div class="docstring"><p>Gives the present name of the workflow. For example the workflow named
'static-energy/matproj' would have the shortname <code>matproj</code></p>
</div>


                            </div>
                            <div id="Workflow.description_doc" class="classattr">
                                <div class="attr variable">
            <span class="name">description_doc</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Workflow.description_doc"></a>
    
            <div class="docstring"><p>This simply returns the documentation string of this workflow -- so this
is the same as <code>__doc__</code>. This attribute is only defined for beginners
to python and for use in django templates for the website interface.</p>
</div>


                            </div>
                            <div id="Workflow.parameter_names" class="classattr">
                                <div class="attr variable">
            <span class="name">parameter_names</span>

        
    </div>
    <a class="headerlink" href="#Workflow.parameter_names"></a>
    
            <div class="docstring"><p>Prints a list of all the parameter names for this workflow.</p>
</div>


                            </div>
                            <div id="Workflow.show_parameters" class="classattr">
                                        <input id="Workflow.show_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span>)</span>

                <label class="view-source-button" for="Workflow.show_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Workflow.show_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Workflow.show_parameters-119"><a href="#Workflow.show_parameters-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">show_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Workflow.show_parameters-120"><a href="#Workflow.show_parameters-120"><span class="linenos">120</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow.show_parameters-121"><a href="#Workflow.show_parameters-121"><span class="linenos">121</span></a><span class="sd">        Prints a list of all the parameter names for this workflow.</span>
</span><span id="Workflow.show_parameters-122"><a href="#Workflow.show_parameters-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow.show_parameters-123"><a href="#Workflow.show_parameters-123"><span class="linenos">123</span></a>        <span class="c1"># use yaml to make the printout pretty (no quotes and separate lines)</span>
</span><span id="Workflow.show_parameters-124"><a href="#Workflow.show_parameters-124"><span class="linenos">124</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_names</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Prints a list of all the parameter names for this workflow.</p>
</div>


                            </div>
                            <div id="Workflow.run_cloud" class="classattr">
                                        <input id="Workflow.run_cloud-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_cloud</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>, </span><span class="param"><span class="n">wait_for_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Workflow.run_cloud-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Workflow.run_cloud"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Workflow.run_cloud-126"><a href="#Workflow.run_cloud-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">run_cloud</span><span class="p">(</span>
</span><span id="Workflow.run_cloud-127"><a href="#Workflow.run_cloud-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Workflow.run_cloud-128"><a href="#Workflow.run_cloud-128"><span class="linenos">128</span></a>        <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="Workflow.run_cloud-129"><a href="#Workflow.run_cloud-129"><span class="linenos">129</span></a>        <span class="n">wait_for_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Workflow.run_cloud-130"><a href="#Workflow.run_cloud-130"><span class="linenos">130</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="Workflow.run_cloud-131"><a href="#Workflow.run_cloud-131"><span class="linenos">131</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Workflow.run_cloud-132"><a href="#Workflow.run_cloud-132"><span class="linenos">132</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow.run_cloud-133"><a href="#Workflow.run_cloud-133"><span class="linenos">133</span></a><span class="sd">        This schedules the workflow to run remotely on Prefect Cloud.</span>
</span><span id="Workflow.run_cloud-134"><a href="#Workflow.run_cloud-134"><span class="linenos">134</span></a>
</span><span id="Workflow.run_cloud-135"><a href="#Workflow.run_cloud-135"><span class="linenos">135</span></a><span class="sd">        #### Parameters</span>
</span><span id="Workflow.run_cloud-136"><a href="#Workflow.run_cloud-136"><span class="linenos">136</span></a>
</span><span id="Workflow.run_cloud-137"><a href="#Workflow.run_cloud-137"><span class="linenos">137</span></a><span class="sd">        - `labels`:</span>
</span><span id="Workflow.run_cloud-138"><a href="#Workflow.run_cloud-138"><span class="linenos">138</span></a><span class="sd">            a list of labels to schedule the workflow with</span>
</span><span id="Workflow.run_cloud-139"><a href="#Workflow.run_cloud-139"><span class="linenos">139</span></a>
</span><span id="Workflow.run_cloud-140"><a href="#Workflow.run_cloud-140"><span class="linenos">140</span></a><span class="sd">        - `wait_for_run`:</span>
</span><span id="Workflow.run_cloud-141"><a href="#Workflow.run_cloud-141"><span class="linenos">141</span></a><span class="sd">            whether to wait for the workflow to finish. If False, the workflow</span>
</span><span id="Workflow.run_cloud-142"><a href="#Workflow.run_cloud-142"><span class="linenos">142</span></a><span class="sd">            will simply be submitted and then exit. The default is True.</span>
</span><span id="Workflow.run_cloud-143"><a href="#Workflow.run_cloud-143"><span class="linenos">143</span></a>
</span><span id="Workflow.run_cloud-144"><a href="#Workflow.run_cloud-144"><span class="linenos">144</span></a><span class="sd">        - `**kwargs`:</span>
</span><span id="Workflow.run_cloud-145"><a href="#Workflow.run_cloud-145"><span class="linenos">145</span></a><span class="sd">            all options that are normally passed to the workflow.run() method</span>
</span><span id="Workflow.run_cloud-146"><a href="#Workflow.run_cloud-146"><span class="linenos">146</span></a>
</span><span id="Workflow.run_cloud-147"><a href="#Workflow.run_cloud-147"><span class="linenos">147</span></a><span class="sd">        #### Returns</span>
</span><span id="Workflow.run_cloud-148"><a href="#Workflow.run_cloud-148"><span class="linenos">148</span></a>
</span><span id="Workflow.run_cloud-149"><a href="#Workflow.run_cloud-149"><span class="linenos">149</span></a><span class="sd">        - The flow run id that was used in prefect cloud.</span>
</span><span id="Workflow.run_cloud-150"><a href="#Workflow.run_cloud-150"><span class="linenos">150</span></a>
</span><span id="Workflow.run_cloud-151"><a href="#Workflow.run_cloud-151"><span class="linenos">151</span></a>
</span><span id="Workflow.run_cloud-152"><a href="#Workflow.run_cloud-152"><span class="linenos">152</span></a><span class="sd">        #### Usage</span>
</span><span id="Workflow.run_cloud-153"><a href="#Workflow.run_cloud-153"><span class="linenos">153</span></a>
</span><span id="Workflow.run_cloud-154"><a href="#Workflow.run_cloud-154"><span class="linenos">154</span></a><span class="sd">        Make sure you have Prefect properly configured and have registered your</span>
</span><span id="Workflow.run_cloud-155"><a href="#Workflow.run_cloud-155"><span class="linenos">155</span></a><span class="sd">        workflow with the backend.</span>
</span><span id="Workflow.run_cloud-156"><a href="#Workflow.run_cloud-156"><span class="linenos">156</span></a>
</span><span id="Workflow.run_cloud-157"><a href="#Workflow.run_cloud-157"><span class="linenos">157</span></a><span class="sd">        Note that this method can be viewed as a fork of:</span>
</span><span id="Workflow.run_cloud-158"><a href="#Workflow.run_cloud-158"><span class="linenos">158</span></a><span class="sd">            - from prefect.tasks.prefect.flow_run import create_flow_run</span>
</span><span id="Workflow.run_cloud-159"><a href="#Workflow.run_cloud-159"><span class="linenos">159</span></a><span class="sd">        It can also be viewed as a more convenient way to call to client.create_flow_run.</span>
</span><span id="Workflow.run_cloud-160"><a href="#Workflow.run_cloud-160"><span class="linenos">160</span></a><span class="sd">        I don&#39;t accept any other client.create_flow_run() inputs besides &#39;labels&#39;.</span>
</span><span id="Workflow.run_cloud-161"><a href="#Workflow.run_cloud-161"><span class="linenos">161</span></a><span class="sd">        This may change in the future if I need to set flow run names or schedules.</span>
</span><span id="Workflow.run_cloud-162"><a href="#Workflow.run_cloud-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow.run_cloud-163"><a href="#Workflow.run_cloud-163"><span class="linenos">163</span></a>
</span><span id="Workflow.run_cloud-164"><a href="#Workflow.run_cloud-164"><span class="linenos">164</span></a>        <span class="c1"># Grab the logger as we will print useful information below.</span>
</span><span id="Workflow.run_cloud-165"><a href="#Workflow.run_cloud-165"><span class="linenos">165</span></a>        <span class="c1"># In some cases, there is no logger present, so we just set logger=None.</span>
</span><span id="Workflow.run_cloud-166"><a href="#Workflow.run_cloud-166"><span class="linenos">166</span></a>        <span class="c1"># This possibility is why we use `if logger else None` statements below.</span>
</span><span id="Workflow.run_cloud-167"><a href="#Workflow.run_cloud-167"><span class="linenos">167</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">prefect</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s2">&quot;logger&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Workflow.run_cloud-168"><a href="#Workflow.run_cloud-168"><span class="linenos">168</span></a>
</span><span id="Workflow.run_cloud-169"><a href="#Workflow.run_cloud-169"><span class="linenos">169</span></a>        <span class="c1"># Grab the Flow&#39;s ID from Prefect Cloud</span>
</span><span id="Workflow.run_cloud-170"><a href="#Workflow.run_cloud-170"><span class="linenos">170</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Looking up flow metadata...&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">logger</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Workflow.run_cloud-171"><a href="#Workflow.run_cloud-171"><span class="linenos">171</span></a>        <span class="n">flow_view</span> <span class="o">=</span> <span class="n">FlowView</span><span class="o">.</span><span class="n">from_flow_name</span><span class="p">(</span>
</span><span id="Workflow.run_cloud-172"><a href="#Workflow.run_cloud-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Workflow.run_cloud-173"><a href="#Workflow.run_cloud-173"><span class="linenos">173</span></a>            <span class="n">project_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
</span><span id="Workflow.run_cloud-174"><a href="#Workflow.run_cloud-174"><span class="linenos">174</span></a>        <span class="p">)</span>
</span><span id="Workflow.run_cloud-175"><a href="#Workflow.run_cloud-175"><span class="linenos">175</span></a>
</span><span id="Workflow.run_cloud-176"><a href="#Workflow.run_cloud-176"><span class="linenos">176</span></a>        <span class="c1"># Prefect does not properly deserialize objects that have</span>
</span><span id="Workflow.run_cloud-177"><a href="#Workflow.run_cloud-177"><span class="linenos">177</span></a>        <span class="c1"># as as_dict or to_dict method, so we use a custom method to do that here</span>
</span><span id="Workflow.run_cloud-178"><a href="#Workflow.run_cloud-178"><span class="linenos">178</span></a>        <span class="n">parameters_serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Workflow.run_cloud-179"><a href="#Workflow.run_cloud-179"><span class="linenos">179</span></a>        <span class="c1"># BUG: What if we are submitting using a filename? We don&#39;t want to</span>
</span><span id="Workflow.run_cloud-180"><a href="#Workflow.run_cloud-180"><span class="linenos">180</span></a>        <span class="c1"># submit to a cluster and have the job fail because it doesn&#39;t have</span>
</span><span id="Workflow.run_cloud-181"><a href="#Workflow.run_cloud-181"><span class="linenos">181</span></a>        <span class="c1"># access to the file. One solution could be to deserialize right before</span>
</span><span id="Workflow.run_cloud-182"><a href="#Workflow.run_cloud-182"><span class="linenos">182</span></a>        <span class="c1"># serializing in the next line in order to ensure parameters that</span>
</span><span id="Workflow.run_cloud-183"><a href="#Workflow.run_cloud-183"><span class="linenos">183</span></a>        <span class="c1"># accept file names are submitted with all necessary data.</span>
</span><span id="Workflow.run_cloud-184"><a href="#Workflow.run_cloud-184"><span class="linenos">184</span></a>
</span><span id="Workflow.run_cloud-185"><a href="#Workflow.run_cloud-185"><span class="linenos">185</span></a>        <span class="c1"># Now we submit the workflow</span>
</span><span id="Workflow.run_cloud-186"><a href="#Workflow.run_cloud-186"><span class="linenos">186</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating flow run for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">logger</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Workflow.run_cloud-187"><a href="#Workflow.run_cloud-187"><span class="linenos">187</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span id="Workflow.run_cloud-188"><a href="#Workflow.run_cloud-188"><span class="linenos">188</span></a>        <span class="n">flow_run_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_flow_run</span><span class="p">(</span>
</span><span id="Workflow.run_cloud-189"><a href="#Workflow.run_cloud-189"><span class="linenos">189</span></a>            <span class="n">flow_id</span><span class="o">=</span><span class="n">flow_view</span><span class="o">.</span><span class="n">flow_id</span><span class="p">,</span>
</span><span id="Workflow.run_cloud-190"><a href="#Workflow.run_cloud-190"><span class="linenos">190</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters_serialized</span><span class="p">,</span>
</span><span id="Workflow.run_cloud-191"><a href="#Workflow.run_cloud-191"><span class="linenos">191</span></a>            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
</span><span id="Workflow.run_cloud-192"><a href="#Workflow.run_cloud-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="Workflow.run_cloud-193"><a href="#Workflow.run_cloud-193"><span class="linenos">193</span></a>
</span><span id="Workflow.run_cloud-194"><a href="#Workflow.run_cloud-194"><span class="linenos">194</span></a>        <span class="c1"># we log the website url to the flow for the user</span>
</span><span id="Workflow.run_cloud-195"><a href="#Workflow.run_cloud-195"><span class="linenos">195</span></a>        <span class="n">run_url</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_cloud_url</span><span class="p">(</span><span class="s2">&quot;flow-run&quot;</span><span class="p">,</span> <span class="n">flow_run_id</span><span class="p">)</span>
</span><span id="Workflow.run_cloud-196"><a href="#Workflow.run_cloud-196"><span class="linenos">196</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created flow run: </span><span class="si">{</span><span class="n">run_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">logger</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Workflow.run_cloud-197"><a href="#Workflow.run_cloud-197"><span class="linenos">197</span></a>
</span><span id="Workflow.run_cloud-198"><a href="#Workflow.run_cloud-198"><span class="linenos">198</span></a>        <span class="c1"># -----------------------------------</span>
</span><span id="Workflow.run_cloud-199"><a href="#Workflow.run_cloud-199"><span class="linenos">199</span></a>        <span class="c1"># This part is unique to Simmate. Because we often want to save some info</span>
</span><span id="Workflow.run_cloud-200"><a href="#Workflow.run_cloud-200"><span class="linenos">200</span></a>        <span class="c1"># to our database even before the calculation starts/finishes, we do that</span>
</span><span id="Workflow.run_cloud-201"><a href="#Workflow.run_cloud-201"><span class="linenos">201</span></a>        <span class="c1"># here. An example is storing the structure and prefect id that we just</span>
</span><span id="Workflow.run_cloud-202"><a href="#Workflow.run_cloud-202"><span class="linenos">202</span></a>        <span class="c1"># submitted.</span>
</span><span id="Workflow.run_cloud-203"><a href="#Workflow.run_cloud-203"><span class="linenos">203</span></a>        <span class="c1"># BUG: Will there be a race condition here? What if the workflow finishes</span>
</span><span id="Workflow.run_cloud-204"><a href="#Workflow.run_cloud-204"><span class="linenos">204</span></a>        <span class="c1"># and tries writing to the databse before this is done?</span>
</span><span id="Workflow.run_cloud-205"><a href="#Workflow.run_cloud-205"><span class="linenos">205</span></a>        <span class="n">parameters_cleaned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Workflow.run_cloud-206"><a href="#Workflow.run_cloud-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register_calculation</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">,</span> <span class="n">parameters_cleaned</span><span class="p">)</span>
</span><span id="Workflow.run_cloud-207"><a href="#Workflow.run_cloud-207"><span class="linenos">207</span></a>        <span class="c1"># -----------------------------------</span>
</span><span id="Workflow.run_cloud-208"><a href="#Workflow.run_cloud-208"><span class="linenos">208</span></a>
</span><span id="Workflow.run_cloud-209"><a href="#Workflow.run_cloud-209"><span class="linenos">209</span></a>        <span class="c1"># if we want to wait until the job is complete, we do that here</span>
</span><span id="Workflow.run_cloud-210"><a href="#Workflow.run_cloud-210"><span class="linenos">210</span></a>        <span class="k">if</span> <span class="n">wait_for_run</span><span class="p">:</span>
</span><span id="Workflow.run_cloud-211"><a href="#Workflow.run_cloud-211"><span class="linenos">211</span></a>            <span class="n">flow_run_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_flow_run</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">)</span>
</span><span id="Workflow.run_cloud-212"><a href="#Workflow.run_cloud-212"><span class="linenos">212</span></a>            <span class="c1"># return flow_run_view # !!! Should I return this instead?</span>
</span><span id="Workflow.run_cloud-213"><a href="#Workflow.run_cloud-213"><span class="linenos">213</span></a>
</span><span id="Workflow.run_cloud-214"><a href="#Workflow.run_cloud-214"><span class="linenos">214</span></a>        <span class="c1"># return the flow_run_id for the user</span>
</span><span id="Workflow.run_cloud-215"><a href="#Workflow.run_cloud-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="n">flow_run_id</span>
</span></pre></div>


            <div class="docstring"><p>This schedules the workflow to run remotely on Prefect Cloud.</p>

<h4 id="parameters">Parameters</h4>

<ul>
<li><p><code>labels</code>:
a list of labels to schedule the workflow with</p></li>
<li><p><code>wait_for_run</code>:
whether to wait for the workflow to finish. If False, the workflow
will simply be submitted and then exit. The default is True.</p></li>
<li><p><code>**kwargs</code>:
all options that are normally passed to the workflow.run() method</p></li>
</ul>

<h4 id="returns">Returns</h4>

<ul>
<li>The flow run id that was used in prefect cloud.</li>
</ul>

<h4 id="usage">Usage</h4>

<p>Make sure you have Prefect properly configured and have registered your
workflow with the backend.</p>

<p>Note that this method can be viewed as a fork of:
    - from prefect.tasks.prefect.flow_run import create_flow_run
It can also be viewed as a more convenient way to call to client.create_flow_run.
I don't accept any other client.create_flow_run() inputs besides 'labels'.
This may change in the future if I need to set flow run names or schedules.</p>
</div>


                            </div>
                            <div id="Workflow.wait_for_flow_run" class="classattr">
                                        <input id="Workflow.wait_for_flow_run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wait_for_flow_run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">flow_run_id</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="Workflow.wait_for_flow_run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Workflow.wait_for_flow_run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Workflow.wait_for_flow_run-217"><a href="#Workflow.wait_for_flow_run-217"><span class="linenos">217</span></a>    <span class="k">def</span> <span class="nf">wait_for_flow_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow_run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Workflow.wait_for_flow_run-218"><a href="#Workflow.wait_for_flow_run-218"><span class="linenos">218</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow.wait_for_flow_run-219"><a href="#Workflow.wait_for_flow_run-219"><span class="linenos">219</span></a><span class="sd">        Waits for a given flow run to complete</span>
</span><span id="Workflow.wait_for_flow_run-220"><a href="#Workflow.wait_for_flow_run-220"><span class="linenos">220</span></a>
</span><span id="Workflow.wait_for_flow_run-221"><a href="#Workflow.wait_for_flow_run-221"><span class="linenos">221</span></a><span class="sd">        This method is a direct fork of...</span>
</span><span id="Workflow.wait_for_flow_run-222"><a href="#Workflow.wait_for_flow_run-222"><span class="linenos">222</span></a><span class="sd">            from prefect.tasks.prefect.flow_run import wait_for_flow_run</span>
</span><span id="Workflow.wait_for_flow_run-223"><a href="#Workflow.wait_for_flow_run-223"><span class="linenos">223</span></a>
</span><span id="Workflow.wait_for_flow_run-224"><a href="#Workflow.wait_for_flow_run-224"><span class="linenos">224</span></a><span class="sd">        It does exactly the same thing where I just assume I want to stream logs.</span>
</span><span id="Workflow.wait_for_flow_run-225"><a href="#Workflow.wait_for_flow_run-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow.wait_for_flow_run-226"><a href="#Workflow.wait_for_flow_run-226"><span class="linenos">226</span></a>
</span><span id="Workflow.wait_for_flow_run-227"><a href="#Workflow.wait_for_flow_run-227"><span class="linenos">227</span></a>        <span class="n">flow_run</span> <span class="o">=</span> <span class="n">FlowRunView</span><span class="o">.</span><span class="n">from_flow_run_id</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">)</span>
</span><span id="Workflow.wait_for_flow_run-228"><a href="#Workflow.wait_for_flow_run-228"><span class="linenos">228</span></a>
</span><span id="Workflow.wait_for_flow_run-229"><a href="#Workflow.wait_for_flow_run-229"><span class="linenos">229</span></a>        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">flow_run_module</span><span class="o">.</span><span class="n">watch_flow_run</span><span class="p">(</span><span class="n">flow_run_id</span><span class="p">):</span>
</span><span id="Workflow.wait_for_flow_run-230"><a href="#Workflow.wait_for_flow_run-230"><span class="linenos">230</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Flow </span><span class="si">{</span><span class="n">flow_run</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Workflow.wait_for_flow_run-231"><a href="#Workflow.wait_for_flow_run-231"><span class="linenos">231</span></a>            <span class="n">prefect</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="Workflow.wait_for_flow_run-232"><a href="#Workflow.wait_for_flow_run-232"><span class="linenos">232</span></a>
</span><span id="Workflow.wait_for_flow_run-233"><a href="#Workflow.wait_for_flow_run-233"><span class="linenos">233</span></a>        <span class="c1"># Return the final view of the flow run</span>
</span><span id="Workflow.wait_for_flow_run-234"><a href="#Workflow.wait_for_flow_run-234"><span class="linenos">234</span></a>        <span class="k">return</span> <span class="n">flow_run</span><span class="o">.</span><span class="n">get_latest</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Waits for a given flow run to complete</p>

<p>This method is a direct fork of...
    from prefect.tasks.prefect.flow_run import wait_for_flow_run</p>

<p>It does exactly the same thing where I just assume I want to stream logs.</p>
</div>


                            </div>
                            <div id="Workflow.nflows_submitted" class="classattr">
                                <div class="attr variable">
            <span class="name">nflows_submitted</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Workflow.nflows_submitted"></a>
    
            <div class="docstring"><p>Queries Prefect to see how many workflows are in a running or submitted
state. It will return a count (integer).</p>

<p>Note, your workflow must be registered with Prefect for this to work.</p>
</div>


                            </div>
                            <div id="Workflow.to_workflow_task" class="classattr">
                                        <input id="Workflow.to_workflow_task-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_workflow_task</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span>)</span>

                <label class="view-source-button" for="Workflow.to_workflow_task-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Workflow.to_workflow_task"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Workflow.to_workflow_task-416"><a href="#Workflow.to_workflow_task-416"><span class="linenos">416</span></a>    <span class="k">def</span> <span class="nf">to_workflow_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Workflow.to_workflow_task-417"><a href="#Workflow.to_workflow_task-417"><span class="linenos">417</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Workflow.to_workflow_task-418"><a href="#Workflow.to_workflow_task-418"><span class="linenos">418</span></a><span class="sd">        Converts a prefect workflow to a prefect task (aka a &quot;workflow task&quot;)</span>
</span><span id="Workflow.to_workflow_task-419"><a href="#Workflow.to_workflow_task-419"><span class="linenos">419</span></a>
</span><span id="Workflow.to_workflow_task-420"><a href="#Workflow.to_workflow_task-420"><span class="linenos">420</span></a><span class="sd">        See the documentation in workflow_engine.tasks.workflow_task for more.</span>
</span><span id="Workflow.to_workflow_task-421"><a href="#Workflow.to_workflow_task-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Workflow.to_workflow_task-422"><a href="#Workflow.to_workflow_task-422"><span class="linenos">422</span></a>        <span class="kn">from</span> <span class="nn">simmate.workflow_engine</span> <span class="kn">import</span> <span class="n">WorkflowTask</span>
</span><span id="Workflow.to_workflow_task-423"><a href="#Workflow.to_workflow_task-423"><span class="linenos">423</span></a>
</span><span id="Workflow.to_workflow_task-424"><a href="#Workflow.to_workflow_task-424"><span class="linenos">424</span></a>        <span class="k">return</span> <span class="n">WorkflowTask</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Converts a prefect workflow to a prefect task (aka a "workflow task")</p>

<p>See the documentation in workflow_engine.tasks.workflow_task for more.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>prefect.core.flow.Flow</dt>
                                <dd id="Workflow.__init__" class="function">Flow</dd>
                <dd id="Workflow.copy" class="function">copy</dd>
                <dd id="Workflow.get_tasks" class="function">get_tasks</dd>
                <dd id="Workflow.replace" class="function">replace</dd>
                <dd id="Workflow.root_tasks" class="function">root_tasks</dd>
                <dd id="Workflow.terminal_tasks" class="function">terminal_tasks</dd>
                <dd id="Workflow.parameters" class="function">parameters</dd>
                <dd id="Workflow.reference_tasks" class="function">reference_tasks</dd>
                <dd id="Workflow.set_reference_tasks" class="function">set_reference_tasks</dd>
                <dd id="Workflow.add_task" class="function">add_task</dd>
                <dd id="Workflow.add_edge" class="function">add_edge</dd>
                <dd id="Workflow.chain" class="function">chain</dd>
                <dd id="Workflow.update" class="function">update</dd>
                <dd id="Workflow.all_upstream_edges" class="function">all_upstream_edges</dd>
                <dd id="Workflow.all_downstream_edges" class="function">all_downstream_edges</dd>
                <dd id="Workflow.edges_to" class="function">edges_to</dd>
                <dd id="Workflow.edges_from" class="function">edges_from</dd>
                <dd id="Workflow.upstream_tasks" class="function">upstream_tasks</dd>
                <dd id="Workflow.downstream_tasks" class="function">downstream_tasks</dd>
                <dd id="Workflow.validate" class="function">validate</dd>
                <dd id="Workflow.sorted_tasks" class="function">sorted_tasks</dd>
                <dd id="Workflow.set_dependencies" class="function">set_dependencies</dd>
                <dd id="Workflow.run" class="function">run</dd>
                <dd id="Workflow.visualize" class="function">visualize</dd>
                <dd id="Workflow.serialize" class="function">serialize</dd>
                <dd id="Workflow.serialized_hash" class="function">serialized_hash</dd>
                <dd id="Workflow.diagnostics" class="function">diagnostics</dd>
                <dd id="Workflow.load" class="function">load</dd>
                <dd id="Workflow.save" class="function">save</dd>
                <dd id="Workflow.run_agent" class="function">run_agent</dd>
                <dd id="Workflow.register" class="function">register</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>