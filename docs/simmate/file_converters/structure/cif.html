<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 11.1.0"/>
    <title>simmate.file_converters.structure.cif API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(:first-of-type){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc > section:first-of-type details > summary{top:-20px;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../structure.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simmate.file_converters.structure</a>

<a href="https://github.com/jacksund/simmate">            <img src="https://github.com/jacksund/simmate/blob/main/src/simmate/website/static_files/images/simmate-logo.svg?raw=true" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#CifParser">CifParser</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CifParser.__init__">CifParser</a>
                        </li>
                        <li>
                                <a class="function" href="#CifParser.from_string">from_string</a>
                        </li>
                        <li>
                                <a class="function" href="#CifParser.get_lattice">get_lattice</a>
                        </li>
                        <li>
                                <a class="function" href="#CifParser.get_symops">get_symops</a>
                        </li>
                        <li>
                                <a class="function" href="#CifParser.get_magsymops">get_magsymops</a>
                        </li>
                        <li>
                                <a class="function" href="#CifParser.parse_oxi_states">parse_oxi_states</a>
                        </li>
                        <li>
                                <a class="function" href="#CifParser.parse_magmoms">parse_magmoms</a>
                        </li>
                        <li>
                                <a class="function" href="#CifParser.get_structures">get_structures</a>
                        </li>
                        <li>
                                <a class="function" href="#CifParser.get_bibtex_string">get_bibtex_string</a>
                        </li>
                        <li>
                                <a class="function" href="#CifParser.as_dict">as_dict</a>
                        </li>
                        <li>
                                <a class="variable" href="#CifParser.has_errors">has_errors</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CifWriter">CifWriter</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CifWriter.__init__">CifWriter</a>
                        </li>
                        <li>
                                <a class="variable" href="#CifWriter.ciffile">ciffile</a>
                        </li>
                        <li>
                                <a class="function" href="#CifWriter.write_file">write_file</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/file_converters/structure/cif.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../simmate.html">simmate</a><wbr>.<a href="./../../file_converters.html">file_converters</a><wbr>.<a href="./../structure.html">structure</a><wbr>.cif    </h1>

                        <div class="docstring"><p>This converter simply imports a pymatgen class. With this you can quickly
convert between Simmate.toolkit and CIF files.</p>

<p>This class is built-in to the base toolkit class, so you typically can read/write
with CIFs without ever loading this module directly.</p>

<p>Recommended use:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="../../toolkit.html">simmate.toolkit</a></span> <span class="kn">import</span> <span class="n">Structure</span>

<span class="c1"># read a cif file</span>
<span class="n">initial_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;example.cif&quot;</span><span class="p">)</span>

<span class="c1"># write a cif file</span>
<span class="n">initial_structure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cif&quot;</span><span class="p">,</span> <span class="s2">&quot;my_new_file.cif&quot;</span><span class="p">)</span>
</code></pre></div>

<p>For advanced use, you can interact with this class directly:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="">simmate.file_converters.structure.cif</a></span> <span class="kn">import</span> <span class="n">CifParser</span>

<span class="c1"># load from file</span>
<span class="n">cif_data</span> <span class="o">=</span> <span class="n">CifParser</span><span class="p">(</span><span class="s2">&quot;example.cif&quot;</span><span class="p">)</span>

<span class="c1"># then access underlying data</span>
<span class="n">cif_data</span><span class="o">.</span><span class="n">get_structures</span><span class="p">()</span>
</code></pre></div>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="L-0"><a href="#L-0"><span class="linenos"> 0</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">This converter simply imports a pymatgen class. With this you can quickly</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">convert between Simmate.toolkit and CIF files.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="sd">This class is built-in to the base toolkit class, so you typically can read/write</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="sd">with CIFs without ever loading this module directly.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="sd">Recommended use:</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="sd">``` python</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="sd">from simmate.toolkit import Structure</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="sd"># read a cif file</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="sd">initial_structure = Structure.from_file(&quot;example.cif&quot;)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a><span class="sd"># write a cif file</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="sd">initial_structure.to(&quot;cif&quot;, &quot;my_new_file.cif&quot;)</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="sd">```</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="sd">For advanced use, you can interact with this class directly:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a><span class="sd">``` python</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="sd">from simmate.file_converters.structure.cif import CifParser</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a><span class="sd"># load from file</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a><span class="sd">cif_data = CifParser(&quot;example.cif&quot;)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a><span class="sd"># then access underlying data</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a><span class="sd">cif_data.get_structures()</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a><span class="sd">```</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a><span class="kn">from</span> <span class="nn">pymatgen.io.cif</span> <span class="kn">import</span> <span class="n">CifParser</span><span class="p">,</span> <span class="n">CifWriter</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CifParser&quot;</span><span class="p">,</span> <span class="s2">&quot;CifWriter&quot;</span><span class="p">]</span>
</span></pre></div>

        </details>

            </section>
                <section id="CifParser">
                                <div class="attr class">
        <a class="headerlink" href="#CifParser">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">CifParser</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser-287"><a href="#CifParser-287"><span class="linenos"> 287</span></a><span class="k">class</span> <span class="nc">CifParser</span><span class="p">:</span>
</span><span id="CifParser-288"><a href="#CifParser-288"><span class="linenos"> 288</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-289"><a href="#CifParser-289"><span class="linenos"> 289</span></a><span class="sd">    Parses a CIF file. Attempts to fix CIFs that are out-of-spec, but will</span>
</span><span id="CifParser-290"><a href="#CifParser-290"><span class="linenos"> 290</span></a><span class="sd">    issue warnings if corrections applied. These are also stored in the</span>
</span><span id="CifParser-291"><a href="#CifParser-291"><span class="linenos"> 291</span></a><span class="sd">    CifParser&#39;s errors attribute.</span>
</span><span id="CifParser-292"><a href="#CifParser-292"><span class="linenos"> 292</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CifParser-293"><a href="#CifParser-293"><span class="linenos"> 293</span></a>
</span><span id="CifParser-294"><a href="#CifParser-294"><span class="linenos"> 294</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">occupancy_tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">site_tolerance</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">):</span>
</span><span id="CifParser-295"><a href="#CifParser-295"><span class="linenos"> 295</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-296"><a href="#CifParser-296"><span class="linenos"> 296</span></a><span class="sd">        Args:</span>
</span><span id="CifParser-297"><a href="#CifParser-297"><span class="linenos"> 297</span></a><span class="sd">            filename (str): CIF filename, bzipped or gzipped CIF files are fine too.</span>
</span><span id="CifParser-298"><a href="#CifParser-298"><span class="linenos"> 298</span></a><span class="sd">            occupancy_tolerance (float): If total occupancy of a site is between 1</span>
</span><span id="CifParser-299"><a href="#CifParser-299"><span class="linenos"> 299</span></a><span class="sd">                and occupancy_tolerance, the occupancies will be scaled down to 1.</span>
</span><span id="CifParser-300"><a href="#CifParser-300"><span class="linenos"> 300</span></a><span class="sd">            site_tolerance (float): This tolerance is used to determine if two</span>
</span><span id="CifParser-301"><a href="#CifParser-301"><span class="linenos"> 301</span></a><span class="sd">                sites are sitting in the same position, in which case they will be</span>
</span><span id="CifParser-302"><a href="#CifParser-302"><span class="linenos"> 302</span></a><span class="sd">                combined to a single disordered site. Defaults to 1e-4.</span>
</span><span id="CifParser-303"><a href="#CifParser-303"><span class="linenos"> 303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-304"><a href="#CifParser-304"><span class="linenos"> 304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_occupancy_tolerance</span> <span class="o">=</span> <span class="n">occupancy_tolerance</span>
</span><span id="CifParser-305"><a href="#CifParser-305"><span class="linenos"> 305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_site_tolerance</span> <span class="o">=</span> <span class="n">site_tolerance</span>
</span><span id="CifParser-306"><a href="#CifParser-306"><span class="linenos"> 306</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
</span><span id="CifParser-307"><a href="#CifParser-307"><span class="linenos"> 307</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span> <span class="o">=</span> <span class="n">CifFile</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="CifParser-308"><a href="#CifParser-308"><span class="linenos"> 308</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-309"><a href="#CifParser-309"><span class="linenos"> 309</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span> <span class="o">=</span> <span class="n">CifFile</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="CifParser-310"><a href="#CifParser-310"><span class="linenos"> 310</span></a>
</span><span id="CifParser-311"><a href="#CifParser-311"><span class="linenos"> 311</span></a>        <span class="c1"># store if CIF contains features from non-core CIF dictionaries</span>
</span><span id="CifParser-312"><a href="#CifParser-312"><span class="linenos"> 312</span></a>        <span class="c1"># e.g. magCIF</span>
</span><span id="CifParser-313"><a href="#CifParser-313"><span class="linenos"> 313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-314"><a href="#CifParser-314"><span class="linenos"> 314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-315"><a href="#CifParser-315"><span class="linenos"> 315</span></a>
</span><span id="CifParser-316"><a href="#CifParser-316"><span class="linenos"> 316</span></a>        <span class="k">def</span> <span class="nf">is_magcif</span><span class="p">():</span>
</span><span id="CifParser-317"><a href="#CifParser-317"><span class="linenos"> 317</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-318"><a href="#CifParser-318"><span class="linenos"> 318</span></a><span class="sd">            Checks to see if file appears to be a magCIF file (heuristic).</span>
</span><span id="CifParser-319"><a href="#CifParser-319"><span class="linenos"> 319</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CifParser-320"><a href="#CifParser-320"><span class="linenos"> 320</span></a>            <span class="c1"># Doesn&#39;t seem to be a canonical way to test if file is magCIF or</span>
</span><span id="CifParser-321"><a href="#CifParser-321"><span class="linenos"> 321</span></a>            <span class="c1"># not, so instead check for magnetic symmetry datanames</span>
</span><span id="CifParser-322"><a href="#CifParser-322"><span class="linenos"> 322</span></a>            <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CifParser-323"><a href="#CifParser-323"><span class="linenos"> 323</span></a>                <span class="s2">&quot;_space_group_magn&quot;</span><span class="p">,</span>
</span><span id="CifParser-324"><a href="#CifParser-324"><span class="linenos"> 324</span></a>                <span class="s2">&quot;_atom_site_moment&quot;</span><span class="p">,</span>
</span><span id="CifParser-325"><a href="#CifParser-325"><span class="linenos"> 325</span></a>                <span class="s2">&quot;_space_group_symop_magn&quot;</span><span class="p">,</span>
</span><span id="CifParser-326"><a href="#CifParser-326"><span class="linenos"> 326</span></a>            <span class="p">]</span>
</span><span id="CifParser-327"><a href="#CifParser-327"><span class="linenos"> 327</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="CifParser-328"><a href="#CifParser-328"><span class="linenos"> 328</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser-329"><a href="#CifParser-329"><span class="linenos"> 329</span></a>                    <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>
</span><span id="CifParser-330"><a href="#CifParser-330"><span class="linenos"> 330</span></a>                        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
</span><span id="CifParser-331"><a href="#CifParser-331"><span class="linenos"> 331</span></a>                            <span class="k">return</span> <span class="kc">True</span>
</span><span id="CifParser-332"><a href="#CifParser-332"><span class="linenos"> 332</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="CifParser-333"><a href="#CifParser-333"><span class="linenos"> 333</span></a>
</span><span id="CifParser-334"><a href="#CifParser-334"><span class="linenos"> 334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_magcif</span><span class="p">()</span>
</span><span id="CifParser-335"><a href="#CifParser-335"><span class="linenos"> 335</span></a>
</span><span id="CifParser-336"><a href="#CifParser-336"><span class="linenos"> 336</span></a>        <span class="k">def</span> <span class="nf">is_magcif_incommensurate</span><span class="p">():</span>
</span><span id="CifParser-337"><a href="#CifParser-337"><span class="linenos"> 337</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-338"><a href="#CifParser-338"><span class="linenos"> 338</span></a><span class="sd">            Checks to see if file contains an incommensurate magnetic</span>
</span><span id="CifParser-339"><a href="#CifParser-339"><span class="linenos"> 339</span></a><span class="sd">            structure (heuristic).</span>
</span><span id="CifParser-340"><a href="#CifParser-340"><span class="linenos"> 340</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CifParser-341"><a href="#CifParser-341"><span class="linenos"> 341</span></a>            <span class="c1"># Doesn&#39;t seem to be a canonical way to test if magCIF file</span>
</span><span id="CifParser-342"><a href="#CifParser-342"><span class="linenos"> 342</span></a>            <span class="c1"># describes incommensurate structure or not, so instead check</span>
</span><span id="CifParser-343"><a href="#CifParser-343"><span class="linenos"> 343</span></a>            <span class="c1"># for common datanames</span>
</span><span id="CifParser-344"><a href="#CifParser-344"><span class="linenos"> 344</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]:</span>
</span><span id="CifParser-345"><a href="#CifParser-345"><span class="linenos"> 345</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="CifParser-346"><a href="#CifParser-346"><span class="linenos"> 346</span></a>            <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_cell_modulation_dimension&quot;</span><span class="p">,</span> <span class="s2">&quot;_cell_wave_vector&quot;</span><span class="p">]</span>
</span><span id="CifParser-347"><a href="#CifParser-347"><span class="linenos"> 347</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="CifParser-348"><a href="#CifParser-348"><span class="linenos"> 348</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser-349"><a href="#CifParser-349"><span class="linenos"> 349</span></a>                    <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>
</span><span id="CifParser-350"><a href="#CifParser-350"><span class="linenos"> 350</span></a>                        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
</span><span id="CifParser-351"><a href="#CifParser-351"><span class="linenos"> 351</span></a>                            <span class="k">return</span> <span class="kc">True</span>
</span><span id="CifParser-352"><a href="#CifParser-352"><span class="linenos"> 352</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="CifParser-353"><a href="#CifParser-353"><span class="linenos"> 353</span></a>
</span><span id="CifParser-354"><a href="#CifParser-354"><span class="linenos"> 354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif_incommensurate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_magcif_incommensurate</span><span class="p">()</span>
</span><span id="CifParser-355"><a href="#CifParser-355"><span class="linenos"> 355</span></a>
</span><span id="CifParser-356"><a href="#CifParser-356"><span class="linenos"> 356</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser-357"><a href="#CifParser-357"><span class="linenos"> 357</span></a>            <span class="c1"># pass individual CifBlocks to _sanitize_data</span>
</span><span id="CifParser-358"><a href="#CifParser-358"><span class="linenos"> 358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span id="CifParser-359"><a href="#CifParser-359"><span class="linenos"> 359</span></a>
</span><span id="CifParser-360"><a href="#CifParser-360"><span class="linenos"> 360</span></a>    <span class="nd">@staticmethod</span>
</span><span id="CifParser-361"><a href="#CifParser-361"><span class="linenos"> 361</span></a>    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">cif_string</span><span class="p">,</span> <span class="n">occupancy_tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="CifParser-362"><a href="#CifParser-362"><span class="linenos"> 362</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-363"><a href="#CifParser-363"><span class="linenos"> 363</span></a><span class="sd">        Creates a CifParser from a string.</span>
</span><span id="CifParser-364"><a href="#CifParser-364"><span class="linenos"> 364</span></a>
</span><span id="CifParser-365"><a href="#CifParser-365"><span class="linenos"> 365</span></a><span class="sd">        Args:</span>
</span><span id="CifParser-366"><a href="#CifParser-366"><span class="linenos"> 366</span></a><span class="sd">            cif_string (str): String representation of a CIF.</span>
</span><span id="CifParser-367"><a href="#CifParser-367"><span class="linenos"> 367</span></a><span class="sd">            occupancy_tolerance (float): If total occupancy of a site is</span>
</span><span id="CifParser-368"><a href="#CifParser-368"><span class="linenos"> 368</span></a><span class="sd">                between 1 and occupancy_tolerance, the occupancies will be</span>
</span><span id="CifParser-369"><a href="#CifParser-369"><span class="linenos"> 369</span></a><span class="sd">                scaled down to 1.</span>
</span><span id="CifParser-370"><a href="#CifParser-370"><span class="linenos"> 370</span></a>
</span><span id="CifParser-371"><a href="#CifParser-371"><span class="linenos"> 371</span></a><span class="sd">        Returns:</span>
</span><span id="CifParser-372"><a href="#CifParser-372"><span class="linenos"> 372</span></a><span class="sd">            CifParser</span>
</span><span id="CifParser-373"><a href="#CifParser-373"><span class="linenos"> 373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-374"><a href="#CifParser-374"><span class="linenos"> 374</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">cif_string</span><span class="p">)</span>
</span><span id="CifParser-375"><a href="#CifParser-375"><span class="linenos"> 375</span></a>        <span class="k">return</span> <span class="n">CifParser</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">occupancy_tolerance</span><span class="p">)</span>
</span><span id="CifParser-376"><a href="#CifParser-376"><span class="linenos"> 376</span></a>
</span><span id="CifParser-377"><a href="#CifParser-377"><span class="linenos"> 377</span></a>    <span class="k">def</span> <span class="nf">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="CifParser-378"><a href="#CifParser-378"><span class="linenos"> 378</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-379"><a href="#CifParser-379"><span class="linenos"> 379</span></a><span class="sd">        Some CIF files do not conform to spec. This function corrects</span>
</span><span id="CifParser-380"><a href="#CifParser-380"><span class="linenos"> 380</span></a><span class="sd">        known issues, particular in regards to Springer materials/</span>
</span><span id="CifParser-381"><a href="#CifParser-381"><span class="linenos"> 381</span></a><span class="sd">        Pauling files.</span>
</span><span id="CifParser-382"><a href="#CifParser-382"><span class="linenos"> 382</span></a>
</span><span id="CifParser-383"><a href="#CifParser-383"><span class="linenos"> 383</span></a><span class="sd">        This function is here so that CifParser can assume its</span>
</span><span id="CifParser-384"><a href="#CifParser-384"><span class="linenos"> 384</span></a><span class="sd">        input conforms to spec, simplifying its implementation.</span>
</span><span id="CifParser-385"><a href="#CifParser-385"><span class="linenos"> 385</span></a><span class="sd">        :param data: CifBlock</span>
</span><span id="CifParser-386"><a href="#CifParser-386"><span class="linenos"> 386</span></a><span class="sd">        :return: data CifBlock</span>
</span><span id="CifParser-387"><a href="#CifParser-387"><span class="linenos"> 387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-388"><a href="#CifParser-388"><span class="linenos"> 388</span></a>
</span><span id="CifParser-389"><a href="#CifParser-389"><span class="linenos"> 389</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-390"><a href="#CifParser-390"><span class="linenos"> 390</span></a><span class="sd">        This part of the code deals with handling formats of data as found in</span>
</span><span id="CifParser-391"><a href="#CifParser-391"><span class="linenos"> 391</span></a><span class="sd">        CIF files extracted from the Springer Materials/Pauling File</span>
</span><span id="CifParser-392"><a href="#CifParser-392"><span class="linenos"> 392</span></a><span class="sd">        databases, and that are different from standard ICSD formats.</span>
</span><span id="CifParser-393"><a href="#CifParser-393"><span class="linenos"> 393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-394"><a href="#CifParser-394"><span class="linenos"> 394</span></a>
</span><span id="CifParser-395"><a href="#CifParser-395"><span class="linenos"> 395</span></a>        <span class="c1"># check for implicit hydrogens, warn if any present</span>
</span><span id="CifParser-396"><a href="#CifParser-396"><span class="linenos"> 396</span></a>        <span class="k">if</span> <span class="s2">&quot;_atom_site_attached_hydrogens&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser-397"><a href="#CifParser-397"><span class="linenos"> 397</span></a>            <span class="n">attached_hydrogens</span> <span class="o">=</span> <span class="p">[</span><span class="n">str2float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_attached_hydrogens&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">str2float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="CifParser-398"><a href="#CifParser-398"><span class="linenos"> 398</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attached_hydrogens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifParser-399"><a href="#CifParser-399"><span class="linenos"> 399</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CifParser-400"><a href="#CifParser-400"><span class="linenos"> 400</span></a>                    <span class="s2">&quot;Structure has implicit hydrogens defined, &quot;</span>
</span><span id="CifParser-401"><a href="#CifParser-401"><span class="linenos"> 401</span></a>                    <span class="s2">&quot;parsed structure unlikely to be suitable for use &quot;</span>
</span><span id="CifParser-402"><a href="#CifParser-402"><span class="linenos"> 402</span></a>                    <span class="s2">&quot;in calculations unless hydrogens added.&quot;</span>
</span><span id="CifParser-403"><a href="#CifParser-403"><span class="linenos"> 403</span></a>                <span class="p">)</span>
</span><span id="CifParser-404"><a href="#CifParser-404"><span class="linenos"> 404</span></a>
</span><span id="CifParser-405"><a href="#CifParser-405"><span class="linenos"> 405</span></a>        <span class="c1"># Check to see if &quot;_atom_site_type_symbol&quot; exists, as some test CIFs do</span>
</span><span id="CifParser-406"><a href="#CifParser-406"><span class="linenos"> 406</span></a>        <span class="c1"># not contain this key.</span>
</span><span id="CifParser-407"><a href="#CifParser-407"><span class="linenos"> 407</span></a>        <span class="k">if</span> <span class="s2">&quot;_atom_site_type_symbol&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser-408"><a href="#CifParser-408"><span class="linenos"> 408</span></a>
</span><span id="CifParser-409"><a href="#CifParser-409"><span class="linenos"> 409</span></a>            <span class="c1"># Keep a track of which data row needs to be removed.</span>
</span><span id="CifParser-410"><a href="#CifParser-410"><span class="linenos"> 410</span></a>            <span class="c1"># Example of a row: Nb,Zr &#39;0.8Nb + 0.2Zr&#39; .2a .m-3m 0 0 0 1 14</span>
</span><span id="CifParser-411"><a href="#CifParser-411"><span class="linenos"> 411</span></a>            <span class="c1"># &#39;rhombic dodecahedron, Nb&lt;sub&gt;14&lt;/sub&gt;&#39;</span>
</span><span id="CifParser-412"><a href="#CifParser-412"><span class="linenos"> 412</span></a>            <span class="c1"># Without this code, the above row in a structure would be parsed</span>
</span><span id="CifParser-413"><a href="#CifParser-413"><span class="linenos"> 413</span></a>            <span class="c1"># as an ordered site with only Nb (since</span>
</span><span id="CifParser-414"><a href="#CifParser-414"><span class="linenos"> 414</span></a>            <span class="c1"># CifParser would try to parse the first two characters of the</span>
</span><span id="CifParser-415"><a href="#CifParser-415"><span class="linenos"> 415</span></a>            <span class="c1"># label &quot;Nb,Zr&quot;) and occupancy=1.</span>
</span><span id="CifParser-416"><a href="#CifParser-416"><span class="linenos"> 416</span></a>            <span class="c1"># However, this site is meant to be a disordered site with 0.8 of</span>
</span><span id="CifParser-417"><a href="#CifParser-417"><span class="linenos"> 417</span></a>            <span class="c1"># Nb and 0.2 of Zr.</span>
</span><span id="CifParser-418"><a href="#CifParser-418"><span class="linenos"> 418</span></a>            <span class="n">idxs_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-419"><a href="#CifParser-419"><span class="linenos"> 419</span></a>
</span><span id="CifParser-420"><a href="#CifParser-420"><span class="linenos"> 420</span></a>            <span class="n">new_atom_site_label</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-421"><a href="#CifParser-421"><span class="linenos"> 421</span></a>            <span class="n">new_atom_site_type_symbol</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-422"><a href="#CifParser-422"><span class="linenos"> 422</span></a>            <span class="n">new_atom_site_occupancy</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-423"><a href="#CifParser-423"><span class="linenos"> 423</span></a>            <span class="n">new_fract_x</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-424"><a href="#CifParser-424"><span class="linenos"> 424</span></a>            <span class="n">new_fract_y</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-425"><a href="#CifParser-425"><span class="linenos"> 425</span></a>            <span class="n">new_fract_z</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-426"><a href="#CifParser-426"><span class="linenos"> 426</span></a>
</span><span id="CifParser-427"><a href="#CifParser-427"><span class="linenos"> 427</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">el_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_label&quot;</span><span class="p">]):</span>
</span><span id="CifParser-428"><a href="#CifParser-428"><span class="linenos"> 428</span></a>
</span><span id="CifParser-429"><a href="#CifParser-429"><span class="linenos"> 429</span></a>                <span class="c1"># CIF files from the Springer Materials/Pauling File have</span>
</span><span id="CifParser-430"><a href="#CifParser-430"><span class="linenos"> 430</span></a>                <span class="c1"># switched the label and symbol. Thus, in the</span>
</span><span id="CifParser-431"><a href="#CifParser-431"><span class="linenos"> 431</span></a>                <span class="c1"># above shown example row, &#39;0.8Nb + 0.2Zr&#39; is the symbol.</span>
</span><span id="CifParser-432"><a href="#CifParser-432"><span class="linenos"> 432</span></a>                <span class="c1"># Below, we split the strings on &#39; + &#39; to</span>
</span><span id="CifParser-433"><a href="#CifParser-433"><span class="linenos"> 433</span></a>                <span class="c1"># check if the length (or number of elements) in the label and</span>
</span><span id="CifParser-434"><a href="#CifParser-434"><span class="linenos"> 434</span></a>                <span class="c1"># symbol are equal.</span>
</span><span id="CifParser-435"><a href="#CifParser-435"><span class="linenos"> 435</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; + &quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="CifParser-436"><a href="#CifParser-436"><span class="linenos"> 436</span></a>                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_label&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; + &quot;</span><span class="p">)</span>
</span><span id="CifParser-437"><a href="#CifParser-437"><span class="linenos"> 437</span></a>                <span class="p">):</span>
</span><span id="CifParser-438"><a href="#CifParser-438"><span class="linenos"> 438</span></a>
</span><span id="CifParser-439"><a href="#CifParser-439"><span class="linenos"> 439</span></a>                    <span class="c1"># Dictionary to hold extracted elements and occupancies</span>
</span><span id="CifParser-440"><a href="#CifParser-440"><span class="linenos"> 440</span></a>                    <span class="n">els_occu</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-441"><a href="#CifParser-441"><span class="linenos"> 441</span></a>
</span><span id="CifParser-442"><a href="#CifParser-442"><span class="linenos"> 442</span></a>                    <span class="c1"># parse symbol to get element names and occupancy and store</span>
</span><span id="CifParser-443"><a href="#CifParser-443"><span class="linenos"> 443</span></a>                    <span class="c1"># in &quot;els_occu&quot;</span>
</span><span id="CifParser-444"><a href="#CifParser-444"><span class="linenos"> 444</span></a>                    <span class="n">symbol_str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
</span><span id="CifParser-445"><a href="#CifParser-445"><span class="linenos"> 445</span></a>                    <span class="n">symbol_str_lst</span> <span class="o">=</span> <span class="n">symbol_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; + &quot;</span><span class="p">)</span>
</span><span id="CifParser-446"><a href="#CifParser-446"><span class="linenos"> 446</span></a>                    <span class="k">for</span> <span class="n">elocc_idx</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">symbol_str_lst</span><span class="p">):</span>
</span><span id="CifParser-447"><a href="#CifParser-447"><span class="linenos"> 447</span></a>                        <span class="c1"># Remove any bracketed items in the string</span>
</span><span id="CifParser-448"><a href="#CifParser-448"><span class="linenos"> 448</span></a>                        <span class="n">symbol_str_lst</span><span class="p">[</span><span class="n">elocc_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\([0-9]*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="CifParser-449"><a href="#CifParser-449"><span class="linenos"> 449</span></a>
</span><span id="CifParser-450"><a href="#CifParser-450"><span class="linenos"> 450</span></a>                        <span class="c1"># Extract element name and its occupancy from the</span>
</span><span id="CifParser-451"><a href="#CifParser-451"><span class="linenos"> 451</span></a>                        <span class="c1"># string, and store it as a</span>
</span><span id="CifParser-452"><a href="#CifParser-452"><span class="linenos"> 452</span></a>                        <span class="c1"># key-value pair in &quot;els_occ&quot;.</span>
</span><span id="CifParser-453"><a href="#CifParser-453"><span class="linenos"> 453</span></a>                        <span class="n">els_occu</span><span class="p">[</span>
</span><span id="CifParser-454"><a href="#CifParser-454"><span class="linenos"> 454</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\D+&quot;</span><span class="p">,</span> <span class="n">symbol_str_lst</span><span class="p">[</span><span class="n">elocc_idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;sup&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="CifParser-455"><a href="#CifParser-455"><span class="linenos"> 455</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.?\d+&quot;</span><span class="p">,</span> <span class="n">symbol_str_lst</span><span class="p">[</span><span class="n">elocc_idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="CifParser-456"><a href="#CifParser-456"><span class="linenos"> 456</span></a>
</span><span id="CifParser-457"><a href="#CifParser-457"><span class="linenos"> 457</span></a>                    <span class="n">x</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_x&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
</span><span id="CifParser-458"><a href="#CifParser-458"><span class="linenos"> 458</span></a>                    <span class="n">y</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_y&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
</span><span id="CifParser-459"><a href="#CifParser-459"><span class="linenos"> 459</span></a>                    <span class="n">z</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_z&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
</span><span id="CifParser-460"><a href="#CifParser-460"><span class="linenos"> 460</span></a>
</span><span id="CifParser-461"><a href="#CifParser-461"><span class="linenos"> 461</span></a>                    <span class="k">for</span> <span class="n">et</span><span class="p">,</span> <span class="n">occu</span> <span class="ow">in</span> <span class="n">els_occu</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-462"><a href="#CifParser-462"><span class="linenos"> 462</span></a>                        <span class="c1"># new atom site labels have &#39;fix&#39; appended</span>
</span><span id="CifParser-463"><a href="#CifParser-463"><span class="linenos"> 463</span></a>                        <span class="n">new_atom_site_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">et</span> <span class="o">+</span> <span class="s2">&quot;_fix&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_atom_site_label</span><span class="p">)))</span>
</span><span id="CifParser-464"><a href="#CifParser-464"><span class="linenos"> 464</span></a>                        <span class="n">new_atom_site_type_symbol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">et</span><span class="p">)</span>
</span><span id="CifParser-465"><a href="#CifParser-465"><span class="linenos"> 465</span></a>                        <span class="n">new_atom_site_occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">occu</span><span class="p">))</span>
</span><span id="CifParser-466"><a href="#CifParser-466"><span class="linenos"> 466</span></a>                        <span class="n">new_fract_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="CifParser-467"><a href="#CifParser-467"><span class="linenos"> 467</span></a>                        <span class="n">new_fract_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</span><span id="CifParser-468"><a href="#CifParser-468"><span class="linenos"> 468</span></a>                        <span class="n">new_fract_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="CifParser-469"><a href="#CifParser-469"><span class="linenos"> 469</span></a>
</span><span id="CifParser-470"><a href="#CifParser-470"><span class="linenos"> 470</span></a>                    <span class="n">idxs_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
</span><span id="CifParser-471"><a href="#CifParser-471"><span class="linenos"> 471</span></a>
</span><span id="CifParser-472"><a href="#CifParser-472"><span class="linenos"> 472</span></a>            <span class="c1"># Remove the original row by iterating over all keys in the CIF</span>
</span><span id="CifParser-473"><a href="#CifParser-473"><span class="linenos"> 473</span></a>            <span class="c1"># data looking for lists, which indicates</span>
</span><span id="CifParser-474"><a href="#CifParser-474"><span class="linenos"> 474</span></a>            <span class="c1"># multiple data items, one for each row, and remove items from the</span>
</span><span id="CifParser-475"><a href="#CifParser-475"><span class="linenos"> 475</span></a>            <span class="c1"># list that corresponds to the removed row,</span>
</span><span id="CifParser-476"><a href="#CifParser-476"><span class="linenos"> 476</span></a>            <span class="c1"># so that it&#39;s not processed by the rest of this function (which</span>
</span><span id="CifParser-477"><a href="#CifParser-477"><span class="linenos"> 477</span></a>            <span class="c1"># would result in an error).</span>
</span><span id="CifParser-478"><a href="#CifParser-478"><span class="linenos"> 478</span></a>            <span class="k">for</span> <span class="n">original_key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span id="CifParser-479"><a href="#CifParser-479"><span class="linenos"> 479</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">original_key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="CifParser-480"><a href="#CifParser-480"><span class="linenos"> 480</span></a>                    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">idxs_to_remove</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CifParser-481"><a href="#CifParser-481"><span class="linenos"> 481</span></a>                        <span class="k">del</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">original_key</span><span class="p">][</span><span class="nb">id</span><span class="p">]</span>
</span><span id="CifParser-482"><a href="#CifParser-482"><span class="linenos"> 482</span></a>
</span><span id="CifParser-483"><a href="#CifParser-483"><span class="linenos"> 483</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxs_to_remove</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifParser-484"><a href="#CifParser-484"><span class="linenos"> 484</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Pauling file corrections applied.&quot;</span><span class="p">)</span>
</span><span id="CifParser-485"><a href="#CifParser-485"><span class="linenos"> 485</span></a>
</span><span id="CifParser-486"><a href="#CifParser-486"><span class="linenos"> 486</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_label&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_atom_site_label</span>
</span><span id="CifParser-487"><a href="#CifParser-487"><span class="linenos"> 487</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_atom_site_type_symbol</span>
</span><span id="CifParser-488"><a href="#CifParser-488"><span class="linenos"> 488</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_occupancy&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_atom_site_occupancy</span>
</span><span id="CifParser-489"><a href="#CifParser-489"><span class="linenos"> 489</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_x&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_fract_x</span>
</span><span id="CifParser-490"><a href="#CifParser-490"><span class="linenos"> 490</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_y&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_fract_y</span>
</span><span id="CifParser-491"><a href="#CifParser-491"><span class="linenos"> 491</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_z&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_fract_z</span>
</span><span id="CifParser-492"><a href="#CifParser-492"><span class="linenos"> 492</span></a>
</span><span id="CifParser-493"><a href="#CifParser-493"><span class="linenos"> 493</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-494"><a href="#CifParser-494"><span class="linenos"> 494</span></a><span class="sd">        This fixes inconsistencies in naming of several magCIF tags</span>
</span><span id="CifParser-495"><a href="#CifParser-495"><span class="linenos"> 495</span></a><span class="sd">        as a result of magCIF being in widespread use prior to</span>
</span><span id="CifParser-496"><a href="#CifParser-496"><span class="linenos"> 496</span></a><span class="sd">        specification being finalized (on advice of Branton Campbell).</span>
</span><span id="CifParser-497"><a href="#CifParser-497"><span class="linenos"> 497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-498"><a href="#CifParser-498"><span class="linenos"> 498</span></a>
</span><span id="CifParser-499"><a href="#CifParser-499"><span class="linenos"> 499</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]:</span>
</span><span id="CifParser-500"><a href="#CifParser-500"><span class="linenos"> 500</span></a>
</span><span id="CifParser-501"><a href="#CifParser-501"><span class="linenos"> 501</span></a>            <span class="c1"># CIF-1 style has all underscores, interim standard</span>
</span><span id="CifParser-502"><a href="#CifParser-502"><span class="linenos"> 502</span></a>            <span class="c1"># had period before magn instead of before the final</span>
</span><span id="CifParser-503"><a href="#CifParser-503"><span class="linenos"> 503</span></a>            <span class="c1"># component (e.g. xyz)</span>
</span><span id="CifParser-504"><a href="#CifParser-504"><span class="linenos"> 504</span></a>            <span class="c1"># we want to standardize on a specific key, to simplify</span>
</span><span id="CifParser-505"><a href="#CifParser-505"><span class="linenos"> 505</span></a>            <span class="c1"># parsing code</span>
</span><span id="CifParser-506"><a href="#CifParser-506"><span class="linenos"> 506</span></a>            <span class="n">correct_keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CifParser-507"><a href="#CifParser-507"><span class="linenos"> 507</span></a>                <span class="s2">&quot;_space_group_symop_magn_operation.xyz&quot;</span><span class="p">,</span>
</span><span id="CifParser-508"><a href="#CifParser-508"><span class="linenos"> 508</span></a>                <span class="s2">&quot;_space_group_symop_magn_centering.xyz&quot;</span><span class="p">,</span>
</span><span id="CifParser-509"><a href="#CifParser-509"><span class="linenos"> 509</span></a>                <span class="s2">&quot;_space_group_magn.name_BNS&quot;</span><span class="p">,</span>
</span><span id="CifParser-510"><a href="#CifParser-510"><span class="linenos"> 510</span></a>                <span class="s2">&quot;_space_group_magn.number_BNS&quot;</span><span class="p">,</span>
</span><span id="CifParser-511"><a href="#CifParser-511"><span class="linenos"> 511</span></a>                <span class="s2">&quot;_atom_site_moment_crystalaxis_x&quot;</span><span class="p">,</span>
</span><span id="CifParser-512"><a href="#CifParser-512"><span class="linenos"> 512</span></a>                <span class="s2">&quot;_atom_site_moment_crystalaxis_y&quot;</span><span class="p">,</span>
</span><span id="CifParser-513"><a href="#CifParser-513"><span class="linenos"> 513</span></a>                <span class="s2">&quot;_atom_site_moment_crystalaxis_z&quot;</span><span class="p">,</span>
</span><span id="CifParser-514"><a href="#CifParser-514"><span class="linenos"> 514</span></a>                <span class="s2">&quot;_atom_site_moment_label&quot;</span><span class="p">,</span>
</span><span id="CifParser-515"><a href="#CifParser-515"><span class="linenos"> 515</span></a>            <span class="p">]</span>
</span><span id="CifParser-516"><a href="#CifParser-516"><span class="linenos"> 516</span></a>
</span><span id="CifParser-517"><a href="#CifParser-517"><span class="linenos"> 517</span></a>            <span class="c1"># cannot mutate dict during enumeration, so store changes we want to make</span>
</span><span id="CifParser-518"><a href="#CifParser-518"><span class="linenos"> 518</span></a>            <span class="n">changes_to_make</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-519"><a href="#CifParser-519"><span class="linenos"> 519</span></a>
</span><span id="CifParser-520"><a href="#CifParser-520"><span class="linenos"> 520</span></a>            <span class="k">for</span> <span class="n">original_key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span id="CifParser-521"><a href="#CifParser-521"><span class="linenos"> 521</span></a>                <span class="k">for</span> <span class="n">correct_key</span> <span class="ow">in</span> <span class="n">correct_keys</span><span class="p">:</span>
</span><span id="CifParser-522"><a href="#CifParser-522"><span class="linenos"> 522</span></a>                    <span class="c1"># convert to all underscore</span>
</span><span id="CifParser-523"><a href="#CifParser-523"><span class="linenos"> 523</span></a>                    <span class="n">trial_key</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">correct_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
</span><span id="CifParser-524"><a href="#CifParser-524"><span class="linenos"> 524</span></a>                    <span class="n">test_key</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">original_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
</span><span id="CifParser-525"><a href="#CifParser-525"><span class="linenos"> 525</span></a>                    <span class="k">if</span> <span class="n">trial_key</span> <span class="o">==</span> <span class="n">test_key</span><span class="p">:</span>
</span><span id="CifParser-526"><a href="#CifParser-526"><span class="linenos"> 526</span></a>                        <span class="n">changes_to_make</span><span class="p">[</span><span class="n">correct_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_key</span>
</span><span id="CifParser-527"><a href="#CifParser-527"><span class="linenos"> 527</span></a>
</span><span id="CifParser-528"><a href="#CifParser-528"><span class="linenos"> 528</span></a>            <span class="c1"># make changes</span>
</span><span id="CifParser-529"><a href="#CifParser-529"><span class="linenos"> 529</span></a>            <span class="k">for</span> <span class="n">correct_key</span><span class="p">,</span> <span class="n">original_key</span> <span class="ow">in</span> <span class="n">changes_to_make</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-530"><a href="#CifParser-530"><span class="linenos"> 530</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">correct_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">original_key</span><span class="p">]</span>
</span><span id="CifParser-531"><a href="#CifParser-531"><span class="linenos"> 531</span></a>
</span><span id="CifParser-532"><a href="#CifParser-532"><span class="linenos"> 532</span></a>            <span class="c1"># renamed_keys maps interim_keys to final_keys</span>
</span><span id="CifParser-533"><a href="#CifParser-533"><span class="linenos"> 533</span></a>            <span class="n">renamed_keys</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CifParser-534"><a href="#CifParser-534"><span class="linenos"> 534</span></a>                <span class="s2">&quot;_magnetic_space_group.transform_to_standard_Pp_abc&quot;</span><span class="p">:</span> <span class="s2">&quot;_space_group_magn.transform_BNS_Pp_abc&quot;</span>
</span><span id="CifParser-535"><a href="#CifParser-535"><span class="linenos"> 535</span></a>            <span class="p">}</span>
</span><span id="CifParser-536"><a href="#CifParser-536"><span class="linenos"> 536</span></a>            <span class="n">changes_to_make</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-537"><a href="#CifParser-537"><span class="linenos"> 537</span></a>
</span><span id="CifParser-538"><a href="#CifParser-538"><span class="linenos"> 538</span></a>            <span class="k">for</span> <span class="n">interim_key</span><span class="p">,</span> <span class="n">final_key</span> <span class="ow">in</span> <span class="n">renamed_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-539"><a href="#CifParser-539"><span class="linenos"> 539</span></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">interim_key</span><span class="p">):</span>
</span><span id="CifParser-540"><a href="#CifParser-540"><span class="linenos"> 540</span></a>                    <span class="n">changes_to_make</span><span class="p">[</span><span class="n">final_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">interim_key</span>
</span><span id="CifParser-541"><a href="#CifParser-541"><span class="linenos"> 541</span></a>
</span><span id="CifParser-542"><a href="#CifParser-542"><span class="linenos"> 542</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">changes_to_make</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifParser-543"><a href="#CifParser-543"><span class="linenos"> 543</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Keys changed to match new magCIF specification.&quot;</span><span class="p">)</span>
</span><span id="CifParser-544"><a href="#CifParser-544"><span class="linenos"> 544</span></a>
</span><span id="CifParser-545"><a href="#CifParser-545"><span class="linenos"> 545</span></a>            <span class="k">for</span> <span class="n">final_key</span><span class="p">,</span> <span class="n">interim_key</span> <span class="ow">in</span> <span class="n">changes_to_make</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-546"><a href="#CifParser-546"><span class="linenos"> 546</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">final_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">interim_key</span><span class="p">]</span>
</span><span id="CifParser-547"><a href="#CifParser-547"><span class="linenos"> 547</span></a>
</span><span id="CifParser-548"><a href="#CifParser-548"><span class="linenos"> 548</span></a>        <span class="c1"># check for finite precision frac coordinates (e.g. 0.6667 instead of 0.6666666...7)</span>
</span><span id="CifParser-549"><a href="#CifParser-549"><span class="linenos"> 549</span></a>        <span class="c1"># this can sometimes cause serious issues when applying symmetry operations</span>
</span><span id="CifParser-550"><a href="#CifParser-550"><span class="linenos"> 550</span></a>        <span class="n">important_fracs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
</span><span id="CifParser-551"><a href="#CifParser-551"><span class="linenos"> 551</span></a>        <span class="n">fracs_to_change</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-552"><a href="#CifParser-552"><span class="linenos"> 552</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;_atom_site_fract_x&quot;</span><span class="p">,</span> <span class="s2">&quot;_atom_site_fract_y&quot;</span><span class="p">,</span> <span class="s2">&quot;_atom_site_fract_z&quot;</span><span class="p">):</span>
</span><span id="CifParser-553"><a href="#CifParser-553"><span class="linenos"> 553</span></a>            <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser-554"><a href="#CifParser-554"><span class="linenos"> 554</span></a>                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">frac</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]):</span>
</span><span id="CifParser-555"><a href="#CifParser-555"><span class="linenos"> 555</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-556"><a href="#CifParser-556"><span class="linenos"> 556</span></a>                        <span class="n">frac</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span>
</span><span id="CifParser-557"><a href="#CifParser-557"><span class="linenos"> 557</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="CifParser-558"><a href="#CifParser-558"><span class="linenos"> 558</span></a>                        <span class="c1"># coordinate might not be defined e.g. &#39;?&#39;</span>
</span><span id="CifParser-559"><a href="#CifParser-559"><span class="linenos"> 559</span></a>                        <span class="k">continue</span>
</span><span id="CifParser-560"><a href="#CifParser-560"><span class="linenos"> 560</span></a>                    <span class="k">for</span> <span class="n">comparison_frac</span> <span class="ow">in</span> <span class="n">important_fracs</span><span class="p">:</span>
</span><span id="CifParser-561"><a href="#CifParser-561"><span class="linenos"> 561</span></a>                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">frac</span> <span class="o">/</span> <span class="n">comparison_frac</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-4</span><span class="p">:</span>
</span><span id="CifParser-562"><a href="#CifParser-562"><span class="linenos"> 562</span></a>                            <span class="n">fracs_to_change</span><span class="p">[(</span><span class="n">label</span><span class="p">,</span> <span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comparison_frac</span><span class="p">)</span>
</span><span id="CifParser-563"><a href="#CifParser-563"><span class="linenos"> 563</span></a>        <span class="k">if</span> <span class="n">fracs_to_change</span><span class="p">:</span>
</span><span id="CifParser-564"><a href="#CifParser-564"><span class="linenos"> 564</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CifParser-565"><a href="#CifParser-565"><span class="linenos"> 565</span></a>                <span class="s2">&quot;Some fractional coordinates rounded to ideal values to avoid issues with finite precision.&quot;</span>
</span><span id="CifParser-566"><a href="#CifParser-566"><span class="linenos"> 566</span></a>            <span class="p">)</span>
</span><span id="CifParser-567"><a href="#CifParser-567"><span class="linenos"> 567</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fracs_to_change</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-568"><a href="#CifParser-568"><span class="linenos"> 568</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="CifParser-569"><a href="#CifParser-569"><span class="linenos"> 569</span></a>
</span><span id="CifParser-570"><a href="#CifParser-570"><span class="linenos"> 570</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="CifParser-571"><a href="#CifParser-571"><span class="linenos"> 571</span></a>
</span><span id="CifParser-572"><a href="#CifParser-572"><span class="linenos"> 572</span></a>    <span class="k">def</span> <span class="nf">_unique_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords_in</span><span class="p">,</span> <span class="n">magmoms_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="CifParser-573"><a href="#CifParser-573"><span class="linenos"> 573</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-574"><a href="#CifParser-574"><span class="linenos"> 574</span></a><span class="sd">        Generate unique coordinates using coord and symmetry positions</span>
</span><span id="CifParser-575"><a href="#CifParser-575"><span class="linenos"> 575</span></a><span class="sd">        and also their corresponding magnetic moments, if supplied.</span>
</span><span id="CifParser-576"><a href="#CifParser-576"><span class="linenos"> 576</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-577"><a href="#CifParser-577"><span class="linenos"> 577</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-578"><a href="#CifParser-578"><span class="linenos"> 578</span></a>        <span class="k">if</span> <span class="n">magmoms_in</span><span class="p">:</span>
</span><span id="CifParser-579"><a href="#CifParser-579"><span class="linenos"> 579</span></a>            <span class="n">magmoms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-580"><a href="#CifParser-580"><span class="linenos"> 580</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">magmoms_in</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords_in</span><span class="p">):</span>
</span><span id="CifParser-581"><a href="#CifParser-581"><span class="linenos"> 581</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span>
</span><span id="CifParser-582"><a href="#CifParser-582"><span class="linenos"> 582</span></a>            <span class="k">for</span> <span class="n">tmp_coord</span><span class="p">,</span> <span class="n">tmp_magmom</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coords_in</span><span class="p">,</span> <span class="n">magmoms_in</span><span class="p">):</span>
</span><span id="CifParser-583"><a href="#CifParser-583"><span class="linenos"> 583</span></a>                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_operations</span><span class="p">:</span>
</span><span id="CifParser-584"><a href="#CifParser-584"><span class="linenos"> 584</span></a>                    <span class="n">coord</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">tmp_coord</span><span class="p">)</span>
</span><span id="CifParser-585"><a href="#CifParser-585"><span class="linenos"> 585</span></a>                    <span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">coord</span><span class="p">])</span>
</span><span id="CifParser-586"><a href="#CifParser-586"><span class="linenos"> 586</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">MagSymmOp</span><span class="p">):</span>
</span><span id="CifParser-587"><a href="#CifParser-587"><span class="linenos"> 587</span></a>                        <span class="c1"># Up to this point, magmoms have been defined relative</span>
</span><span id="CifParser-588"><a href="#CifParser-588"><span class="linenos"> 588</span></a>                        <span class="c1"># to crystal axis. Now convert to Cartesian and into</span>
</span><span id="CifParser-589"><a href="#CifParser-589"><span class="linenos"> 589</span></a>                        <span class="c1"># a Magmom object.</span>
</span><span id="CifParser-590"><a href="#CifParser-590"><span class="linenos"> 590</span></a>                        <span class="n">magmom</span> <span class="o">=</span> <span class="n">Magmom</span><span class="o">.</span><span class="n">from_moment_relative_to_crystal_axes</span><span class="p">(</span>
</span><span id="CifParser-591"><a href="#CifParser-591"><span class="linenos"> 591</span></a>                            <span class="n">op</span><span class="o">.</span><span class="n">operate_magmom</span><span class="p">(</span><span class="n">tmp_magmom</span><span class="p">),</span> <span class="n">lattice</span><span class="o">=</span><span class="n">lattice</span>
</span><span id="CifParser-592"><a href="#CifParser-592"><span class="linenos"> 592</span></a>                        <span class="p">)</span>
</span><span id="CifParser-593"><a href="#CifParser-593"><span class="linenos"> 593</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-594"><a href="#CifParser-594"><span class="linenos"> 594</span></a>                        <span class="n">magmom</span> <span class="o">=</span> <span class="n">Magmom</span><span class="p">(</span><span class="n">tmp_magmom</span><span class="p">)</span>
</span><span id="CifParser-595"><a href="#CifParser-595"><span class="linenos"> 595</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">in_coord_list_pbc</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_site_tolerance</span><span class="p">):</span>
</span><span id="CifParser-596"><a href="#CifParser-596"><span class="linenos"> 596</span></a>                        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
</span><span id="CifParser-597"><a href="#CifParser-597"><span class="linenos"> 597</span></a>                        <span class="n">magmoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">magmom</span><span class="p">)</span>
</span><span id="CifParser-598"><a href="#CifParser-598"><span class="linenos"> 598</span></a>            <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">magmoms</span>
</span><span id="CifParser-599"><a href="#CifParser-599"><span class="linenos"> 599</span></a>
</span><span id="CifParser-600"><a href="#CifParser-600"><span class="linenos"> 600</span></a>        <span class="k">for</span> <span class="n">tmp_coord</span> <span class="ow">in</span> <span class="n">coords_in</span><span class="p">:</span>
</span><span id="CifParser-601"><a href="#CifParser-601"><span class="linenos"> 601</span></a>            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_operations</span><span class="p">:</span>
</span><span id="CifParser-602"><a href="#CifParser-602"><span class="linenos"> 602</span></a>                <span class="n">coord</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">tmp_coord</span><span class="p">)</span>
</span><span id="CifParser-603"><a href="#CifParser-603"><span class="linenos"> 603</span></a>                <span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">coord</span><span class="p">])</span>
</span><span id="CifParser-604"><a href="#CifParser-604"><span class="linenos"> 604</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_coord_list_pbc</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_site_tolerance</span><span class="p">):</span>
</span><span id="CifParser-605"><a href="#CifParser-605"><span class="linenos"> 605</span></a>                    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
</span><span id="CifParser-606"><a href="#CifParser-606"><span class="linenos"> 606</span></a>        <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="p">[</span><span class="n">Magmom</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>  <span class="c1"># return dummy magmoms</span>
</span><span id="CifParser-607"><a href="#CifParser-607"><span class="linenos"> 607</span></a>
</span><span id="CifParser-608"><a href="#CifParser-608"><span class="linenos"> 608</span></a>    <span class="k">def</span> <span class="nf">get_lattice</span><span class="p">(</span>
</span><span id="CifParser-609"><a href="#CifParser-609"><span class="linenos"> 609</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CifParser-610"><a href="#CifParser-610"><span class="linenos"> 610</span></a>        <span class="n">data</span><span class="p">,</span>
</span><span id="CifParser-611"><a href="#CifParser-611"><span class="linenos"> 611</span></a>        <span class="n">length_strings</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">),</span>
</span><span id="CifParser-612"><a href="#CifParser-612"><span class="linenos"> 612</span></a>        <span class="n">angle_strings</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">),</span>
</span><span id="CifParser-613"><a href="#CifParser-613"><span class="linenos"> 613</span></a>        <span class="n">lattice_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="CifParser-614"><a href="#CifParser-614"><span class="linenos"> 614</span></a>    <span class="p">):</span>
</span><span id="CifParser-615"><a href="#CifParser-615"><span class="linenos"> 615</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-616"><a href="#CifParser-616"><span class="linenos"> 616</span></a><span class="sd">        Generate the lattice from the provided lattice parameters. In</span>
</span><span id="CifParser-617"><a href="#CifParser-617"><span class="linenos"> 617</span></a><span class="sd">        the absence of all six lattice parameters, the crystal system</span>
</span><span id="CifParser-618"><a href="#CifParser-618"><span class="linenos"> 618</span></a><span class="sd">        and necessary parameters are parsed</span>
</span><span id="CifParser-619"><a href="#CifParser-619"><span class="linenos"> 619</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-620"><a href="#CifParser-620"><span class="linenos"> 620</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-621"><a href="#CifParser-621"><span class="linenos"> 621</span></a>
</span><span id="CifParser-622"><a href="#CifParser-622"><span class="linenos"> 622</span></a>            <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_cell_length_&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">length_strings</span><span class="p">]</span>
</span><span id="CifParser-623"><a href="#CifParser-623"><span class="linenos"> 623</span></a>            <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_cell_angle_&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">angle_strings</span><span class="p">]</span>
</span><span id="CifParser-624"><a href="#CifParser-624"><span class="linenos"> 624</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">lattice_type</span><span class="p">:</span>
</span><span id="CifParser-625"><a href="#CifParser-625"><span class="linenos"> 625</span></a>                <span class="k">return</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span><span class="o">*</span><span class="n">lengths</span><span class="p">,</span> <span class="o">*</span><span class="n">angles</span><span class="p">)</span>
</span><span id="CifParser-626"><a href="#CifParser-626"><span class="linenos"> 626</span></a>
</span><span id="CifParser-627"><a href="#CifParser-627"><span class="linenos"> 627</span></a>            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Lattice</span><span class="p">,</span> <span class="n">lattice_type</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="n">lengths</span> <span class="o">+</span> <span class="n">angles</span><span class="p">))</span>
</span><span id="CifParser-628"><a href="#CifParser-628"><span class="linenos"> 628</span></a>
</span><span id="CifParser-629"><a href="#CifParser-629"><span class="linenos"> 629</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="CifParser-630"><a href="#CifParser-630"><span class="linenos"> 630</span></a>            <span class="c1"># Missing Key search for cell setting</span>
</span><span id="CifParser-631"><a href="#CifParser-631"><span class="linenos"> 631</span></a>            <span class="k">for</span> <span class="n">lattice_lable</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="CifParser-632"><a href="#CifParser-632"><span class="linenos"> 632</span></a>                <span class="s2">&quot;_symmetry_cell_setting&quot;</span><span class="p">,</span>
</span><span id="CifParser-633"><a href="#CifParser-633"><span class="linenos"> 633</span></a>                <span class="s2">&quot;_space_group_crystal_system&quot;</span><span class="p">,</span>
</span><span id="CifParser-634"><a href="#CifParser-634"><span class="linenos"> 634</span></a>            <span class="p">]:</span>
</span><span id="CifParser-635"><a href="#CifParser-635"><span class="linenos"> 635</span></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lattice_lable</span><span class="p">):</span>
</span><span id="CifParser-636"><a href="#CifParser-636"><span class="linenos"> 636</span></a>                    <span class="n">lattice_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lattice_lable</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="CifParser-637"><a href="#CifParser-637"><span class="linenos"> 637</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-638"><a href="#CifParser-638"><span class="linenos"> 638</span></a>
</span><span id="CifParser-639"><a href="#CifParser-639"><span class="linenos"> 639</span></a>                        <span class="n">required_args</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Lattice</span><span class="p">,</span> <span class="n">lattice_type</span><span class="p">))</span><span class="o">.</span><span class="n">args</span>
</span><span id="CifParser-640"><a href="#CifParser-640"><span class="linenos"> 640</span></a>
</span><span id="CifParser-641"><a href="#CifParser-641"><span class="linenos"> 641</span></a>                        <span class="n">lengths</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">length_strings</span> <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">required_args</span><span class="p">)</span>
</span><span id="CifParser-642"><a href="#CifParser-642"><span class="linenos"> 642</span></a>                        <span class="n">angles</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">angle_strings</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">required_args</span><span class="p">)</span>
</span><span id="CifParser-643"><a href="#CifParser-643"><span class="linenos"> 643</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">lattice_type</span><span class="o">=</span><span class="n">lattice_type</span><span class="p">)</span>
</span><span id="CifParser-644"><a href="#CifParser-644"><span class="linenos"> 644</span></a>                    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="CifParser-645"><a href="#CifParser-645"><span class="linenos"> 645</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
</span><span id="CifParser-646"><a href="#CifParser-646"><span class="linenos"> 646</span></a>                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span><span id="CifParser-647"><a href="#CifParser-647"><span class="linenos"> 647</span></a>
</span><span id="CifParser-648"><a href="#CifParser-648"><span class="linenos"> 648</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-649"><a href="#CifParser-649"><span class="linenos"> 649</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="CifParser-650"><a href="#CifParser-650"><span class="linenos"> 650</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="CifParser-651"><a href="#CifParser-651"><span class="linenos"> 651</span></a>
</span><span id="CifParser-652"><a href="#CifParser-652"><span class="linenos"> 652</span></a>    <span class="k">def</span> <span class="nf">get_symops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="CifParser-653"><a href="#CifParser-653"><span class="linenos"> 653</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-654"><a href="#CifParser-654"><span class="linenos"> 654</span></a><span class="sd">        In order to generate symmetry equivalent positions, the symmetry</span>
</span><span id="CifParser-655"><a href="#CifParser-655"><span class="linenos"> 655</span></a><span class="sd">        operations are parsed. If the symops are not present, the space</span>
</span><span id="CifParser-656"><a href="#CifParser-656"><span class="linenos"> 656</span></a><span class="sd">        group symbol is parsed, and symops are generated.</span>
</span><span id="CifParser-657"><a href="#CifParser-657"><span class="linenos"> 657</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-658"><a href="#CifParser-658"><span class="linenos"> 658</span></a>        <span class="n">symops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-659"><a href="#CifParser-659"><span class="linenos"> 659</span></a>        <span class="k">for</span> <span class="n">symmetry_label</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="CifParser-660"><a href="#CifParser-660"><span class="linenos"> 660</span></a>            <span class="s2">&quot;_symmetry_equiv_pos_as_xyz&quot;</span><span class="p">,</span>
</span><span id="CifParser-661"><a href="#CifParser-661"><span class="linenos"> 661</span></a>            <span class="s2">&quot;_symmetry_equiv_pos_as_xyz_&quot;</span><span class="p">,</span>
</span><span id="CifParser-662"><a href="#CifParser-662"><span class="linenos"> 662</span></a>            <span class="s2">&quot;_space_group_symop_operation_xyz&quot;</span><span class="p">,</span>
</span><span id="CifParser-663"><a href="#CifParser-663"><span class="linenos"> 663</span></a>            <span class="s2">&quot;_space_group_symop_operation_xyz_&quot;</span><span class="p">,</span>
</span><span id="CifParser-664"><a href="#CifParser-664"><span class="linenos"> 664</span></a>        <span class="p">]:</span>
</span><span id="CifParser-665"><a href="#CifParser-665"><span class="linenos"> 665</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">):</span>
</span><span id="CifParser-666"><a href="#CifParser-666"><span class="linenos"> 666</span></a>                <span class="n">xyz</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)</span>
</span><span id="CifParser-667"><a href="#CifParser-667"><span class="linenos"> 667</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CifParser-668"><a href="#CifParser-668"><span class="linenos"> 668</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;A 1-line symmetry op P1 CIF is detected!&quot;</span>
</span><span id="CifParser-669"><a href="#CifParser-669"><span class="linenos"> 669</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-670"><a href="#CifParser-670"><span class="linenos"> 670</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-671"><a href="#CifParser-671"><span class="linenos"> 671</span></a>                    <span class="n">xyz</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz</span><span class="p">]</span>
</span><span id="CifParser-672"><a href="#CifParser-672"><span class="linenos"> 672</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-673"><a href="#CifParser-673"><span class="linenos"> 673</span></a>                    <span class="n">symops</span> <span class="o">=</span> <span class="p">[</span><span class="n">SymmOp</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">]</span>
</span><span id="CifParser-674"><a href="#CifParser-674"><span class="linenos"> 674</span></a>                    <span class="k">break</span>
</span><span id="CifParser-675"><a href="#CifParser-675"><span class="linenos"> 675</span></a>                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="CifParser-676"><a href="#CifParser-676"><span class="linenos"> 676</span></a>                    <span class="k">continue</span>
</span><span id="CifParser-677"><a href="#CifParser-677"><span class="linenos"> 677</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">symops</span><span class="p">:</span>
</span><span id="CifParser-678"><a href="#CifParser-678"><span class="linenos"> 678</span></a>            <span class="c1"># Try to parse symbol</span>
</span><span id="CifParser-679"><a href="#CifParser-679"><span class="linenos"> 679</span></a>            <span class="k">for</span> <span class="n">symmetry_label</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="CifParser-680"><a href="#CifParser-680"><span class="linenos"> 680</span></a>                <span class="s2">&quot;_symmetry_space_group_name_H-M&quot;</span><span class="p">,</span>
</span><span id="CifParser-681"><a href="#CifParser-681"><span class="linenos"> 681</span></a>                <span class="s2">&quot;_symmetry_space_group_name_H_M&quot;</span><span class="p">,</span>
</span><span id="CifParser-682"><a href="#CifParser-682"><span class="linenos"> 682</span></a>                <span class="s2">&quot;_symmetry_space_group_name_H-M_&quot;</span><span class="p">,</span>
</span><span id="CifParser-683"><a href="#CifParser-683"><span class="linenos"> 683</span></a>                <span class="s2">&quot;_symmetry_space_group_name_H_M_&quot;</span><span class="p">,</span>
</span><span id="CifParser-684"><a href="#CifParser-684"><span class="linenos"> 684</span></a>                <span class="s2">&quot;_space_group_name_Hall&quot;</span><span class="p">,</span>
</span><span id="CifParser-685"><a href="#CifParser-685"><span class="linenos"> 685</span></a>                <span class="s2">&quot;_space_group_name_Hall_&quot;</span><span class="p">,</span>
</span><span id="CifParser-686"><a href="#CifParser-686"><span class="linenos"> 686</span></a>                <span class="s2">&quot;_space_group_name_H-M_alt&quot;</span><span class="p">,</span>
</span><span id="CifParser-687"><a href="#CifParser-687"><span class="linenos"> 687</span></a>                <span class="s2">&quot;_space_group_name_H-M_alt_&quot;</span><span class="p">,</span>
</span><span id="CifParser-688"><a href="#CifParser-688"><span class="linenos"> 688</span></a>                <span class="s2">&quot;_symmetry_space_group_name_hall&quot;</span><span class="p">,</span>
</span><span id="CifParser-689"><a href="#CifParser-689"><span class="linenos"> 689</span></a>                <span class="s2">&quot;_symmetry_space_group_name_hall_&quot;</span><span class="p">,</span>
</span><span id="CifParser-690"><a href="#CifParser-690"><span class="linenos"> 690</span></a>                <span class="s2">&quot;_symmetry_space_group_name_h-m&quot;</span><span class="p">,</span>
</span><span id="CifParser-691"><a href="#CifParser-691"><span class="linenos"> 691</span></a>                <span class="s2">&quot;_symmetry_space_group_name_h-m_&quot;</span><span class="p">,</span>
</span><span id="CifParser-692"><a href="#CifParser-692"><span class="linenos"> 692</span></a>            <span class="p">]:</span>
</span><span id="CifParser-693"><a href="#CifParser-693"><span class="linenos"> 693</span></a>                <span class="n">sg</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)</span>
</span><span id="CifParser-694"><a href="#CifParser-694"><span class="linenos"> 694</span></a>                <span class="n">msg_template</span> <span class="o">=</span> <span class="s2">&quot;No _symmetry_equiv_pos_as_xyz type key found. Spacegroup from </span><span class="si">{}</span><span class="s2"> used.&quot;</span>
</span><span id="CifParser-695"><a href="#CifParser-695"><span class="linenos"> 695</span></a>
</span><span id="CifParser-696"><a href="#CifParser-696"><span class="linenos"> 696</span></a>                <span class="k">if</span> <span class="n">sg</span><span class="p">:</span>
</span><span id="CifParser-697"><a href="#CifParser-697"><span class="linenos"> 697</span></a>                    <span class="n">sg</span> <span class="o">=</span> <span class="n">sub_spgrp</span><span class="p">(</span><span class="n">sg</span><span class="p">)</span>
</span><span id="CifParser-698"><a href="#CifParser-698"><span class="linenos"> 698</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-699"><a href="#CifParser-699"><span class="linenos"> 699</span></a>                        <span class="n">spg</span> <span class="o">=</span> <span class="n">space_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sg</span><span class="p">)</span>
</span><span id="CifParser-700"><a href="#CifParser-700"><span class="linenos"> 700</span></a>                        <span class="k">if</span> <span class="n">spg</span><span class="p">:</span>
</span><span id="CifParser-701"><a href="#CifParser-701"><span class="linenos"> 701</span></a>                            <span class="n">symops</span> <span class="o">=</span> <span class="n">SpaceGroup</span><span class="p">(</span><span class="n">spg</span><span class="p">)</span><span class="o">.</span><span class="n">symmetry_ops</span>
</span><span id="CifParser-702"><a href="#CifParser-702"><span class="linenos"> 702</span></a>                            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)</span>
</span><span id="CifParser-703"><a href="#CifParser-703"><span class="linenos"> 703</span></a>                            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-704"><a href="#CifParser-704"><span class="linenos"> 704</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-705"><a href="#CifParser-705"><span class="linenos"> 705</span></a>                            <span class="k">break</span>
</span><span id="CifParser-706"><a href="#CifParser-706"><span class="linenos"> 706</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="CifParser-707"><a href="#CifParser-707"><span class="linenos"> 707</span></a>                        <span class="c1"># Ignore any errors</span>
</span><span id="CifParser-708"><a href="#CifParser-708"><span class="linenos"> 708</span></a>                        <span class="k">pass</span>
</span><span id="CifParser-709"><a href="#CifParser-709"><span class="linenos"> 709</span></a>
</span><span id="CifParser-710"><a href="#CifParser-710"><span class="linenos"> 710</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-711"><a href="#CifParser-711"><span class="linenos"> 711</span></a>                        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">_get_cod_data</span><span class="p">():</span>
</span><span id="CifParser-712"><a href="#CifParser-712"><span class="linenos"> 712</span></a>                            <span class="k">if</span> <span class="n">sg</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;hermann_mauguin&quot;</span><span class="p">]):</span>
</span><span id="CifParser-713"><a href="#CifParser-713"><span class="linenos"> 713</span></a>                                <span class="n">xyz</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;symops&quot;</span><span class="p">]</span>
</span><span id="CifParser-714"><a href="#CifParser-714"><span class="linenos"> 714</span></a>                                <span class="n">symops</span> <span class="o">=</span> <span class="p">[</span><span class="n">SymmOp</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">]</span>
</span><span id="CifParser-715"><a href="#CifParser-715"><span class="linenos"> 715</span></a>                                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)</span>
</span><span id="CifParser-716"><a href="#CifParser-716"><span class="linenos"> 716</span></a>                                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-717"><a href="#CifParser-717"><span class="linenos"> 717</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-718"><a href="#CifParser-718"><span class="linenos"> 718</span></a>                                <span class="k">break</span>
</span><span id="CifParser-719"><a href="#CifParser-719"><span class="linenos"> 719</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="CifParser-720"><a href="#CifParser-720"><span class="linenos"> 720</span></a>                        <span class="k">continue</span>
</span><span id="CifParser-721"><a href="#CifParser-721"><span class="linenos"> 721</span></a>
</span><span id="CifParser-722"><a href="#CifParser-722"><span class="linenos"> 722</span></a>                    <span class="k">if</span> <span class="n">symops</span><span class="p">:</span>
</span><span id="CifParser-723"><a href="#CifParser-723"><span class="linenos"> 723</span></a>                        <span class="k">break</span>
</span><span id="CifParser-724"><a href="#CifParser-724"><span class="linenos"> 724</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">symops</span><span class="p">:</span>
</span><span id="CifParser-725"><a href="#CifParser-725"><span class="linenos"> 725</span></a>            <span class="c1"># Try to parse International number</span>
</span><span id="CifParser-726"><a href="#CifParser-726"><span class="linenos"> 726</span></a>            <span class="k">for</span> <span class="n">symmetry_label</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="CifParser-727"><a href="#CifParser-727"><span class="linenos"> 727</span></a>                <span class="s2">&quot;_space_group_IT_number&quot;</span><span class="p">,</span>
</span><span id="CifParser-728"><a href="#CifParser-728"><span class="linenos"> 728</span></a>                <span class="s2">&quot;_space_group_IT_number_&quot;</span><span class="p">,</span>
</span><span id="CifParser-729"><a href="#CifParser-729"><span class="linenos"> 729</span></a>                <span class="s2">&quot;_symmetry_Int_Tables_number&quot;</span><span class="p">,</span>
</span><span id="CifParser-730"><a href="#CifParser-730"><span class="linenos"> 730</span></a>                <span class="s2">&quot;_symmetry_Int_Tables_number_&quot;</span><span class="p">,</span>
</span><span id="CifParser-731"><a href="#CifParser-731"><span class="linenos"> 731</span></a>            <span class="p">]:</span>
</span><span id="CifParser-732"><a href="#CifParser-732"><span class="linenos"> 732</span></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">):</span>
</span><span id="CifParser-733"><a href="#CifParser-733"><span class="linenos"> 733</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-734"><a href="#CifParser-734"><span class="linenos"> 734</span></a>                        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)))</span>
</span><span id="CifParser-735"><a href="#CifParser-735"><span class="linenos"> 735</span></a>                        <span class="n">symops</span> <span class="o">=</span> <span class="n">SpaceGroup</span><span class="o">.</span><span class="n">from_int_number</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">symmetry_ops</span>
</span><span id="CifParser-736"><a href="#CifParser-736"><span class="linenos"> 736</span></a>                        <span class="k">break</span>
</span><span id="CifParser-737"><a href="#CifParser-737"><span class="linenos"> 737</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="CifParser-738"><a href="#CifParser-738"><span class="linenos"> 738</span></a>                        <span class="k">continue</span>
</span><span id="CifParser-739"><a href="#CifParser-739"><span class="linenos"> 739</span></a>
</span><span id="CifParser-740"><a href="#CifParser-740"><span class="linenos"> 740</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">symops</span><span class="p">:</span>
</span><span id="CifParser-741"><a href="#CifParser-741"><span class="linenos"> 741</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No _symmetry_equiv_pos_as_xyz type key found. Defaulting to P1.&quot;</span>
</span><span id="CifParser-742"><a href="#CifParser-742"><span class="linenos"> 742</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-743"><a href="#CifParser-743"><span class="linenos"> 743</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-744"><a href="#CifParser-744"><span class="linenos"> 744</span></a>            <span class="n">symops</span> <span class="o">=</span> <span class="p">[</span><span class="n">SymmOp</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span>
</span><span id="CifParser-745"><a href="#CifParser-745"><span class="linenos"> 745</span></a>
</span><span id="CifParser-746"><a href="#CifParser-746"><span class="linenos"> 746</span></a>        <span class="k">return</span> <span class="n">symops</span>
</span><span id="CifParser-747"><a href="#CifParser-747"><span class="linenos"> 747</span></a>
</span><span id="CifParser-748"><a href="#CifParser-748"><span class="linenos"> 748</span></a>    <span class="k">def</span> <span class="nf">get_magsymops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="CifParser-749"><a href="#CifParser-749"><span class="linenos"> 749</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-750"><a href="#CifParser-750"><span class="linenos"> 750</span></a><span class="sd">        Equivalent to get_symops except for magnetic symmetry groups.</span>
</span><span id="CifParser-751"><a href="#CifParser-751"><span class="linenos"> 751</span></a><span class="sd">        Separate function since additional operation for time reversal symmetry</span>
</span><span id="CifParser-752"><a href="#CifParser-752"><span class="linenos"> 752</span></a><span class="sd">        (which changes magnetic moments on sites) needs to be returned.</span>
</span><span id="CifParser-753"><a href="#CifParser-753"><span class="linenos"> 753</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-754"><a href="#CifParser-754"><span class="linenos"> 754</span></a>        <span class="n">magsymmops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-755"><a href="#CifParser-755"><span class="linenos"> 755</span></a>
</span><span id="CifParser-756"><a href="#CifParser-756"><span class="linenos"> 756</span></a>        <span class="c1"># check to see if magCIF file explicitly contains magnetic symmetry operations</span>
</span><span id="CifParser-757"><a href="#CifParser-757"><span class="linenos"> 757</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_symop_magn_operation.xyz&quot;</span><span class="p">):</span>
</span><span id="CifParser-758"><a href="#CifParser-758"><span class="linenos"> 758</span></a>
</span><span id="CifParser-759"><a href="#CifParser-759"><span class="linenos"> 759</span></a>            <span class="n">xyzt</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_symop_magn_operation.xyz&quot;</span><span class="p">)</span>
</span><span id="CifParser-760"><a href="#CifParser-760"><span class="linenos"> 760</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CifParser-761"><a href="#CifParser-761"><span class="linenos"> 761</span></a>                <span class="n">xyzt</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyzt</span><span class="p">]</span>
</span><span id="CifParser-762"><a href="#CifParser-762"><span class="linenos"> 762</span></a>            <span class="n">magsymmops</span> <span class="o">=</span> <span class="p">[</span><span class="n">MagSymmOp</span><span class="o">.</span><span class="n">from_xyzt_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">xyzt</span><span class="p">]</span>
</span><span id="CifParser-763"><a href="#CifParser-763"><span class="linenos"> 763</span></a>
</span><span id="CifParser-764"><a href="#CifParser-764"><span class="linenos"> 764</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_symop_magn_centering.xyz&quot;</span><span class="p">):</span>
</span><span id="CifParser-765"><a href="#CifParser-765"><span class="linenos"> 765</span></a>
</span><span id="CifParser-766"><a href="#CifParser-766"><span class="linenos"> 766</span></a>                <span class="n">xyzt</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_symop_magn_centering.xyz&quot;</span><span class="p">)</span>
</span><span id="CifParser-767"><a href="#CifParser-767"><span class="linenos"> 767</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CifParser-768"><a href="#CifParser-768"><span class="linenos"> 768</span></a>                    <span class="n">xyzt</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyzt</span><span class="p">]</span>
</span><span id="CifParser-769"><a href="#CifParser-769"><span class="linenos"> 769</span></a>                <span class="n">centering_symops</span> <span class="o">=</span> <span class="p">[</span><span class="n">MagSymmOp</span><span class="o">.</span><span class="n">from_xyzt_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">xyzt</span><span class="p">]</span>
</span><span id="CifParser-770"><a href="#CifParser-770"><span class="linenos"> 770</span></a>
</span><span id="CifParser-771"><a href="#CifParser-771"><span class="linenos"> 771</span></a>                <span class="n">all_ops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-772"><a href="#CifParser-772"><span class="linenos"> 772</span></a>                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">magsymmops</span><span class="p">:</span>
</span><span id="CifParser-773"><a href="#CifParser-773"><span class="linenos"> 773</span></a>                    <span class="k">for</span> <span class="n">centering_op</span> <span class="ow">in</span> <span class="n">centering_symops</span><span class="p">:</span>
</span><span id="CifParser-774"><a href="#CifParser-774"><span class="linenos"> 774</span></a>                        <span class="n">new_translation</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CifParser-775"><a href="#CifParser-775"><span class="linenos"> 775</span></a>                            <span class="n">i</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">translation_vector</span> <span class="o">+</span> <span class="n">centering_op</span><span class="o">.</span><span class="n">translation_vector</span>
</span><span id="CifParser-776"><a href="#CifParser-776"><span class="linenos"> 776</span></a>                        <span class="p">]</span>
</span><span id="CifParser-777"><a href="#CifParser-777"><span class="linenos"> 777</span></a>                        <span class="n">new_time_reversal</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">time_reversal</span> <span class="o">*</span> <span class="n">centering_op</span><span class="o">.</span><span class="n">time_reversal</span>
</span><span id="CifParser-778"><a href="#CifParser-778"><span class="linenos"> 778</span></a>                        <span class="n">all_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CifParser-779"><a href="#CifParser-779"><span class="linenos"> 779</span></a>                            <span class="n">MagSymmOp</span><span class="o">.</span><span class="n">from_rotation_and_translation_and_time_reversal</span><span class="p">(</span>
</span><span id="CifParser-780"><a href="#CifParser-780"><span class="linenos"> 780</span></a>                                <span class="n">rotation_matrix</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">,</span>
</span><span id="CifParser-781"><a href="#CifParser-781"><span class="linenos"> 781</span></a>                                <span class="n">translation_vec</span><span class="o">=</span><span class="n">new_translation</span><span class="p">,</span>
</span><span id="CifParser-782"><a href="#CifParser-782"><span class="linenos"> 782</span></a>                                <span class="n">time_reversal</span><span class="o">=</span><span class="n">new_time_reversal</span><span class="p">,</span>
</span><span id="CifParser-783"><a href="#CifParser-783"><span class="linenos"> 783</span></a>                            <span class="p">)</span>
</span><span id="CifParser-784"><a href="#CifParser-784"><span class="linenos"> 784</span></a>                        <span class="p">)</span>
</span><span id="CifParser-785"><a href="#CifParser-785"><span class="linenos"> 785</span></a>                <span class="n">magsymmops</span> <span class="o">=</span> <span class="n">all_ops</span>
</span><span id="CifParser-786"><a href="#CifParser-786"><span class="linenos"> 786</span></a>
</span><span id="CifParser-787"><a href="#CifParser-787"><span class="linenos"> 787</span></a>        <span class="c1"># else check to see if it specifies a magnetic space group</span>
</span><span id="CifParser-788"><a href="#CifParser-788"><span class="linenos"> 788</span></a>        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.name_BNS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.number_BNS&quot;</span><span class="p">):</span>
</span><span id="CifParser-789"><a href="#CifParser-789"><span class="linenos"> 789</span></a>
</span><span id="CifParser-790"><a href="#CifParser-790"><span class="linenos"> 790</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.name_BNS&quot;</span><span class="p">):</span>
</span><span id="CifParser-791"><a href="#CifParser-791"><span class="linenos"> 791</span></a>                <span class="c1"># get BNS label for MagneticSpaceGroup()</span>
</span><span id="CifParser-792"><a href="#CifParser-792"><span class="linenos"> 792</span></a>                <span class="nb">id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.name_BNS&quot;</span><span class="p">)</span>
</span><span id="CifParser-793"><a href="#CifParser-793"><span class="linenos"> 793</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-794"><a href="#CifParser-794"><span class="linenos"> 794</span></a>                <span class="c1"># get BNS number for MagneticSpaceGroup()</span>
</span><span id="CifParser-795"><a href="#CifParser-795"><span class="linenos"> 795</span></a>                <span class="c1"># by converting string to list of ints</span>
</span><span id="CifParser-796"><a href="#CifParser-796"><span class="linenos"> 796</span></a>                <span class="nb">id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.number_BNS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))))</span>
</span><span id="CifParser-797"><a href="#CifParser-797"><span class="linenos"> 797</span></a>
</span><span id="CifParser-798"><a href="#CifParser-798"><span class="linenos"> 798</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.transform_BNS_Pp_abc&quot;</span><span class="p">):</span>
</span><span id="CifParser-799"><a href="#CifParser-799"><span class="linenos"> 799</span></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.transform_BNS_Pp_abc&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;a,b,c;0,0,0&quot;</span><span class="p">:</span>
</span><span id="CifParser-800"><a href="#CifParser-800"><span class="linenos"> 800</span></a>
</span><span id="CifParser-801"><a href="#CifParser-801"><span class="linenos"> 801</span></a>                    <span class="n">jf</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.transform_BNS_Pp_abc&quot;</span><span class="p">)</span>
</span><span id="CifParser-802"><a href="#CifParser-802"><span class="linenos"> 802</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">MagneticSpaceGroup</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">jf</span><span class="p">)</span>
</span><span id="CifParser-803"><a href="#CifParser-803"><span class="linenos"> 803</span></a>
</span><span id="CifParser-804"><a href="#CifParser-804"><span class="linenos"> 804</span></a>            <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.transform_BNS_Pp&quot;</span><span class="p">):</span>
</span><span id="CifParser-805"><a href="#CifParser-805"><span class="linenos"> 805</span></a>                <span class="k">return</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Incomplete specification to implement.&quot;</span><span class="p">)</span>
</span><span id="CifParser-806"><a href="#CifParser-806"><span class="linenos"> 806</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-807"><a href="#CifParser-807"><span class="linenos"> 807</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">MagneticSpaceGroup</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="CifParser-808"><a href="#CifParser-808"><span class="linenos"> 808</span></a>
</span><span id="CifParser-809"><a href="#CifParser-809"><span class="linenos"> 809</span></a>            <span class="n">magsymmops</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">symmetry_ops</span>
</span><span id="CifParser-810"><a href="#CifParser-810"><span class="linenos"> 810</span></a>
</span><span id="CifParser-811"><a href="#CifParser-811"><span class="linenos"> 811</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">magsymmops</span><span class="p">:</span>
</span><span id="CifParser-812"><a href="#CifParser-812"><span class="linenos"> 812</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No magnetic symmetry detected, using primitive symmetry.&quot;</span>
</span><span id="CifParser-813"><a href="#CifParser-813"><span class="linenos"> 813</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-814"><a href="#CifParser-814"><span class="linenos"> 814</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-815"><a href="#CifParser-815"><span class="linenos"> 815</span></a>            <span class="n">magsymmops</span> <span class="o">=</span> <span class="p">[</span><span class="n">MagSymmOp</span><span class="o">.</span><span class="n">from_xyzt_string</span><span class="p">(</span><span class="s2">&quot;x, y, z, 1&quot;</span><span class="p">)]</span>
</span><span id="CifParser-816"><a href="#CifParser-816"><span class="linenos"> 816</span></a>
</span><span id="CifParser-817"><a href="#CifParser-817"><span class="linenos"> 817</span></a>        <span class="k">return</span> <span class="n">magsymmops</span>
</span><span id="CifParser-818"><a href="#CifParser-818"><span class="linenos"> 818</span></a>
</span><span id="CifParser-819"><a href="#CifParser-819"><span class="linenos"> 819</span></a>    <span class="nd">@staticmethod</span>
</span><span id="CifParser-820"><a href="#CifParser-820"><span class="linenos"> 820</span></a>    <span class="k">def</span> <span class="nf">parse_oxi_states</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="CifParser-821"><a href="#CifParser-821"><span class="linenos"> 821</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-822"><a href="#CifParser-822"><span class="linenos"> 822</span></a><span class="sd">        Parse oxidation states from data dictionary</span>
</span><span id="CifParser-823"><a href="#CifParser-823"><span class="linenos"> 823</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-824"><a href="#CifParser-824"><span class="linenos"> 824</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-825"><a href="#CifParser-825"><span class="linenos"> 825</span></a>            <span class="n">oxi_states</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CifParser-826"><a href="#CifParser-826"><span class="linenos"> 826</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_oxidation_number&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-827"><a href="#CifParser-827"><span class="linenos"> 827</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">]))</span>
</span><span id="CifParser-828"><a href="#CifParser-828"><span class="linenos"> 828</span></a>            <span class="p">}</span>
</span><span id="CifParser-829"><a href="#CifParser-829"><span class="linenos"> 829</span></a>            <span class="c1"># attempt to strip oxidation state from _atom_type_symbol</span>
</span><span id="CifParser-830"><a href="#CifParser-830"><span class="linenos"> 830</span></a>            <span class="c1"># in case the label does not contain an oxidation state</span>
</span><span id="CifParser-831"><a href="#CifParser-831"><span class="linenos"> 831</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">]):</span>
</span><span id="CifParser-832"><a href="#CifParser-832"><span class="linenos"> 832</span></a>                <span class="n">oxi_states</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d?[\+,\-]?$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)]</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_oxidation_number&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-833"><a href="#CifParser-833"><span class="linenos"> 833</span></a>
</span><span id="CifParser-834"><a href="#CifParser-834"><span class="linenos"> 834</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
</span><span id="CifParser-835"><a href="#CifParser-835"><span class="linenos"> 835</span></a>            <span class="n">oxi_states</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CifParser-836"><a href="#CifParser-836"><span class="linenos"> 836</span></a>        <span class="k">return</span> <span class="n">oxi_states</span>
</span><span id="CifParser-837"><a href="#CifParser-837"><span class="linenos"> 837</span></a>
</span><span id="CifParser-838"><a href="#CifParser-838"><span class="linenos"> 838</span></a>    <span class="nd">@staticmethod</span>
</span><span id="CifParser-839"><a href="#CifParser-839"><span class="linenos"> 839</span></a>    <span class="k">def</span> <span class="nf">parse_magmoms</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="CifParser-840"><a href="#CifParser-840"><span class="linenos"> 840</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-841"><a href="#CifParser-841"><span class="linenos"> 841</span></a><span class="sd">        Parse atomic magnetic moments from data dictionary</span>
</span><span id="CifParser-842"><a href="#CifParser-842"><span class="linenos"> 842</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-843"><a href="#CifParser-843"><span class="linenos"> 843</span></a>        <span class="k">if</span> <span class="n">lattice</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifParser-844"><a href="#CifParser-844"><span class="linenos"> 844</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Magmoms given in terms of crystal axes in magCIF spec.&quot;</span><span class="p">)</span>
</span><span id="CifParser-845"><a href="#CifParser-845"><span class="linenos"> 845</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-846"><a href="#CifParser-846"><span class="linenos"> 846</span></a>            <span class="n">magmoms</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CifParser-847"><a href="#CifParser-847"><span class="linenos"> 847</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_label&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="CifParser-848"><a href="#CifParser-848"><span class="linenos"> 848</span></a>                    <span class="p">[</span>
</span><span id="CifParser-849"><a href="#CifParser-849"><span class="linenos"> 849</span></a>                        <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_x&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
</span><span id="CifParser-850"><a href="#CifParser-850"><span class="linenos"> 850</span></a>                        <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_y&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
</span><span id="CifParser-851"><a href="#CifParser-851"><span class="linenos"> 851</span></a>                        <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_z&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
</span><span id="CifParser-852"><a href="#CifParser-852"><span class="linenos"> 852</span></a>                    <span class="p">]</span>
</span><span id="CifParser-853"><a href="#CifParser-853"><span class="linenos"> 853</span></a>                <span class="p">)</span>
</span><span id="CifParser-854"><a href="#CifParser-854"><span class="linenos"> 854</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_label&quot;</span><span class="p">]))</span>
</span><span id="CifParser-855"><a href="#CifParser-855"><span class="linenos"> 855</span></a>            <span class="p">}</span>
</span><span id="CifParser-856"><a href="#CifParser-856"><span class="linenos"> 856</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
</span><span id="CifParser-857"><a href="#CifParser-857"><span class="linenos"> 857</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="CifParser-858"><a href="#CifParser-858"><span class="linenos"> 858</span></a>        <span class="k">return</span> <span class="n">magmoms</span>
</span><span id="CifParser-859"><a href="#CifParser-859"><span class="linenos"> 859</span></a>
</span><span id="CifParser-860"><a href="#CifParser-860"><span class="linenos"> 860</span></a>    <span class="k">def</span> <span class="nf">_parse_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
</span><span id="CifParser-861"><a href="#CifParser-861"><span class="linenos"> 861</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-862"><a href="#CifParser-862"><span class="linenos"> 862</span></a><span class="sd">        Parse a string with a symbol to extract a string representing an element.</span>
</span><span id="CifParser-863"><a href="#CifParser-863"><span class="linenos"> 863</span></a>
</span><span id="CifParser-864"><a href="#CifParser-864"><span class="linenos"> 864</span></a><span class="sd">        Args:</span>
</span><span id="CifParser-865"><a href="#CifParser-865"><span class="linenos"> 865</span></a><span class="sd">            sym (str): A symbol to be parsed.</span>
</span><span id="CifParser-866"><a href="#CifParser-866"><span class="linenos"> 866</span></a>
</span><span id="CifParser-867"><a href="#CifParser-867"><span class="linenos"> 867</span></a><span class="sd">        Returns:</span>
</span><span id="CifParser-868"><a href="#CifParser-868"><span class="linenos"> 868</span></a><span class="sd">            A string with the parsed symbol. None if no parsing was possible.</span>
</span><span id="CifParser-869"><a href="#CifParser-869"><span class="linenos"> 869</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-870"><a href="#CifParser-870"><span class="linenos"> 870</span></a>        <span class="c1"># Common representations for elements/water in cif files</span>
</span><span id="CifParser-871"><a href="#CifParser-871"><span class="linenos"> 871</span></a>        <span class="c1"># TODO: fix inconsistent handling of water</span>
</span><span id="CifParser-872"><a href="#CifParser-872"><span class="linenos"> 872</span></a>        <span class="n">special</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CifParser-873"><a href="#CifParser-873"><span class="linenos"> 873</span></a>            <span class="s2">&quot;Hw&quot;</span><span class="p">:</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span>
</span><span id="CifParser-874"><a href="#CifParser-874"><span class="linenos"> 874</span></a>            <span class="s2">&quot;Ow&quot;</span><span class="p">:</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span>
</span><span id="CifParser-875"><a href="#CifParser-875"><span class="linenos"> 875</span></a>            <span class="s2">&quot;Wat&quot;</span><span class="p">:</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span>
</span><span id="CifParser-876"><a href="#CifParser-876"><span class="linenos"> 876</span></a>            <span class="s2">&quot;wat&quot;</span><span class="p">:</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span>
</span><span id="CifParser-877"><a href="#CifParser-877"><span class="linenos"> 877</span></a>            <span class="s2">&quot;OH&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="CifParser-878"><a href="#CifParser-878"><span class="linenos"> 878</span></a>            <span class="s2">&quot;OH2&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="CifParser-879"><a href="#CifParser-879"><span class="linenos"> 879</span></a>            <span class="s2">&quot;NO3&quot;</span><span class="p">:</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span>
</span><span id="CifParser-880"><a href="#CifParser-880"><span class="linenos"> 880</span></a>        <span class="p">}</span>
</span><span id="CifParser-881"><a href="#CifParser-881"><span class="linenos"> 881</span></a>
</span><span id="CifParser-882"><a href="#CifParser-882"><span class="linenos"> 882</span></a>        <span class="n">parsed_sym</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CifParser-883"><a href="#CifParser-883"><span class="linenos"> 883</span></a>        <span class="c1"># try with special symbols, otherwise check the first two letters,</span>
</span><span id="CifParser-884"><a href="#CifParser-884"><span class="linenos"> 884</span></a>        <span class="c1"># then the first letter alone. If everything fails try extracting the</span>
</span><span id="CifParser-885"><a href="#CifParser-885"><span class="linenos"> 885</span></a>        <span class="c1"># first letters.</span>
</span><span id="CifParser-886"><a href="#CifParser-886"><span class="linenos"> 886</span></a>        <span class="n">m_sp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">special</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">sym</span><span class="p">)</span>
</span><span id="CifParser-887"><a href="#CifParser-887"><span class="linenos"> 887</span></a>        <span class="k">if</span> <span class="n">m_sp</span><span class="p">:</span>
</span><span id="CifParser-888"><a href="#CifParser-888"><span class="linenos"> 888</span></a>            <span class="n">parsed_sym</span> <span class="o">=</span> <span class="n">special</span><span class="p">[</span><span class="n">m_sp</span><span class="o">.</span><span class="n">group</span><span class="p">()]</span>
</span><span id="CifParser-889"><a href="#CifParser-889"><span class="linenos"> 889</span></a>        <span class="k">elif</span> <span class="n">Element</span><span class="o">.</span><span class="n">is_valid_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()):</span>
</span><span id="CifParser-890"><a href="#CifParser-890"><span class="linenos"> 890</span></a>            <span class="n">parsed_sym</span> <span class="o">=</span> <span class="n">sym</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</span><span id="CifParser-891"><a href="#CifParser-891"><span class="linenos"> 891</span></a>        <span class="k">elif</span> <span class="n">Element</span><span class="o">.</span><span class="n">is_valid_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
</span><span id="CifParser-892"><a href="#CifParser-892"><span class="linenos"> 892</span></a>            <span class="n">parsed_sym</span> <span class="o">=</span> <span class="n">sym</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="CifParser-893"><a href="#CifParser-893"><span class="linenos"> 893</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-894"><a href="#CifParser-894"><span class="linenos"> 894</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;w?[A-Z][a-z]*&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
</span><span id="CifParser-895"><a href="#CifParser-895"><span class="linenos"> 895</span></a>            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
</span><span id="CifParser-896"><a href="#CifParser-896"><span class="linenos"> 896</span></a>                <span class="n">parsed_sym</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</span><span id="CifParser-897"><a href="#CifParser-897"><span class="linenos"> 897</span></a>
</span><span id="CifParser-898"><a href="#CifParser-898"><span class="linenos"> 898</span></a>        <span class="k">if</span> <span class="n">parsed_sym</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">m_sp</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed_sym</span><span class="si">}</span><span class="s2">\d*&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="p">)):</span>
</span><span id="CifParser-899"><a href="#CifParser-899"><span class="linenos"> 899</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sym</span><span class="si">}</span><span class="s2"> parsed as </span><span class="si">{</span><span class="n">parsed_sym</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CifParser-900"><a href="#CifParser-900"><span class="linenos"> 900</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-901"><a href="#CifParser-901"><span class="linenos"> 901</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-902"><a href="#CifParser-902"><span class="linenos"> 902</span></a>
</span><span id="CifParser-903"><a href="#CifParser-903"><span class="linenos"> 903</span></a>        <span class="k">return</span> <span class="n">parsed_sym</span>
</span><span id="CifParser-904"><a href="#CifParser-904"><span class="linenos"> 904</span></a>
</span><span id="CifParser-905"><a href="#CifParser-905"><span class="linenos"> 905</span></a>    <span class="k">def</span> <span class="nf">_get_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">primitive</span><span class="p">,</span> <span class="n">symmetrized</span><span class="p">):</span>
</span><span id="CifParser-906"><a href="#CifParser-906"><span class="linenos"> 906</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-907"><a href="#CifParser-907"><span class="linenos"> 907</span></a><span class="sd">        Generate structure from part of the cif.</span>
</span><span id="CifParser-908"><a href="#CifParser-908"><span class="linenos"> 908</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-909"><a href="#CifParser-909"><span class="linenos"> 909</span></a>
</span><span id="CifParser-910"><a href="#CifParser-910"><span class="linenos"> 910</span></a>        <span class="k">def</span> <span class="nf">get_num_implicit_hydrogens</span><span class="p">(</span><span class="n">sym</span><span class="p">):</span>
</span><span id="CifParser-911"><a href="#CifParser-911"><span class="linenos"> 911</span></a>            <span class="n">num_h</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wat&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;wat&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;O-H&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="CifParser-912"><a href="#CifParser-912"><span class="linenos"> 912</span></a>            <span class="k">return</span> <span class="n">num_h</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="CifParser-913"><a href="#CifParser-913"><span class="linenos"> 913</span></a>
</span><span id="CifParser-914"><a href="#CifParser-914"><span class="linenos"> 914</span></a>        <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="CifParser-915"><a href="#CifParser-915"><span class="linenos"> 915</span></a>
</span><span id="CifParser-916"><a href="#CifParser-916"><span class="linenos"> 916</span></a>        <span class="c1"># if magCIF, get magnetic symmetry moments and magmoms</span>
</span><span id="CifParser-917"><a href="#CifParser-917"><span class="linenos"> 917</span></a>        <span class="c1"># else standard CIF, and use empty magmom dict</span>
</span><span id="CifParser-918"><a href="#CifParser-918"><span class="linenos"> 918</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif_incommensurate&quot;</span><span class="p">]:</span>
</span><span id="CifParser-919"><a href="#CifParser-919"><span class="linenos"> 919</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Incommensurate structures not currently supported.&quot;</span><span class="p">)</span>
</span><span id="CifParser-920"><a href="#CifParser-920"><span class="linenos"> 920</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]:</span>
</span><span id="CifParser-921"><a href="#CifParser-921"><span class="linenos"> 921</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_magsymops</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="CifParser-922"><a href="#CifParser-922"><span class="linenos"> 922</span></a>            <span class="n">magmoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_magmoms</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="n">lattice</span><span class="p">)</span>
</span><span id="CifParser-923"><a href="#CifParser-923"><span class="linenos"> 923</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-924"><a href="#CifParser-924"><span class="linenos"> 924</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_symops</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="CifParser-925"><a href="#CifParser-925"><span class="linenos"> 925</span></a>            <span class="n">magmoms</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-926"><a href="#CifParser-926"><span class="linenos"> 926</span></a>
</span><span id="CifParser-927"><a href="#CifParser-927"><span class="linenos"> 927</span></a>        <span class="n">oxi_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_oxi_states</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="CifParser-928"><a href="#CifParser-928"><span class="linenos"> 928</span></a>
</span><span id="CifParser-929"><a href="#CifParser-929"><span class="linenos"> 929</span></a>        <span class="n">coord_to_species</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-930"><a href="#CifParser-930"><span class="linenos"> 930</span></a>        <span class="n">coord_to_magmoms</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-931"><a href="#CifParser-931"><span class="linenos"> 931</span></a>
</span><span id="CifParser-932"><a href="#CifParser-932"><span class="linenos"> 932</span></a>        <span class="k">def</span> <span class="nf">get_matching_coord</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span>
</span><span id="CifParser-933"><a href="#CifParser-933"><span class="linenos"> 933</span></a>            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">coord_to_species</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="CifParser-934"><a href="#CifParser-934"><span class="linenos"> 934</span></a>            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</span><span id="CifParser-935"><a href="#CifParser-935"><span class="linenos"> 935</span></a>            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_operations</span><span class="p">:</span>
</span><span id="CifParser-936"><a href="#CifParser-936"><span class="linenos"> 936</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
</span><span id="CifParser-937"><a href="#CifParser-937"><span class="linenos"> 937</span></a>                <span class="n">inds</span> <span class="o">=</span> <span class="n">find_in_coord_list_pbc</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_site_tolerance</span><span class="p">)</span>
</span><span id="CifParser-938"><a href="#CifParser-938"><span class="linenos"> 938</span></a>                <span class="c1"># can&#39;t use if inds, because python is dumb and np.array([0]) evaluates</span>
</span><span id="CifParser-939"><a href="#CifParser-939"><span class="linenos"> 939</span></a>                <span class="c1"># to False</span>
</span><span id="CifParser-940"><a href="#CifParser-940"><span class="linenos"> 940</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">):</span>
</span><span id="CifParser-941"><a href="#CifParser-941"><span class="linenos"> 941</span></a>                    <span class="k">return</span> <span class="n">keys</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="CifParser-942"><a href="#CifParser-942"><span class="linenos"> 942</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="CifParser-943"><a href="#CifParser-943"><span class="linenos"> 943</span></a>
</span><span id="CifParser-944"><a href="#CifParser-944"><span class="linenos"> 944</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_label&quot;</span><span class="p">])):</span>
</span><span id="CifParser-945"><a href="#CifParser-945"><span class="linenos"> 945</span></a>
</span><span id="CifParser-946"><a href="#CifParser-946"><span class="linenos"> 946</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-947"><a href="#CifParser-947"><span class="linenos"> 947</span></a>                <span class="c1"># If site type symbol exists, use it. Otherwise, we use the</span>
</span><span id="CifParser-948"><a href="#CifParser-948"><span class="linenos"> 948</span></a>                <span class="c1"># label.</span>
</span><span id="CifParser-949"><a href="#CifParser-949"><span class="linenos"> 949</span></a>                <span class="n">symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_symbol</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-950"><a href="#CifParser-950"><span class="linenos"> 950</span></a>                <span class="n">num_h</span> <span class="o">=</span> <span class="n">get_num_implicit_hydrogens</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-951"><a href="#CifParser-951"><span class="linenos"> 951</span></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="CifParser-952"><a href="#CifParser-952"><span class="linenos"> 952</span></a>                <span class="n">symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_symbol</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_label&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-953"><a href="#CifParser-953"><span class="linenos"> 953</span></a>                <span class="n">num_h</span> <span class="o">=</span> <span class="n">get_num_implicit_hydrogens</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_label&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-954"><a href="#CifParser-954"><span class="linenos"> 954</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">symbol</span><span class="p">:</span>
</span><span id="CifParser-955"><a href="#CifParser-955"><span class="linenos"> 955</span></a>                <span class="k">continue</span>
</span><span id="CifParser-956"><a href="#CifParser-956"><span class="linenos"> 956</span></a>
</span><span id="CifParser-957"><a href="#CifParser-957"><span class="linenos"> 957</span></a>            <span class="k">if</span> <span class="n">oxi_states</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifParser-958"><a href="#CifParser-958"><span class="linenos"> 958</span></a>                <span class="n">o_s</span> <span class="o">=</span> <span class="n">oxi_states</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="CifParser-959"><a href="#CifParser-959"><span class="linenos"> 959</span></a>                <span class="c1"># use _atom_site_type_symbol if possible for oxidation state</span>
</span><span id="CifParser-960"><a href="#CifParser-960"><span class="linenos"> 960</span></a>                <span class="k">if</span> <span class="s2">&quot;_atom_site_type_symbol&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser-961"><a href="#CifParser-961"><span class="linenos"> 961</span></a>                    <span class="n">oxi_symbol</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="CifParser-962"><a href="#CifParser-962"><span class="linenos"> 962</span></a>                    <span class="n">o_s</span> <span class="o">=</span> <span class="n">oxi_states</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">oxi_symbol</span><span class="p">,</span> <span class="n">o_s</span><span class="p">)</span>
</span><span id="CifParser-963"><a href="#CifParser-963"><span class="linenos"> 963</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-964"><a href="#CifParser-964"><span class="linenos"> 964</span></a>                    <span class="n">el</span> <span class="o">=</span> <span class="n">Species</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">o_s</span><span class="p">)</span>
</span><span id="CifParser-965"><a href="#CifParser-965"><span class="linenos"> 965</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="CifParser-966"><a href="#CifParser-966"><span class="linenos"> 966</span></a>                    <span class="n">el</span> <span class="o">=</span> <span class="n">DummySpecies</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">o_s</span><span class="p">)</span>
</span><span id="CifParser-967"><a href="#CifParser-967"><span class="linenos"> 967</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-968"><a href="#CifParser-968"><span class="linenos"> 968</span></a>                <span class="n">el</span> <span class="o">=</span> <span class="n">get_el_sp</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
</span><span id="CifParser-969"><a href="#CifParser-969"><span class="linenos"> 969</span></a>
</span><span id="CifParser-970"><a href="#CifParser-970"><span class="linenos"> 970</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_x&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-971"><a href="#CifParser-971"><span class="linenos"> 971</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_y&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-972"><a href="#CifParser-972"><span class="linenos"> 972</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_z&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-973"><a href="#CifParser-973"><span class="linenos"> 973</span></a>            <span class="n">magmom</span> <span class="o">=</span> <span class="n">magmoms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_label&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</span><span id="CifParser-974"><a href="#CifParser-974"><span class="linenos"> 974</span></a>
</span><span id="CifParser-975"><a href="#CifParser-975"><span class="linenos"> 975</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-976"><a href="#CifParser-976"><span class="linenos"> 976</span></a>                <span class="n">occu</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_occupancy&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser-977"><a href="#CifParser-977"><span class="linenos"> 977</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="CifParser-978"><a href="#CifParser-978"><span class="linenos"> 978</span></a>                <span class="n">occu</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="CifParser-979"><a href="#CifParser-979"><span class="linenos"> 979</span></a>
</span><span id="CifParser-980"><a href="#CifParser-980"><span class="linenos"> 980</span></a>            <span class="k">if</span> <span class="n">occu</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifParser-981"><a href="#CifParser-981"><span class="linenos"> 981</span></a>                <span class="n">coord</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</span><span id="CifParser-982"><a href="#CifParser-982"><span class="linenos"> 982</span></a>                <span class="n">match</span> <span class="o">=</span> <span class="n">get_matching_coord</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
</span><span id="CifParser-983"><a href="#CifParser-983"><span class="linenos"> 983</span></a>                <span class="n">comp_d</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="p">:</span> <span class="n">occu</span><span class="p">}</span>
</span><span id="CifParser-984"><a href="#CifParser-984"><span class="linenos"> 984</span></a>                <span class="k">if</span> <span class="n">num_h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifParser-985"><a href="#CifParser-985"><span class="linenos"> 985</span></a>                    <span class="n">comp_d</span><span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_h</span>
</span><span id="CifParser-986"><a href="#CifParser-986"><span class="linenos"> 986</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CifParser-987"><a href="#CifParser-987"><span class="linenos"> 987</span></a>                        <span class="s2">&quot;Structure has implicit hydrogens defined, &quot;</span>
</span><span id="CifParser-988"><a href="#CifParser-988"><span class="linenos"> 988</span></a>                        <span class="s2">&quot;parsed structure unlikely to be suitable for use &quot;</span>
</span><span id="CifParser-989"><a href="#CifParser-989"><span class="linenos"> 989</span></a>                        <span class="s2">&quot;in calculations unless hydrogens added.&quot;</span>
</span><span id="CifParser-990"><a href="#CifParser-990"><span class="linenos"> 990</span></a>                    <span class="p">)</span>
</span><span id="CifParser-991"><a href="#CifParser-991"><span class="linenos"> 991</span></a>                <span class="n">comp</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">comp_d</span><span class="p">)</span>
</span><span id="CifParser-992"><a href="#CifParser-992"><span class="linenos"> 992</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
</span><span id="CifParser-993"><a href="#CifParser-993"><span class="linenos"> 993</span></a>                    <span class="n">coord_to_species</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp</span>
</span><span id="CifParser-994"><a href="#CifParser-994"><span class="linenos"> 994</span></a>                    <span class="n">coord_to_magmoms</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">magmom</span>
</span><span id="CifParser-995"><a href="#CifParser-995"><span class="linenos"> 995</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-996"><a href="#CifParser-996"><span class="linenos"> 996</span></a>                    <span class="n">coord_to_species</span><span class="p">[</span><span class="n">match</span><span class="p">]</span> <span class="o">+=</span> <span class="n">comp</span>
</span><span id="CifParser-997"><a href="#CifParser-997"><span class="linenos"> 997</span></a>                    <span class="c1"># disordered magnetic not currently supported</span>
</span><span id="CifParser-998"><a href="#CifParser-998"><span class="linenos"> 998</span></a>                    <span class="n">coord_to_magmoms</span><span class="p">[</span><span class="n">match</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CifParser-999"><a href="#CifParser-999"><span class="linenos"> 999</span></a>
</span><span id="CifParser-1000"><a href="#CifParser-1000"><span class="linenos">1000</span></a>        <span class="n">sum_occu</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CifParser-1001"><a href="#CifParser-1001"><span class="linenos">1001</span></a>            <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coord_to_species</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">),</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">)}</span>
</span><span id="CifParser-1002"><a href="#CifParser-1002"><span class="linenos">1002</span></a>        <span class="p">]</span>
</span><span id="CifParser-1003"><a href="#CifParser-1003"><span class="linenos">1003</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">o</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">sum_occu</span><span class="p">):</span>
</span><span id="CifParser-1004"><a href="#CifParser-1004"><span class="linenos">1004</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="CifParser-1005"><a href="#CifParser-1005"><span class="linenos">1005</span></a>                <span class="s2">&quot;Some occupancies (</span><span class="si">{}</span><span class="s2">) sum to &gt; 1! If they are within &quot;</span>
</span><span id="CifParser-1006"><a href="#CifParser-1006"><span class="linenos">1006</span></a>                <span class="s2">&quot;the occupancy_tolerance, they will be rescaled. &quot;</span>
</span><span id="CifParser-1007"><a href="#CifParser-1007"><span class="linenos">1007</span></a>                <span class="s2">&quot;The current occupancy_tolerance is set to: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sum_occu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occupancy_tolerance</span><span class="p">)</span>
</span><span id="CifParser-1008"><a href="#CifParser-1008"><span class="linenos">1008</span></a>            <span class="p">)</span>
</span><span id="CifParser-1009"><a href="#CifParser-1009"><span class="linenos">1009</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-1010"><a href="#CifParser-1010"><span class="linenos">1010</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser-1011"><a href="#CifParser-1011"><span class="linenos">1011</span></a>
</span><span id="CifParser-1012"><a href="#CifParser-1012"><span class="linenos">1012</span></a>        <span class="n">allspecies</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-1013"><a href="#CifParser-1013"><span class="linenos">1013</span></a>        <span class="n">allcoords</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-1014"><a href="#CifParser-1014"><span class="linenos">1014</span></a>        <span class="n">allmagmoms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-1015"><a href="#CifParser-1015"><span class="linenos">1015</span></a>        <span class="n">allhydrogens</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-1016"><a href="#CifParser-1016"><span class="linenos">1016</span></a>        <span class="n">equivalent_indices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-1017"><a href="#CifParser-1017"><span class="linenos">1017</span></a>
</span><span id="CifParser-1018"><a href="#CifParser-1018"><span class="linenos">1018</span></a>        <span class="c1"># check to see if magCIF file is disordered</span>
</span><span id="CifParser-1019"><a href="#CifParser-1019"><span class="linenos">1019</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]:</span>
</span><span id="CifParser-1020"><a href="#CifParser-1020"><span class="linenos">1020</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coord_to_magmoms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-1021"><a href="#CifParser-1021"><span class="linenos">1021</span></a>                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifParser-1022"><a href="#CifParser-1022"><span class="linenos">1022</span></a>                    <span class="c1"># Proposed solution to this is to instead store magnetic</span>
</span><span id="CifParser-1023"><a href="#CifParser-1023"><span class="linenos">1023</span></a>                    <span class="c1"># moments as Species &#39;spin&#39; property, instead of site</span>
</span><span id="CifParser-1024"><a href="#CifParser-1024"><span class="linenos">1024</span></a>                    <span class="c1"># property, but this introduces ambiguities for end user</span>
</span><span id="CifParser-1025"><a href="#CifParser-1025"><span class="linenos">1025</span></a>                    <span class="c1"># (such as unintended use of `spin` and Species will have</span>
</span><span id="CifParser-1026"><a href="#CifParser-1026"><span class="linenos">1026</span></a>                    <span class="c1"># fictitious oxidation state).</span>
</span><span id="CifParser-1027"><a href="#CifParser-1027"><span class="linenos">1027</span></a>                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Disordered magnetic structures not currently supported.&quot;</span><span class="p">)</span>
</span><span id="CifParser-1028"><a href="#CifParser-1028"><span class="linenos">1028</span></a>
</span><span id="CifParser-1029"><a href="#CifParser-1029"><span class="linenos">1029</span></a>        <span class="k">if</span> <span class="n">coord_to_species</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-1030"><a href="#CifParser-1030"><span class="linenos">1030</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="CifParser-1031"><a href="#CifParser-1031"><span class="linenos">1031</span></a>                <span class="n">groupby</span><span class="p">(</span>
</span><span id="CifParser-1032"><a href="#CifParser-1032"><span class="linenos">1032</span></a>                    <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">coord_to_species</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="CifParser-1033"><a href="#CifParser-1033"><span class="linenos">1033</span></a>                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="CifParser-1034"><a href="#CifParser-1034"><span class="linenos">1034</span></a>                <span class="p">)</span>
</span><span id="CifParser-1035"><a href="#CifParser-1035"><span class="linenos">1035</span></a>            <span class="p">):</span>
</span><span id="CifParser-1036"><a href="#CifParser-1036"><span class="linenos">1036</span></a>                <span class="n">tmp_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">group</span><span class="p">]</span>
</span><span id="CifParser-1037"><a href="#CifParser-1037"><span class="linenos">1037</span></a>                <span class="n">tmp_magmom</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord_to_magmoms</span><span class="p">[</span><span class="n">tmp_coord</span><span class="p">]</span> <span class="k">for</span> <span class="n">tmp_coord</span> <span class="ow">in</span> <span class="n">tmp_coords</span><span class="p">]</span>
</span><span id="CifParser-1038"><a href="#CifParser-1038"><span class="linenos">1038</span></a>
</span><span id="CifParser-1039"><a href="#CifParser-1039"><span class="linenos">1039</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]:</span>
</span><span id="CifParser-1040"><a href="#CifParser-1040"><span class="linenos">1040</span></a>                    <span class="n">coords</span><span class="p">,</span> <span class="n">magmoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_coords</span><span class="p">(</span><span class="n">tmp_coords</span><span class="p">,</span> <span class="n">magmoms_in</span><span class="o">=</span><span class="n">tmp_magmom</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="n">lattice</span><span class="p">)</span>
</span><span id="CifParser-1041"><a href="#CifParser-1041"><span class="linenos">1041</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-1042"><a href="#CifParser-1042"><span class="linenos">1042</span></a>                    <span class="n">coords</span><span class="p">,</span> <span class="n">magmoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_coords</span><span class="p">(</span><span class="n">tmp_coords</span><span class="p">)</span>
</span><span id="CifParser-1043"><a href="#CifParser-1043"><span class="linenos">1043</span></a>
</span><span id="CifParser-1044"><a href="#CifParser-1044"><span class="linenos">1044</span></a>                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">),</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">)}:</span>
</span><span id="CifParser-1045"><a href="#CifParser-1045"><span class="linenos">1045</span></a>                    <span class="c1"># O with implicit hydrogens</span>
</span><span id="CifParser-1046"><a href="#CifParser-1046"><span class="linenos">1046</span></a>                    <span class="n">im_h</span> <span class="o">=</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">]</span>
</span><span id="CifParser-1047"><a href="#CifParser-1047"><span class="linenos">1047</span></a>                    <span class="n">species</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">({</span><span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">]})</span>
</span><span id="CifParser-1048"><a href="#CifParser-1048"><span class="linenos">1048</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-1049"><a href="#CifParser-1049"><span class="linenos">1049</span></a>                    <span class="n">im_h</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CifParser-1050"><a href="#CifParser-1050"><span class="linenos">1050</span></a>                    <span class="n">species</span> <span class="o">=</span> <span class="n">comp</span>
</span><span id="CifParser-1051"><a href="#CifParser-1051"><span class="linenos">1051</span></a>
</span><span id="CifParser-1052"><a href="#CifParser-1052"><span class="linenos">1052</span></a>                <span class="c1"># The following might be a more natural representation of equivalent indices,</span>
</span><span id="CifParser-1053"><a href="#CifParser-1053"><span class="linenos">1053</span></a>                <span class="c1"># but is not in the format expect by SymmetrizedStructure:</span>
</span><span id="CifParser-1054"><a href="#CifParser-1054"><span class="linenos">1054</span></a>                <span class="c1">#   equivalent_indices.append(list(range(len(allcoords), len(coords)+len(allcoords))))</span>
</span><span id="CifParser-1055"><a href="#CifParser-1055"><span class="linenos">1055</span></a>                <span class="c1"># The above gives a list like:</span>
</span><span id="CifParser-1056"><a href="#CifParser-1056"><span class="linenos">1056</span></a>                <span class="c1">#   [[0, 1, 2, 3], [4, 5, 6, 7, 8, 9, 10, 11]] where the</span>
</span><span id="CifParser-1057"><a href="#CifParser-1057"><span class="linenos">1057</span></a>                <span class="c1"># integers are site indices, whereas the version used below will give a version like:</span>
</span><span id="CifParser-1058"><a href="#CifParser-1058"><span class="linenos">1058</span></a>                <span class="c1">#   [0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1]</span>
</span><span id="CifParser-1059"><a href="#CifParser-1059"><span class="linenos">1059</span></a>                <span class="c1"># which is a list in the same order as the sites, but where if a site has the same integer</span>
</span><span id="CifParser-1060"><a href="#CifParser-1060"><span class="linenos">1060</span></a>                <span class="c1"># it is equivalent.</span>
</span><span id="CifParser-1061"><a href="#CifParser-1061"><span class="linenos">1061</span></a>                <span class="n">equivalent_indices</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="CifParser-1062"><a href="#CifParser-1062"><span class="linenos">1062</span></a>
</span><span id="CifParser-1063"><a href="#CifParser-1063"><span class="linenos">1063</span></a>                <span class="n">allhydrogens</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">im_h</span><span class="p">])</span>
</span><span id="CifParser-1064"><a href="#CifParser-1064"><span class="linenos">1064</span></a>                <span class="n">allcoords</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="CifParser-1065"><a href="#CifParser-1065"><span class="linenos">1065</span></a>                <span class="n">allspecies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">species</span><span class="p">])</span>
</span><span id="CifParser-1066"><a href="#CifParser-1066"><span class="linenos">1066</span></a>                <span class="n">allmagmoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">magmoms</span><span class="p">)</span>
</span><span id="CifParser-1067"><a href="#CifParser-1067"><span class="linenos">1067</span></a>
</span><span id="CifParser-1068"><a href="#CifParser-1068"><span class="linenos">1068</span></a>            <span class="c1"># rescale occupancies if necessary</span>
</span><span id="CifParser-1069"><a href="#CifParser-1069"><span class="linenos">1069</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">species</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">allspecies</span><span class="p">):</span>
</span><span id="CifParser-1070"><a href="#CifParser-1070"><span class="linenos">1070</span></a>                <span class="n">totaloccu</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="CifParser-1071"><a href="#CifParser-1071"><span class="linenos">1071</span></a>                <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">totaloccu</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occupancy_tolerance</span><span class="p">:</span>
</span><span id="CifParser-1072"><a href="#CifParser-1072"><span class="linenos">1072</span></a>                    <span class="n">allspecies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">species</span> <span class="o">/</span> <span class="n">totaloccu</span>
</span><span id="CifParser-1073"><a href="#CifParser-1073"><span class="linenos">1073</span></a>
</span><span id="CifParser-1074"><a href="#CifParser-1074"><span class="linenos">1074</span></a>        <span class="k">if</span> <span class="n">allspecies</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">allspecies</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">allcoords</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">allspecies</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">allmagmoms</span><span class="p">):</span>
</span><span id="CifParser-1075"><a href="#CifParser-1075"><span class="linenos">1075</span></a>            <span class="n">site_properties</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-1076"><a href="#CifParser-1076"><span class="linenos">1076</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">allhydrogens</span><span class="p">):</span>
</span><span id="CifParser-1077"><a href="#CifParser-1077"><span class="linenos">1077</span></a>                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">allhydrogens</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">allcoords</span><span class="p">)</span>
</span><span id="CifParser-1078"><a href="#CifParser-1078"><span class="linenos">1078</span></a>                <span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;implicit_hydrogens&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">allhydrogens</span>
</span><span id="CifParser-1079"><a href="#CifParser-1079"><span class="linenos">1079</span></a>
</span><span id="CifParser-1080"><a href="#CifParser-1080"><span class="linenos">1080</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]:</span>
</span><span id="CifParser-1081"><a href="#CifParser-1081"><span class="linenos">1081</span></a>                <span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;magmom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">allmagmoms</span>
</span><span id="CifParser-1082"><a href="#CifParser-1082"><span class="linenos">1082</span></a>
</span><span id="CifParser-1083"><a href="#CifParser-1083"><span class="linenos">1083</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">site_properties</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifParser-1084"><a href="#CifParser-1084"><span class="linenos">1084</span></a>                <span class="n">site_properties</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CifParser-1085"><a href="#CifParser-1085"><span class="linenos">1085</span></a>
</span><span id="CifParser-1086"><a href="#CifParser-1086"><span class="linenos">1086</span></a>            <span class="n">struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">allspecies</span><span class="p">,</span> <span class="n">allcoords</span><span class="p">,</span> <span class="n">site_properties</span><span class="o">=</span><span class="n">site_properties</span><span class="p">)</span>
</span><span id="CifParser-1087"><a href="#CifParser-1087"><span class="linenos">1087</span></a>
</span><span id="CifParser-1088"><a href="#CifParser-1088"><span class="linenos">1088</span></a>            <span class="k">if</span> <span class="n">symmetrized</span><span class="p">:</span>
</span><span id="CifParser-1089"><a href="#CifParser-1089"><span class="linenos">1089</span></a>
</span><span id="CifParser-1090"><a href="#CifParser-1090"><span class="linenos">1090</span></a>                <span class="c1"># Wyckoff labels not currently parsed, note that not all CIFs will contain Wyckoff labels</span>
</span><span id="CifParser-1091"><a href="#CifParser-1091"><span class="linenos">1091</span></a>                <span class="c1"># TODO: extract Wyckoff labels (or other CIF attributes) and include as site_properties</span>
</span><span id="CifParser-1092"><a href="#CifParser-1092"><span class="linenos">1092</span></a>                <span class="n">wyckoffs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Not Parsed&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span>
</span><span id="CifParser-1093"><a href="#CifParser-1093"><span class="linenos">1093</span></a>
</span><span id="CifParser-1094"><a href="#CifParser-1094"><span class="linenos">1094</span></a>                <span class="c1"># Names of space groups are likewise not parsed (again, not all CIFs will contain this information)</span>
</span><span id="CifParser-1095"><a href="#CifParser-1095"><span class="linenos">1095</span></a>                <span class="c1"># What is stored are the lists of symmetry operations used to generate the structure</span>
</span><span id="CifParser-1096"><a href="#CifParser-1096"><span class="linenos">1096</span></a>                <span class="c1"># TODO: ensure space group labels are stored if present</span>
</span><span id="CifParser-1097"><a href="#CifParser-1097"><span class="linenos">1097</span></a>                <span class="n">sg</span> <span class="o">=</span> <span class="n">SpacegroupOperations</span><span class="p">(</span><span class="s2">&quot;Not Parsed&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_operations</span><span class="p">)</span>
</span><span id="CifParser-1098"><a href="#CifParser-1098"><span class="linenos">1098</span></a>
</span><span id="CifParser-1099"><a href="#CifParser-1099"><span class="linenos">1099</span></a>                <span class="k">return</span> <span class="n">SymmetrizedStructure</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">sg</span><span class="p">,</span> <span class="n">equivalent_indices</span><span class="p">,</span> <span class="n">wyckoffs</span><span class="p">)</span>
</span><span id="CifParser-1100"><a href="#CifParser-1100"><span class="linenos">1100</span></a>
</span><span id="CifParser-1101"><a href="#CifParser-1101"><span class="linenos">1101</span></a>            <span class="n">struct</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">get_sorted_structure</span><span class="p">()</span>
</span><span id="CifParser-1102"><a href="#CifParser-1102"><span class="linenos">1102</span></a>
</span><span id="CifParser-1103"><a href="#CifParser-1103"><span class="linenos">1103</span></a>            <span class="k">if</span> <span class="n">primitive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]:</span>
</span><span id="CifParser-1104"><a href="#CifParser-1104"><span class="linenos">1104</span></a>                <span class="n">struct</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">(</span><span class="n">use_site_props</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CifParser-1105"><a href="#CifParser-1105"><span class="linenos">1105</span></a>            <span class="k">elif</span> <span class="n">primitive</span><span class="p">:</span>
</span><span id="CifParser-1106"><a href="#CifParser-1106"><span class="linenos">1106</span></a>                <span class="n">struct</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">()</span>
</span><span id="CifParser-1107"><a href="#CifParser-1107"><span class="linenos">1107</span></a>                <span class="n">struct</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">get_reduced_structure</span><span class="p">()</span>
</span><span id="CifParser-1108"><a href="#CifParser-1108"><span class="linenos">1108</span></a>
</span><span id="CifParser-1109"><a href="#CifParser-1109"><span class="linenos">1109</span></a>            <span class="k">return</span> <span class="n">struct</span>
</span><span id="CifParser-1110"><a href="#CifParser-1110"><span class="linenos">1110</span></a>
</span><span id="CifParser-1111"><a href="#CifParser-1111"><span class="linenos">1111</span></a>    <span class="k">def</span> <span class="nf">get_structures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">symmetrized</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="CifParser-1112"><a href="#CifParser-1112"><span class="linenos">1112</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-1113"><a href="#CifParser-1113"><span class="linenos">1113</span></a><span class="sd">        Return list of structures in CIF file. primitive boolean sets whether a</span>
</span><span id="CifParser-1114"><a href="#CifParser-1114"><span class="linenos">1114</span></a><span class="sd">        conventional cell structure or primitive cell structure is returned.</span>
</span><span id="CifParser-1115"><a href="#CifParser-1115"><span class="linenos">1115</span></a>
</span><span id="CifParser-1116"><a href="#CifParser-1116"><span class="linenos">1116</span></a><span class="sd">        Args:</span>
</span><span id="CifParser-1117"><a href="#CifParser-1117"><span class="linenos">1117</span></a><span class="sd">            primitive (bool): Set to False to return conventional unit cells.</span>
</span><span id="CifParser-1118"><a href="#CifParser-1118"><span class="linenos">1118</span></a><span class="sd">                Defaults to True. With magnetic CIF files, will return primitive</span>
</span><span id="CifParser-1119"><a href="#CifParser-1119"><span class="linenos">1119</span></a><span class="sd">                magnetic cell which may be larger than nuclear primitive cell.</span>
</span><span id="CifParser-1120"><a href="#CifParser-1120"><span class="linenos">1120</span></a><span class="sd">            symmetrized (bool): If True, return a SymmetrizedStructure which will</span>
</span><span id="CifParser-1121"><a href="#CifParser-1121"><span class="linenos">1121</span></a><span class="sd">                include the equivalent indices and symmetry operations used to</span>
</span><span id="CifParser-1122"><a href="#CifParser-1122"><span class="linenos">1122</span></a><span class="sd">                create the Structure as provided by the CIF (if explicit symmetry</span>
</span><span id="CifParser-1123"><a href="#CifParser-1123"><span class="linenos">1123</span></a><span class="sd">                operations are included in the CIF) or generated from information</span>
</span><span id="CifParser-1124"><a href="#CifParser-1124"><span class="linenos">1124</span></a><span class="sd">                in the CIF (if only space group labels are provided). Note that</span>
</span><span id="CifParser-1125"><a href="#CifParser-1125"><span class="linenos">1125</span></a><span class="sd">                currently Wyckoff labels and space group labels or numbers are</span>
</span><span id="CifParser-1126"><a href="#CifParser-1126"><span class="linenos">1126</span></a><span class="sd">                not included in the generated SymmetrizedStructure, these will be</span>
</span><span id="CifParser-1127"><a href="#CifParser-1127"><span class="linenos">1127</span></a><span class="sd">                notated as &quot;Not Parsed&quot; or -1 respectively.</span>
</span><span id="CifParser-1128"><a href="#CifParser-1128"><span class="linenos">1128</span></a>
</span><span id="CifParser-1129"><a href="#CifParser-1129"><span class="linenos">1129</span></a><span class="sd">        Returns:</span>
</span><span id="CifParser-1130"><a href="#CifParser-1130"><span class="linenos">1130</span></a><span class="sd">            List of Structures.</span>
</span><span id="CifParser-1131"><a href="#CifParser-1131"><span class="linenos">1131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-1132"><a href="#CifParser-1132"><span class="linenos">1132</span></a>
</span><span id="CifParser-1133"><a href="#CifParser-1133"><span class="linenos">1133</span></a>        <span class="k">if</span> <span class="n">primitive</span> <span class="ow">and</span> <span class="n">symmetrized</span><span class="p">:</span>
</span><span id="CifParser-1134"><a href="#CifParser-1134"><span class="linenos">1134</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="CifParser-1135"><a href="#CifParser-1135"><span class="linenos">1135</span></a>                <span class="s2">&quot;Using both &#39;primitive&#39; and &#39;symmetrized&#39; arguments is not currently supported &quot;</span>
</span><span id="CifParser-1136"><a href="#CifParser-1136"><span class="linenos">1136</span></a>                <span class="s2">&quot;since unexpected behavior might result.&quot;</span>
</span><span id="CifParser-1137"><a href="#CifParser-1137"><span class="linenos">1137</span></a>            <span class="p">)</span>
</span><span id="CifParser-1138"><a href="#CifParser-1138"><span class="linenos">1138</span></a>
</span><span id="CifParser-1139"><a href="#CifParser-1139"><span class="linenos">1139</span></a>        <span class="n">structures</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser-1140"><a href="#CifParser-1140"><span class="linenos">1140</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="CifParser-1141"><a href="#CifParser-1141"><span class="linenos">1141</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-1142"><a href="#CifParser-1142"><span class="linenos">1142</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_structure</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">primitive</span><span class="p">,</span> <span class="n">symmetrized</span><span class="p">)</span>
</span><span id="CifParser-1143"><a href="#CifParser-1143"><span class="linenos">1143</span></a>                <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
</span><span id="CifParser-1144"><a href="#CifParser-1144"><span class="linenos">1144</span></a>                    <span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="CifParser-1145"><a href="#CifParser-1145"><span class="linenos">1145</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="CifParser-1146"><a href="#CifParser-1146"><span class="linenos">1146</span></a>                <span class="c1"># Warn the user (Errors should never pass silently)</span>
</span><span id="CifParser-1147"><a href="#CifParser-1147"><span class="linenos">1147</span></a>                <span class="c1"># A user reported a problem with cif files produced by Avogadro</span>
</span><span id="CifParser-1148"><a href="#CifParser-1148"><span class="linenos">1148</span></a>                <span class="c1"># in which the atomic coordinates are in Cartesian coords.</span>
</span><span id="CifParser-1149"><a href="#CifParser-1149"><span class="linenos">1149</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
</span><span id="CifParser-1150"><a href="#CifParser-1150"><span class="linenos">1150</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No structure parsed for </span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> structure in CIF. Section of CIF file below.&quot;</span><span class="p">)</span>
</span><span id="CifParser-1151"><a href="#CifParser-1151"><span class="linenos">1151</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
</span><span id="CifParser-1152"><a href="#CifParser-1152"><span class="linenos">1152</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error is </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="CifParser-1153"><a href="#CifParser-1153"><span class="linenos">1153</span></a>
</span><span id="CifParser-1154"><a href="#CifParser-1154"><span class="linenos">1154</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">:</span>
</span><span id="CifParser-1155"><a href="#CifParser-1155"><span class="linenos">1155</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Issues encountered while parsing CIF: &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">))</span>
</span><span id="CifParser-1156"><a href="#CifParser-1156"><span class="linenos">1156</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifParser-1157"><a href="#CifParser-1157"><span class="linenos">1157</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid cif file with no structures!&quot;</span><span class="p">)</span>
</span><span id="CifParser-1158"><a href="#CifParser-1158"><span class="linenos">1158</span></a>        <span class="k">return</span> <span class="n">structures</span>
</span><span id="CifParser-1159"><a href="#CifParser-1159"><span class="linenos">1159</span></a>
</span><span id="CifParser-1160"><a href="#CifParser-1160"><span class="linenos">1160</span></a>    <span class="k">def</span> <span class="nf">get_bibtex_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CifParser-1161"><a href="#CifParser-1161"><span class="linenos">1161</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-1162"><a href="#CifParser-1162"><span class="linenos">1162</span></a><span class="sd">        Get BibTeX reference from CIF file.</span>
</span><span id="CifParser-1163"><a href="#CifParser-1163"><span class="linenos">1163</span></a><span class="sd">        :param data:</span>
</span><span id="CifParser-1164"><a href="#CifParser-1164"><span class="linenos">1164</span></a><span class="sd">        :return: BibTeX string</span>
</span><span id="CifParser-1165"><a href="#CifParser-1165"><span class="linenos">1165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-1166"><a href="#CifParser-1166"><span class="linenos">1166</span></a>
</span><span id="CifParser-1167"><a href="#CifParser-1167"><span class="linenos">1167</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser-1168"><a href="#CifParser-1168"><span class="linenos">1168</span></a>            <span class="kn">from</span> <span class="nn">pybtex.database</span> <span class="kn">import</span> <span class="n">BibliographyData</span><span class="p">,</span> <span class="n">Entry</span>
</span><span id="CifParser-1169"><a href="#CifParser-1169"><span class="linenos">1169</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="CifParser-1170"><a href="#CifParser-1170"><span class="linenos">1170</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Bibliographic data extraction requires pybtex.&quot;</span><span class="p">)</span>
</span><span id="CifParser-1171"><a href="#CifParser-1171"><span class="linenos">1171</span></a>
</span><span id="CifParser-1172"><a href="#CifParser-1172"><span class="linenos">1172</span></a>        <span class="n">bibtex_keys</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CifParser-1173"><a href="#CifParser-1173"><span class="linenos">1173</span></a>            <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_publ_author_name&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_author_name&quot;</span><span class="p">),</span>
</span><span id="CifParser-1174"><a href="#CifParser-1174"><span class="linenos">1174</span></a>            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_publ_section_title&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_title&quot;</span><span class="p">),</span>
</span><span id="CifParser-1175"><a href="#CifParser-1175"><span class="linenos">1175</span></a>            <span class="s2">&quot;journal&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="CifParser-1176"><a href="#CifParser-1176"><span class="linenos">1176</span></a>                <span class="s2">&quot;_journal_name_full&quot;</span><span class="p">,</span>
</span><span id="CifParser-1177"><a href="#CifParser-1177"><span class="linenos">1177</span></a>                <span class="s2">&quot;_journal_name_abbrev&quot;</span><span class="p">,</span>
</span><span id="CifParser-1178"><a href="#CifParser-1178"><span class="linenos">1178</span></a>                <span class="s2">&quot;_citation_journal_full&quot;</span><span class="p">,</span>
</span><span id="CifParser-1179"><a href="#CifParser-1179"><span class="linenos">1179</span></a>                <span class="s2">&quot;_citation_journal_abbrev&quot;</span><span class="p">,</span>
</span><span id="CifParser-1180"><a href="#CifParser-1180"><span class="linenos">1180</span></a>            <span class="p">),</span>
</span><span id="CifParser-1181"><a href="#CifParser-1181"><span class="linenos">1181</span></a>            <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_volume&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_journal_volume&quot;</span><span class="p">),</span>
</span><span id="CifParser-1182"><a href="#CifParser-1182"><span class="linenos">1182</span></a>            <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_year&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_year&quot;</span><span class="p">),</span>
</span><span id="CifParser-1183"><a href="#CifParser-1183"><span class="linenos">1183</span></a>            <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_number&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_number&quot;</span><span class="p">),</span>
</span><span id="CifParser-1184"><a href="#CifParser-1184"><span class="linenos">1184</span></a>            <span class="s2">&quot;page_first&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_page_first&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_page_first&quot;</span><span class="p">),</span>
</span><span id="CifParser-1185"><a href="#CifParser-1185"><span class="linenos">1185</span></a>            <span class="s2">&quot;page_last&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_page_last&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_page_last&quot;</span><span class="p">),</span>
</span><span id="CifParser-1186"><a href="#CifParser-1186"><span class="linenos">1186</span></a>            <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_DOI&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_DOI&quot;</span><span class="p">),</span>
</span><span id="CifParser-1187"><a href="#CifParser-1187"><span class="linenos">1187</span></a>        <span class="p">}</span>
</span><span id="CifParser-1188"><a href="#CifParser-1188"><span class="linenos">1188</span></a>
</span><span id="CifParser-1189"><a href="#CifParser-1189"><span class="linenos">1189</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-1190"><a href="#CifParser-1190"><span class="linenos">1190</span></a>
</span><span id="CifParser-1191"><a href="#CifParser-1191"><span class="linenos">1191</span></a>        <span class="c1"># TODO: parse &#39;_publ_section_references&#39; when it exists?</span>
</span><span id="CifParser-1192"><a href="#CifParser-1192"><span class="linenos">1192</span></a>        <span class="c1"># TODO: CIF specification supports multiple citations.</span>
</span><span id="CifParser-1193"><a href="#CifParser-1193"><span class="linenos">1193</span></a>
</span><span id="CifParser-1194"><a href="#CifParser-1194"><span class="linenos">1194</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="CifParser-1195"><a href="#CifParser-1195"><span class="linenos">1195</span></a>
</span><span id="CifParser-1196"><a href="#CifParser-1196"><span class="linenos">1196</span></a>            <span class="c1"># convert to lower-case keys, some cif files inconsistent</span>
</span><span id="CifParser-1197"><a href="#CifParser-1197"><span class="linenos">1197</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="CifParser-1198"><a href="#CifParser-1198"><span class="linenos">1198</span></a>
</span><span id="CifParser-1199"><a href="#CifParser-1199"><span class="linenos">1199</span></a>            <span class="n">bibtex_entry</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-1200"><a href="#CifParser-1200"><span class="linenos">1200</span></a>
</span><span id="CifParser-1201"><a href="#CifParser-1201"><span class="linenos">1201</span></a>            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">tags</span> <span class="ow">in</span> <span class="n">bibtex_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-1202"><a href="#CifParser-1202"><span class="linenos">1202</span></a>                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
</span><span id="CifParser-1203"><a href="#CifParser-1203"><span class="linenos">1203</span></a>                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="CifParser-1204"><a href="#CifParser-1204"><span class="linenos">1204</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">tag</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="CifParser-1205"><a href="#CifParser-1205"><span class="linenos">1205</span></a>                            <span class="n">bibtex_entry</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CifParser-1206"><a href="#CifParser-1206"><span class="linenos">1206</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser-1207"><a href="#CifParser-1207"><span class="linenos">1207</span></a>                            <span class="n">bibtex_entry</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
</span><span id="CifParser-1208"><a href="#CifParser-1208"><span class="linenos">1208</span></a>
</span><span id="CifParser-1209"><a href="#CifParser-1209"><span class="linenos">1209</span></a>            <span class="c1"># convert to bibtex author format (&#39;and&#39; delimited)</span>
</span><span id="CifParser-1210"><a href="#CifParser-1210"><span class="linenos">1210</span></a>            <span class="k">if</span> <span class="s2">&quot;author&quot;</span> <span class="ow">in</span> <span class="n">bibtex_entry</span><span class="p">:</span>
</span><span id="CifParser-1211"><a href="#CifParser-1211"><span class="linenos">1211</span></a>                <span class="c1"># separate out semicolon authors</span>
</span><span id="CifParser-1212"><a href="#CifParser-1212"><span class="linenos">1212</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CifParser-1213"><a href="#CifParser-1213"><span class="linenos">1213</span></a>                    <span class="k">if</span> <span class="s2">&quot;;&quot;</span> <span class="ow">in</span> <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]:</span>
</span><span id="CifParser-1214"><a href="#CifParser-1214"><span class="linenos">1214</span></a>                        <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span id="CifParser-1215"><a href="#CifParser-1215"><span class="linenos">1215</span></a>
</span><span id="CifParser-1216"><a href="#CifParser-1216"><span class="linenos">1216</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="CifParser-1217"><a href="#CifParser-1217"><span class="linenos">1217</span></a>                    <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">])</span>
</span><span id="CifParser-1218"><a href="#CifParser-1218"><span class="linenos">1218</span></a>
</span><span id="CifParser-1219"><a href="#CifParser-1219"><span class="linenos">1219</span></a>            <span class="c1"># convert to bibtex page range format, use empty string if not specified</span>
</span><span id="CifParser-1220"><a href="#CifParser-1220"><span class="linenos">1220</span></a>            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;page_first&quot;</span> <span class="ow">in</span> <span class="n">bibtex_entry</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;page_last&quot;</span> <span class="ow">in</span> <span class="n">bibtex_entry</span><span class="p">):</span>
</span><span id="CifParser-1221"><a href="#CifParser-1221"><span class="linenos">1221</span></a>                <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">--</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="CifParser-1222"><a href="#CifParser-1222"><span class="linenos">1222</span></a>                    <span class="n">bibtex_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_first&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="CifParser-1223"><a href="#CifParser-1223"><span class="linenos">1223</span></a>                    <span class="n">bibtex_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_last&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="CifParser-1224"><a href="#CifParser-1224"><span class="linenos">1224</span></a>                <span class="p">)</span>
</span><span id="CifParser-1225"><a href="#CifParser-1225"><span class="linenos">1225</span></a>                <span class="n">bibtex_entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;page_first&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># and remove page_first, page_list if present</span>
</span><span id="CifParser-1226"><a href="#CifParser-1226"><span class="linenos">1226</span></a>                <span class="n">bibtex_entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;page_last&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="CifParser-1227"><a href="#CifParser-1227"><span class="linenos">1227</span></a>
</span><span id="CifParser-1228"><a href="#CifParser-1228"><span class="linenos">1228</span></a>            <span class="c1"># cite keys are given as cif-reference-idx in order they are found</span>
</span><span id="CifParser-1229"><a href="#CifParser-1229"><span class="linenos">1229</span></a>            <span class="n">entries</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;cifref</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">(</span><span class="s2">&quot;article&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">bibtex_entry</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="CifParser-1230"><a href="#CifParser-1230"><span class="linenos">1230</span></a>
</span><span id="CifParser-1231"><a href="#CifParser-1231"><span class="linenos">1231</span></a>        <span class="k">return</span> <span class="n">BibliographyData</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">bib_format</span><span class="o">=</span><span class="s2">&quot;bibtex&quot;</span><span class="p">)</span>
</span><span id="CifParser-1232"><a href="#CifParser-1232"><span class="linenos">1232</span></a>
</span><span id="CifParser-1233"><a href="#CifParser-1233"><span class="linenos">1233</span></a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CifParser-1234"><a href="#CifParser-1234"><span class="linenos">1234</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-1235"><a href="#CifParser-1235"><span class="linenos">1235</span></a><span class="sd">        :return: MSONable dict</span>
</span><span id="CifParser-1236"><a href="#CifParser-1236"><span class="linenos">1236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-1237"><a href="#CifParser-1237"><span class="linenos">1237</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-1238"><a href="#CifParser-1238"><span class="linenos">1238</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-1239"><a href="#CifParser-1239"><span class="linenos">1239</span></a>            <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser-1240"><a href="#CifParser-1240"><span class="linenos">1240</span></a>            <span class="k">for</span> <span class="n">k2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser-1241"><a href="#CifParser-1241"><span class="linenos">1241</span></a>                <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v2</span>
</span><span id="CifParser-1242"><a href="#CifParser-1242"><span class="linenos">1242</span></a>        <span class="k">return</span> <span class="n">d</span>
</span><span id="CifParser-1243"><a href="#CifParser-1243"><span class="linenos">1243</span></a>
</span><span id="CifParser-1244"><a href="#CifParser-1244"><span class="linenos">1244</span></a>    <span class="nd">@property</span>
</span><span id="CifParser-1245"><a href="#CifParser-1245"><span class="linenos">1245</span></a>    <span class="k">def</span> <span class="nf">has_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CifParser-1246"><a href="#CifParser-1246"><span class="linenos">1246</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser-1247"><a href="#CifParser-1247"><span class="linenos">1247</span></a><span class="sd">        :return: Whether there are errors/warnings detected in CIF parsing.</span>
</span><span id="CifParser-1248"><a href="#CifParser-1248"><span class="linenos">1248</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser-1249"><a href="#CifParser-1249"><span class="linenos">1249</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Parses a CIF file. Attempts to fix CIFs that are out-of-spec, but will
issue warnings if corrections applied. These are also stored in the
CifParser's errors attribute.</p>
</div>


                            <div id="CifParser.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">CifParser</span><span class="signature">(filename, occupancy_tolerance=1.0, site_tolerance=0.0001)</span>
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.__init__-294"><a href="#CifParser.__init__-294"><span class="linenos">294</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">occupancy_tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">site_tolerance</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">):</span>
</span><span id="CifParser.__init__-295"><a href="#CifParser.__init__-295"><span class="linenos">295</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.__init__-296"><a href="#CifParser.__init__-296"><span class="linenos">296</span></a><span class="sd">        Args:</span>
</span><span id="CifParser.__init__-297"><a href="#CifParser.__init__-297"><span class="linenos">297</span></a><span class="sd">            filename (str): CIF filename, bzipped or gzipped CIF files are fine too.</span>
</span><span id="CifParser.__init__-298"><a href="#CifParser.__init__-298"><span class="linenos">298</span></a><span class="sd">            occupancy_tolerance (float): If total occupancy of a site is between 1</span>
</span><span id="CifParser.__init__-299"><a href="#CifParser.__init__-299"><span class="linenos">299</span></a><span class="sd">                and occupancy_tolerance, the occupancies will be scaled down to 1.</span>
</span><span id="CifParser.__init__-300"><a href="#CifParser.__init__-300"><span class="linenos">300</span></a><span class="sd">            site_tolerance (float): This tolerance is used to determine if two</span>
</span><span id="CifParser.__init__-301"><a href="#CifParser.__init__-301"><span class="linenos">301</span></a><span class="sd">                sites are sitting in the same position, in which case they will be</span>
</span><span id="CifParser.__init__-302"><a href="#CifParser.__init__-302"><span class="linenos">302</span></a><span class="sd">                combined to a single disordered site. Defaults to 1e-4.</span>
</span><span id="CifParser.__init__-303"><a href="#CifParser.__init__-303"><span class="linenos">303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.__init__-304"><a href="#CifParser.__init__-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_occupancy_tolerance</span> <span class="o">=</span> <span class="n">occupancy_tolerance</span>
</span><span id="CifParser.__init__-305"><a href="#CifParser.__init__-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_site_tolerance</span> <span class="o">=</span> <span class="n">site_tolerance</span>
</span><span id="CifParser.__init__-306"><a href="#CifParser.__init__-306"><span class="linenos">306</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
</span><span id="CifParser.__init__-307"><a href="#CifParser.__init__-307"><span class="linenos">307</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span> <span class="o">=</span> <span class="n">CifFile</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="CifParser.__init__-308"><a href="#CifParser.__init__-308"><span class="linenos">308</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser.__init__-309"><a href="#CifParser.__init__-309"><span class="linenos">309</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span> <span class="o">=</span> <span class="n">CifFile</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="CifParser.__init__-310"><a href="#CifParser.__init__-310"><span class="linenos">310</span></a>
</span><span id="CifParser.__init__-311"><a href="#CifParser.__init__-311"><span class="linenos">311</span></a>        <span class="c1"># store if CIF contains features from non-core CIF dictionaries</span>
</span><span id="CifParser.__init__-312"><a href="#CifParser.__init__-312"><span class="linenos">312</span></a>        <span class="c1"># e.g. magCIF</span>
</span><span id="CifParser.__init__-313"><a href="#CifParser.__init__-313"><span class="linenos">313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser.__init__-314"><a href="#CifParser.__init__-314"><span class="linenos">314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser.__init__-315"><a href="#CifParser.__init__-315"><span class="linenos">315</span></a>
</span><span id="CifParser.__init__-316"><a href="#CifParser.__init__-316"><span class="linenos">316</span></a>        <span class="k">def</span> <span class="nf">is_magcif</span><span class="p">():</span>
</span><span id="CifParser.__init__-317"><a href="#CifParser.__init__-317"><span class="linenos">317</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.__init__-318"><a href="#CifParser.__init__-318"><span class="linenos">318</span></a><span class="sd">            Checks to see if file appears to be a magCIF file (heuristic).</span>
</span><span id="CifParser.__init__-319"><a href="#CifParser.__init__-319"><span class="linenos">319</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CifParser.__init__-320"><a href="#CifParser.__init__-320"><span class="linenos">320</span></a>            <span class="c1"># Doesn&#39;t seem to be a canonical way to test if file is magCIF or</span>
</span><span id="CifParser.__init__-321"><a href="#CifParser.__init__-321"><span class="linenos">321</span></a>            <span class="c1"># not, so instead check for magnetic symmetry datanames</span>
</span><span id="CifParser.__init__-322"><a href="#CifParser.__init__-322"><span class="linenos">322</span></a>            <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CifParser.__init__-323"><a href="#CifParser.__init__-323"><span class="linenos">323</span></a>                <span class="s2">&quot;_space_group_magn&quot;</span><span class="p">,</span>
</span><span id="CifParser.__init__-324"><a href="#CifParser.__init__-324"><span class="linenos">324</span></a>                <span class="s2">&quot;_atom_site_moment&quot;</span><span class="p">,</span>
</span><span id="CifParser.__init__-325"><a href="#CifParser.__init__-325"><span class="linenos">325</span></a>                <span class="s2">&quot;_space_group_symop_magn&quot;</span><span class="p">,</span>
</span><span id="CifParser.__init__-326"><a href="#CifParser.__init__-326"><span class="linenos">326</span></a>            <span class="p">]</span>
</span><span id="CifParser.__init__-327"><a href="#CifParser.__init__-327"><span class="linenos">327</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="CifParser.__init__-328"><a href="#CifParser.__init__-328"><span class="linenos">328</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser.__init__-329"><a href="#CifParser.__init__-329"><span class="linenos">329</span></a>                    <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>
</span><span id="CifParser.__init__-330"><a href="#CifParser.__init__-330"><span class="linenos">330</span></a>                        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
</span><span id="CifParser.__init__-331"><a href="#CifParser.__init__-331"><span class="linenos">331</span></a>                            <span class="k">return</span> <span class="kc">True</span>
</span><span id="CifParser.__init__-332"><a href="#CifParser.__init__-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="CifParser.__init__-333"><a href="#CifParser.__init__-333"><span class="linenos">333</span></a>
</span><span id="CifParser.__init__-334"><a href="#CifParser.__init__-334"><span class="linenos">334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_magcif</span><span class="p">()</span>
</span><span id="CifParser.__init__-335"><a href="#CifParser.__init__-335"><span class="linenos">335</span></a>
</span><span id="CifParser.__init__-336"><a href="#CifParser.__init__-336"><span class="linenos">336</span></a>        <span class="k">def</span> <span class="nf">is_magcif_incommensurate</span><span class="p">():</span>
</span><span id="CifParser.__init__-337"><a href="#CifParser.__init__-337"><span class="linenos">337</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.__init__-338"><a href="#CifParser.__init__-338"><span class="linenos">338</span></a><span class="sd">            Checks to see if file contains an incommensurate magnetic</span>
</span><span id="CifParser.__init__-339"><a href="#CifParser.__init__-339"><span class="linenos">339</span></a><span class="sd">            structure (heuristic).</span>
</span><span id="CifParser.__init__-340"><a href="#CifParser.__init__-340"><span class="linenos">340</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CifParser.__init__-341"><a href="#CifParser.__init__-341"><span class="linenos">341</span></a>            <span class="c1"># Doesn&#39;t seem to be a canonical way to test if magCIF file</span>
</span><span id="CifParser.__init__-342"><a href="#CifParser.__init__-342"><span class="linenos">342</span></a>            <span class="c1"># describes incommensurate structure or not, so instead check</span>
</span><span id="CifParser.__init__-343"><a href="#CifParser.__init__-343"><span class="linenos">343</span></a>            <span class="c1"># for common datanames</span>
</span><span id="CifParser.__init__-344"><a href="#CifParser.__init__-344"><span class="linenos">344</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif&quot;</span><span class="p">]:</span>
</span><span id="CifParser.__init__-345"><a href="#CifParser.__init__-345"><span class="linenos">345</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="CifParser.__init__-346"><a href="#CifParser.__init__-346"><span class="linenos">346</span></a>            <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_cell_modulation_dimension&quot;</span><span class="p">,</span> <span class="s2">&quot;_cell_wave_vector&quot;</span><span class="p">]</span>
</span><span id="CifParser.__init__-347"><a href="#CifParser.__init__-347"><span class="linenos">347</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="CifParser.__init__-348"><a href="#CifParser.__init__-348"><span class="linenos">348</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser.__init__-349"><a href="#CifParser.__init__-349"><span class="linenos">349</span></a>                    <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>
</span><span id="CifParser.__init__-350"><a href="#CifParser.__init__-350"><span class="linenos">350</span></a>                        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
</span><span id="CifParser.__init__-351"><a href="#CifParser.__init__-351"><span class="linenos">351</span></a>                            <span class="k">return</span> <span class="kc">True</span>
</span><span id="CifParser.__init__-352"><a href="#CifParser.__init__-352"><span class="linenos">352</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="CifParser.__init__-353"><a href="#CifParser.__init__-353"><span class="linenos">353</span></a>
</span><span id="CifParser.__init__-354"><a href="#CifParser.__init__-354"><span class="linenos">354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="p">[</span><span class="s2">&quot;magcif_incommensurate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_magcif_incommensurate</span><span class="p">()</span>
</span><span id="CifParser.__init__-355"><a href="#CifParser.__init__-355"><span class="linenos">355</span></a>
</span><span id="CifParser.__init__-356"><a href="#CifParser.__init__-356"><span class="linenos">356</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CifParser.__init__-357"><a href="#CifParser.__init__-357"><span class="linenos">357</span></a>            <span class="c1"># pass individual CifBlocks to _sanitize_data</span>
</span><span id="CifParser.__init__-358"><a href="#CifParser.__init__-358"><span class="linenos">358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Args:
    filename (str): CIF filename, bzipped or gzipped CIF files are fine too.
    occupancy_tolerance (float): If total occupancy of a site is between 1
        and occupancy_tolerance, the occupancies will be scaled down to 1.
    site_tolerance (float): This tolerance is used to determine if two
        sites are sitting in the same position, in which case they will be
        combined to a single disordered site. Defaults to 1e-4.</p>
</div>


                            </div>
                            <div id="CifParser.from_string" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.from_string">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">from_string</span><span class="signature">(cif_string, occupancy_tolerance=1.0)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.from_string-360"><a href="#CifParser.from_string-360"><span class="linenos">360</span></a>    <span class="nd">@staticmethod</span>
</span><span id="CifParser.from_string-361"><a href="#CifParser.from_string-361"><span class="linenos">361</span></a>    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">cif_string</span><span class="p">,</span> <span class="n">occupancy_tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="CifParser.from_string-362"><a href="#CifParser.from_string-362"><span class="linenos">362</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.from_string-363"><a href="#CifParser.from_string-363"><span class="linenos">363</span></a><span class="sd">        Creates a CifParser from a string.</span>
</span><span id="CifParser.from_string-364"><a href="#CifParser.from_string-364"><span class="linenos">364</span></a>
</span><span id="CifParser.from_string-365"><a href="#CifParser.from_string-365"><span class="linenos">365</span></a><span class="sd">        Args:</span>
</span><span id="CifParser.from_string-366"><a href="#CifParser.from_string-366"><span class="linenos">366</span></a><span class="sd">            cif_string (str): String representation of a CIF.</span>
</span><span id="CifParser.from_string-367"><a href="#CifParser.from_string-367"><span class="linenos">367</span></a><span class="sd">            occupancy_tolerance (float): If total occupancy of a site is</span>
</span><span id="CifParser.from_string-368"><a href="#CifParser.from_string-368"><span class="linenos">368</span></a><span class="sd">                between 1 and occupancy_tolerance, the occupancies will be</span>
</span><span id="CifParser.from_string-369"><a href="#CifParser.from_string-369"><span class="linenos">369</span></a><span class="sd">                scaled down to 1.</span>
</span><span id="CifParser.from_string-370"><a href="#CifParser.from_string-370"><span class="linenos">370</span></a>
</span><span id="CifParser.from_string-371"><a href="#CifParser.from_string-371"><span class="linenos">371</span></a><span class="sd">        Returns:</span>
</span><span id="CifParser.from_string-372"><a href="#CifParser.from_string-372"><span class="linenos">372</span></a><span class="sd">            CifParser</span>
</span><span id="CifParser.from_string-373"><a href="#CifParser.from_string-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.from_string-374"><a href="#CifParser.from_string-374"><span class="linenos">374</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">cif_string</span><span class="p">)</span>
</span><span id="CifParser.from_string-375"><a href="#CifParser.from_string-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="n">CifParser</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">occupancy_tolerance</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Creates a CifParser from a string.</p>

<p>Args:
    cif_string (str): String representation of a CIF.
    occupancy_tolerance (float): If total occupancy of a site is
        between 1 and occupancy_tolerance, the occupancies will be
        scaled down to 1.</p>

<p>Returns:
    CifParser</p>
</div>


                            </div>
                            <div id="CifParser.get_lattice" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.get_lattice">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_lattice</span><span class="signature">(
    self,
    data,
    length_strings=(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;),
    angle_strings=(&#39;alpha&#39;, &#39;beta&#39;, &#39;gamma&#39;),
    lattice_type=None
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.get_lattice-608"><a href="#CifParser.get_lattice-608"><span class="linenos">608</span></a>    <span class="k">def</span> <span class="nf">get_lattice</span><span class="p">(</span>
</span><span id="CifParser.get_lattice-609"><a href="#CifParser.get_lattice-609"><span class="linenos">609</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CifParser.get_lattice-610"><a href="#CifParser.get_lattice-610"><span class="linenos">610</span></a>        <span class="n">data</span><span class="p">,</span>
</span><span id="CifParser.get_lattice-611"><a href="#CifParser.get_lattice-611"><span class="linenos">611</span></a>        <span class="n">length_strings</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_lattice-612"><a href="#CifParser.get_lattice-612"><span class="linenos">612</span></a>        <span class="n">angle_strings</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_lattice-613"><a href="#CifParser.get_lattice-613"><span class="linenos">613</span></a>        <span class="n">lattice_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="CifParser.get_lattice-614"><a href="#CifParser.get_lattice-614"><span class="linenos">614</span></a>    <span class="p">):</span>
</span><span id="CifParser.get_lattice-615"><a href="#CifParser.get_lattice-615"><span class="linenos">615</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.get_lattice-616"><a href="#CifParser.get_lattice-616"><span class="linenos">616</span></a><span class="sd">        Generate the lattice from the provided lattice parameters. In</span>
</span><span id="CifParser.get_lattice-617"><a href="#CifParser.get_lattice-617"><span class="linenos">617</span></a><span class="sd">        the absence of all six lattice parameters, the crystal system</span>
</span><span id="CifParser.get_lattice-618"><a href="#CifParser.get_lattice-618"><span class="linenos">618</span></a><span class="sd">        and necessary parameters are parsed</span>
</span><span id="CifParser.get_lattice-619"><a href="#CifParser.get_lattice-619"><span class="linenos">619</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.get_lattice-620"><a href="#CifParser.get_lattice-620"><span class="linenos">620</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.get_lattice-621"><a href="#CifParser.get_lattice-621"><span class="linenos">621</span></a>
</span><span id="CifParser.get_lattice-622"><a href="#CifParser.get_lattice-622"><span class="linenos">622</span></a>            <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_cell_length_&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">length_strings</span><span class="p">]</span>
</span><span id="CifParser.get_lattice-623"><a href="#CifParser.get_lattice-623"><span class="linenos">623</span></a>            <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_cell_angle_&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">angle_strings</span><span class="p">]</span>
</span><span id="CifParser.get_lattice-624"><a href="#CifParser.get_lattice-624"><span class="linenos">624</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">lattice_type</span><span class="p">:</span>
</span><span id="CifParser.get_lattice-625"><a href="#CifParser.get_lattice-625"><span class="linenos">625</span></a>                <span class="k">return</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span><span class="o">*</span><span class="n">lengths</span><span class="p">,</span> <span class="o">*</span><span class="n">angles</span><span class="p">)</span>
</span><span id="CifParser.get_lattice-626"><a href="#CifParser.get_lattice-626"><span class="linenos">626</span></a>
</span><span id="CifParser.get_lattice-627"><a href="#CifParser.get_lattice-627"><span class="linenos">627</span></a>            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Lattice</span><span class="p">,</span> <span class="n">lattice_type</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="n">lengths</span> <span class="o">+</span> <span class="n">angles</span><span class="p">))</span>
</span><span id="CifParser.get_lattice-628"><a href="#CifParser.get_lattice-628"><span class="linenos">628</span></a>
</span><span id="CifParser.get_lattice-629"><a href="#CifParser.get_lattice-629"><span class="linenos">629</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="CifParser.get_lattice-630"><a href="#CifParser.get_lattice-630"><span class="linenos">630</span></a>            <span class="c1"># Missing Key search for cell setting</span>
</span><span id="CifParser.get_lattice-631"><a href="#CifParser.get_lattice-631"><span class="linenos">631</span></a>            <span class="k">for</span> <span class="n">lattice_lable</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="CifParser.get_lattice-632"><a href="#CifParser.get_lattice-632"><span class="linenos">632</span></a>                <span class="s2">&quot;_symmetry_cell_setting&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_lattice-633"><a href="#CifParser.get_lattice-633"><span class="linenos">633</span></a>                <span class="s2">&quot;_space_group_crystal_system&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_lattice-634"><a href="#CifParser.get_lattice-634"><span class="linenos">634</span></a>            <span class="p">]:</span>
</span><span id="CifParser.get_lattice-635"><a href="#CifParser.get_lattice-635"><span class="linenos">635</span></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lattice_lable</span><span class="p">):</span>
</span><span id="CifParser.get_lattice-636"><a href="#CifParser.get_lattice-636"><span class="linenos">636</span></a>                    <span class="n">lattice_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lattice_lable</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="CifParser.get_lattice-637"><a href="#CifParser.get_lattice-637"><span class="linenos">637</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.get_lattice-638"><a href="#CifParser.get_lattice-638"><span class="linenos">638</span></a>
</span><span id="CifParser.get_lattice-639"><a href="#CifParser.get_lattice-639"><span class="linenos">639</span></a>                        <span class="n">required_args</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Lattice</span><span class="p">,</span> <span class="n">lattice_type</span><span class="p">))</span><span class="o">.</span><span class="n">args</span>
</span><span id="CifParser.get_lattice-640"><a href="#CifParser.get_lattice-640"><span class="linenos">640</span></a>
</span><span id="CifParser.get_lattice-641"><a href="#CifParser.get_lattice-641"><span class="linenos">641</span></a>                        <span class="n">lengths</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">length_strings</span> <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">required_args</span><span class="p">)</span>
</span><span id="CifParser.get_lattice-642"><a href="#CifParser.get_lattice-642"><span class="linenos">642</span></a>                        <span class="n">angles</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">angle_strings</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">required_args</span><span class="p">)</span>
</span><span id="CifParser.get_lattice-643"><a href="#CifParser.get_lattice-643"><span class="linenos">643</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">lattice_type</span><span class="o">=</span><span class="n">lattice_type</span><span class="p">)</span>
</span><span id="CifParser.get_lattice-644"><a href="#CifParser.get_lattice-644"><span class="linenos">644</span></a>                    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="CifParser.get_lattice-645"><a href="#CifParser.get_lattice-645"><span class="linenos">645</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
</span><span id="CifParser.get_lattice-646"><a href="#CifParser.get_lattice-646"><span class="linenos">646</span></a>                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span><span id="CifParser.get_lattice-647"><a href="#CifParser.get_lattice-647"><span class="linenos">647</span></a>
</span><span id="CifParser.get_lattice-648"><a href="#CifParser.get_lattice-648"><span class="linenos">648</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser.get_lattice-649"><a href="#CifParser.get_lattice-649"><span class="linenos">649</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="CifParser.get_lattice-650"><a href="#CifParser.get_lattice-650"><span class="linenos">650</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Generate the lattice from the provided lattice parameters. In
the absence of all six lattice parameters, the crystal system
and necessary parameters are parsed</p>
</div>


                            </div>
                            <div id="CifParser.get_symops" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.get_symops">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_symops</span><span class="signature">(self, data)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.get_symops-652"><a href="#CifParser.get_symops-652"><span class="linenos">652</span></a>    <span class="k">def</span> <span class="nf">get_symops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="CifParser.get_symops-653"><a href="#CifParser.get_symops-653"><span class="linenos">653</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.get_symops-654"><a href="#CifParser.get_symops-654"><span class="linenos">654</span></a><span class="sd">        In order to generate symmetry equivalent positions, the symmetry</span>
</span><span id="CifParser.get_symops-655"><a href="#CifParser.get_symops-655"><span class="linenos">655</span></a><span class="sd">        operations are parsed. If the symops are not present, the space</span>
</span><span id="CifParser.get_symops-656"><a href="#CifParser.get_symops-656"><span class="linenos">656</span></a><span class="sd">        group symbol is parsed, and symops are generated.</span>
</span><span id="CifParser.get_symops-657"><a href="#CifParser.get_symops-657"><span class="linenos">657</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.get_symops-658"><a href="#CifParser.get_symops-658"><span class="linenos">658</span></a>        <span class="n">symops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser.get_symops-659"><a href="#CifParser.get_symops-659"><span class="linenos">659</span></a>        <span class="k">for</span> <span class="n">symmetry_label</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="CifParser.get_symops-660"><a href="#CifParser.get_symops-660"><span class="linenos">660</span></a>            <span class="s2">&quot;_symmetry_equiv_pos_as_xyz&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-661"><a href="#CifParser.get_symops-661"><span class="linenos">661</span></a>            <span class="s2">&quot;_symmetry_equiv_pos_as_xyz_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-662"><a href="#CifParser.get_symops-662"><span class="linenos">662</span></a>            <span class="s2">&quot;_space_group_symop_operation_xyz&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-663"><a href="#CifParser.get_symops-663"><span class="linenos">663</span></a>            <span class="s2">&quot;_space_group_symop_operation_xyz_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-664"><a href="#CifParser.get_symops-664"><span class="linenos">664</span></a>        <span class="p">]:</span>
</span><span id="CifParser.get_symops-665"><a href="#CifParser.get_symops-665"><span class="linenos">665</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">):</span>
</span><span id="CifParser.get_symops-666"><a href="#CifParser.get_symops-666"><span class="linenos">666</span></a>                <span class="n">xyz</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)</span>
</span><span id="CifParser.get_symops-667"><a href="#CifParser.get_symops-667"><span class="linenos">667</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CifParser.get_symops-668"><a href="#CifParser.get_symops-668"><span class="linenos">668</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;A 1-line symmetry op P1 CIF is detected!&quot;</span>
</span><span id="CifParser.get_symops-669"><a href="#CifParser.get_symops-669"><span class="linenos">669</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-670"><a href="#CifParser.get_symops-670"><span class="linenos">670</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-671"><a href="#CifParser.get_symops-671"><span class="linenos">671</span></a>                    <span class="n">xyz</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz</span><span class="p">]</span>
</span><span id="CifParser.get_symops-672"><a href="#CifParser.get_symops-672"><span class="linenos">672</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.get_symops-673"><a href="#CifParser.get_symops-673"><span class="linenos">673</span></a>                    <span class="n">symops</span> <span class="o">=</span> <span class="p">[</span><span class="n">SymmOp</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">]</span>
</span><span id="CifParser.get_symops-674"><a href="#CifParser.get_symops-674"><span class="linenos">674</span></a>                    <span class="k">break</span>
</span><span id="CifParser.get_symops-675"><a href="#CifParser.get_symops-675"><span class="linenos">675</span></a>                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="CifParser.get_symops-676"><a href="#CifParser.get_symops-676"><span class="linenos">676</span></a>                    <span class="k">continue</span>
</span><span id="CifParser.get_symops-677"><a href="#CifParser.get_symops-677"><span class="linenos">677</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">symops</span><span class="p">:</span>
</span><span id="CifParser.get_symops-678"><a href="#CifParser.get_symops-678"><span class="linenos">678</span></a>            <span class="c1"># Try to parse symbol</span>
</span><span id="CifParser.get_symops-679"><a href="#CifParser.get_symops-679"><span class="linenos">679</span></a>            <span class="k">for</span> <span class="n">symmetry_label</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="CifParser.get_symops-680"><a href="#CifParser.get_symops-680"><span class="linenos">680</span></a>                <span class="s2">&quot;_symmetry_space_group_name_H-M&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-681"><a href="#CifParser.get_symops-681"><span class="linenos">681</span></a>                <span class="s2">&quot;_symmetry_space_group_name_H_M&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-682"><a href="#CifParser.get_symops-682"><span class="linenos">682</span></a>                <span class="s2">&quot;_symmetry_space_group_name_H-M_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-683"><a href="#CifParser.get_symops-683"><span class="linenos">683</span></a>                <span class="s2">&quot;_symmetry_space_group_name_H_M_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-684"><a href="#CifParser.get_symops-684"><span class="linenos">684</span></a>                <span class="s2">&quot;_space_group_name_Hall&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-685"><a href="#CifParser.get_symops-685"><span class="linenos">685</span></a>                <span class="s2">&quot;_space_group_name_Hall_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-686"><a href="#CifParser.get_symops-686"><span class="linenos">686</span></a>                <span class="s2">&quot;_space_group_name_H-M_alt&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-687"><a href="#CifParser.get_symops-687"><span class="linenos">687</span></a>                <span class="s2">&quot;_space_group_name_H-M_alt_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-688"><a href="#CifParser.get_symops-688"><span class="linenos">688</span></a>                <span class="s2">&quot;_symmetry_space_group_name_hall&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-689"><a href="#CifParser.get_symops-689"><span class="linenos">689</span></a>                <span class="s2">&quot;_symmetry_space_group_name_hall_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-690"><a href="#CifParser.get_symops-690"><span class="linenos">690</span></a>                <span class="s2">&quot;_symmetry_space_group_name_h-m&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-691"><a href="#CifParser.get_symops-691"><span class="linenos">691</span></a>                <span class="s2">&quot;_symmetry_space_group_name_h-m_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-692"><a href="#CifParser.get_symops-692"><span class="linenos">692</span></a>            <span class="p">]:</span>
</span><span id="CifParser.get_symops-693"><a href="#CifParser.get_symops-693"><span class="linenos">693</span></a>                <span class="n">sg</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)</span>
</span><span id="CifParser.get_symops-694"><a href="#CifParser.get_symops-694"><span class="linenos">694</span></a>                <span class="n">msg_template</span> <span class="o">=</span> <span class="s2">&quot;No _symmetry_equiv_pos_as_xyz type key found. Spacegroup from </span><span class="si">{}</span><span class="s2"> used.&quot;</span>
</span><span id="CifParser.get_symops-695"><a href="#CifParser.get_symops-695"><span class="linenos">695</span></a>
</span><span id="CifParser.get_symops-696"><a href="#CifParser.get_symops-696"><span class="linenos">696</span></a>                <span class="k">if</span> <span class="n">sg</span><span class="p">:</span>
</span><span id="CifParser.get_symops-697"><a href="#CifParser.get_symops-697"><span class="linenos">697</span></a>                    <span class="n">sg</span> <span class="o">=</span> <span class="n">sub_spgrp</span><span class="p">(</span><span class="n">sg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-698"><a href="#CifParser.get_symops-698"><span class="linenos">698</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.get_symops-699"><a href="#CifParser.get_symops-699"><span class="linenos">699</span></a>                        <span class="n">spg</span> <span class="o">=</span> <span class="n">space_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-700"><a href="#CifParser.get_symops-700"><span class="linenos">700</span></a>                        <span class="k">if</span> <span class="n">spg</span><span class="p">:</span>
</span><span id="CifParser.get_symops-701"><a href="#CifParser.get_symops-701"><span class="linenos">701</span></a>                            <span class="n">symops</span> <span class="o">=</span> <span class="n">SpaceGroup</span><span class="p">(</span><span class="n">spg</span><span class="p">)</span><span class="o">.</span><span class="n">symmetry_ops</span>
</span><span id="CifParser.get_symops-702"><a href="#CifParser.get_symops-702"><span class="linenos">702</span></a>                            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)</span>
</span><span id="CifParser.get_symops-703"><a href="#CifParser.get_symops-703"><span class="linenos">703</span></a>                            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-704"><a href="#CifParser.get_symops-704"><span class="linenos">704</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-705"><a href="#CifParser.get_symops-705"><span class="linenos">705</span></a>                            <span class="k">break</span>
</span><span id="CifParser.get_symops-706"><a href="#CifParser.get_symops-706"><span class="linenos">706</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="CifParser.get_symops-707"><a href="#CifParser.get_symops-707"><span class="linenos">707</span></a>                        <span class="c1"># Ignore any errors</span>
</span><span id="CifParser.get_symops-708"><a href="#CifParser.get_symops-708"><span class="linenos">708</span></a>                        <span class="k">pass</span>
</span><span id="CifParser.get_symops-709"><a href="#CifParser.get_symops-709"><span class="linenos">709</span></a>
</span><span id="CifParser.get_symops-710"><a href="#CifParser.get_symops-710"><span class="linenos">710</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.get_symops-711"><a href="#CifParser.get_symops-711"><span class="linenos">711</span></a>                        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">_get_cod_data</span><span class="p">():</span>
</span><span id="CifParser.get_symops-712"><a href="#CifParser.get_symops-712"><span class="linenos">712</span></a>                            <span class="k">if</span> <span class="n">sg</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;hermann_mauguin&quot;</span><span class="p">]):</span>
</span><span id="CifParser.get_symops-713"><a href="#CifParser.get_symops-713"><span class="linenos">713</span></a>                                <span class="n">xyz</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;symops&quot;</span><span class="p">]</span>
</span><span id="CifParser.get_symops-714"><a href="#CifParser.get_symops-714"><span class="linenos">714</span></a>                                <span class="n">symops</span> <span class="o">=</span> <span class="p">[</span><span class="n">SymmOp</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">]</span>
</span><span id="CifParser.get_symops-715"><a href="#CifParser.get_symops-715"><span class="linenos">715</span></a>                                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)</span>
</span><span id="CifParser.get_symops-716"><a href="#CifParser.get_symops-716"><span class="linenos">716</span></a>                                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-717"><a href="#CifParser.get_symops-717"><span class="linenos">717</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-718"><a href="#CifParser.get_symops-718"><span class="linenos">718</span></a>                                <span class="k">break</span>
</span><span id="CifParser.get_symops-719"><a href="#CifParser.get_symops-719"><span class="linenos">719</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="CifParser.get_symops-720"><a href="#CifParser.get_symops-720"><span class="linenos">720</span></a>                        <span class="k">continue</span>
</span><span id="CifParser.get_symops-721"><a href="#CifParser.get_symops-721"><span class="linenos">721</span></a>
</span><span id="CifParser.get_symops-722"><a href="#CifParser.get_symops-722"><span class="linenos">722</span></a>                    <span class="k">if</span> <span class="n">symops</span><span class="p">:</span>
</span><span id="CifParser.get_symops-723"><a href="#CifParser.get_symops-723"><span class="linenos">723</span></a>                        <span class="k">break</span>
</span><span id="CifParser.get_symops-724"><a href="#CifParser.get_symops-724"><span class="linenos">724</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">symops</span><span class="p">:</span>
</span><span id="CifParser.get_symops-725"><a href="#CifParser.get_symops-725"><span class="linenos">725</span></a>            <span class="c1"># Try to parse International number</span>
</span><span id="CifParser.get_symops-726"><a href="#CifParser.get_symops-726"><span class="linenos">726</span></a>            <span class="k">for</span> <span class="n">symmetry_label</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="CifParser.get_symops-727"><a href="#CifParser.get_symops-727"><span class="linenos">727</span></a>                <span class="s2">&quot;_space_group_IT_number&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-728"><a href="#CifParser.get_symops-728"><span class="linenos">728</span></a>                <span class="s2">&quot;_space_group_IT_number_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-729"><a href="#CifParser.get_symops-729"><span class="linenos">729</span></a>                <span class="s2">&quot;_symmetry_Int_Tables_number&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-730"><a href="#CifParser.get_symops-730"><span class="linenos">730</span></a>                <span class="s2">&quot;_symmetry_Int_Tables_number_&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_symops-731"><a href="#CifParser.get_symops-731"><span class="linenos">731</span></a>            <span class="p">]:</span>
</span><span id="CifParser.get_symops-732"><a href="#CifParser.get_symops-732"><span class="linenos">732</span></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">):</span>
</span><span id="CifParser.get_symops-733"><a href="#CifParser.get_symops-733"><span class="linenos">733</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.get_symops-734"><a href="#CifParser.get_symops-734"><span class="linenos">734</span></a>                        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry_label</span><span class="p">)))</span>
</span><span id="CifParser.get_symops-735"><a href="#CifParser.get_symops-735"><span class="linenos">735</span></a>                        <span class="n">symops</span> <span class="o">=</span> <span class="n">SpaceGroup</span><span class="o">.</span><span class="n">from_int_number</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">symmetry_ops</span>
</span><span id="CifParser.get_symops-736"><a href="#CifParser.get_symops-736"><span class="linenos">736</span></a>                        <span class="k">break</span>
</span><span id="CifParser.get_symops-737"><a href="#CifParser.get_symops-737"><span class="linenos">737</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="CifParser.get_symops-738"><a href="#CifParser.get_symops-738"><span class="linenos">738</span></a>                        <span class="k">continue</span>
</span><span id="CifParser.get_symops-739"><a href="#CifParser.get_symops-739"><span class="linenos">739</span></a>
</span><span id="CifParser.get_symops-740"><a href="#CifParser.get_symops-740"><span class="linenos">740</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">symops</span><span class="p">:</span>
</span><span id="CifParser.get_symops-741"><a href="#CifParser.get_symops-741"><span class="linenos">741</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No _symmetry_equiv_pos_as_xyz type key found. Defaulting to P1.&quot;</span>
</span><span id="CifParser.get_symops-742"><a href="#CifParser.get_symops-742"><span class="linenos">742</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-743"><a href="#CifParser.get_symops-743"><span class="linenos">743</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_symops-744"><a href="#CifParser.get_symops-744"><span class="linenos">744</span></a>            <span class="n">symops</span> <span class="o">=</span> <span class="p">[</span><span class="n">SymmOp</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span>
</span><span id="CifParser.get_symops-745"><a href="#CifParser.get_symops-745"><span class="linenos">745</span></a>
</span><span id="CifParser.get_symops-746"><a href="#CifParser.get_symops-746"><span class="linenos">746</span></a>        <span class="k">return</span> <span class="n">symops</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>In order to generate symmetry equivalent positions, the symmetry
operations are parsed. If the symops are not present, the space
group symbol is parsed, and symops are generated.</p>
</div>


                            </div>
                            <div id="CifParser.get_magsymops" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.get_magsymops">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_magsymops</span><span class="signature">(self, data)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.get_magsymops-748"><a href="#CifParser.get_magsymops-748"><span class="linenos">748</span></a>    <span class="k">def</span> <span class="nf">get_magsymops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="CifParser.get_magsymops-749"><a href="#CifParser.get_magsymops-749"><span class="linenos">749</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.get_magsymops-750"><a href="#CifParser.get_magsymops-750"><span class="linenos">750</span></a><span class="sd">        Equivalent to get_symops except for magnetic symmetry groups.</span>
</span><span id="CifParser.get_magsymops-751"><a href="#CifParser.get_magsymops-751"><span class="linenos">751</span></a><span class="sd">        Separate function since additional operation for time reversal symmetry</span>
</span><span id="CifParser.get_magsymops-752"><a href="#CifParser.get_magsymops-752"><span class="linenos">752</span></a><span class="sd">        (which changes magnetic moments on sites) needs to be returned.</span>
</span><span id="CifParser.get_magsymops-753"><a href="#CifParser.get_magsymops-753"><span class="linenos">753</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.get_magsymops-754"><a href="#CifParser.get_magsymops-754"><span class="linenos">754</span></a>        <span class="n">magsymmops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser.get_magsymops-755"><a href="#CifParser.get_magsymops-755"><span class="linenos">755</span></a>
</span><span id="CifParser.get_magsymops-756"><a href="#CifParser.get_magsymops-756"><span class="linenos">756</span></a>        <span class="c1"># check to see if magCIF file explicitly contains magnetic symmetry operations</span>
</span><span id="CifParser.get_magsymops-757"><a href="#CifParser.get_magsymops-757"><span class="linenos">757</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_symop_magn_operation.xyz&quot;</span><span class="p">):</span>
</span><span id="CifParser.get_magsymops-758"><a href="#CifParser.get_magsymops-758"><span class="linenos">758</span></a>
</span><span id="CifParser.get_magsymops-759"><a href="#CifParser.get_magsymops-759"><span class="linenos">759</span></a>            <span class="n">xyzt</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_symop_magn_operation.xyz&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_magsymops-760"><a href="#CifParser.get_magsymops-760"><span class="linenos">760</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CifParser.get_magsymops-761"><a href="#CifParser.get_magsymops-761"><span class="linenos">761</span></a>                <span class="n">xyzt</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyzt</span><span class="p">]</span>
</span><span id="CifParser.get_magsymops-762"><a href="#CifParser.get_magsymops-762"><span class="linenos">762</span></a>            <span class="n">magsymmops</span> <span class="o">=</span> <span class="p">[</span><span class="n">MagSymmOp</span><span class="o">.</span><span class="n">from_xyzt_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">xyzt</span><span class="p">]</span>
</span><span id="CifParser.get_magsymops-763"><a href="#CifParser.get_magsymops-763"><span class="linenos">763</span></a>
</span><span id="CifParser.get_magsymops-764"><a href="#CifParser.get_magsymops-764"><span class="linenos">764</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_symop_magn_centering.xyz&quot;</span><span class="p">):</span>
</span><span id="CifParser.get_magsymops-765"><a href="#CifParser.get_magsymops-765"><span class="linenos">765</span></a>
</span><span id="CifParser.get_magsymops-766"><a href="#CifParser.get_magsymops-766"><span class="linenos">766</span></a>                <span class="n">xyzt</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_symop_magn_centering.xyz&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_magsymops-767"><a href="#CifParser.get_magsymops-767"><span class="linenos">767</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CifParser.get_magsymops-768"><a href="#CifParser.get_magsymops-768"><span class="linenos">768</span></a>                    <span class="n">xyzt</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyzt</span><span class="p">]</span>
</span><span id="CifParser.get_magsymops-769"><a href="#CifParser.get_magsymops-769"><span class="linenos">769</span></a>                <span class="n">centering_symops</span> <span class="o">=</span> <span class="p">[</span><span class="n">MagSymmOp</span><span class="o">.</span><span class="n">from_xyzt_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">xyzt</span><span class="p">]</span>
</span><span id="CifParser.get_magsymops-770"><a href="#CifParser.get_magsymops-770"><span class="linenos">770</span></a>
</span><span id="CifParser.get_magsymops-771"><a href="#CifParser.get_magsymops-771"><span class="linenos">771</span></a>                <span class="n">all_ops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser.get_magsymops-772"><a href="#CifParser.get_magsymops-772"><span class="linenos">772</span></a>                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">magsymmops</span><span class="p">:</span>
</span><span id="CifParser.get_magsymops-773"><a href="#CifParser.get_magsymops-773"><span class="linenos">773</span></a>                    <span class="k">for</span> <span class="n">centering_op</span> <span class="ow">in</span> <span class="n">centering_symops</span><span class="p">:</span>
</span><span id="CifParser.get_magsymops-774"><a href="#CifParser.get_magsymops-774"><span class="linenos">774</span></a>                        <span class="n">new_translation</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CifParser.get_magsymops-775"><a href="#CifParser.get_magsymops-775"><span class="linenos">775</span></a>                            <span class="n">i</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">translation_vector</span> <span class="o">+</span> <span class="n">centering_op</span><span class="o">.</span><span class="n">translation_vector</span>
</span><span id="CifParser.get_magsymops-776"><a href="#CifParser.get_magsymops-776"><span class="linenos">776</span></a>                        <span class="p">]</span>
</span><span id="CifParser.get_magsymops-777"><a href="#CifParser.get_magsymops-777"><span class="linenos">777</span></a>                        <span class="n">new_time_reversal</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">time_reversal</span> <span class="o">*</span> <span class="n">centering_op</span><span class="o">.</span><span class="n">time_reversal</span>
</span><span id="CifParser.get_magsymops-778"><a href="#CifParser.get_magsymops-778"><span class="linenos">778</span></a>                        <span class="n">all_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CifParser.get_magsymops-779"><a href="#CifParser.get_magsymops-779"><span class="linenos">779</span></a>                            <span class="n">MagSymmOp</span><span class="o">.</span><span class="n">from_rotation_and_translation_and_time_reversal</span><span class="p">(</span>
</span><span id="CifParser.get_magsymops-780"><a href="#CifParser.get_magsymops-780"><span class="linenos">780</span></a>                                <span class="n">rotation_matrix</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">,</span>
</span><span id="CifParser.get_magsymops-781"><a href="#CifParser.get_magsymops-781"><span class="linenos">781</span></a>                                <span class="n">translation_vec</span><span class="o">=</span><span class="n">new_translation</span><span class="p">,</span>
</span><span id="CifParser.get_magsymops-782"><a href="#CifParser.get_magsymops-782"><span class="linenos">782</span></a>                                <span class="n">time_reversal</span><span class="o">=</span><span class="n">new_time_reversal</span><span class="p">,</span>
</span><span id="CifParser.get_magsymops-783"><a href="#CifParser.get_magsymops-783"><span class="linenos">783</span></a>                            <span class="p">)</span>
</span><span id="CifParser.get_magsymops-784"><a href="#CifParser.get_magsymops-784"><span class="linenos">784</span></a>                        <span class="p">)</span>
</span><span id="CifParser.get_magsymops-785"><a href="#CifParser.get_magsymops-785"><span class="linenos">785</span></a>                <span class="n">magsymmops</span> <span class="o">=</span> <span class="n">all_ops</span>
</span><span id="CifParser.get_magsymops-786"><a href="#CifParser.get_magsymops-786"><span class="linenos">786</span></a>
</span><span id="CifParser.get_magsymops-787"><a href="#CifParser.get_magsymops-787"><span class="linenos">787</span></a>        <span class="c1"># else check to see if it specifies a magnetic space group</span>
</span><span id="CifParser.get_magsymops-788"><a href="#CifParser.get_magsymops-788"><span class="linenos">788</span></a>        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.name_BNS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.number_BNS&quot;</span><span class="p">):</span>
</span><span id="CifParser.get_magsymops-789"><a href="#CifParser.get_magsymops-789"><span class="linenos">789</span></a>
</span><span id="CifParser.get_magsymops-790"><a href="#CifParser.get_magsymops-790"><span class="linenos">790</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.name_BNS&quot;</span><span class="p">):</span>
</span><span id="CifParser.get_magsymops-791"><a href="#CifParser.get_magsymops-791"><span class="linenos">791</span></a>                <span class="c1"># get BNS label for MagneticSpaceGroup()</span>
</span><span id="CifParser.get_magsymops-792"><a href="#CifParser.get_magsymops-792"><span class="linenos">792</span></a>                <span class="nb">id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.name_BNS&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_magsymops-793"><a href="#CifParser.get_magsymops-793"><span class="linenos">793</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser.get_magsymops-794"><a href="#CifParser.get_magsymops-794"><span class="linenos">794</span></a>                <span class="c1"># get BNS number for MagneticSpaceGroup()</span>
</span><span id="CifParser.get_magsymops-795"><a href="#CifParser.get_magsymops-795"><span class="linenos">795</span></a>                <span class="c1"># by converting string to list of ints</span>
</span><span id="CifParser.get_magsymops-796"><a href="#CifParser.get_magsymops-796"><span class="linenos">796</span></a>                <span class="nb">id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.number_BNS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))))</span>
</span><span id="CifParser.get_magsymops-797"><a href="#CifParser.get_magsymops-797"><span class="linenos">797</span></a>
</span><span id="CifParser.get_magsymops-798"><a href="#CifParser.get_magsymops-798"><span class="linenos">798</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.transform_BNS_Pp_abc&quot;</span><span class="p">):</span>
</span><span id="CifParser.get_magsymops-799"><a href="#CifParser.get_magsymops-799"><span class="linenos">799</span></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.transform_BNS_Pp_abc&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;a,b,c;0,0,0&quot;</span><span class="p">:</span>
</span><span id="CifParser.get_magsymops-800"><a href="#CifParser.get_magsymops-800"><span class="linenos">800</span></a>
</span><span id="CifParser.get_magsymops-801"><a href="#CifParser.get_magsymops-801"><span class="linenos">801</span></a>                    <span class="n">jf</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.transform_BNS_Pp_abc&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_magsymops-802"><a href="#CifParser.get_magsymops-802"><span class="linenos">802</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">MagneticSpaceGroup</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">jf</span><span class="p">)</span>
</span><span id="CifParser.get_magsymops-803"><a href="#CifParser.get_magsymops-803"><span class="linenos">803</span></a>
</span><span id="CifParser.get_magsymops-804"><a href="#CifParser.get_magsymops-804"><span class="linenos">804</span></a>            <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_space_group_magn.transform_BNS_Pp&quot;</span><span class="p">):</span>
</span><span id="CifParser.get_magsymops-805"><a href="#CifParser.get_magsymops-805"><span class="linenos">805</span></a>                <span class="k">return</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Incomplete specification to implement.&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_magsymops-806"><a href="#CifParser.get_magsymops-806"><span class="linenos">806</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser.get_magsymops-807"><a href="#CifParser.get_magsymops-807"><span class="linenos">807</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">MagneticSpaceGroup</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="CifParser.get_magsymops-808"><a href="#CifParser.get_magsymops-808"><span class="linenos">808</span></a>
</span><span id="CifParser.get_magsymops-809"><a href="#CifParser.get_magsymops-809"><span class="linenos">809</span></a>            <span class="n">magsymmops</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">symmetry_ops</span>
</span><span id="CifParser.get_magsymops-810"><a href="#CifParser.get_magsymops-810"><span class="linenos">810</span></a>
</span><span id="CifParser.get_magsymops-811"><a href="#CifParser.get_magsymops-811"><span class="linenos">811</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">magsymmops</span><span class="p">:</span>
</span><span id="CifParser.get_magsymops-812"><a href="#CifParser.get_magsymops-812"><span class="linenos">812</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No magnetic symmetry detected, using primitive symmetry.&quot;</span>
</span><span id="CifParser.get_magsymops-813"><a href="#CifParser.get_magsymops-813"><span class="linenos">813</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_magsymops-814"><a href="#CifParser.get_magsymops-814"><span class="linenos">814</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="CifParser.get_magsymops-815"><a href="#CifParser.get_magsymops-815"><span class="linenos">815</span></a>            <span class="n">magsymmops</span> <span class="o">=</span> <span class="p">[</span><span class="n">MagSymmOp</span><span class="o">.</span><span class="n">from_xyzt_string</span><span class="p">(</span><span class="s2">&quot;x, y, z, 1&quot;</span><span class="p">)]</span>
</span><span id="CifParser.get_magsymops-816"><a href="#CifParser.get_magsymops-816"><span class="linenos">816</span></a>
</span><span id="CifParser.get_magsymops-817"><a href="#CifParser.get_magsymops-817"><span class="linenos">817</span></a>        <span class="k">return</span> <span class="n">magsymmops</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Equivalent to get_symops except for magnetic symmetry groups.
Separate function since additional operation for time reversal symmetry
(which changes magnetic moments on sites) needs to be returned.</p>
</div>


                            </div>
                            <div id="CifParser.parse_oxi_states" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.parse_oxi_states">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">parse_oxi_states</span><span class="signature">(data)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.parse_oxi_states-819"><a href="#CifParser.parse_oxi_states-819"><span class="linenos">819</span></a>    <span class="nd">@staticmethod</span>
</span><span id="CifParser.parse_oxi_states-820"><a href="#CifParser.parse_oxi_states-820"><span class="linenos">820</span></a>    <span class="k">def</span> <span class="nf">parse_oxi_states</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="CifParser.parse_oxi_states-821"><a href="#CifParser.parse_oxi_states-821"><span class="linenos">821</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.parse_oxi_states-822"><a href="#CifParser.parse_oxi_states-822"><span class="linenos">822</span></a><span class="sd">        Parse oxidation states from data dictionary</span>
</span><span id="CifParser.parse_oxi_states-823"><a href="#CifParser.parse_oxi_states-823"><span class="linenos">823</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.parse_oxi_states-824"><a href="#CifParser.parse_oxi_states-824"><span class="linenos">824</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.parse_oxi_states-825"><a href="#CifParser.parse_oxi_states-825"><span class="linenos">825</span></a>            <span class="n">oxi_states</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CifParser.parse_oxi_states-826"><a href="#CifParser.parse_oxi_states-826"><span class="linenos">826</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_oxidation_number&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser.parse_oxi_states-827"><a href="#CifParser.parse_oxi_states-827"><span class="linenos">827</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">]))</span>
</span><span id="CifParser.parse_oxi_states-828"><a href="#CifParser.parse_oxi_states-828"><span class="linenos">828</span></a>            <span class="p">}</span>
</span><span id="CifParser.parse_oxi_states-829"><a href="#CifParser.parse_oxi_states-829"><span class="linenos">829</span></a>            <span class="c1"># attempt to strip oxidation state from _atom_type_symbol</span>
</span><span id="CifParser.parse_oxi_states-830"><a href="#CifParser.parse_oxi_states-830"><span class="linenos">830</span></a>            <span class="c1"># in case the label does not contain an oxidation state</span>
</span><span id="CifParser.parse_oxi_states-831"><a href="#CifParser.parse_oxi_states-831"><span class="linenos">831</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">]):</span>
</span><span id="CifParser.parse_oxi_states-832"><a href="#CifParser.parse_oxi_states-832"><span class="linenos">832</span></a>                <span class="n">oxi_states</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d?[\+,\-]?$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)]</span> <span class="o">=</span> <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_type_oxidation_number&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="CifParser.parse_oxi_states-833"><a href="#CifParser.parse_oxi_states-833"><span class="linenos">833</span></a>
</span><span id="CifParser.parse_oxi_states-834"><a href="#CifParser.parse_oxi_states-834"><span class="linenos">834</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
</span><span id="CifParser.parse_oxi_states-835"><a href="#CifParser.parse_oxi_states-835"><span class="linenos">835</span></a>            <span class="n">oxi_states</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CifParser.parse_oxi_states-836"><a href="#CifParser.parse_oxi_states-836"><span class="linenos">836</span></a>        <span class="k">return</span> <span class="n">oxi_states</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Parse oxidation states from data dictionary</p>
</div>


                            </div>
                            <div id="CifParser.parse_magmoms" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.parse_magmoms">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">parse_magmoms</span><span class="signature">(data, lattice=None)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.parse_magmoms-838"><a href="#CifParser.parse_magmoms-838"><span class="linenos">838</span></a>    <span class="nd">@staticmethod</span>
</span><span id="CifParser.parse_magmoms-839"><a href="#CifParser.parse_magmoms-839"><span class="linenos">839</span></a>    <span class="k">def</span> <span class="nf">parse_magmoms</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="CifParser.parse_magmoms-840"><a href="#CifParser.parse_magmoms-840"><span class="linenos">840</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.parse_magmoms-841"><a href="#CifParser.parse_magmoms-841"><span class="linenos">841</span></a><span class="sd">        Parse atomic magnetic moments from data dictionary</span>
</span><span id="CifParser.parse_magmoms-842"><a href="#CifParser.parse_magmoms-842"><span class="linenos">842</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.parse_magmoms-843"><a href="#CifParser.parse_magmoms-843"><span class="linenos">843</span></a>        <span class="k">if</span> <span class="n">lattice</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifParser.parse_magmoms-844"><a href="#CifParser.parse_magmoms-844"><span class="linenos">844</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Magmoms given in terms of crystal axes in magCIF spec.&quot;</span><span class="p">)</span>
</span><span id="CifParser.parse_magmoms-845"><a href="#CifParser.parse_magmoms-845"><span class="linenos">845</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.parse_magmoms-846"><a href="#CifParser.parse_magmoms-846"><span class="linenos">846</span></a>            <span class="n">magmoms</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CifParser.parse_magmoms-847"><a href="#CifParser.parse_magmoms-847"><span class="linenos">847</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_label&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="CifParser.parse_magmoms-848"><a href="#CifParser.parse_magmoms-848"><span class="linenos">848</span></a>                    <span class="p">[</span>
</span><span id="CifParser.parse_magmoms-849"><a href="#CifParser.parse_magmoms-849"><span class="linenos">849</span></a>                        <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_x&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
</span><span id="CifParser.parse_magmoms-850"><a href="#CifParser.parse_magmoms-850"><span class="linenos">850</span></a>                        <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_y&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
</span><span id="CifParser.parse_magmoms-851"><a href="#CifParser.parse_magmoms-851"><span class="linenos">851</span></a>                        <span class="n">str2float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_z&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
</span><span id="CifParser.parse_magmoms-852"><a href="#CifParser.parse_magmoms-852"><span class="linenos">852</span></a>                    <span class="p">]</span>
</span><span id="CifParser.parse_magmoms-853"><a href="#CifParser.parse_magmoms-853"><span class="linenos">853</span></a>                <span class="p">)</span>
</span><span id="CifParser.parse_magmoms-854"><a href="#CifParser.parse_magmoms-854"><span class="linenos">854</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_label&quot;</span><span class="p">]))</span>
</span><span id="CifParser.parse_magmoms-855"><a href="#CifParser.parse_magmoms-855"><span class="linenos">855</span></a>            <span class="p">}</span>
</span><span id="CifParser.parse_magmoms-856"><a href="#CifParser.parse_magmoms-856"><span class="linenos">856</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
</span><span id="CifParser.parse_magmoms-857"><a href="#CifParser.parse_magmoms-857"><span class="linenos">857</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="CifParser.parse_magmoms-858"><a href="#CifParser.parse_magmoms-858"><span class="linenos">858</span></a>        <span class="k">return</span> <span class="n">magmoms</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Parse atomic magnetic moments from data dictionary</p>
</div>


                            </div>
                            <div id="CifParser.get_structures" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.get_structures">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_structures</span><span class="signature">(self, primitive=True, symmetrized=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.get_structures-1111"><a href="#CifParser.get_structures-1111"><span class="linenos">1111</span></a>    <span class="k">def</span> <span class="nf">get_structures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">symmetrized</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="CifParser.get_structures-1112"><a href="#CifParser.get_structures-1112"><span class="linenos">1112</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.get_structures-1113"><a href="#CifParser.get_structures-1113"><span class="linenos">1113</span></a><span class="sd">        Return list of structures in CIF file. primitive boolean sets whether a</span>
</span><span id="CifParser.get_structures-1114"><a href="#CifParser.get_structures-1114"><span class="linenos">1114</span></a><span class="sd">        conventional cell structure or primitive cell structure is returned.</span>
</span><span id="CifParser.get_structures-1115"><a href="#CifParser.get_structures-1115"><span class="linenos">1115</span></a>
</span><span id="CifParser.get_structures-1116"><a href="#CifParser.get_structures-1116"><span class="linenos">1116</span></a><span class="sd">        Args:</span>
</span><span id="CifParser.get_structures-1117"><a href="#CifParser.get_structures-1117"><span class="linenos">1117</span></a><span class="sd">            primitive (bool): Set to False to return conventional unit cells.</span>
</span><span id="CifParser.get_structures-1118"><a href="#CifParser.get_structures-1118"><span class="linenos">1118</span></a><span class="sd">                Defaults to True. With magnetic CIF files, will return primitive</span>
</span><span id="CifParser.get_structures-1119"><a href="#CifParser.get_structures-1119"><span class="linenos">1119</span></a><span class="sd">                magnetic cell which may be larger than nuclear primitive cell.</span>
</span><span id="CifParser.get_structures-1120"><a href="#CifParser.get_structures-1120"><span class="linenos">1120</span></a><span class="sd">            symmetrized (bool): If True, return a SymmetrizedStructure which will</span>
</span><span id="CifParser.get_structures-1121"><a href="#CifParser.get_structures-1121"><span class="linenos">1121</span></a><span class="sd">                include the equivalent indices and symmetry operations used to</span>
</span><span id="CifParser.get_structures-1122"><a href="#CifParser.get_structures-1122"><span class="linenos">1122</span></a><span class="sd">                create the Structure as provided by the CIF (if explicit symmetry</span>
</span><span id="CifParser.get_structures-1123"><a href="#CifParser.get_structures-1123"><span class="linenos">1123</span></a><span class="sd">                operations are included in the CIF) or generated from information</span>
</span><span id="CifParser.get_structures-1124"><a href="#CifParser.get_structures-1124"><span class="linenos">1124</span></a><span class="sd">                in the CIF (if only space group labels are provided). Note that</span>
</span><span id="CifParser.get_structures-1125"><a href="#CifParser.get_structures-1125"><span class="linenos">1125</span></a><span class="sd">                currently Wyckoff labels and space group labels or numbers are</span>
</span><span id="CifParser.get_structures-1126"><a href="#CifParser.get_structures-1126"><span class="linenos">1126</span></a><span class="sd">                not included in the generated SymmetrizedStructure, these will be</span>
</span><span id="CifParser.get_structures-1127"><a href="#CifParser.get_structures-1127"><span class="linenos">1127</span></a><span class="sd">                notated as &quot;Not Parsed&quot; or -1 respectively.</span>
</span><span id="CifParser.get_structures-1128"><a href="#CifParser.get_structures-1128"><span class="linenos">1128</span></a>
</span><span id="CifParser.get_structures-1129"><a href="#CifParser.get_structures-1129"><span class="linenos">1129</span></a><span class="sd">        Returns:</span>
</span><span id="CifParser.get_structures-1130"><a href="#CifParser.get_structures-1130"><span class="linenos">1130</span></a><span class="sd">            List of Structures.</span>
</span><span id="CifParser.get_structures-1131"><a href="#CifParser.get_structures-1131"><span class="linenos">1131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.get_structures-1132"><a href="#CifParser.get_structures-1132"><span class="linenos">1132</span></a>
</span><span id="CifParser.get_structures-1133"><a href="#CifParser.get_structures-1133"><span class="linenos">1133</span></a>        <span class="k">if</span> <span class="n">primitive</span> <span class="ow">and</span> <span class="n">symmetrized</span><span class="p">:</span>
</span><span id="CifParser.get_structures-1134"><a href="#CifParser.get_structures-1134"><span class="linenos">1134</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="CifParser.get_structures-1135"><a href="#CifParser.get_structures-1135"><span class="linenos">1135</span></a>                <span class="s2">&quot;Using both &#39;primitive&#39; and &#39;symmetrized&#39; arguments is not currently supported &quot;</span>
</span><span id="CifParser.get_structures-1136"><a href="#CifParser.get_structures-1136"><span class="linenos">1136</span></a>                <span class="s2">&quot;since unexpected behavior might result.&quot;</span>
</span><span id="CifParser.get_structures-1137"><a href="#CifParser.get_structures-1137"><span class="linenos">1137</span></a>            <span class="p">)</span>
</span><span id="CifParser.get_structures-1138"><a href="#CifParser.get_structures-1138"><span class="linenos">1138</span></a>
</span><span id="CifParser.get_structures-1139"><a href="#CifParser.get_structures-1139"><span class="linenos">1139</span></a>        <span class="n">structures</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifParser.get_structures-1140"><a href="#CifParser.get_structures-1140"><span class="linenos">1140</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="CifParser.get_structures-1141"><a href="#CifParser.get_structures-1141"><span class="linenos">1141</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.get_structures-1142"><a href="#CifParser.get_structures-1142"><span class="linenos">1142</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_structure</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">primitive</span><span class="p">,</span> <span class="n">symmetrized</span><span class="p">)</span>
</span><span id="CifParser.get_structures-1143"><a href="#CifParser.get_structures-1143"><span class="linenos">1143</span></a>                <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
</span><span id="CifParser.get_structures-1144"><a href="#CifParser.get_structures-1144"><span class="linenos">1144</span></a>                    <span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="CifParser.get_structures-1145"><a href="#CifParser.get_structures-1145"><span class="linenos">1145</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="CifParser.get_structures-1146"><a href="#CifParser.get_structures-1146"><span class="linenos">1146</span></a>                <span class="c1"># Warn the user (Errors should never pass silently)</span>
</span><span id="CifParser.get_structures-1147"><a href="#CifParser.get_structures-1147"><span class="linenos">1147</span></a>                <span class="c1"># A user reported a problem with cif files produced by Avogadro</span>
</span><span id="CifParser.get_structures-1148"><a href="#CifParser.get_structures-1148"><span class="linenos">1148</span></a>                <span class="c1"># in which the atomic coordinates are in Cartesian coords.</span>
</span><span id="CifParser.get_structures-1149"><a href="#CifParser.get_structures-1149"><span class="linenos">1149</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
</span><span id="CifParser.get_structures-1150"><a href="#CifParser.get_structures-1150"><span class="linenos">1150</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No structure parsed for </span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> structure in CIF. Section of CIF file below.&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_structures-1151"><a href="#CifParser.get_structures-1151"><span class="linenos">1151</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
</span><span id="CifParser.get_structures-1152"><a href="#CifParser.get_structures-1152"><span class="linenos">1152</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error is </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_structures-1153"><a href="#CifParser.get_structures-1153"><span class="linenos">1153</span></a>
</span><span id="CifParser.get_structures-1154"><a href="#CifParser.get_structures-1154"><span class="linenos">1154</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">:</span>
</span><span id="CifParser.get_structures-1155"><a href="#CifParser.get_structures-1155"><span class="linenos">1155</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Issues encountered while parsing CIF: &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">))</span>
</span><span id="CifParser.get_structures-1156"><a href="#CifParser.get_structures-1156"><span class="linenos">1156</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifParser.get_structures-1157"><a href="#CifParser.get_structures-1157"><span class="linenos">1157</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid cif file with no structures!&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_structures-1158"><a href="#CifParser.get_structures-1158"><span class="linenos">1158</span></a>        <span class="k">return</span> <span class="n">structures</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Return list of structures in CIF file. primitive boolean sets whether a
conventional cell structure or primitive cell structure is returned.</p>

<p>Args:
    primitive (bool): Set to False to return conventional unit cells.
        Defaults to True. With magnetic CIF files, will return primitive
        magnetic cell which may be larger than nuclear primitive cell.
    symmetrized (bool): If True, return a SymmetrizedStructure which will
        include the equivalent indices and symmetry operations used to
        create the Structure as provided by the CIF (if explicit symmetry
        operations are included in the CIF) or generated from information
        in the CIF (if only space group labels are provided). Note that
        currently Wyckoff labels and space group labels or numbers are
        not included in the generated SymmetrizedStructure, these will be
        notated as "Not Parsed" or -1 respectively.</p>

<p>Returns:
    List of Structures.</p>
</div>


                            </div>
                            <div id="CifParser.get_bibtex_string" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.get_bibtex_string">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_bibtex_string</span><span class="signature">(self)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.get_bibtex_string-1160"><a href="#CifParser.get_bibtex_string-1160"><span class="linenos">1160</span></a>    <span class="k">def</span> <span class="nf">get_bibtex_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CifParser.get_bibtex_string-1161"><a href="#CifParser.get_bibtex_string-1161"><span class="linenos">1161</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.get_bibtex_string-1162"><a href="#CifParser.get_bibtex_string-1162"><span class="linenos">1162</span></a><span class="sd">        Get BibTeX reference from CIF file.</span>
</span><span id="CifParser.get_bibtex_string-1163"><a href="#CifParser.get_bibtex_string-1163"><span class="linenos">1163</span></a><span class="sd">        :param data:</span>
</span><span id="CifParser.get_bibtex_string-1164"><a href="#CifParser.get_bibtex_string-1164"><span class="linenos">1164</span></a><span class="sd">        :return: BibTeX string</span>
</span><span id="CifParser.get_bibtex_string-1165"><a href="#CifParser.get_bibtex_string-1165"><span class="linenos">1165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.get_bibtex_string-1166"><a href="#CifParser.get_bibtex_string-1166"><span class="linenos">1166</span></a>
</span><span id="CifParser.get_bibtex_string-1167"><a href="#CifParser.get_bibtex_string-1167"><span class="linenos">1167</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifParser.get_bibtex_string-1168"><a href="#CifParser.get_bibtex_string-1168"><span class="linenos">1168</span></a>            <span class="kn">from</span> <span class="nn">pybtex.database</span> <span class="kn">import</span> <span class="n">BibliographyData</span><span class="p">,</span> <span class="n">Entry</span>
</span><span id="CifParser.get_bibtex_string-1169"><a href="#CifParser.get_bibtex_string-1169"><span class="linenos">1169</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="CifParser.get_bibtex_string-1170"><a href="#CifParser.get_bibtex_string-1170"><span class="linenos">1170</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Bibliographic data extraction requires pybtex.&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_bibtex_string-1171"><a href="#CifParser.get_bibtex_string-1171"><span class="linenos">1171</span></a>
</span><span id="CifParser.get_bibtex_string-1172"><a href="#CifParser.get_bibtex_string-1172"><span class="linenos">1172</span></a>        <span class="n">bibtex_keys</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CifParser.get_bibtex_string-1173"><a href="#CifParser.get_bibtex_string-1173"><span class="linenos">1173</span></a>            <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_publ_author_name&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_author_name&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1174"><a href="#CifParser.get_bibtex_string-1174"><span class="linenos">1174</span></a>            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_publ_section_title&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_title&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1175"><a href="#CifParser.get_bibtex_string-1175"><span class="linenos">1175</span></a>            <span class="s2">&quot;journal&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="CifParser.get_bibtex_string-1176"><a href="#CifParser.get_bibtex_string-1176"><span class="linenos">1176</span></a>                <span class="s2">&quot;_journal_name_full&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_bibtex_string-1177"><a href="#CifParser.get_bibtex_string-1177"><span class="linenos">1177</span></a>                <span class="s2">&quot;_journal_name_abbrev&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_bibtex_string-1178"><a href="#CifParser.get_bibtex_string-1178"><span class="linenos">1178</span></a>                <span class="s2">&quot;_citation_journal_full&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_bibtex_string-1179"><a href="#CifParser.get_bibtex_string-1179"><span class="linenos">1179</span></a>                <span class="s2">&quot;_citation_journal_abbrev&quot;</span><span class="p">,</span>
</span><span id="CifParser.get_bibtex_string-1180"><a href="#CifParser.get_bibtex_string-1180"><span class="linenos">1180</span></a>            <span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1181"><a href="#CifParser.get_bibtex_string-1181"><span class="linenos">1181</span></a>            <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_volume&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_journal_volume&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1182"><a href="#CifParser.get_bibtex_string-1182"><span class="linenos">1182</span></a>            <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_year&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_year&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1183"><a href="#CifParser.get_bibtex_string-1183"><span class="linenos">1183</span></a>            <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_number&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_number&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1184"><a href="#CifParser.get_bibtex_string-1184"><span class="linenos">1184</span></a>            <span class="s2">&quot;page_first&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_page_first&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_page_first&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1185"><a href="#CifParser.get_bibtex_string-1185"><span class="linenos">1185</span></a>            <span class="s2">&quot;page_last&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_page_last&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_page_last&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1186"><a href="#CifParser.get_bibtex_string-1186"><span class="linenos">1186</span></a>            <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_journal_DOI&quot;</span><span class="p">,</span> <span class="s2">&quot;_citation_DOI&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1187"><a href="#CifParser.get_bibtex_string-1187"><span class="linenos">1187</span></a>        <span class="p">}</span>
</span><span id="CifParser.get_bibtex_string-1188"><a href="#CifParser.get_bibtex_string-1188"><span class="linenos">1188</span></a>
</span><span id="CifParser.get_bibtex_string-1189"><a href="#CifParser.get_bibtex_string-1189"><span class="linenos">1189</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser.get_bibtex_string-1190"><a href="#CifParser.get_bibtex_string-1190"><span class="linenos">1190</span></a>
</span><span id="CifParser.get_bibtex_string-1191"><a href="#CifParser.get_bibtex_string-1191"><span class="linenos">1191</span></a>        <span class="c1"># TODO: parse &#39;_publ_section_references&#39; when it exists?</span>
</span><span id="CifParser.get_bibtex_string-1192"><a href="#CifParser.get_bibtex_string-1192"><span class="linenos">1192</span></a>        <span class="c1"># TODO: CIF specification supports multiple citations.</span>
</span><span id="CifParser.get_bibtex_string-1193"><a href="#CifParser.get_bibtex_string-1193"><span class="linenos">1193</span></a>
</span><span id="CifParser.get_bibtex_string-1194"><a href="#CifParser.get_bibtex_string-1194"><span class="linenos">1194</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="CifParser.get_bibtex_string-1195"><a href="#CifParser.get_bibtex_string-1195"><span class="linenos">1195</span></a>
</span><span id="CifParser.get_bibtex_string-1196"><a href="#CifParser.get_bibtex_string-1196"><span class="linenos">1196</span></a>            <span class="c1"># convert to lower-case keys, some cif files inconsistent</span>
</span><span id="CifParser.get_bibtex_string-1197"><a href="#CifParser.get_bibtex_string-1197"><span class="linenos">1197</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="CifParser.get_bibtex_string-1198"><a href="#CifParser.get_bibtex_string-1198"><span class="linenos">1198</span></a>
</span><span id="CifParser.get_bibtex_string-1199"><a href="#CifParser.get_bibtex_string-1199"><span class="linenos">1199</span></a>            <span class="n">bibtex_entry</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser.get_bibtex_string-1200"><a href="#CifParser.get_bibtex_string-1200"><span class="linenos">1200</span></a>
</span><span id="CifParser.get_bibtex_string-1201"><a href="#CifParser.get_bibtex_string-1201"><span class="linenos">1201</span></a>            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">tags</span> <span class="ow">in</span> <span class="n">bibtex_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser.get_bibtex_string-1202"><a href="#CifParser.get_bibtex_string-1202"><span class="linenos">1202</span></a>                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
</span><span id="CifParser.get_bibtex_string-1203"><a href="#CifParser.get_bibtex_string-1203"><span class="linenos">1203</span></a>                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="CifParser.get_bibtex_string-1204"><a href="#CifParser.get_bibtex_string-1204"><span class="linenos">1204</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">tag</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="CifParser.get_bibtex_string-1205"><a href="#CifParser.get_bibtex_string-1205"><span class="linenos">1205</span></a>                            <span class="n">bibtex_entry</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CifParser.get_bibtex_string-1206"><a href="#CifParser.get_bibtex_string-1206"><span class="linenos">1206</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="CifParser.get_bibtex_string-1207"><a href="#CifParser.get_bibtex_string-1207"><span class="linenos">1207</span></a>                            <span class="n">bibtex_entry</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
</span><span id="CifParser.get_bibtex_string-1208"><a href="#CifParser.get_bibtex_string-1208"><span class="linenos">1208</span></a>
</span><span id="CifParser.get_bibtex_string-1209"><a href="#CifParser.get_bibtex_string-1209"><span class="linenos">1209</span></a>            <span class="c1"># convert to bibtex author format (&#39;and&#39; delimited)</span>
</span><span id="CifParser.get_bibtex_string-1210"><a href="#CifParser.get_bibtex_string-1210"><span class="linenos">1210</span></a>            <span class="k">if</span> <span class="s2">&quot;author&quot;</span> <span class="ow">in</span> <span class="n">bibtex_entry</span><span class="p">:</span>
</span><span id="CifParser.get_bibtex_string-1211"><a href="#CifParser.get_bibtex_string-1211"><span class="linenos">1211</span></a>                <span class="c1"># separate out semicolon authors</span>
</span><span id="CifParser.get_bibtex_string-1212"><a href="#CifParser.get_bibtex_string-1212"><span class="linenos">1212</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CifParser.get_bibtex_string-1213"><a href="#CifParser.get_bibtex_string-1213"><span class="linenos">1213</span></a>                    <span class="k">if</span> <span class="s2">&quot;;&quot;</span> <span class="ow">in</span> <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]:</span>
</span><span id="CifParser.get_bibtex_string-1214"><a href="#CifParser.get_bibtex_string-1214"><span class="linenos">1214</span></a>                        <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span id="CifParser.get_bibtex_string-1215"><a href="#CifParser.get_bibtex_string-1215"><span class="linenos">1215</span></a>
</span><span id="CifParser.get_bibtex_string-1216"><a href="#CifParser.get_bibtex_string-1216"><span class="linenos">1216</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="CifParser.get_bibtex_string-1217"><a href="#CifParser.get_bibtex_string-1217"><span class="linenos">1217</span></a>                    <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">])</span>
</span><span id="CifParser.get_bibtex_string-1218"><a href="#CifParser.get_bibtex_string-1218"><span class="linenos">1218</span></a>
</span><span id="CifParser.get_bibtex_string-1219"><a href="#CifParser.get_bibtex_string-1219"><span class="linenos">1219</span></a>            <span class="c1"># convert to bibtex page range format, use empty string if not specified</span>
</span><span id="CifParser.get_bibtex_string-1220"><a href="#CifParser.get_bibtex_string-1220"><span class="linenos">1220</span></a>            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;page_first&quot;</span> <span class="ow">in</span> <span class="n">bibtex_entry</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;page_last&quot;</span> <span class="ow">in</span> <span class="n">bibtex_entry</span><span class="p">):</span>
</span><span id="CifParser.get_bibtex_string-1221"><a href="#CifParser.get_bibtex_string-1221"><span class="linenos">1221</span></a>                <span class="n">bibtex_entry</span><span class="p">[</span><span class="s2">&quot;pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">--</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="CifParser.get_bibtex_string-1222"><a href="#CifParser.get_bibtex_string-1222"><span class="linenos">1222</span></a>                    <span class="n">bibtex_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_first&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1223"><a href="#CifParser.get_bibtex_string-1223"><span class="linenos">1223</span></a>                    <span class="n">bibtex_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_last&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="CifParser.get_bibtex_string-1224"><a href="#CifParser.get_bibtex_string-1224"><span class="linenos">1224</span></a>                <span class="p">)</span>
</span><span id="CifParser.get_bibtex_string-1225"><a href="#CifParser.get_bibtex_string-1225"><span class="linenos">1225</span></a>                <span class="n">bibtex_entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;page_first&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># and remove page_first, page_list if present</span>
</span><span id="CifParser.get_bibtex_string-1226"><a href="#CifParser.get_bibtex_string-1226"><span class="linenos">1226</span></a>                <span class="n">bibtex_entry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;page_last&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="CifParser.get_bibtex_string-1227"><a href="#CifParser.get_bibtex_string-1227"><span class="linenos">1227</span></a>
</span><span id="CifParser.get_bibtex_string-1228"><a href="#CifParser.get_bibtex_string-1228"><span class="linenos">1228</span></a>            <span class="c1"># cite keys are given as cif-reference-idx in order they are found</span>
</span><span id="CifParser.get_bibtex_string-1229"><a href="#CifParser.get_bibtex_string-1229"><span class="linenos">1229</span></a>            <span class="n">entries</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;cifref</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">(</span><span class="s2">&quot;article&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">bibtex_entry</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="CifParser.get_bibtex_string-1230"><a href="#CifParser.get_bibtex_string-1230"><span class="linenos">1230</span></a>
</span><span id="CifParser.get_bibtex_string-1231"><a href="#CifParser.get_bibtex_string-1231"><span class="linenos">1231</span></a>        <span class="k">return</span> <span class="n">BibliographyData</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">bib_format</span><span class="o">=</span><span class="s2">&quot;bibtex&quot;</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Get BibTeX reference from CIF file.
:param data:
:return: BibTeX string</p>
</div>


                            </div>
                            <div id="CifParser.as_dict" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifParser.as_dict">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">as_dict</span><span class="signature">(self)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifParser.as_dict-1233"><a href="#CifParser.as_dict-1233"><span class="linenos">1233</span></a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CifParser.as_dict-1234"><a href="#CifParser.as_dict-1234"><span class="linenos">1234</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifParser.as_dict-1235"><a href="#CifParser.as_dict-1235"><span class="linenos">1235</span></a><span class="sd">        :return: MSONable dict</span>
</span><span id="CifParser.as_dict-1236"><a href="#CifParser.as_dict-1236"><span class="linenos">1236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifParser.as_dict-1237"><a href="#CifParser.as_dict-1237"><span class="linenos">1237</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser.as_dict-1238"><a href="#CifParser.as_dict-1238"><span class="linenos">1238</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cif</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser.as_dict-1239"><a href="#CifParser.as_dict-1239"><span class="linenos">1239</span></a>            <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifParser.as_dict-1240"><a href="#CifParser.as_dict-1240"><span class="linenos">1240</span></a>            <span class="k">for</span> <span class="n">k2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifParser.as_dict-1241"><a href="#CifParser.as_dict-1241"><span class="linenos">1241</span></a>                <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v2</span>
</span><span id="CifParser.as_dict-1242"><a href="#CifParser.as_dict-1242"><span class="linenos">1242</span></a>        <span class="k">return</span> <span class="n">d</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>:return: MSONable dict</p>
</div>


                            </div>
                            <div id="CifParser.has_errors" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#CifParser.has_errors">#&nbsp;&nbsp</a>

        <span class="name">has_errors</span>
    </div>

    
            <div class="docstring"><p>:return: Whether there are errors/warnings detected in CIF parsing.</p>
</div>


                            </div>
                </section>
                <section id="CifWriter">
                                <div class="attr class">
        <a class="headerlink" href="#CifWriter">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">CifWriter</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifWriter-1252"><a href="#CifWriter-1252"><span class="linenos">1252</span></a><span class="k">class</span> <span class="nc">CifWriter</span><span class="p">:</span>
</span><span id="CifWriter-1253"><a href="#CifWriter-1253"><span class="linenos">1253</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifWriter-1254"><a href="#CifWriter-1254"><span class="linenos">1254</span></a><span class="sd">    A wrapper around CifFile to write CIF files from pymatgen structures.</span>
</span><span id="CifWriter-1255"><a href="#CifWriter-1255"><span class="linenos">1255</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CifWriter-1256"><a href="#CifWriter-1256"><span class="linenos">1256</span></a>
</span><span id="CifWriter-1257"><a href="#CifWriter-1257"><span class="linenos">1257</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CifWriter-1258"><a href="#CifWriter-1258"><span class="linenos">1258</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CifWriter-1259"><a href="#CifWriter-1259"><span class="linenos">1259</span></a>        <span class="n">struct</span><span class="p">,</span>
</span><span id="CifWriter-1260"><a href="#CifWriter-1260"><span class="linenos">1260</span></a>        <span class="n">symprec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="CifWriter-1261"><a href="#CifWriter-1261"><span class="linenos">1261</span></a>        <span class="n">write_magmoms</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="CifWriter-1262"><a href="#CifWriter-1262"><span class="linenos">1262</span></a>        <span class="n">significant_figures</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
</span><span id="CifWriter-1263"><a href="#CifWriter-1263"><span class="linenos">1263</span></a>        <span class="n">angle_tolerance</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
</span><span id="CifWriter-1264"><a href="#CifWriter-1264"><span class="linenos">1264</span></a>        <span class="n">refine_struct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="CifWriter-1265"><a href="#CifWriter-1265"><span class="linenos">1265</span></a>    <span class="p">):</span>
</span><span id="CifWriter-1266"><a href="#CifWriter-1266"><span class="linenos">1266</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifWriter-1267"><a href="#CifWriter-1267"><span class="linenos">1267</span></a><span class="sd">        Args:</span>
</span><span id="CifWriter-1268"><a href="#CifWriter-1268"><span class="linenos">1268</span></a><span class="sd">            struct (Structure): structure to write</span>
</span><span id="CifWriter-1269"><a href="#CifWriter-1269"><span class="linenos">1269</span></a><span class="sd">            symprec (float): If not none, finds the symmetry of the structure</span>
</span><span id="CifWriter-1270"><a href="#CifWriter-1270"><span class="linenos">1270</span></a><span class="sd">                and writes the cif with symmetry information. Passes symprec</span>
</span><span id="CifWriter-1271"><a href="#CifWriter-1271"><span class="linenos">1271</span></a><span class="sd">                to the SpacegroupAnalyzer. See also refine_struct.</span>
</span><span id="CifWriter-1272"><a href="#CifWriter-1272"><span class="linenos">1272</span></a><span class="sd">            write_magmoms (bool): If True, will write magCIF file. Incompatible</span>
</span><span id="CifWriter-1273"><a href="#CifWriter-1273"><span class="linenos">1273</span></a><span class="sd">                with symprec</span>
</span><span id="CifWriter-1274"><a href="#CifWriter-1274"><span class="linenos">1274</span></a><span class="sd">            significant_figures (int): Specifies precision for formatting of floats.</span>
</span><span id="CifWriter-1275"><a href="#CifWriter-1275"><span class="linenos">1275</span></a><span class="sd">                Defaults to 8.</span>
</span><span id="CifWriter-1276"><a href="#CifWriter-1276"><span class="linenos">1276</span></a><span class="sd">            angle_tolerance (float): Angle tolerance for symmetry finding. Passes</span>
</span><span id="CifWriter-1277"><a href="#CifWriter-1277"><span class="linenos">1277</span></a><span class="sd">                angle_tolerance to the SpacegroupAnalyzer. Used only if symprec</span>
</span><span id="CifWriter-1278"><a href="#CifWriter-1278"><span class="linenos">1278</span></a><span class="sd">                is not None.</span>
</span><span id="CifWriter-1279"><a href="#CifWriter-1279"><span class="linenos">1279</span></a><span class="sd">            refine_struct: Used only if symprec is not None. If True, get_refined_structure</span>
</span><span id="CifWriter-1280"><a href="#CifWriter-1280"><span class="linenos">1280</span></a><span class="sd">                is invoked to convert input structure from primitive to conventional.</span>
</span><span id="CifWriter-1281"><a href="#CifWriter-1281"><span class="linenos">1281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifWriter-1282"><a href="#CifWriter-1282"><span class="linenos">1282</span></a>
</span><span id="CifWriter-1283"><a href="#CifWriter-1283"><span class="linenos">1283</span></a>        <span class="k">if</span> <span class="n">write_magmoms</span> <span class="ow">and</span> <span class="n">symprec</span><span class="p">:</span>
</span><span id="CifWriter-1284"><a href="#CifWriter-1284"><span class="linenos">1284</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Magnetic symmetry cannot currently be detected by pymatgen,disabling symmetry detection.&quot;</span><span class="p">)</span>
</span><span id="CifWriter-1285"><a href="#CifWriter-1285"><span class="linenos">1285</span></a>            <span class="n">symprec</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CifWriter-1286"><a href="#CifWriter-1286"><span class="linenos">1286</span></a>
</span><span id="CifWriter-1287"><a href="#CifWriter-1287"><span class="linenos">1287</span></a>        <span class="n">format_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">:.</span><span class="si">{</span><span class="n">significant_figures</span><span class="si">}</span><span class="s2">f</span><span class="se">}}</span><span class="s2">&quot;</span>
</span><span id="CifWriter-1288"><a href="#CifWriter-1288"><span class="linenos">1288</span></a>
</span><span id="CifWriter-1289"><a href="#CifWriter-1289"><span class="linenos">1289</span></a>        <span class="n">block</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifWriter-1290"><a href="#CifWriter-1290"><span class="linenos">1290</span></a>        <span class="n">loops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1291"><a href="#CifWriter-1291"><span class="linenos">1291</span></a>        <span class="n">spacegroup</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P 1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CifWriter-1292"><a href="#CifWriter-1292"><span class="linenos">1292</span></a>        <span class="k">if</span> <span class="n">symprec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifWriter-1293"><a href="#CifWriter-1293"><span class="linenos">1293</span></a>            <span class="n">sf</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">symprec</span><span class="p">,</span> <span class="n">angle_tolerance</span><span class="o">=</span><span class="n">angle_tolerance</span><span class="p">)</span>
</span><span id="CifWriter-1294"><a href="#CifWriter-1294"><span class="linenos">1294</span></a>            <span class="n">spacegroup</span> <span class="o">=</span> <span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">get_space_group_symbol</span><span class="p">(),</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_space_group_number</span><span class="p">())</span>
</span><span id="CifWriter-1295"><a href="#CifWriter-1295"><span class="linenos">1295</span></a>
</span><span id="CifWriter-1296"><a href="#CifWriter-1296"><span class="linenos">1296</span></a>            <span class="k">if</span> <span class="n">refine_struct</span><span class="p">:</span>
</span><span id="CifWriter-1297"><a href="#CifWriter-1297"><span class="linenos">1297</span></a>                <span class="c1"># Needs the refined structure when using symprec. This converts</span>
</span><span id="CifWriter-1298"><a href="#CifWriter-1298"><span class="linenos">1298</span></a>                <span class="c1"># primitive to conventional structures, the standard for CIF.</span>
</span><span id="CifWriter-1299"><a href="#CifWriter-1299"><span class="linenos">1299</span></a>                <span class="n">struct</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_refined_structure</span><span class="p">()</span>
</span><span id="CifWriter-1300"><a href="#CifWriter-1300"><span class="linenos">1300</span></a>
</span><span id="CifWriter-1301"><a href="#CifWriter-1301"><span class="linenos">1301</span></a>        <span class="n">latt</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">lattice</span>
</span><span id="CifWriter-1302"><a href="#CifWriter-1302"><span class="linenos">1302</span></a>        <span class="n">comp</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">composition</span>
</span><span id="CifWriter-1303"><a href="#CifWriter-1303"><span class="linenos">1303</span></a>        <span class="n">no_oxi_comp</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">element_composition</span>
</span><span id="CifWriter-1304"><a href="#CifWriter-1304"><span class="linenos">1304</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_space_group_name_H-M&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spacegroup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CifWriter-1305"><a href="#CifWriter-1305"><span class="linenos">1305</span></a>        <span class="k">for</span> <span class="n">cell_attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]:</span>
</span><span id="CifWriter-1306"><a href="#CifWriter-1306"><span class="linenos">1306</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_cell_length_&quot;</span> <span class="o">+</span> <span class="n">cell_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">latt</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">))</span>
</span><span id="CifWriter-1307"><a href="#CifWriter-1307"><span class="linenos">1307</span></a>        <span class="k">for</span> <span class="n">cell_attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">]:</span>
</span><span id="CifWriter-1308"><a href="#CifWriter-1308"><span class="linenos">1308</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_cell_angle_&quot;</span> <span class="o">+</span> <span class="n">cell_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">latt</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">))</span>
</span><span id="CifWriter-1309"><a href="#CifWriter-1309"><span class="linenos">1309</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_Int_Tables_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spacegroup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CifWriter-1310"><a href="#CifWriter-1310"><span class="linenos">1310</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_chemical_formula_structural&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no_oxi_comp</span><span class="o">.</span><span class="n">reduced_formula</span>
</span><span id="CifWriter-1311"><a href="#CifWriter-1311"><span class="linenos">1311</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_chemical_formula_sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no_oxi_comp</span><span class="o">.</span><span class="n">formula</span>
</span><span id="CifWriter-1312"><a href="#CifWriter-1312"><span class="linenos">1312</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_cell_volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latt</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>
</span><span id="CifWriter-1313"><a href="#CifWriter-1313"><span class="linenos">1313</span></a>
</span><span id="CifWriter-1314"><a href="#CifWriter-1314"><span class="linenos">1314</span></a>        <span class="n">reduced_comp</span><span class="p">,</span> <span class="n">fu</span> <span class="o">=</span> <span class="n">no_oxi_comp</span><span class="o">.</span><span class="n">get_reduced_composition_and_factor</span><span class="p">()</span>
</span><span id="CifWriter-1315"><a href="#CifWriter-1315"><span class="linenos">1315</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_cell_formula_units_Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fu</span><span class="p">))</span>
</span><span id="CifWriter-1316"><a href="#CifWriter-1316"><span class="linenos">1316</span></a>
</span><span id="CifWriter-1317"><a href="#CifWriter-1317"><span class="linenos">1317</span></a>        <span class="k">if</span> <span class="n">symprec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifWriter-1318"><a href="#CifWriter-1318"><span class="linenos">1318</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_equiv_pos_site_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]</span>
</span><span id="CifWriter-1319"><a href="#CifWriter-1319"><span class="linenos">1319</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_equiv_pos_as_xyz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x, y, z&quot;</span><span class="p">]</span>
</span><span id="CifWriter-1320"><a href="#CifWriter-1320"><span class="linenos">1320</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CifWriter-1321"><a href="#CifWriter-1321"><span class="linenos">1321</span></a>            <span class="n">sf</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">symprec</span><span class="p">)</span>
</span><span id="CifWriter-1322"><a href="#CifWriter-1322"><span class="linenos">1322</span></a>
</span><span id="CifWriter-1323"><a href="#CifWriter-1323"><span class="linenos">1323</span></a>            <span class="n">symmops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1324"><a href="#CifWriter-1324"><span class="linenos">1324</span></a>            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_symmetry_operations</span><span class="p">():</span>
</span><span id="CifWriter-1325"><a href="#CifWriter-1325"><span class="linenos">1325</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">translation_vector</span>
</span><span id="CifWriter-1326"><a href="#CifWriter-1326"><span class="linenos">1326</span></a>                <span class="n">symmops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SymmOp</span><span class="o">.</span><span class="n">from_rotation_and_translation</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
</span><span id="CifWriter-1327"><a href="#CifWriter-1327"><span class="linenos">1327</span></a>
</span><span id="CifWriter-1328"><a href="#CifWriter-1328"><span class="linenos">1328</span></a>            <span class="n">ops</span> <span class="o">=</span> <span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">as_xyz_string</span><span class="p">()</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">symmops</span><span class="p">]</span>
</span><span id="CifWriter-1329"><a href="#CifWriter-1329"><span class="linenos">1329</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_equiv_pos_site_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ops</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="CifWriter-1330"><a href="#CifWriter-1330"><span class="linenos">1330</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_equiv_pos_as_xyz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ops</span>
</span><span id="CifWriter-1331"><a href="#CifWriter-1331"><span class="linenos">1331</span></a>
</span><span id="CifWriter-1332"><a href="#CifWriter-1332"><span class="linenos">1332</span></a>        <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;_symmetry_equiv_pos_site_id&quot;</span><span class="p">,</span> <span class="s2">&quot;_symmetry_equiv_pos_as_xyz&quot;</span><span class="p">])</span>
</span><span id="CifWriter-1333"><a href="#CifWriter-1333"><span class="linenos">1333</span></a>
</span><span id="CifWriter-1334"><a href="#CifWriter-1334"><span class="linenos">1334</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifWriter-1335"><a href="#CifWriter-1335"><span class="linenos">1335</span></a>            <span class="n">symbol_to_oxinum</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="o">.</span><span class="fm">__str__</span><span class="p">():</span> <span class="nb">float</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">oxi_state</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">elements</span><span class="p">)}</span>
</span><span id="CifWriter-1336"><a href="#CifWriter-1336"><span class="linenos">1336</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol_to_oxinum</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="CifWriter-1337"><a href="#CifWriter-1337"><span class="linenos">1337</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_type_oxidation_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol_to_oxinum</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="CifWriter-1338"><a href="#CifWriter-1338"><span class="linenos">1338</span></a>            <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">,</span> <span class="s2">&quot;_atom_type_oxidation_number&quot;</span><span class="p">])</span>
</span><span id="CifWriter-1339"><a href="#CifWriter-1339"><span class="linenos">1339</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
</span><span id="CifWriter-1340"><a href="#CifWriter-1340"><span class="linenos">1340</span></a>            <span class="n">symbol_to_oxinum</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="o">.</span><span class="n">symbol</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">elements</span><span class="p">)}</span>
</span><span id="CifWriter-1341"><a href="#CifWriter-1341"><span class="linenos">1341</span></a>
</span><span id="CifWriter-1342"><a href="#CifWriter-1342"><span class="linenos">1342</span></a>        <span class="n">atom_site_type_symbol</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1343"><a href="#CifWriter-1343"><span class="linenos">1343</span></a>        <span class="n">atom_site_symmetry_multiplicity</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1344"><a href="#CifWriter-1344"><span class="linenos">1344</span></a>        <span class="n">atom_site_fract_x</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1345"><a href="#CifWriter-1345"><span class="linenos">1345</span></a>        <span class="n">atom_site_fract_y</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1346"><a href="#CifWriter-1346"><span class="linenos">1346</span></a>        <span class="n">atom_site_fract_z</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1347"><a href="#CifWriter-1347"><span class="linenos">1347</span></a>        <span class="n">atom_site_label</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1348"><a href="#CifWriter-1348"><span class="linenos">1348</span></a>        <span class="n">atom_site_occupancy</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1349"><a href="#CifWriter-1349"><span class="linenos">1349</span></a>        <span class="n">atom_site_moment_label</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1350"><a href="#CifWriter-1350"><span class="linenos">1350</span></a>        <span class="n">atom_site_moment_crystalaxis_x</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1351"><a href="#CifWriter-1351"><span class="linenos">1351</span></a>        <span class="n">atom_site_moment_crystalaxis_y</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1352"><a href="#CifWriter-1352"><span class="linenos">1352</span></a>        <span class="n">atom_site_moment_crystalaxis_z</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter-1353"><a href="#CifWriter-1353"><span class="linenos">1353</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CifWriter-1354"><a href="#CifWriter-1354"><span class="linenos">1354</span></a>        <span class="k">if</span> <span class="n">symprec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifWriter-1355"><a href="#CifWriter-1355"><span class="linenos">1355</span></a>            <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">struct</span><span class="p">:</span>
</span><span id="CifWriter-1356"><a href="#CifWriter-1356"><span class="linenos">1356</span></a>                <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">occu</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="CifWriter-1357"><a href="#CifWriter-1357"><span class="linenos">1357</span></a>                    <span class="n">atom_site_type_symbol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="CifWriter-1358"><a href="#CifWriter-1358"><span class="linenos">1358</span></a>                    <span class="n">atom_site_symmetry_multiplicity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
</span><span id="CifWriter-1359"><a href="#CifWriter-1359"><span class="linenos">1359</span></a>                    <span class="n">atom_site_fract_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">a</span><span class="p">))</span>
</span><span id="CifWriter-1360"><a href="#CifWriter-1360"><span class="linenos">1360</span></a>                    <span class="n">atom_site_fract_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>
</span><span id="CifWriter-1361"><a href="#CifWriter-1361"><span class="linenos">1361</span></a>                    <span class="n">atom_site_fract_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
</span><span id="CifWriter-1362"><a href="#CifWriter-1362"><span class="linenos">1362</span></a>                    <span class="n">atom_site_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sp</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CifWriter-1363"><a href="#CifWriter-1363"><span class="linenos">1363</span></a>                    <span class="n">atom_site_occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">occu</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="CifWriter-1364"><a href="#CifWriter-1364"><span class="linenos">1364</span></a>
</span><span id="CifWriter-1365"><a href="#CifWriter-1365"><span class="linenos">1365</span></a>                    <span class="n">magmom</span> <span class="o">=</span> <span class="n">Magmom</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;magmom&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</span><span id="CifWriter-1366"><a href="#CifWriter-1366"><span class="linenos">1366</span></a>                    <span class="k">if</span> <span class="n">write_magmoms</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">magmom</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifWriter-1367"><a href="#CifWriter-1367"><span class="linenos">1367</span></a>                        <span class="n">moment</span> <span class="o">=</span> <span class="n">Magmom</span><span class="o">.</span><span class="n">get_moment_relative_to_crystal_axes</span><span class="p">(</span><span class="n">magmom</span><span class="p">,</span> <span class="n">latt</span><span class="p">)</span>
</span><span id="CifWriter-1368"><a href="#CifWriter-1368"><span class="linenos">1368</span></a>                        <span class="n">atom_site_moment_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sp</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CifWriter-1369"><a href="#CifWriter-1369"><span class="linenos">1369</span></a>                        <span class="n">atom_site_moment_crystalaxis_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">moment</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="CifWriter-1370"><a href="#CifWriter-1370"><span class="linenos">1370</span></a>                        <span class="n">atom_site_moment_crystalaxis_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">moment</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="CifWriter-1371"><a href="#CifWriter-1371"><span class="linenos">1371</span></a>                        <span class="n">atom_site_moment_crystalaxis_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">moment</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="CifWriter-1372"><a href="#CifWriter-1372"><span class="linenos">1372</span></a>
</span><span id="CifWriter-1373"><a href="#CifWriter-1373"><span class="linenos">1373</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="CifWriter-1374"><a href="#CifWriter-1374"><span class="linenos">1374</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CifWriter-1375"><a href="#CifWriter-1375"><span class="linenos">1375</span></a>            <span class="c1"># The following just presents a deterministic ordering.</span>
</span><span id="CifWriter-1376"><a href="#CifWriter-1376"><span class="linenos">1376</span></a>            <span class="n">unique_sites</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CifWriter-1377"><a href="#CifWriter-1377"><span class="linenos">1377</span></a>                <span class="p">(</span>
</span><span id="CifWriter-1378"><a href="#CifWriter-1378"><span class="linenos">1378</span></a>                    <span class="nb">sorted</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="CifWriter-1379"><a href="#CifWriter-1379"><span class="linenos">1379</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">sites</span><span class="p">),</span>
</span><span id="CifWriter-1380"><a href="#CifWriter-1380"><span class="linenos">1380</span></a>                <span class="p">)</span>
</span><span id="CifWriter-1381"><a href="#CifWriter-1381"><span class="linenos">1381</span></a>                <span class="k">for</span> <span class="n">sites</span> <span class="ow">in</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_symmetrized_structure</span><span class="p">()</span><span class="o">.</span><span class="n">equivalent_sites</span>
</span><span id="CifWriter-1382"><a href="#CifWriter-1382"><span class="linenos">1382</span></a>            <span class="p">]</span>
</span><span id="CifWriter-1383"><a href="#CifWriter-1383"><span class="linenos">1383</span></a>            <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">mult</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="CifWriter-1384"><a href="#CifWriter-1384"><span class="linenos">1384</span></a>                <span class="n">unique_sites</span><span class="p">,</span>
</span><span id="CifWriter-1385"><a href="#CifWriter-1385"><span class="linenos">1385</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">(</span>
</span><span id="CifWriter-1386"><a href="#CifWriter-1386"><span class="linenos">1386</span></a>                    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">average_electroneg</span><span class="p">,</span>
</span><span id="CifWriter-1387"><a href="#CifWriter-1387"><span class="linenos">1387</span></a>                    <span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="CifWriter-1388"><a href="#CifWriter-1388"><span class="linenos">1388</span></a>                    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">a</span><span class="p">,</span>
</span><span id="CifWriter-1389"><a href="#CifWriter-1389"><span class="linenos">1389</span></a>                    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
</span><span id="CifWriter-1390"><a href="#CifWriter-1390"><span class="linenos">1390</span></a>                    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
</span><span id="CifWriter-1391"><a href="#CifWriter-1391"><span class="linenos">1391</span></a>                <span class="p">),</span>
</span><span id="CifWriter-1392"><a href="#CifWriter-1392"><span class="linenos">1392</span></a>            <span class="p">):</span>
</span><span id="CifWriter-1393"><a href="#CifWriter-1393"><span class="linenos">1393</span></a>                <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">occu</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifWriter-1394"><a href="#CifWriter-1394"><span class="linenos">1394</span></a>                    <span class="n">atom_site_type_symbol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="CifWriter-1395"><a href="#CifWriter-1395"><span class="linenos">1395</span></a>                    <span class="n">atom_site_symmetry_multiplicity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mult</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CifWriter-1396"><a href="#CifWriter-1396"><span class="linenos">1396</span></a>                    <span class="n">atom_site_fract_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">a</span><span class="p">))</span>
</span><span id="CifWriter-1397"><a href="#CifWriter-1397"><span class="linenos">1397</span></a>                    <span class="n">atom_site_fract_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>
</span><span id="CifWriter-1398"><a href="#CifWriter-1398"><span class="linenos">1398</span></a>                    <span class="n">atom_site_fract_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
</span><span id="CifWriter-1399"><a href="#CifWriter-1399"><span class="linenos">1399</span></a>                    <span class="n">atom_site_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sp</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CifWriter-1400"><a href="#CifWriter-1400"><span class="linenos">1400</span></a>                    <span class="n">atom_site_occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">occu</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="CifWriter-1401"><a href="#CifWriter-1401"><span class="linenos">1401</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="CifWriter-1402"><a href="#CifWriter-1402"><span class="linenos">1402</span></a>
</span><span id="CifWriter-1403"><a href="#CifWriter-1403"><span class="linenos">1403</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_type_symbol</span>
</span><span id="CifWriter-1404"><a href="#CifWriter-1404"><span class="linenos">1404</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_label</span>
</span><span id="CifWriter-1405"><a href="#CifWriter-1405"><span class="linenos">1405</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_symmetry_multiplicity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_symmetry_multiplicity</span>
</span><span id="CifWriter-1406"><a href="#CifWriter-1406"><span class="linenos">1406</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_fract_x</span>
</span><span id="CifWriter-1407"><a href="#CifWriter-1407"><span class="linenos">1407</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_fract_y</span>
</span><span id="CifWriter-1408"><a href="#CifWriter-1408"><span class="linenos">1408</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_fract_z</span>
</span><span id="CifWriter-1409"><a href="#CifWriter-1409"><span class="linenos">1409</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_occupancy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_occupancy</span>
</span><span id="CifWriter-1410"><a href="#CifWriter-1410"><span class="linenos">1410</span></a>        <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CifWriter-1411"><a href="#CifWriter-1411"><span class="linenos">1411</span></a>            <span class="p">[</span>
</span><span id="CifWriter-1412"><a href="#CifWriter-1412"><span class="linenos">1412</span></a>                <span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1413"><a href="#CifWriter-1413"><span class="linenos">1413</span></a>                <span class="s2">&quot;_atom_site_label&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1414"><a href="#CifWriter-1414"><span class="linenos">1414</span></a>                <span class="s2">&quot;_atom_site_symmetry_multiplicity&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1415"><a href="#CifWriter-1415"><span class="linenos">1415</span></a>                <span class="s2">&quot;_atom_site_fract_x&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1416"><a href="#CifWriter-1416"><span class="linenos">1416</span></a>                <span class="s2">&quot;_atom_site_fract_y&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1417"><a href="#CifWriter-1417"><span class="linenos">1417</span></a>                <span class="s2">&quot;_atom_site_fract_z&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1418"><a href="#CifWriter-1418"><span class="linenos">1418</span></a>                <span class="s2">&quot;_atom_site_occupancy&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1419"><a href="#CifWriter-1419"><span class="linenos">1419</span></a>            <span class="p">]</span>
</span><span id="CifWriter-1420"><a href="#CifWriter-1420"><span class="linenos">1420</span></a>        <span class="p">)</span>
</span><span id="CifWriter-1421"><a href="#CifWriter-1421"><span class="linenos">1421</span></a>        <span class="k">if</span> <span class="n">write_magmoms</span><span class="p">:</span>
</span><span id="CifWriter-1422"><a href="#CifWriter-1422"><span class="linenos">1422</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_moment_label</span>
</span><span id="CifWriter-1423"><a href="#CifWriter-1423"><span class="linenos">1423</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_moment_crystalaxis_x</span>
</span><span id="CifWriter-1424"><a href="#CifWriter-1424"><span class="linenos">1424</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_moment_crystalaxis_y</span>
</span><span id="CifWriter-1425"><a href="#CifWriter-1425"><span class="linenos">1425</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_moment_crystalaxis_z</span>
</span><span id="CifWriter-1426"><a href="#CifWriter-1426"><span class="linenos">1426</span></a>            <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CifWriter-1427"><a href="#CifWriter-1427"><span class="linenos">1427</span></a>                <span class="p">[</span>
</span><span id="CifWriter-1428"><a href="#CifWriter-1428"><span class="linenos">1428</span></a>                    <span class="s2">&quot;_atom_site_moment_label&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1429"><a href="#CifWriter-1429"><span class="linenos">1429</span></a>                    <span class="s2">&quot;_atom_site_moment_crystalaxis_x&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1430"><a href="#CifWriter-1430"><span class="linenos">1430</span></a>                    <span class="s2">&quot;_atom_site_moment_crystalaxis_y&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1431"><a href="#CifWriter-1431"><span class="linenos">1431</span></a>                    <span class="s2">&quot;_atom_site_moment_crystalaxis_z&quot;</span><span class="p">,</span>
</span><span id="CifWriter-1432"><a href="#CifWriter-1432"><span class="linenos">1432</span></a>                <span class="p">]</span>
</span><span id="CifWriter-1433"><a href="#CifWriter-1433"><span class="linenos">1433</span></a>            <span class="p">)</span>
</span><span id="CifWriter-1434"><a href="#CifWriter-1434"><span class="linenos">1434</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifWriter-1435"><a href="#CifWriter-1435"><span class="linenos">1435</span></a>        <span class="n">d</span><span class="p">[</span><span class="n">comp</span><span class="o">.</span><span class="n">reduced_formula</span><span class="p">]</span> <span class="o">=</span> <span class="n">CifBlock</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">loops</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">reduced_formula</span><span class="p">)</span>
</span><span id="CifWriter-1436"><a href="#CifWriter-1436"><span class="linenos">1436</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cf</span> <span class="o">=</span> <span class="n">CifFile</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span id="CifWriter-1437"><a href="#CifWriter-1437"><span class="linenos">1437</span></a>
</span><span id="CifWriter-1438"><a href="#CifWriter-1438"><span class="linenos">1438</span></a>    <span class="nd">@property</span>
</span><span id="CifWriter-1439"><a href="#CifWriter-1439"><span class="linenos">1439</span></a>    <span class="k">def</span> <span class="nf">ciffile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CifWriter-1440"><a href="#CifWriter-1440"><span class="linenos">1440</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifWriter-1441"><a href="#CifWriter-1441"><span class="linenos">1441</span></a><span class="sd">        Returns: CifFile associated with the CifWriter.</span>
</span><span id="CifWriter-1442"><a href="#CifWriter-1442"><span class="linenos">1442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifWriter-1443"><a href="#CifWriter-1443"><span class="linenos">1443</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cf</span>
</span><span id="CifWriter-1444"><a href="#CifWriter-1444"><span class="linenos">1444</span></a>
</span><span id="CifWriter-1445"><a href="#CifWriter-1445"><span class="linenos">1445</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CifWriter-1446"><a href="#CifWriter-1446"><span class="linenos">1446</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifWriter-1447"><a href="#CifWriter-1447"><span class="linenos">1447</span></a><span class="sd">        Returns the cif as a string.</span>
</span><span id="CifWriter-1448"><a href="#CifWriter-1448"><span class="linenos">1448</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifWriter-1449"><a href="#CifWriter-1449"><span class="linenos">1449</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cf</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
</span><span id="CifWriter-1450"><a href="#CifWriter-1450"><span class="linenos">1450</span></a>
</span><span id="CifWriter-1451"><a href="#CifWriter-1451"><span class="linenos">1451</span></a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="CifWriter-1452"><a href="#CifWriter-1452"><span class="linenos">1452</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifWriter-1453"><a href="#CifWriter-1453"><span class="linenos">1453</span></a><span class="sd">        Write the cif file.</span>
</span><span id="CifWriter-1454"><a href="#CifWriter-1454"><span class="linenos">1454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifWriter-1455"><a href="#CifWriter-1455"><span class="linenos">1455</span></a>        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="CifWriter-1456"><a href="#CifWriter-1456"><span class="linenos">1456</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>A wrapper around CifFile to write CIF files from pymatgen structures.</p>
</div>


                            <div id="CifWriter.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifWriter.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">CifWriter</span><span class="signature">(
    struct,
    symprec=None,
    write_magmoms=False,
    significant_figures=8,
    angle_tolerance=5.0,
    refine_struct=True
)</span>
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifWriter.__init__-1257"><a href="#CifWriter.__init__-1257"><span class="linenos">1257</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CifWriter.__init__-1258"><a href="#CifWriter.__init__-1258"><span class="linenos">1258</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1259"><a href="#CifWriter.__init__-1259"><span class="linenos">1259</span></a>        <span class="n">struct</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1260"><a href="#CifWriter.__init__-1260"><span class="linenos">1260</span></a>        <span class="n">symprec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1261"><a href="#CifWriter.__init__-1261"><span class="linenos">1261</span></a>        <span class="n">write_magmoms</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1262"><a href="#CifWriter.__init__-1262"><span class="linenos">1262</span></a>        <span class="n">significant_figures</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1263"><a href="#CifWriter.__init__-1263"><span class="linenos">1263</span></a>        <span class="n">angle_tolerance</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1264"><a href="#CifWriter.__init__-1264"><span class="linenos">1264</span></a>        <span class="n">refine_struct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1265"><a href="#CifWriter.__init__-1265"><span class="linenos">1265</span></a>    <span class="p">):</span>
</span><span id="CifWriter.__init__-1266"><a href="#CifWriter.__init__-1266"><span class="linenos">1266</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifWriter.__init__-1267"><a href="#CifWriter.__init__-1267"><span class="linenos">1267</span></a><span class="sd">        Args:</span>
</span><span id="CifWriter.__init__-1268"><a href="#CifWriter.__init__-1268"><span class="linenos">1268</span></a><span class="sd">            struct (Structure): structure to write</span>
</span><span id="CifWriter.__init__-1269"><a href="#CifWriter.__init__-1269"><span class="linenos">1269</span></a><span class="sd">            symprec (float): If not none, finds the symmetry of the structure</span>
</span><span id="CifWriter.__init__-1270"><a href="#CifWriter.__init__-1270"><span class="linenos">1270</span></a><span class="sd">                and writes the cif with symmetry information. Passes symprec</span>
</span><span id="CifWriter.__init__-1271"><a href="#CifWriter.__init__-1271"><span class="linenos">1271</span></a><span class="sd">                to the SpacegroupAnalyzer. See also refine_struct.</span>
</span><span id="CifWriter.__init__-1272"><a href="#CifWriter.__init__-1272"><span class="linenos">1272</span></a><span class="sd">            write_magmoms (bool): If True, will write magCIF file. Incompatible</span>
</span><span id="CifWriter.__init__-1273"><a href="#CifWriter.__init__-1273"><span class="linenos">1273</span></a><span class="sd">                with symprec</span>
</span><span id="CifWriter.__init__-1274"><a href="#CifWriter.__init__-1274"><span class="linenos">1274</span></a><span class="sd">            significant_figures (int): Specifies precision for formatting of floats.</span>
</span><span id="CifWriter.__init__-1275"><a href="#CifWriter.__init__-1275"><span class="linenos">1275</span></a><span class="sd">                Defaults to 8.</span>
</span><span id="CifWriter.__init__-1276"><a href="#CifWriter.__init__-1276"><span class="linenos">1276</span></a><span class="sd">            angle_tolerance (float): Angle tolerance for symmetry finding. Passes</span>
</span><span id="CifWriter.__init__-1277"><a href="#CifWriter.__init__-1277"><span class="linenos">1277</span></a><span class="sd">                angle_tolerance to the SpacegroupAnalyzer. Used only if symprec</span>
</span><span id="CifWriter.__init__-1278"><a href="#CifWriter.__init__-1278"><span class="linenos">1278</span></a><span class="sd">                is not None.</span>
</span><span id="CifWriter.__init__-1279"><a href="#CifWriter.__init__-1279"><span class="linenos">1279</span></a><span class="sd">            refine_struct: Used only if symprec is not None. If True, get_refined_structure</span>
</span><span id="CifWriter.__init__-1280"><a href="#CifWriter.__init__-1280"><span class="linenos">1280</span></a><span class="sd">                is invoked to convert input structure from primitive to conventional.</span>
</span><span id="CifWriter.__init__-1281"><a href="#CifWriter.__init__-1281"><span class="linenos">1281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifWriter.__init__-1282"><a href="#CifWriter.__init__-1282"><span class="linenos">1282</span></a>
</span><span id="CifWriter.__init__-1283"><a href="#CifWriter.__init__-1283"><span class="linenos">1283</span></a>        <span class="k">if</span> <span class="n">write_magmoms</span> <span class="ow">and</span> <span class="n">symprec</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1284"><a href="#CifWriter.__init__-1284"><span class="linenos">1284</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Magnetic symmetry cannot currently be detected by pymatgen,disabling symmetry detection.&quot;</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1285"><a href="#CifWriter.__init__-1285"><span class="linenos">1285</span></a>            <span class="n">symprec</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CifWriter.__init__-1286"><a href="#CifWriter.__init__-1286"><span class="linenos">1286</span></a>
</span><span id="CifWriter.__init__-1287"><a href="#CifWriter.__init__-1287"><span class="linenos">1287</span></a>        <span class="n">format_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">:.</span><span class="si">{</span><span class="n">significant_figures</span><span class="si">}</span><span class="s2">f</span><span class="se">}}</span><span class="s2">&quot;</span>
</span><span id="CifWriter.__init__-1288"><a href="#CifWriter.__init__-1288"><span class="linenos">1288</span></a>
</span><span id="CifWriter.__init__-1289"><a href="#CifWriter.__init__-1289"><span class="linenos">1289</span></a>        <span class="n">block</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifWriter.__init__-1290"><a href="#CifWriter.__init__-1290"><span class="linenos">1290</span></a>        <span class="n">loops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1291"><a href="#CifWriter.__init__-1291"><span class="linenos">1291</span></a>        <span class="n">spacegroup</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P 1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1292"><a href="#CifWriter.__init__-1292"><span class="linenos">1292</span></a>        <span class="k">if</span> <span class="n">symprec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1293"><a href="#CifWriter.__init__-1293"><span class="linenos">1293</span></a>            <span class="n">sf</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">symprec</span><span class="p">,</span> <span class="n">angle_tolerance</span><span class="o">=</span><span class="n">angle_tolerance</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1294"><a href="#CifWriter.__init__-1294"><span class="linenos">1294</span></a>            <span class="n">spacegroup</span> <span class="o">=</span> <span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">get_space_group_symbol</span><span class="p">(),</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_space_group_number</span><span class="p">())</span>
</span><span id="CifWriter.__init__-1295"><a href="#CifWriter.__init__-1295"><span class="linenos">1295</span></a>
</span><span id="CifWriter.__init__-1296"><a href="#CifWriter.__init__-1296"><span class="linenos">1296</span></a>            <span class="k">if</span> <span class="n">refine_struct</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1297"><a href="#CifWriter.__init__-1297"><span class="linenos">1297</span></a>                <span class="c1"># Needs the refined structure when using symprec. This converts</span>
</span><span id="CifWriter.__init__-1298"><a href="#CifWriter.__init__-1298"><span class="linenos">1298</span></a>                <span class="c1"># primitive to conventional structures, the standard for CIF.</span>
</span><span id="CifWriter.__init__-1299"><a href="#CifWriter.__init__-1299"><span class="linenos">1299</span></a>                <span class="n">struct</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_refined_structure</span><span class="p">()</span>
</span><span id="CifWriter.__init__-1300"><a href="#CifWriter.__init__-1300"><span class="linenos">1300</span></a>
</span><span id="CifWriter.__init__-1301"><a href="#CifWriter.__init__-1301"><span class="linenos">1301</span></a>        <span class="n">latt</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">lattice</span>
</span><span id="CifWriter.__init__-1302"><a href="#CifWriter.__init__-1302"><span class="linenos">1302</span></a>        <span class="n">comp</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">composition</span>
</span><span id="CifWriter.__init__-1303"><a href="#CifWriter.__init__-1303"><span class="linenos">1303</span></a>        <span class="n">no_oxi_comp</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">element_composition</span>
</span><span id="CifWriter.__init__-1304"><a href="#CifWriter.__init__-1304"><span class="linenos">1304</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_space_group_name_H-M&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spacegroup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CifWriter.__init__-1305"><a href="#CifWriter.__init__-1305"><span class="linenos">1305</span></a>        <span class="k">for</span> <span class="n">cell_attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]:</span>
</span><span id="CifWriter.__init__-1306"><a href="#CifWriter.__init__-1306"><span class="linenos">1306</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_cell_length_&quot;</span> <span class="o">+</span> <span class="n">cell_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">latt</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1307"><a href="#CifWriter.__init__-1307"><span class="linenos">1307</span></a>        <span class="k">for</span> <span class="n">cell_attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">]:</span>
</span><span id="CifWriter.__init__-1308"><a href="#CifWriter.__init__-1308"><span class="linenos">1308</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_cell_angle_&quot;</span> <span class="o">+</span> <span class="n">cell_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">latt</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1309"><a href="#CifWriter.__init__-1309"><span class="linenos">1309</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_Int_Tables_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spacegroup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CifWriter.__init__-1310"><a href="#CifWriter.__init__-1310"><span class="linenos">1310</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_chemical_formula_structural&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no_oxi_comp</span><span class="o">.</span><span class="n">reduced_formula</span>
</span><span id="CifWriter.__init__-1311"><a href="#CifWriter.__init__-1311"><span class="linenos">1311</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_chemical_formula_sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no_oxi_comp</span><span class="o">.</span><span class="n">formula</span>
</span><span id="CifWriter.__init__-1312"><a href="#CifWriter.__init__-1312"><span class="linenos">1312</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_cell_volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latt</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1313"><a href="#CifWriter.__init__-1313"><span class="linenos">1313</span></a>
</span><span id="CifWriter.__init__-1314"><a href="#CifWriter.__init__-1314"><span class="linenos">1314</span></a>        <span class="n">reduced_comp</span><span class="p">,</span> <span class="n">fu</span> <span class="o">=</span> <span class="n">no_oxi_comp</span><span class="o">.</span><span class="n">get_reduced_composition_and_factor</span><span class="p">()</span>
</span><span id="CifWriter.__init__-1315"><a href="#CifWriter.__init__-1315"><span class="linenos">1315</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_cell_formula_units_Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fu</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1316"><a href="#CifWriter.__init__-1316"><span class="linenos">1316</span></a>
</span><span id="CifWriter.__init__-1317"><a href="#CifWriter.__init__-1317"><span class="linenos">1317</span></a>        <span class="k">if</span> <span class="n">symprec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1318"><a href="#CifWriter.__init__-1318"><span class="linenos">1318</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_equiv_pos_site_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]</span>
</span><span id="CifWriter.__init__-1319"><a href="#CifWriter.__init__-1319"><span class="linenos">1319</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_equiv_pos_as_xyz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x, y, z&quot;</span><span class="p">]</span>
</span><span id="CifWriter.__init__-1320"><a href="#CifWriter.__init__-1320"><span class="linenos">1320</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1321"><a href="#CifWriter.__init__-1321"><span class="linenos">1321</span></a>            <span class="n">sf</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">symprec</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1322"><a href="#CifWriter.__init__-1322"><span class="linenos">1322</span></a>
</span><span id="CifWriter.__init__-1323"><a href="#CifWriter.__init__-1323"><span class="linenos">1323</span></a>            <span class="n">symmops</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1324"><a href="#CifWriter.__init__-1324"><span class="linenos">1324</span></a>            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_symmetry_operations</span><span class="p">():</span>
</span><span id="CifWriter.__init__-1325"><a href="#CifWriter.__init__-1325"><span class="linenos">1325</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">translation_vector</span>
</span><span id="CifWriter.__init__-1326"><a href="#CifWriter.__init__-1326"><span class="linenos">1326</span></a>                <span class="n">symmops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SymmOp</span><span class="o">.</span><span class="n">from_rotation_and_translation</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1327"><a href="#CifWriter.__init__-1327"><span class="linenos">1327</span></a>
</span><span id="CifWriter.__init__-1328"><a href="#CifWriter.__init__-1328"><span class="linenos">1328</span></a>            <span class="n">ops</span> <span class="o">=</span> <span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">as_xyz_string</span><span class="p">()</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">symmops</span><span class="p">]</span>
</span><span id="CifWriter.__init__-1329"><a href="#CifWriter.__init__-1329"><span class="linenos">1329</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_equiv_pos_site_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ops</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="CifWriter.__init__-1330"><a href="#CifWriter.__init__-1330"><span class="linenos">1330</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_symmetry_equiv_pos_as_xyz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ops</span>
</span><span id="CifWriter.__init__-1331"><a href="#CifWriter.__init__-1331"><span class="linenos">1331</span></a>
</span><span id="CifWriter.__init__-1332"><a href="#CifWriter.__init__-1332"><span class="linenos">1332</span></a>        <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;_symmetry_equiv_pos_site_id&quot;</span><span class="p">,</span> <span class="s2">&quot;_symmetry_equiv_pos_as_xyz&quot;</span><span class="p">])</span>
</span><span id="CifWriter.__init__-1333"><a href="#CifWriter.__init__-1333"><span class="linenos">1333</span></a>
</span><span id="CifWriter.__init__-1334"><a href="#CifWriter.__init__-1334"><span class="linenos">1334</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1335"><a href="#CifWriter.__init__-1335"><span class="linenos">1335</span></a>            <span class="n">symbol_to_oxinum</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="o">.</span><span class="fm">__str__</span><span class="p">():</span> <span class="nb">float</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">oxi_state</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">elements</span><span class="p">)}</span>
</span><span id="CifWriter.__init__-1336"><a href="#CifWriter.__init__-1336"><span class="linenos">1336</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol_to_oxinum</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="CifWriter.__init__-1337"><a href="#CifWriter.__init__-1337"><span class="linenos">1337</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_type_oxidation_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol_to_oxinum</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="CifWriter.__init__-1338"><a href="#CifWriter.__init__-1338"><span class="linenos">1338</span></a>            <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;_atom_type_symbol&quot;</span><span class="p">,</span> <span class="s2">&quot;_atom_type_oxidation_number&quot;</span><span class="p">])</span>
</span><span id="CifWriter.__init__-1339"><a href="#CifWriter.__init__-1339"><span class="linenos">1339</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
</span><span id="CifWriter.__init__-1340"><a href="#CifWriter.__init__-1340"><span class="linenos">1340</span></a>            <span class="n">symbol_to_oxinum</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="o">.</span><span class="n">symbol</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">elements</span><span class="p">)}</span>
</span><span id="CifWriter.__init__-1341"><a href="#CifWriter.__init__-1341"><span class="linenos">1341</span></a>
</span><span id="CifWriter.__init__-1342"><a href="#CifWriter.__init__-1342"><span class="linenos">1342</span></a>        <span class="n">atom_site_type_symbol</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1343"><a href="#CifWriter.__init__-1343"><span class="linenos">1343</span></a>        <span class="n">atom_site_symmetry_multiplicity</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1344"><a href="#CifWriter.__init__-1344"><span class="linenos">1344</span></a>        <span class="n">atom_site_fract_x</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1345"><a href="#CifWriter.__init__-1345"><span class="linenos">1345</span></a>        <span class="n">atom_site_fract_y</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1346"><a href="#CifWriter.__init__-1346"><span class="linenos">1346</span></a>        <span class="n">atom_site_fract_z</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1347"><a href="#CifWriter.__init__-1347"><span class="linenos">1347</span></a>        <span class="n">atom_site_label</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1348"><a href="#CifWriter.__init__-1348"><span class="linenos">1348</span></a>        <span class="n">atom_site_occupancy</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1349"><a href="#CifWriter.__init__-1349"><span class="linenos">1349</span></a>        <span class="n">atom_site_moment_label</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1350"><a href="#CifWriter.__init__-1350"><span class="linenos">1350</span></a>        <span class="n">atom_site_moment_crystalaxis_x</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1351"><a href="#CifWriter.__init__-1351"><span class="linenos">1351</span></a>        <span class="n">atom_site_moment_crystalaxis_y</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1352"><a href="#CifWriter.__init__-1352"><span class="linenos">1352</span></a>        <span class="n">atom_site_moment_crystalaxis_z</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CifWriter.__init__-1353"><a href="#CifWriter.__init__-1353"><span class="linenos">1353</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CifWriter.__init__-1354"><a href="#CifWriter.__init__-1354"><span class="linenos">1354</span></a>        <span class="k">if</span> <span class="n">symprec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1355"><a href="#CifWriter.__init__-1355"><span class="linenos">1355</span></a>            <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">struct</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1356"><a href="#CifWriter.__init__-1356"><span class="linenos">1356</span></a>                <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">occu</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="CifWriter.__init__-1357"><a href="#CifWriter.__init__-1357"><span class="linenos">1357</span></a>                    <span class="n">atom_site_type_symbol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="CifWriter.__init__-1358"><a href="#CifWriter.__init__-1358"><span class="linenos">1358</span></a>                    <span class="n">atom_site_symmetry_multiplicity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1359"><a href="#CifWriter.__init__-1359"><span class="linenos">1359</span></a>                    <span class="n">atom_site_fract_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">a</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1360"><a href="#CifWriter.__init__-1360"><span class="linenos">1360</span></a>                    <span class="n">atom_site_fract_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1361"><a href="#CifWriter.__init__-1361"><span class="linenos">1361</span></a>                    <span class="n">atom_site_fract_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1362"><a href="#CifWriter.__init__-1362"><span class="linenos">1362</span></a>                    <span class="n">atom_site_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sp</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1363"><a href="#CifWriter.__init__-1363"><span class="linenos">1363</span></a>                    <span class="n">atom_site_occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">occu</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="CifWriter.__init__-1364"><a href="#CifWriter.__init__-1364"><span class="linenos">1364</span></a>
</span><span id="CifWriter.__init__-1365"><a href="#CifWriter.__init__-1365"><span class="linenos">1365</span></a>                    <span class="n">magmom</span> <span class="o">=</span> <span class="n">Magmom</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;magmom&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</span><span id="CifWriter.__init__-1366"><a href="#CifWriter.__init__-1366"><span class="linenos">1366</span></a>                    <span class="k">if</span> <span class="n">write_magmoms</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">magmom</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1367"><a href="#CifWriter.__init__-1367"><span class="linenos">1367</span></a>                        <span class="n">moment</span> <span class="o">=</span> <span class="n">Magmom</span><span class="o">.</span><span class="n">get_moment_relative_to_crystal_axes</span><span class="p">(</span><span class="n">magmom</span><span class="p">,</span> <span class="n">latt</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1368"><a href="#CifWriter.__init__-1368"><span class="linenos">1368</span></a>                        <span class="n">atom_site_moment_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sp</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1369"><a href="#CifWriter.__init__-1369"><span class="linenos">1369</span></a>                        <span class="n">atom_site_moment_crystalaxis_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">moment</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="CifWriter.__init__-1370"><a href="#CifWriter.__init__-1370"><span class="linenos">1370</span></a>                        <span class="n">atom_site_moment_crystalaxis_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">moment</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="CifWriter.__init__-1371"><a href="#CifWriter.__init__-1371"><span class="linenos">1371</span></a>                        <span class="n">atom_site_moment_crystalaxis_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">moment</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="CifWriter.__init__-1372"><a href="#CifWriter.__init__-1372"><span class="linenos">1372</span></a>
</span><span id="CifWriter.__init__-1373"><a href="#CifWriter.__init__-1373"><span class="linenos">1373</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="CifWriter.__init__-1374"><a href="#CifWriter.__init__-1374"><span class="linenos">1374</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1375"><a href="#CifWriter.__init__-1375"><span class="linenos">1375</span></a>            <span class="c1"># The following just presents a deterministic ordering.</span>
</span><span id="CifWriter.__init__-1376"><a href="#CifWriter.__init__-1376"><span class="linenos">1376</span></a>            <span class="n">unique_sites</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CifWriter.__init__-1377"><a href="#CifWriter.__init__-1377"><span class="linenos">1377</span></a>                <span class="p">(</span>
</span><span id="CifWriter.__init__-1378"><a href="#CifWriter.__init__-1378"><span class="linenos">1378</span></a>                    <span class="nb">sorted</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="CifWriter.__init__-1379"><a href="#CifWriter.__init__-1379"><span class="linenos">1379</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">sites</span><span class="p">),</span>
</span><span id="CifWriter.__init__-1380"><a href="#CifWriter.__init__-1380"><span class="linenos">1380</span></a>                <span class="p">)</span>
</span><span id="CifWriter.__init__-1381"><a href="#CifWriter.__init__-1381"><span class="linenos">1381</span></a>                <span class="k">for</span> <span class="n">sites</span> <span class="ow">in</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_symmetrized_structure</span><span class="p">()</span><span class="o">.</span><span class="n">equivalent_sites</span>
</span><span id="CifWriter.__init__-1382"><a href="#CifWriter.__init__-1382"><span class="linenos">1382</span></a>            <span class="p">]</span>
</span><span id="CifWriter.__init__-1383"><a href="#CifWriter.__init__-1383"><span class="linenos">1383</span></a>            <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">mult</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="CifWriter.__init__-1384"><a href="#CifWriter.__init__-1384"><span class="linenos">1384</span></a>                <span class="n">unique_sites</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1385"><a href="#CifWriter.__init__-1385"><span class="linenos">1385</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">(</span>
</span><span id="CifWriter.__init__-1386"><a href="#CifWriter.__init__-1386"><span class="linenos">1386</span></a>                    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">average_electroneg</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1387"><a href="#CifWriter.__init__-1387"><span class="linenos">1387</span></a>                    <span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="CifWriter.__init__-1388"><a href="#CifWriter.__init__-1388"><span class="linenos">1388</span></a>                    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">a</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1389"><a href="#CifWriter.__init__-1389"><span class="linenos">1389</span></a>                    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1390"><a href="#CifWriter.__init__-1390"><span class="linenos">1390</span></a>                    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1391"><a href="#CifWriter.__init__-1391"><span class="linenos">1391</span></a>                <span class="p">),</span>
</span><span id="CifWriter.__init__-1392"><a href="#CifWriter.__init__-1392"><span class="linenos">1392</span></a>            <span class="p">):</span>
</span><span id="CifWriter.__init__-1393"><a href="#CifWriter.__init__-1393"><span class="linenos">1393</span></a>                <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">occu</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CifWriter.__init__-1394"><a href="#CifWriter.__init__-1394"><span class="linenos">1394</span></a>                    <span class="n">atom_site_type_symbol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="CifWriter.__init__-1395"><a href="#CifWriter.__init__-1395"><span class="linenos">1395</span></a>                    <span class="n">atom_site_symmetry_multiplicity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mult</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1396"><a href="#CifWriter.__init__-1396"><span class="linenos">1396</span></a>                    <span class="n">atom_site_fract_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">a</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1397"><a href="#CifWriter.__init__-1397"><span class="linenos">1397</span></a>                    <span class="n">atom_site_fract_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1398"><a href="#CifWriter.__init__-1398"><span class="linenos">1398</span></a>                    <span class="n">atom_site_fract_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
</span><span id="CifWriter.__init__-1399"><a href="#CifWriter.__init__-1399"><span class="linenos">1399</span></a>                    <span class="n">atom_site_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sp</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1400"><a href="#CifWriter.__init__-1400"><span class="linenos">1400</span></a>                    <span class="n">atom_site_occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">occu</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="CifWriter.__init__-1401"><a href="#CifWriter.__init__-1401"><span class="linenos">1401</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="CifWriter.__init__-1402"><a href="#CifWriter.__init__-1402"><span class="linenos">1402</span></a>
</span><span id="CifWriter.__init__-1403"><a href="#CifWriter.__init__-1403"><span class="linenos">1403</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_type_symbol</span>
</span><span id="CifWriter.__init__-1404"><a href="#CifWriter.__init__-1404"><span class="linenos">1404</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_label</span>
</span><span id="CifWriter.__init__-1405"><a href="#CifWriter.__init__-1405"><span class="linenos">1405</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_symmetry_multiplicity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_symmetry_multiplicity</span>
</span><span id="CifWriter.__init__-1406"><a href="#CifWriter.__init__-1406"><span class="linenos">1406</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_fract_x</span>
</span><span id="CifWriter.__init__-1407"><a href="#CifWriter.__init__-1407"><span class="linenos">1407</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_fract_y</span>
</span><span id="CifWriter.__init__-1408"><a href="#CifWriter.__init__-1408"><span class="linenos">1408</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_fract_z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_fract_z</span>
</span><span id="CifWriter.__init__-1409"><a href="#CifWriter.__init__-1409"><span class="linenos">1409</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_occupancy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_occupancy</span>
</span><span id="CifWriter.__init__-1410"><a href="#CifWriter.__init__-1410"><span class="linenos">1410</span></a>        <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CifWriter.__init__-1411"><a href="#CifWriter.__init__-1411"><span class="linenos">1411</span></a>            <span class="p">[</span>
</span><span id="CifWriter.__init__-1412"><a href="#CifWriter.__init__-1412"><span class="linenos">1412</span></a>                <span class="s2">&quot;_atom_site_type_symbol&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1413"><a href="#CifWriter.__init__-1413"><span class="linenos">1413</span></a>                <span class="s2">&quot;_atom_site_label&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1414"><a href="#CifWriter.__init__-1414"><span class="linenos">1414</span></a>                <span class="s2">&quot;_atom_site_symmetry_multiplicity&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1415"><a href="#CifWriter.__init__-1415"><span class="linenos">1415</span></a>                <span class="s2">&quot;_atom_site_fract_x&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1416"><a href="#CifWriter.__init__-1416"><span class="linenos">1416</span></a>                <span class="s2">&quot;_atom_site_fract_y&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1417"><a href="#CifWriter.__init__-1417"><span class="linenos">1417</span></a>                <span class="s2">&quot;_atom_site_fract_z&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1418"><a href="#CifWriter.__init__-1418"><span class="linenos">1418</span></a>                <span class="s2">&quot;_atom_site_occupancy&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1419"><a href="#CifWriter.__init__-1419"><span class="linenos">1419</span></a>            <span class="p">]</span>
</span><span id="CifWriter.__init__-1420"><a href="#CifWriter.__init__-1420"><span class="linenos">1420</span></a>        <span class="p">)</span>
</span><span id="CifWriter.__init__-1421"><a href="#CifWriter.__init__-1421"><span class="linenos">1421</span></a>        <span class="k">if</span> <span class="n">write_magmoms</span><span class="p">:</span>
</span><span id="CifWriter.__init__-1422"><a href="#CifWriter.__init__-1422"><span class="linenos">1422</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_moment_label</span>
</span><span id="CifWriter.__init__-1423"><a href="#CifWriter.__init__-1423"><span class="linenos">1423</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_moment_crystalaxis_x</span>
</span><span id="CifWriter.__init__-1424"><a href="#CifWriter.__init__-1424"><span class="linenos">1424</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_moment_crystalaxis_y</span>
</span><span id="CifWriter.__init__-1425"><a href="#CifWriter.__init__-1425"><span class="linenos">1425</span></a>            <span class="n">block</span><span class="p">[</span><span class="s2">&quot;_atom_site_moment_crystalaxis_z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_site_moment_crystalaxis_z</span>
</span><span id="CifWriter.__init__-1426"><a href="#CifWriter.__init__-1426"><span class="linenos">1426</span></a>            <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CifWriter.__init__-1427"><a href="#CifWriter.__init__-1427"><span class="linenos">1427</span></a>                <span class="p">[</span>
</span><span id="CifWriter.__init__-1428"><a href="#CifWriter.__init__-1428"><span class="linenos">1428</span></a>                    <span class="s2">&quot;_atom_site_moment_label&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1429"><a href="#CifWriter.__init__-1429"><span class="linenos">1429</span></a>                    <span class="s2">&quot;_atom_site_moment_crystalaxis_x&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1430"><a href="#CifWriter.__init__-1430"><span class="linenos">1430</span></a>                    <span class="s2">&quot;_atom_site_moment_crystalaxis_y&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1431"><a href="#CifWriter.__init__-1431"><span class="linenos">1431</span></a>                    <span class="s2">&quot;_atom_site_moment_crystalaxis_z&quot;</span><span class="p">,</span>
</span><span id="CifWriter.__init__-1432"><a href="#CifWriter.__init__-1432"><span class="linenos">1432</span></a>                <span class="p">]</span>
</span><span id="CifWriter.__init__-1433"><a href="#CifWriter.__init__-1433"><span class="linenos">1433</span></a>            <span class="p">)</span>
</span><span id="CifWriter.__init__-1434"><a href="#CifWriter.__init__-1434"><span class="linenos">1434</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CifWriter.__init__-1435"><a href="#CifWriter.__init__-1435"><span class="linenos">1435</span></a>        <span class="n">d</span><span class="p">[</span><span class="n">comp</span><span class="o">.</span><span class="n">reduced_formula</span><span class="p">]</span> <span class="o">=</span> <span class="n">CifBlock</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">loops</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">reduced_formula</span><span class="p">)</span>
</span><span id="CifWriter.__init__-1436"><a href="#CifWriter.__init__-1436"><span class="linenos">1436</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cf</span> <span class="o">=</span> <span class="n">CifFile</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Args:
    struct (Structure): structure to write
    symprec (float): If not none, finds the symmetry of the structure
        and writes the cif with symmetry information. Passes symprec
        to the SpacegroupAnalyzer. See also refine_struct.
    write_magmoms (bool): If True, will write magCIF file. Incompatible
        with symprec
    significant_figures (int): Specifies precision for formatting of floats.
        Defaults to 8.
    angle_tolerance (float): Angle tolerance for symmetry finding. Passes
        angle_tolerance to the SpacegroupAnalyzer. Used only if symprec
        is not None.
    refine_struct: Used only if symprec is not None. If True, get_refined_structure
        is invoked to convert input structure from primitive to conventional.</p>
</div>


                            </div>
                            <div id="CifWriter.ciffile" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#CifWriter.ciffile">#&nbsp;&nbsp</a>

        <span class="name">ciffile</span>
    </div>

    
            <div class="docstring"><p>Returns: CifFile associated with the CifWriter.</p>
</div>


                            </div>
                            <div id="CifWriter.write_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CifWriter.write_file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">write_file</span><span class="signature">(self, filename)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CifWriter.write_file-1451"><a href="#CifWriter.write_file-1451"><span class="linenos">1451</span></a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="CifWriter.write_file-1452"><a href="#CifWriter.write_file-1452"><span class="linenos">1452</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CifWriter.write_file-1453"><a href="#CifWriter.write_file-1453"><span class="linenos">1453</span></a><span class="sd">        Write the cif file.</span>
</span><span id="CifWriter.write_file-1454"><a href="#CifWriter.write_file-1454"><span class="linenos">1454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CifWriter.write_file-1455"><a href="#CifWriter.write_file-1455"><span class="linenos">1455</span></a>        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="CifWriter.write_file-1456"><a href="#CifWriter.write_file-1456"><span class="linenos">1456</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Write the cif file.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>