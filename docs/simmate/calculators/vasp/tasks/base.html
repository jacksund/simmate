<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.2"/>
    <title>simmate.calculators.vasp.tasks.base API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../tasks.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simmate.calculators.vasp.tasks</a>

<a href="https://github.com/jacksund/simmate">            <img src="https://github.com/jacksund/simmate/blob/main/src/simmate/website/static_files/images/simmate-logo.svg?raw=true" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="function" href="#get_default_parallel_settings">get_default_parallel_settings</a>
            </li>
            <li>
                    <a class="class" href="#VaspTask">VaspTask</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#VaspTask.requires_structure">requires_structure</a>
                        </li>
                        <li>
                                <a class="variable" href="#VaspTask.command">command</a>
                        </li>
                        <li>
                                <a class="variable" href="#VaspTask.incar">incar</a>
                        </li>
                        <li>
                                <a class="variable" href="#VaspTask.incar_parallel_settings">incar_parallel_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#VaspTask.kpoints">kpoints</a>
                        </li>
                        <li>
                                <a class="variable" href="#VaspTask.functional">functional</a>
                        </li>
                        <li>
                                <a class="variable" href="#VaspTask.potcar_mappings">potcar_mappings</a>
                        </li>
                        <li>
                                <a class="variable" href="#VaspTask.confirm_convergence">confirm_convergence</a>
                        </li>
                        <li>
                                <a class="variable" href="#VaspTask.pre_sanitize_structure">pre_sanitize_structure</a>
                        </li>
                        <li>
                                <a class="variable" href="#VaspTask.pre_standardize_structure">pre_standardize_structure</a>
                        </li>
                        <li>
                                <a class="function" href="#VaspTask.setup">setup</a>
                        </li>
                        <li>
                                <a class="function" href="#VaspTask.workup">workup</a>
                        </li>
                        <li>
                                <a class="function" href="#VaspTask.get_config">get_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#check_for_standardization_bugs">check_for_standardization_bugs</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/calculators/vasp/tasks/base.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../../simmate.html">simmate</a><wbr>.<a href="./../../../calculators.html">calculators</a><wbr>.<a href="./../../vasp.html">vasp</a><wbr>.<a href="./../tasks.html">tasks</a><wbr>.base    </h1>

                
                        <input id="base-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="base-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">yaml</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">pymatgen.analysis.structure_matcher</span> <span class="kn">import</span> <span class="n">StructureMatcher</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">pymatgen.symmetry.analyzer</span> <span class="kn">import</span> <span class="n">SpacegroupAnalyzer</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">pymatgen.io.vasp.outputs</span> <span class="kn">import</span> <span class="n">Vasprun</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">simmate.calculators.vasp.inputs</span> <span class="kn">import</span> <span class="n">Incar</span><span class="p">,</span> <span class="n">Poscar</span><span class="p">,</span> <span class="n">Kpoints</span><span class="p">,</span> <span class="n">Potcar</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">simmate.workflow_engine</span> <span class="kn">import</span> <span class="n">S3Task</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="k">def</span> <span class="nf">get_default_parallel_settings</span><span class="p">():</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    We load the user&#39;s default parallel settings from</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">        ~/simmate/vasp/INCAR_parallel_settings</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    If this file doesn&#39;t exist, then we just use an empty dictionary.</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>    <span class="n">settings_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>        <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">(),</span> <span class="s2">&quot;simmate&quot;</span><span class="p">,</span> <span class="s2">&quot;vasp&quot;</span><span class="p">,</span> <span class="s2">&quot;INCAR_parallel_settings&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>    <span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">settings_filename</span><span class="p">):</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>        <span class="k">return</span> <span class="n">Incar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">settings_filename</span><span class="p">)</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="k">class</span> <span class="nc">VaspTask</span><span class="p">(</span><span class="n">S3Task</span><span class="p">):</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="n">requires_structure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    Vasp calculations always need an input structure, so this is always True.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="n">command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;vasp_std &gt; vasp.out&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    The command to call vasp, which is typically vasp_std. To ensure error</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    handlers work properly, make sure your command has &quot;&gt; vasp.out&quot; at the end.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="c1"># TODO: add support for grabbing a user-set default from their configuration</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="c1"># TODO: add auto check for vasp.out ending</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="n">incar</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    This sets the default vasp settings from a dictionary. This is the one thing</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    you *must* set when subclassing VaspTask. An example is:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        </span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    ``` python</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">      incar = dict(NSW=0, PREC=&quot;Accurate&quot;, KSPACING=0.5)</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    ```</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="n">incar_parallel_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">get_default_parallel_settings</span><span class="p">()</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    The parallel settings to add on to the base incar. These should not effect </span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    the calculation result in any way (only how fast it completes), but they </span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    are still selected based on the computer specs and what runs fastest on it.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    Therefore, these settings are loaded from ~/simmate/vasp/INCAR_parallel_settings</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    by default and adding to this file should be the preferred method for updating</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    these settings.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="c1"># TODO: add options for poscar formation</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="c1"># add_selective_dynamics=False</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="c1"># add_velocities=False</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="c1"># significant_figures=6 --&gt; rounding issues? what&#39;s the best way to do this?</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="n">kpoints</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    (experimental feature)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    The KptGrid or KptPath generator used to create the KPOINTS file. Note,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    this attribute is optional becuase VASP supports setting Kpts by adding</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    KSPACING to the INCAR. If KSPACING is set in the INCAR, we ignore whatever </span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    is set here.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="c1"># TODO - KptGrid is just a float for now, so there&#39;s no typing here.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="n">functional</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">    This directs which Potcar files to grab. You would set this to a string</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    of what you want, such as &quot;PBE&quot;, &quot;PBE_GW&quot;, or &quot;LDA&quot;.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="n">potcar_mappings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    This is an optional parameter to override Simmate&#39;s default selection of</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    potentials based off of the functional chosen. The defaults are located</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    in simmate.calculators.vasp.inputs.potcar_mappings. You can supply your</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    own mapping dictionary or update the specific potentials you&#39;d like. </span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    For example:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">    </span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    ``` python</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">      from simmate.calculators.vasp.inputs.potcar_mappings import PBE_ELEMENT_MAPPINGS</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">      element_mappings = PBE_ELEMENT_MAPPINGS.copy()  # don&#39;t forget to copy!</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">      element_mappings.update({&quot;C&quot;: &quot;C_h&quot;})  # if you wish to update any</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">    ```</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">    </span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">    or if you only use Carbon and don&#39;t care about other elements...</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">    </span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    ``` python</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">      element_mappings = {&quot;C&quot;: &quot;C_h&quot;}</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">    ```</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">    </span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">    Read more on this inside the Potcar class and be careful with updating!</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    <span class="n">confirm_convergence</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">    This flag controls whether or not we raise an error when the calculation </span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">    failed to converge. In somecases we still want results from calculations </span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">    that did NOT converge successfully.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="c1"># OPTIMIZE: What if I updated the ErrorHandler class to allow for &quot;warnings&quot;</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="c1"># instead of raising the error and applying the correction...? This functionality</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="c1"># could then be moved to the UnconvergedErrorHandler. I&#39;d have a fix_error=True</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="c1"># attribute that is used in the .check() method. and If fix_error=False, I</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="c1"># simply print a warning &amp; also add that warning to simmate_corrections.csv</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="n">pre_sanitize_structure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">    In some cases, we may want to sanitize the structure during our setup().</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">    This means converting to the LLL-reduced primitive cell. This simply does:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">    ``` python</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">    structure_sanitzed = structure.copy(santize=True)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">    ```</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="n">pre_standardize_structure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">    In some cases, we may want to convert the structure to the standard primitive</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">    of a structure. For example, this is required when calculating band structures</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">    and ensuring we have a standardized high-symmetry path.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">_get_clean_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">        Uses the class attributes for `pre_sanitize_structure` and</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        `pre_standardize_structure`. If either of these are set to True, then</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        the structure unitcell is converted using the proper methods.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        Note, this method is typically called within `setup` before any input</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        files are written. You should never have to call it directly.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="c1"># if both pre_standardize_structure and pre_sanitize_structure are set,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="c1"># we raise an error. I may want to change this in the future though</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_sanitize_structure</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_standardize_structure</span><span class="p">:</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                <span class="s2">&quot;For this VaspTask, only one of `pre_sanitize_structure` or &quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                <span class="s2">&quot; `pre_standardize_structure` can be set to True, not both.&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>            <span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="c1"># If requested, we convert to the LLL-reduced unit cell, which aims to</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="c1"># be as cubic as possible.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_sanitize_structure</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="n">structure_cleaned</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sanitize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>            <span class="k">return</span> <span class="n">structure_cleaned</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="c1"># For band structures, we need to make sure the structure is in the</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="c1"># standardized primitive form.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="c1"># We use the same SYMPREC from the INCAR, which is 1e-5 if not set.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_standardize_structure</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="n">sym_prec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SYMPREC&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="k">else</span> <span class="mf">1e-5</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="n">sym_finder</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">symprec</span><span class="o">=</span><span class="n">sym_prec</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>            <span class="n">structure_cleaned</span> <span class="o">=</span> <span class="n">sym_finder</span><span class="o">.</span><span class="n">get_primitive_standard_structure</span><span class="p">(</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>                <span class="n">international_monoclinic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="c1"># check for pymatgen bugs here</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>            <span class="n">check_for_standardization_bugs</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">structure_cleaned</span><span class="p">)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="k">return</span> <span class="n">structure_cleaned</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="c1"># if none of the flags above were used, then we just return the orignal</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="c1"># input structure.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="n">structure</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="c1"># run cleaning and standardizing on structure (based on class attributes)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="n">structure_cleaned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_clean_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="c1"># write the poscar file</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="n">Poscar</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">structure_cleaned</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">))</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="c1"># Combine our base incar settings with those of our parallelization settings</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="c1"># and then write the incar file</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">)</span> <span class="o">+</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_parallel_settings</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="n">incar</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;INCAR&quot;</span><span class="p">),</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="n">structure</span><span class="o">=</span><span class="n">structure_cleaned</span><span class="p">,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="c1"># if KSPACING is not provided in the incar AND kpoints is attached to this</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="c1"># class instance, then we write the KPOINTS file</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;KSPACING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>            <span class="n">Kpoints</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>                <span class="n">structure_cleaned</span><span class="p">,</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="p">,</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;KPOINTS&quot;</span><span class="p">),</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="c1"># write the POTCAR file</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="n">Potcar</span><span class="o">.</span><span class="n">to_file_from_type</span><span class="p">(</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="n">structure_cleaned</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">functional</span><span class="p">,</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;POTCAR&quot;</span><span class="p">),</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">potcar_mappings</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="nf">workup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        This is the most basic VASP workup where I simply load the final structure,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        final energy, and (if requested) confirm convergence. I will likely make</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        this a common function for this vasp module down the road.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="c1"># load the xml file and all of the vasprun data</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>            <span class="n">vasprun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">),</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>                <span class="n">exception_on_bad_xml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>                <span class="s2">&quot;XML is malformed. This typically means there&#39;s an error with your&quot;</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                <span class="s2">&quot; calculation that wasn&#39;t caught by your ErrorHandlers. We try&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>                <span class="s2">&quot; salvaging data here though.&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="n">vasprun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">),</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                <span class="n">exception_on_bad_xml</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="n">vasprun</span><span class="o">.</span><span class="n">final_structure</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="c1"># BUG: This try/except is 100% just for my really rough calculations</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="c1"># where I don&#39;t use any ErrorHandlers and still want the final structure</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="c1"># regarless of what when wrong. In the future, I should consider writing</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="c1"># a separate method for those that loads the CONTCAR and moves on.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="c1"># write output files/plots for the user to quickly reference</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_output_summary</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="c1"># confirm that the calculation converged (ionicly and electronically)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_convergence</span><span class="p">:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="k">assert</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">converged</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="c1"># return vasprun object</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="k">return</span> <span class="n">vasprun</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">_write_output_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span><span class="p">):</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        This prints a &quot;simmate_summary.yaml&quot; file with key output information.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        This method should not be called directly as it used within workup().</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="c1"># OPTIMIZE: Ideally, I could take the vasprun object and run to_json,</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="c1"># but this output is extremely difficult to read.</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="s2">&quot;structure_final&quot;</span><span class="p">:</span> <span class="s2">&quot;The final structure is located in the CONTCAR file&quot;</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="s2">&quot;energy_final&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;final_energy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="s2">&quot;energy_final_per_atom&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;final_energy_per_atom&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="s2">&quot;converged_electroinc&quot;</span><span class="p">:</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">converged_electronic</span><span class="p">,</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="s2">&quot;converged_ionic&quot;</span><span class="p">:</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">converged_ionic</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="s2">&quot;fermi_energy&quot;</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;efermi&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="s2">&quot;valence_band_maximum&quot;</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="s2">&quot;conduction_band_minimum&quot;</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="p">}</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="n">summary_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;simmate_summary.yaml&quot;</span><span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">summary_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        Grabs the overall settings from the class. This is useful for printing out</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        settings for users to inspect.</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="s2">&quot;__module__&quot;</span><span class="p">,</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                <span class="s2">&quot;pre_sanitize_structure&quot;</span><span class="p">,</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="s2">&quot;confirm_convergence&quot;</span><span class="p">,</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                <span class="s2">&quot;functional&quot;</span><span class="p">,</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                <span class="s2">&quot;incar&quot;</span><span class="p">,</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>                <span class="s2">&quot;potcar_mappings&quot;</span><span class="p">,</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="p">]</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="p">}</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="k">def</span> <span class="nf">check_for_standardization_bugs</span><span class="p">(</span><span class="n">structure_original</span><span class="p">,</span> <span class="n">structure_new</span><span class="p">):</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>    <span class="c1"># In pymatgen, they include this code with the standardization of their</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>    <span class="c1"># structures because there were several bugs in the past and they want to</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="c1"># double-check themselves. I&#39;m still using their code to standardize</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="c1"># my structures, so I should make this check too.</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>    <span class="n">vpa_old</span> <span class="o">=</span> <span class="n">structure_original</span><span class="o">.</span><span class="n">volume</span> <span class="o">/</span> <span class="n">structure_original</span><span class="o">.</span><span class="n">num_sites</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="n">vpa_new</span> <span class="o">=</span> <span class="n">structure_new</span><span class="o">.</span><span class="n">volume</span> <span class="o">/</span> <span class="n">structure_new</span><span class="o">.</span><span class="n">num_sites</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vpa_old</span> <span class="o">-</span> <span class="n">vpa_new</span><span class="p">)</span> <span class="o">/</span> <span class="n">vpa_old</span> <span class="o">&gt;</span> <span class="mf">0.02</span><span class="p">:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="s2">&quot;Standardizing failed! Volume-per-atom changed... &quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>            <span class="sa">f</span><span class="s2">&quot;old: </span><span class="si">{</span><span class="n">vpa_old</span><span class="si">}</span><span class="s2">, new: </span><span class="si">{</span><span class="n">vpa_new</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>    <span class="n">sm</span> <span class="o">=</span> <span class="n">StructureMatcher</span><span class="p">()</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">sm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">structure_original</span><span class="p">,</span> <span class="n">structure_new</span><span class="p">):</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Standardizing failed! Old structure doesn&#39;t match new.&quot;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="get_default_parallel_settings">
                            <input id="get_default_parallel_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_default_parallel_settings</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="get_default_parallel_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_default_parallel_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_default_parallel_settings-18"><a href="#get_default_parallel_settings-18"><span class="linenos">18</span></a><span class="k">def</span> <span class="nf">get_default_parallel_settings</span><span class="p">():</span>
</span><span id="get_default_parallel_settings-19"><a href="#get_default_parallel_settings-19"><span class="linenos">19</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_default_parallel_settings-20"><a href="#get_default_parallel_settings-20"><span class="linenos">20</span></a><span class="sd">    We load the user&#39;s default parallel settings from</span>
</span><span id="get_default_parallel_settings-21"><a href="#get_default_parallel_settings-21"><span class="linenos">21</span></a><span class="sd">        ~/simmate/vasp/INCAR_parallel_settings</span>
</span><span id="get_default_parallel_settings-22"><a href="#get_default_parallel_settings-22"><span class="linenos">22</span></a><span class="sd">    If this file doesn&#39;t exist, then we just use an empty dictionary.</span>
</span><span id="get_default_parallel_settings-23"><a href="#get_default_parallel_settings-23"><span class="linenos">23</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_default_parallel_settings-24"><a href="#get_default_parallel_settings-24"><span class="linenos">24</span></a>    <span class="n">settings_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="get_default_parallel_settings-25"><a href="#get_default_parallel_settings-25"><span class="linenos">25</span></a>        <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">(),</span> <span class="s2">&quot;simmate&quot;</span><span class="p">,</span> <span class="s2">&quot;vasp&quot;</span><span class="p">,</span> <span class="s2">&quot;INCAR_parallel_settings&quot;</span>
</span><span id="get_default_parallel_settings-26"><a href="#get_default_parallel_settings-26"><span class="linenos">26</span></a>    <span class="p">)</span>
</span><span id="get_default_parallel_settings-27"><a href="#get_default_parallel_settings-27"><span class="linenos">27</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">settings_filename</span><span class="p">):</span>
</span><span id="get_default_parallel_settings-28"><a href="#get_default_parallel_settings-28"><span class="linenos">28</span></a>        <span class="k">return</span> <span class="n">Incar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">settings_filename</span><span class="p">)</span>
</span><span id="get_default_parallel_settings-29"><a href="#get_default_parallel_settings-29"><span class="linenos">29</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_default_parallel_settings-30"><a href="#get_default_parallel_settings-30"><span class="linenos">30</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>We load the user's default parallel settings from
    ~/simmate/vasp/INCAR_parallel_settings
If this file doesn't exist, then we just use an empty dictionary.</p>
</div>


                </section>
                <section id="VaspTask">
                            <input id="VaspTask-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">VaspTask</span><wbr>(<span class="base"><a href="../../../workflow_engine/supervised_staged_shell_task.html#S3Task">simmate.workflow_engine.supervised_staged_shell_task.S3Task</a></span>):

                <label class="view-source-button" for="VaspTask-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VaspTask"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VaspTask-33"><a href="#VaspTask-33"><span class="linenos"> 33</span></a><span class="k">class</span> <span class="nc">VaspTask</span><span class="p">(</span><span class="n">S3Task</span><span class="p">):</span>
</span><span id="VaspTask-34"><a href="#VaspTask-34"><span class="linenos"> 34</span></a>
</span><span id="VaspTask-35"><a href="#VaspTask-35"><span class="linenos"> 35</span></a>    <span class="n">requires_structure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="VaspTask-36"><a href="#VaspTask-36"><span class="linenos"> 36</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-37"><a href="#VaspTask-37"><span class="linenos"> 37</span></a><span class="sd">    Vasp calculations always need an input structure, so this is always True.</span>
</span><span id="VaspTask-38"><a href="#VaspTask-38"><span class="linenos"> 38</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-39"><a href="#VaspTask-39"><span class="linenos"> 39</span></a>
</span><span id="VaspTask-40"><a href="#VaspTask-40"><span class="linenos"> 40</span></a>    <span class="n">command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;vasp_std &gt; vasp.out&quot;</span>
</span><span id="VaspTask-41"><a href="#VaspTask-41"><span class="linenos"> 41</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-42"><a href="#VaspTask-42"><span class="linenos"> 42</span></a><span class="sd">    The command to call vasp, which is typically vasp_std. To ensure error</span>
</span><span id="VaspTask-43"><a href="#VaspTask-43"><span class="linenos"> 43</span></a><span class="sd">    handlers work properly, make sure your command has &quot;&gt; vasp.out&quot; at the end.</span>
</span><span id="VaspTask-44"><a href="#VaspTask-44"><span class="linenos"> 44</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-45"><a href="#VaspTask-45"><span class="linenos"> 45</span></a>    <span class="c1"># TODO: add support for grabbing a user-set default from their configuration</span>
</span><span id="VaspTask-46"><a href="#VaspTask-46"><span class="linenos"> 46</span></a>    <span class="c1"># TODO: add auto check for vasp.out ending</span>
</span><span id="VaspTask-47"><a href="#VaspTask-47"><span class="linenos"> 47</span></a>
</span><span id="VaspTask-48"><a href="#VaspTask-48"><span class="linenos"> 48</span></a>    <span class="n">incar</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VaspTask-49"><a href="#VaspTask-49"><span class="linenos"> 49</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-50"><a href="#VaspTask-50"><span class="linenos"> 50</span></a><span class="sd">    This sets the default vasp settings from a dictionary. This is the one thing</span>
</span><span id="VaspTask-51"><a href="#VaspTask-51"><span class="linenos"> 51</span></a><span class="sd">    you *must* set when subclassing VaspTask. An example is:</span>
</span><span id="VaspTask-52"><a href="#VaspTask-52"><span class="linenos"> 52</span></a><span class="sd">        </span>
</span><span id="VaspTask-53"><a href="#VaspTask-53"><span class="linenos"> 53</span></a><span class="sd">    ``` python</span>
</span><span id="VaspTask-54"><a href="#VaspTask-54"><span class="linenos"> 54</span></a><span class="sd">      incar = dict(NSW=0, PREC=&quot;Accurate&quot;, KSPACING=0.5)</span>
</span><span id="VaspTask-55"><a href="#VaspTask-55"><span class="linenos"> 55</span></a><span class="sd">    ```</span>
</span><span id="VaspTask-56"><a href="#VaspTask-56"><span class="linenos"> 56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-57"><a href="#VaspTask-57"><span class="linenos"> 57</span></a>
</span><span id="VaspTask-58"><a href="#VaspTask-58"><span class="linenos"> 58</span></a>    <span class="n">incar_parallel_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">get_default_parallel_settings</span><span class="p">()</span>
</span><span id="VaspTask-59"><a href="#VaspTask-59"><span class="linenos"> 59</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-60"><a href="#VaspTask-60"><span class="linenos"> 60</span></a><span class="sd">    The parallel settings to add on to the base incar. These should not effect </span>
</span><span id="VaspTask-61"><a href="#VaspTask-61"><span class="linenos"> 61</span></a><span class="sd">    the calculation result in any way (only how fast it completes), but they </span>
</span><span id="VaspTask-62"><a href="#VaspTask-62"><span class="linenos"> 62</span></a><span class="sd">    are still selected based on the computer specs and what runs fastest on it.</span>
</span><span id="VaspTask-63"><a href="#VaspTask-63"><span class="linenos"> 63</span></a><span class="sd">    Therefore, these settings are loaded from ~/simmate/vasp/INCAR_parallel_settings</span>
</span><span id="VaspTask-64"><a href="#VaspTask-64"><span class="linenos"> 64</span></a><span class="sd">    by default and adding to this file should be the preferred method for updating</span>
</span><span id="VaspTask-65"><a href="#VaspTask-65"><span class="linenos"> 65</span></a><span class="sd">    these settings.</span>
</span><span id="VaspTask-66"><a href="#VaspTask-66"><span class="linenos"> 66</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-67"><a href="#VaspTask-67"><span class="linenos"> 67</span></a>
</span><span id="VaspTask-68"><a href="#VaspTask-68"><span class="linenos"> 68</span></a>    <span class="c1"># TODO: add options for poscar formation</span>
</span><span id="VaspTask-69"><a href="#VaspTask-69"><span class="linenos"> 69</span></a>    <span class="c1"># add_selective_dynamics=False</span>
</span><span id="VaspTask-70"><a href="#VaspTask-70"><span class="linenos"> 70</span></a>    <span class="c1"># add_velocities=False</span>
</span><span id="VaspTask-71"><a href="#VaspTask-71"><span class="linenos"> 71</span></a>    <span class="c1"># significant_figures=6 --&gt; rounding issues? what&#39;s the best way to do this?</span>
</span><span id="VaspTask-72"><a href="#VaspTask-72"><span class="linenos"> 72</span></a>
</span><span id="VaspTask-73"><a href="#VaspTask-73"><span class="linenos"> 73</span></a>    <span class="n">kpoints</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VaspTask-74"><a href="#VaspTask-74"><span class="linenos"> 74</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-75"><a href="#VaspTask-75"><span class="linenos"> 75</span></a><span class="sd">    (experimental feature)</span>
</span><span id="VaspTask-76"><a href="#VaspTask-76"><span class="linenos"> 76</span></a><span class="sd">    The KptGrid or KptPath generator used to create the KPOINTS file. Note,</span>
</span><span id="VaspTask-77"><a href="#VaspTask-77"><span class="linenos"> 77</span></a><span class="sd">    this attribute is optional becuase VASP supports setting Kpts by adding</span>
</span><span id="VaspTask-78"><a href="#VaspTask-78"><span class="linenos"> 78</span></a><span class="sd">    KSPACING to the INCAR. If KSPACING is set in the INCAR, we ignore whatever </span>
</span><span id="VaspTask-79"><a href="#VaspTask-79"><span class="linenos"> 79</span></a><span class="sd">    is set here.</span>
</span><span id="VaspTask-80"><a href="#VaspTask-80"><span class="linenos"> 80</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-81"><a href="#VaspTask-81"><span class="linenos"> 81</span></a>    <span class="c1"># TODO - KptGrid is just a float for now, so there&#39;s no typing here.</span>
</span><span id="VaspTask-82"><a href="#VaspTask-82"><span class="linenos"> 82</span></a>
</span><span id="VaspTask-83"><a href="#VaspTask-83"><span class="linenos"> 83</span></a>    <span class="n">functional</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VaspTask-84"><a href="#VaspTask-84"><span class="linenos"> 84</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-85"><a href="#VaspTask-85"><span class="linenos"> 85</span></a><span class="sd">    This directs which Potcar files to grab. You would set this to a string</span>
</span><span id="VaspTask-86"><a href="#VaspTask-86"><span class="linenos"> 86</span></a><span class="sd">    of what you want, such as &quot;PBE&quot;, &quot;PBE_GW&quot;, or &quot;LDA&quot;.</span>
</span><span id="VaspTask-87"><a href="#VaspTask-87"><span class="linenos"> 87</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-88"><a href="#VaspTask-88"><span class="linenos"> 88</span></a>
</span><span id="VaspTask-89"><a href="#VaspTask-89"><span class="linenos"> 89</span></a>    <span class="n">potcar_mappings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VaspTask-90"><a href="#VaspTask-90"><span class="linenos"> 90</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-91"><a href="#VaspTask-91"><span class="linenos"> 91</span></a><span class="sd">    This is an optional parameter to override Simmate&#39;s default selection of</span>
</span><span id="VaspTask-92"><a href="#VaspTask-92"><span class="linenos"> 92</span></a><span class="sd">    potentials based off of the functional chosen. The defaults are located</span>
</span><span id="VaspTask-93"><a href="#VaspTask-93"><span class="linenos"> 93</span></a><span class="sd">    in simmate.calculators.vasp.inputs.potcar_mappings. You can supply your</span>
</span><span id="VaspTask-94"><a href="#VaspTask-94"><span class="linenos"> 94</span></a><span class="sd">    own mapping dictionary or update the specific potentials you&#39;d like. </span>
</span><span id="VaspTask-95"><a href="#VaspTask-95"><span class="linenos"> 95</span></a><span class="sd">    For example:</span>
</span><span id="VaspTask-96"><a href="#VaspTask-96"><span class="linenos"> 96</span></a><span class="sd">    </span>
</span><span id="VaspTask-97"><a href="#VaspTask-97"><span class="linenos"> 97</span></a><span class="sd">    ``` python</span>
</span><span id="VaspTask-98"><a href="#VaspTask-98"><span class="linenos"> 98</span></a><span class="sd">      from simmate.calculators.vasp.inputs.potcar_mappings import PBE_ELEMENT_MAPPINGS</span>
</span><span id="VaspTask-99"><a href="#VaspTask-99"><span class="linenos"> 99</span></a><span class="sd">      element_mappings = PBE_ELEMENT_MAPPINGS.copy()  # don&#39;t forget to copy!</span>
</span><span id="VaspTask-100"><a href="#VaspTask-100"><span class="linenos">100</span></a><span class="sd">      element_mappings.update({&quot;C&quot;: &quot;C_h&quot;})  # if you wish to update any</span>
</span><span id="VaspTask-101"><a href="#VaspTask-101"><span class="linenos">101</span></a><span class="sd">    ```</span>
</span><span id="VaspTask-102"><a href="#VaspTask-102"><span class="linenos">102</span></a><span class="sd">    </span>
</span><span id="VaspTask-103"><a href="#VaspTask-103"><span class="linenos">103</span></a><span class="sd">    or if you only use Carbon and don&#39;t care about other elements...</span>
</span><span id="VaspTask-104"><a href="#VaspTask-104"><span class="linenos">104</span></a><span class="sd">    </span>
</span><span id="VaspTask-105"><a href="#VaspTask-105"><span class="linenos">105</span></a><span class="sd">    ``` python</span>
</span><span id="VaspTask-106"><a href="#VaspTask-106"><span class="linenos">106</span></a><span class="sd">      element_mappings = {&quot;C&quot;: &quot;C_h&quot;}</span>
</span><span id="VaspTask-107"><a href="#VaspTask-107"><span class="linenos">107</span></a><span class="sd">    ```</span>
</span><span id="VaspTask-108"><a href="#VaspTask-108"><span class="linenos">108</span></a><span class="sd">    </span>
</span><span id="VaspTask-109"><a href="#VaspTask-109"><span class="linenos">109</span></a><span class="sd">    Read more on this inside the Potcar class and be careful with updating!</span>
</span><span id="VaspTask-110"><a href="#VaspTask-110"><span class="linenos">110</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-111"><a href="#VaspTask-111"><span class="linenos">111</span></a>
</span><span id="VaspTask-112"><a href="#VaspTask-112"><span class="linenos">112</span></a>    <span class="n">confirm_convergence</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="VaspTask-113"><a href="#VaspTask-113"><span class="linenos">113</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-114"><a href="#VaspTask-114"><span class="linenos">114</span></a><span class="sd">    This flag controls whether or not we raise an error when the calculation </span>
</span><span id="VaspTask-115"><a href="#VaspTask-115"><span class="linenos">115</span></a><span class="sd">    failed to converge. In somecases we still want results from calculations </span>
</span><span id="VaspTask-116"><a href="#VaspTask-116"><span class="linenos">116</span></a><span class="sd">    that did NOT converge successfully.</span>
</span><span id="VaspTask-117"><a href="#VaspTask-117"><span class="linenos">117</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-118"><a href="#VaspTask-118"><span class="linenos">118</span></a>    <span class="c1"># OPTIMIZE: What if I updated the ErrorHandler class to allow for &quot;warnings&quot;</span>
</span><span id="VaspTask-119"><a href="#VaspTask-119"><span class="linenos">119</span></a>    <span class="c1"># instead of raising the error and applying the correction...? This functionality</span>
</span><span id="VaspTask-120"><a href="#VaspTask-120"><span class="linenos">120</span></a>    <span class="c1"># could then be moved to the UnconvergedErrorHandler. I&#39;d have a fix_error=True</span>
</span><span id="VaspTask-121"><a href="#VaspTask-121"><span class="linenos">121</span></a>    <span class="c1"># attribute that is used in the .check() method. and If fix_error=False, I</span>
</span><span id="VaspTask-122"><a href="#VaspTask-122"><span class="linenos">122</span></a>    <span class="c1"># simply print a warning &amp; also add that warning to simmate_corrections.csv</span>
</span><span id="VaspTask-123"><a href="#VaspTask-123"><span class="linenos">123</span></a>
</span><span id="VaspTask-124"><a href="#VaspTask-124"><span class="linenos">124</span></a>    <span class="n">pre_sanitize_structure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="VaspTask-125"><a href="#VaspTask-125"><span class="linenos">125</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-126"><a href="#VaspTask-126"><span class="linenos">126</span></a><span class="sd">    In some cases, we may want to sanitize the structure during our setup().</span>
</span><span id="VaspTask-127"><a href="#VaspTask-127"><span class="linenos">127</span></a><span class="sd">    This means converting to the LLL-reduced primitive cell. This simply does:</span>
</span><span id="VaspTask-128"><a href="#VaspTask-128"><span class="linenos">128</span></a><span class="sd">    ``` python</span>
</span><span id="VaspTask-129"><a href="#VaspTask-129"><span class="linenos">129</span></a><span class="sd">    structure_sanitzed = structure.copy(santize=True)</span>
</span><span id="VaspTask-130"><a href="#VaspTask-130"><span class="linenos">130</span></a><span class="sd">    ```</span>
</span><span id="VaspTask-131"><a href="#VaspTask-131"><span class="linenos">131</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-132"><a href="#VaspTask-132"><span class="linenos">132</span></a>
</span><span id="VaspTask-133"><a href="#VaspTask-133"><span class="linenos">133</span></a>    <span class="n">pre_standardize_structure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="VaspTask-134"><a href="#VaspTask-134"><span class="linenos">134</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-135"><a href="#VaspTask-135"><span class="linenos">135</span></a><span class="sd">    In some cases, we may want to convert the structure to the standard primitive</span>
</span><span id="VaspTask-136"><a href="#VaspTask-136"><span class="linenos">136</span></a><span class="sd">    of a structure. For example, this is required when calculating band structures</span>
</span><span id="VaspTask-137"><a href="#VaspTask-137"><span class="linenos">137</span></a><span class="sd">    and ensuring we have a standardized high-symmetry path.</span>
</span><span id="VaspTask-138"><a href="#VaspTask-138"><span class="linenos">138</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VaspTask-139"><a href="#VaspTask-139"><span class="linenos">139</span></a>
</span><span id="VaspTask-140"><a href="#VaspTask-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">_get_clean_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
</span><span id="VaspTask-141"><a href="#VaspTask-141"><span class="linenos">141</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-142"><a href="#VaspTask-142"><span class="linenos">142</span></a><span class="sd">        Uses the class attributes for `pre_sanitize_structure` and</span>
</span><span id="VaspTask-143"><a href="#VaspTask-143"><span class="linenos">143</span></a><span class="sd">        `pre_standardize_structure`. If either of these are set to True, then</span>
</span><span id="VaspTask-144"><a href="#VaspTask-144"><span class="linenos">144</span></a><span class="sd">        the structure unitcell is converted using the proper methods.</span>
</span><span id="VaspTask-145"><a href="#VaspTask-145"><span class="linenos">145</span></a>
</span><span id="VaspTask-146"><a href="#VaspTask-146"><span class="linenos">146</span></a><span class="sd">        Note, this method is typically called within `setup` before any input</span>
</span><span id="VaspTask-147"><a href="#VaspTask-147"><span class="linenos">147</span></a><span class="sd">        files are written. You should never have to call it directly.</span>
</span><span id="VaspTask-148"><a href="#VaspTask-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VaspTask-149"><a href="#VaspTask-149"><span class="linenos">149</span></a>
</span><span id="VaspTask-150"><a href="#VaspTask-150"><span class="linenos">150</span></a>        <span class="c1"># if both pre_standardize_structure and pre_sanitize_structure are set,</span>
</span><span id="VaspTask-151"><a href="#VaspTask-151"><span class="linenos">151</span></a>        <span class="c1"># we raise an error. I may want to change this in the future though</span>
</span><span id="VaspTask-152"><a href="#VaspTask-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_sanitize_structure</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_standardize_structure</span><span class="p">:</span>
</span><span id="VaspTask-153"><a href="#VaspTask-153"><span class="linenos">153</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="VaspTask-154"><a href="#VaspTask-154"><span class="linenos">154</span></a>                <span class="s2">&quot;For this VaspTask, only one of `pre_sanitize_structure` or &quot;</span>
</span><span id="VaspTask-155"><a href="#VaspTask-155"><span class="linenos">155</span></a>                <span class="s2">&quot; `pre_standardize_structure` can be set to True, not both.&quot;</span>
</span><span id="VaspTask-156"><a href="#VaspTask-156"><span class="linenos">156</span></a>            <span class="p">)</span>
</span><span id="VaspTask-157"><a href="#VaspTask-157"><span class="linenos">157</span></a>
</span><span id="VaspTask-158"><a href="#VaspTask-158"><span class="linenos">158</span></a>        <span class="c1"># If requested, we convert to the LLL-reduced unit cell, which aims to</span>
</span><span id="VaspTask-159"><a href="#VaspTask-159"><span class="linenos">159</span></a>        <span class="c1"># be as cubic as possible.</span>
</span><span id="VaspTask-160"><a href="#VaspTask-160"><span class="linenos">160</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_sanitize_structure</span><span class="p">:</span>
</span><span id="VaspTask-161"><a href="#VaspTask-161"><span class="linenos">161</span></a>            <span class="n">structure_cleaned</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sanitize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="VaspTask-162"><a href="#VaspTask-162"><span class="linenos">162</span></a>            <span class="k">return</span> <span class="n">structure_cleaned</span>
</span><span id="VaspTask-163"><a href="#VaspTask-163"><span class="linenos">163</span></a>
</span><span id="VaspTask-164"><a href="#VaspTask-164"><span class="linenos">164</span></a>        <span class="c1"># For band structures, we need to make sure the structure is in the</span>
</span><span id="VaspTask-165"><a href="#VaspTask-165"><span class="linenos">165</span></a>        <span class="c1"># standardized primitive form.</span>
</span><span id="VaspTask-166"><a href="#VaspTask-166"><span class="linenos">166</span></a>        <span class="c1"># We use the same SYMPREC from the INCAR, which is 1e-5 if not set.</span>
</span><span id="VaspTask-167"><a href="#VaspTask-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_standardize_structure</span><span class="p">:</span>
</span><span id="VaspTask-168"><a href="#VaspTask-168"><span class="linenos">168</span></a>            <span class="n">sym_prec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SYMPREC&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="k">else</span> <span class="mf">1e-5</span>
</span><span id="VaspTask-169"><a href="#VaspTask-169"><span class="linenos">169</span></a>            <span class="n">sym_finder</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">symprec</span><span class="o">=</span><span class="n">sym_prec</span><span class="p">)</span>
</span><span id="VaspTask-170"><a href="#VaspTask-170"><span class="linenos">170</span></a>            <span class="n">structure_cleaned</span> <span class="o">=</span> <span class="n">sym_finder</span><span class="o">.</span><span class="n">get_primitive_standard_structure</span><span class="p">(</span>
</span><span id="VaspTask-171"><a href="#VaspTask-171"><span class="linenos">171</span></a>                <span class="n">international_monoclinic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="VaspTask-172"><a href="#VaspTask-172"><span class="linenos">172</span></a>            <span class="p">)</span>
</span><span id="VaspTask-173"><a href="#VaspTask-173"><span class="linenos">173</span></a>            <span class="c1"># check for pymatgen bugs here</span>
</span><span id="VaspTask-174"><a href="#VaspTask-174"><span class="linenos">174</span></a>            <span class="n">check_for_standardization_bugs</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">structure_cleaned</span><span class="p">)</span>
</span><span id="VaspTask-175"><a href="#VaspTask-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="n">structure_cleaned</span>
</span><span id="VaspTask-176"><a href="#VaspTask-176"><span class="linenos">176</span></a>
</span><span id="VaspTask-177"><a href="#VaspTask-177"><span class="linenos">177</span></a>        <span class="c1"># if none of the flags above were used, then we just return the orignal</span>
</span><span id="VaspTask-178"><a href="#VaspTask-178"><span class="linenos">178</span></a>        <span class="c1"># input structure.</span>
</span><span id="VaspTask-179"><a href="#VaspTask-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="n">structure</span>
</span><span id="VaspTask-180"><a href="#VaspTask-180"><span class="linenos">180</span></a>
</span><span id="VaspTask-181"><a href="#VaspTask-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="VaspTask-182"><a href="#VaspTask-182"><span class="linenos">182</span></a>
</span><span id="VaspTask-183"><a href="#VaspTask-183"><span class="linenos">183</span></a>        <span class="c1"># run cleaning and standardizing on structure (based on class attributes)</span>
</span><span id="VaspTask-184"><a href="#VaspTask-184"><span class="linenos">184</span></a>        <span class="n">structure_cleaned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_clean_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
</span><span id="VaspTask-185"><a href="#VaspTask-185"><span class="linenos">185</span></a>
</span><span id="VaspTask-186"><a href="#VaspTask-186"><span class="linenos">186</span></a>        <span class="c1"># write the poscar file</span>
</span><span id="VaspTask-187"><a href="#VaspTask-187"><span class="linenos">187</span></a>        <span class="n">Poscar</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">structure_cleaned</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">))</span>
</span><span id="VaspTask-188"><a href="#VaspTask-188"><span class="linenos">188</span></a>
</span><span id="VaspTask-189"><a href="#VaspTask-189"><span class="linenos">189</span></a>        <span class="c1"># Combine our base incar settings with those of our parallelization settings</span>
</span><span id="VaspTask-190"><a href="#VaspTask-190"><span class="linenos">190</span></a>        <span class="c1"># and then write the incar file</span>
</span><span id="VaspTask-191"><a href="#VaspTask-191"><span class="linenos">191</span></a>        <span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">)</span> <span class="o">+</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_parallel_settings</span><span class="p">)</span>
</span><span id="VaspTask-192"><a href="#VaspTask-192"><span class="linenos">192</span></a>        <span class="n">incar</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
</span><span id="VaspTask-193"><a href="#VaspTask-193"><span class="linenos">193</span></a>            <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;INCAR&quot;</span><span class="p">),</span>
</span><span id="VaspTask-194"><a href="#VaspTask-194"><span class="linenos">194</span></a>            <span class="n">structure</span><span class="o">=</span><span class="n">structure_cleaned</span><span class="p">,</span>
</span><span id="VaspTask-195"><a href="#VaspTask-195"><span class="linenos">195</span></a>        <span class="p">)</span>
</span><span id="VaspTask-196"><a href="#VaspTask-196"><span class="linenos">196</span></a>
</span><span id="VaspTask-197"><a href="#VaspTask-197"><span class="linenos">197</span></a>        <span class="c1"># if KSPACING is not provided in the incar AND kpoints is attached to this</span>
</span><span id="VaspTask-198"><a href="#VaspTask-198"><span class="linenos">198</span></a>        <span class="c1"># class instance, then we write the KPOINTS file</span>
</span><span id="VaspTask-199"><a href="#VaspTask-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;KSPACING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">):</span>
</span><span id="VaspTask-200"><a href="#VaspTask-200"><span class="linenos">200</span></a>            <span class="n">Kpoints</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
</span><span id="VaspTask-201"><a href="#VaspTask-201"><span class="linenos">201</span></a>                <span class="n">structure_cleaned</span><span class="p">,</span>
</span><span id="VaspTask-202"><a href="#VaspTask-202"><span class="linenos">202</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="p">,</span>
</span><span id="VaspTask-203"><a href="#VaspTask-203"><span class="linenos">203</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;KPOINTS&quot;</span><span class="p">),</span>
</span><span id="VaspTask-204"><a href="#VaspTask-204"><span class="linenos">204</span></a>            <span class="p">)</span>
</span><span id="VaspTask-205"><a href="#VaspTask-205"><span class="linenos">205</span></a>
</span><span id="VaspTask-206"><a href="#VaspTask-206"><span class="linenos">206</span></a>        <span class="c1"># write the POTCAR file</span>
</span><span id="VaspTask-207"><a href="#VaspTask-207"><span class="linenos">207</span></a>        <span class="n">Potcar</span><span class="o">.</span><span class="n">to_file_from_type</span><span class="p">(</span>
</span><span id="VaspTask-208"><a href="#VaspTask-208"><span class="linenos">208</span></a>            <span class="n">structure_cleaned</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
</span><span id="VaspTask-209"><a href="#VaspTask-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">functional</span><span class="p">,</span>
</span><span id="VaspTask-210"><a href="#VaspTask-210"><span class="linenos">210</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;POTCAR&quot;</span><span class="p">),</span>
</span><span id="VaspTask-211"><a href="#VaspTask-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">potcar_mappings</span><span class="p">,</span>
</span><span id="VaspTask-212"><a href="#VaspTask-212"><span class="linenos">212</span></a>        <span class="p">)</span>
</span><span id="VaspTask-213"><a href="#VaspTask-213"><span class="linenos">213</span></a>
</span><span id="VaspTask-214"><a href="#VaspTask-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">workup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="VaspTask-215"><a href="#VaspTask-215"><span class="linenos">215</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-216"><a href="#VaspTask-216"><span class="linenos">216</span></a><span class="sd">        This is the most basic VASP workup where I simply load the final structure,</span>
</span><span id="VaspTask-217"><a href="#VaspTask-217"><span class="linenos">217</span></a><span class="sd">        final energy, and (if requested) confirm convergence. I will likely make</span>
</span><span id="VaspTask-218"><a href="#VaspTask-218"><span class="linenos">218</span></a><span class="sd">        this a common function for this vasp module down the road.</span>
</span><span id="VaspTask-219"><a href="#VaspTask-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VaspTask-220"><a href="#VaspTask-220"><span class="linenos">220</span></a>
</span><span id="VaspTask-221"><a href="#VaspTask-221"><span class="linenos">221</span></a>        <span class="c1"># load the xml file and all of the vasprun data</span>
</span><span id="VaspTask-222"><a href="#VaspTask-222"><span class="linenos">222</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="VaspTask-223"><a href="#VaspTask-223"><span class="linenos">223</span></a>            <span class="n">vasprun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span>
</span><span id="VaspTask-224"><a href="#VaspTask-224"><span class="linenos">224</span></a>                <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">),</span>
</span><span id="VaspTask-225"><a href="#VaspTask-225"><span class="linenos">225</span></a>                <span class="n">exception_on_bad_xml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="VaspTask-226"><a href="#VaspTask-226"><span class="linenos">226</span></a>            <span class="p">)</span>
</span><span id="VaspTask-227"><a href="#VaspTask-227"><span class="linenos">227</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="VaspTask-228"><a href="#VaspTask-228"><span class="linenos">228</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="VaspTask-229"><a href="#VaspTask-229"><span class="linenos">229</span></a>                <span class="s2">&quot;XML is malformed. This typically means there&#39;s an error with your&quot;</span>
</span><span id="VaspTask-230"><a href="#VaspTask-230"><span class="linenos">230</span></a>                <span class="s2">&quot; calculation that wasn&#39;t caught by your ErrorHandlers. We try&quot;</span>
</span><span id="VaspTask-231"><a href="#VaspTask-231"><span class="linenos">231</span></a>                <span class="s2">&quot; salvaging data here though.&quot;</span>
</span><span id="VaspTask-232"><a href="#VaspTask-232"><span class="linenos">232</span></a>            <span class="p">)</span>
</span><span id="VaspTask-233"><a href="#VaspTask-233"><span class="linenos">233</span></a>            <span class="n">vasprun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span>
</span><span id="VaspTask-234"><a href="#VaspTask-234"><span class="linenos">234</span></a>                <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">),</span>
</span><span id="VaspTask-235"><a href="#VaspTask-235"><span class="linenos">235</span></a>                <span class="n">exception_on_bad_xml</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="VaspTask-236"><a href="#VaspTask-236"><span class="linenos">236</span></a>            <span class="p">)</span>
</span><span id="VaspTask-237"><a href="#VaspTask-237"><span class="linenos">237</span></a>            <span class="n">vasprun</span><span class="o">.</span><span class="n">final_structure</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="VaspTask-238"><a href="#VaspTask-238"><span class="linenos">238</span></a>        <span class="c1"># BUG: This try/except is 100% just for my really rough calculations</span>
</span><span id="VaspTask-239"><a href="#VaspTask-239"><span class="linenos">239</span></a>        <span class="c1"># where I don&#39;t use any ErrorHandlers and still want the final structure</span>
</span><span id="VaspTask-240"><a href="#VaspTask-240"><span class="linenos">240</span></a>        <span class="c1"># regarless of what when wrong. In the future, I should consider writing</span>
</span><span id="VaspTask-241"><a href="#VaspTask-241"><span class="linenos">241</span></a>        <span class="c1"># a separate method for those that loads the CONTCAR and moves on.</span>
</span><span id="VaspTask-242"><a href="#VaspTask-242"><span class="linenos">242</span></a>
</span><span id="VaspTask-243"><a href="#VaspTask-243"><span class="linenos">243</span></a>        <span class="c1"># write output files/plots for the user to quickly reference</span>
</span><span id="VaspTask-244"><a href="#VaspTask-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_output_summary</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">)</span>
</span><span id="VaspTask-245"><a href="#VaspTask-245"><span class="linenos">245</span></a>
</span><span id="VaspTask-246"><a href="#VaspTask-246"><span class="linenos">246</span></a>        <span class="c1"># confirm that the calculation converged (ionicly and electronically)</span>
</span><span id="VaspTask-247"><a href="#VaspTask-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_convergence</span><span class="p">:</span>
</span><span id="VaspTask-248"><a href="#VaspTask-248"><span class="linenos">248</span></a>            <span class="k">assert</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">converged</span>
</span><span id="VaspTask-249"><a href="#VaspTask-249"><span class="linenos">249</span></a>
</span><span id="VaspTask-250"><a href="#VaspTask-250"><span class="linenos">250</span></a>        <span class="c1"># return vasprun object</span>
</span><span id="VaspTask-251"><a href="#VaspTask-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="n">vasprun</span>
</span><span id="VaspTask-252"><a href="#VaspTask-252"><span class="linenos">252</span></a>
</span><span id="VaspTask-253"><a href="#VaspTask-253"><span class="linenos">253</span></a>    <span class="k">def</span> <span class="nf">_write_output_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span><span class="p">):</span>
</span><span id="VaspTask-254"><a href="#VaspTask-254"><span class="linenos">254</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-255"><a href="#VaspTask-255"><span class="linenos">255</span></a><span class="sd">        This prints a &quot;simmate_summary.yaml&quot; file with key output information.</span>
</span><span id="VaspTask-256"><a href="#VaspTask-256"><span class="linenos">256</span></a>
</span><span id="VaspTask-257"><a href="#VaspTask-257"><span class="linenos">257</span></a><span class="sd">        This method should not be called directly as it used within workup().</span>
</span><span id="VaspTask-258"><a href="#VaspTask-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VaspTask-259"><a href="#VaspTask-259"><span class="linenos">259</span></a>        <span class="c1"># OPTIMIZE: Ideally, I could take the vasprun object and run to_json,</span>
</span><span id="VaspTask-260"><a href="#VaspTask-260"><span class="linenos">260</span></a>        <span class="c1"># but this output is extremely difficult to read.</span>
</span><span id="VaspTask-261"><a href="#VaspTask-261"><span class="linenos">261</span></a>
</span><span id="VaspTask-262"><a href="#VaspTask-262"><span class="linenos">262</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</span><span id="VaspTask-263"><a href="#VaspTask-263"><span class="linenos">263</span></a>
</span><span id="VaspTask-264"><a href="#VaspTask-264"><span class="linenos">264</span></a>        <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="VaspTask-265"><a href="#VaspTask-265"><span class="linenos">265</span></a>            <span class="s2">&quot;structure_final&quot;</span><span class="p">:</span> <span class="s2">&quot;The final structure is located in the CONTCAR file&quot;</span><span class="p">,</span>
</span><span id="VaspTask-266"><a href="#VaspTask-266"><span class="linenos">266</span></a>            <span class="s2">&quot;energy_final&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;final_energy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
</span><span id="VaspTask-267"><a href="#VaspTask-267"><span class="linenos">267</span></a>            <span class="s2">&quot;energy_final_per_atom&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;final_energy_per_atom&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
</span><span id="VaspTask-268"><a href="#VaspTask-268"><span class="linenos">268</span></a>            <span class="s2">&quot;converged_electroinc&quot;</span><span class="p">:</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">converged_electronic</span><span class="p">,</span>
</span><span id="VaspTask-269"><a href="#VaspTask-269"><span class="linenos">269</span></a>            <span class="s2">&quot;converged_ionic&quot;</span><span class="p">:</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">converged_ionic</span><span class="p">,</span>
</span><span id="VaspTask-270"><a href="#VaspTask-270"><span class="linenos">270</span></a>            <span class="s2">&quot;fermi_energy&quot;</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;efermi&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="VaspTask-271"><a href="#VaspTask-271"><span class="linenos">271</span></a>            <span class="s2">&quot;valence_band_maximum&quot;</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="VaspTask-272"><a href="#VaspTask-272"><span class="linenos">272</span></a>            <span class="s2">&quot;conduction_band_minimum&quot;</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vbm&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="VaspTask-273"><a href="#VaspTask-273"><span class="linenos">273</span></a>        <span class="p">}</span>
</span><span id="VaspTask-274"><a href="#VaspTask-274"><span class="linenos">274</span></a>
</span><span id="VaspTask-275"><a href="#VaspTask-275"><span class="linenos">275</span></a>        <span class="n">summary_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;simmate_summary.yaml&quot;</span><span class="p">)</span>
</span><span id="VaspTask-276"><a href="#VaspTask-276"><span class="linenos">276</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">summary_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="VaspTask-277"><a href="#VaspTask-277"><span class="linenos">277</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</span><span id="VaspTask-278"><a href="#VaspTask-278"><span class="linenos">278</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="VaspTask-279"><a href="#VaspTask-279"><span class="linenos">279</span></a>
</span><span id="VaspTask-280"><a href="#VaspTask-280"><span class="linenos">280</span></a>    <span class="nd">@classmethod</span>
</span><span id="VaspTask-281"><a href="#VaspTask-281"><span class="linenos">281</span></a>    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="VaspTask-282"><a href="#VaspTask-282"><span class="linenos">282</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask-283"><a href="#VaspTask-283"><span class="linenos">283</span></a><span class="sd">        Grabs the overall settings from the class. This is useful for printing out</span>
</span><span id="VaspTask-284"><a href="#VaspTask-284"><span class="linenos">284</span></a><span class="sd">        settings for users to inspect.</span>
</span><span id="VaspTask-285"><a href="#VaspTask-285"><span class="linenos">285</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VaspTask-286"><a href="#VaspTask-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="VaspTask-287"><a href="#VaspTask-287"><span class="linenos">287</span></a>            <span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="VaspTask-288"><a href="#VaspTask-288"><span class="linenos">288</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="VaspTask-289"><a href="#VaspTask-289"><span class="linenos">289</span></a>                <span class="s2">&quot;__module__&quot;</span><span class="p">,</span>
</span><span id="VaspTask-290"><a href="#VaspTask-290"><span class="linenos">290</span></a>                <span class="s2">&quot;pre_sanitize_structure&quot;</span><span class="p">,</span>
</span><span id="VaspTask-291"><a href="#VaspTask-291"><span class="linenos">291</span></a>                <span class="s2">&quot;confirm_convergence&quot;</span><span class="p">,</span>
</span><span id="VaspTask-292"><a href="#VaspTask-292"><span class="linenos">292</span></a>                <span class="s2">&quot;functional&quot;</span><span class="p">,</span>
</span><span id="VaspTask-293"><a href="#VaspTask-293"><span class="linenos">293</span></a>                <span class="s2">&quot;incar&quot;</span><span class="p">,</span>
</span><span id="VaspTask-294"><a href="#VaspTask-294"><span class="linenos">294</span></a>                <span class="s2">&quot;potcar_mappings&quot;</span><span class="p">,</span>
</span><span id="VaspTask-295"><a href="#VaspTask-295"><span class="linenos">295</span></a>            <span class="p">]</span>
</span><span id="VaspTask-296"><a href="#VaspTask-296"><span class="linenos">296</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><h2 id="the-supervised-staged-shell-task-aka-s3task">The Supervised-Staged-Shell Task (aka "S3Task")</h2>

<p>This class contains the core functionality to <strong>supervise</strong> a <strong>staged</strong> task
involving some <strong>shell</strong> command.</p>

<p>Let's breakdown what this means...</p>

<p>A <em>shell</em> command is a single call to some external program. For example,
VASP requires that we call the "vasp_std &gt; vasp.out" command in order to run a
calculation. We consider calling external programs a <em>staged</em> task made
up of three steps:</p>

<ul>
<li>setup = writing any input files required for the program</li>
<li>execution = actually calling the command and running our program</li>
<li>workup = loading data from output files back into python</li>
</ul>

<p>And for <em>supervising</em> the task, this means we monitor the program while the
execution stage is running. So once a program is started, Simmate can check
output files for common errors/issues. If an error is found, we stop the
program, fix the issue, and then restart it. Any fixes that were made are
written to "simmate_corrections.csv".</p>

<!--
TODO: Make a simple diagram to visualize the overall process and add it here.
It will be similar to Custodian's, but we don't have a list of jobs here.
https://materialsproject.github.io/custodian/index.html#usage
The steps are...

- Write Input Files based on custom+defualt settings
- Run the calculation by calling the program
- Load ouput files
- check for errors
- [correct them, rerun]
- postprocess/analysis
-->

<p>This entire process (the different stages and monitoring) is carried out
using the <code><a href="#VaspTask.run">run()</a></code> method. You rarely use this class directly. Instead,
you typically use a subclass of it. As a user, you really just need to do
something like this:</p>

<div class="pdoc-code codehilite"><pre><span></span><code>   <span class="kn">from</span> <span class="nn">simmate.calculator.example.tasks</span> <span class="kn">import</span> <span class="n">ExampleTask</span>

   <span class="n">my_task</span> <span class="o">=</span> <span class="n">ExampleTask</span><span class="p">()</span>
   <span class="n">my_result</span> <span class="o">=</span> <span class="n">my_task</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>And that's it!</p>

<p>For experts, this class can be viewed as a combination of prefect's ShellTask,
a custodian Job, and Custodian monitoring. When subclassing this, we can absorb
functionality of pymatgen.io.vasp.sets too. By merging all of these together
into one class, we make things much easier for users and creating new Tasks.</p>

<h2 id="inheriting-from-this-class">Inheriting from this class</h2>

<p>This class is commonly used to make tasks for our calculator modules, so you
will likely want to subclass this. Here is a basic example of inheriting
and then running a task:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="../../../workflow_engine.html">simmate.workflow_engine</a></span> <span class="kn">import</span> <span class="n">S3Task</span>
<span class="kn">from</span> <span class="nn">example.error_handlers</span> <span class="kn">import</span> <span class="n">PossibleError1</span><span class="p">,</span> <span class="n">PossibleError2</span>


<span class="k">class</span> <span class="nc">ExampleTask</span><span class="p">(</span><span class="n">SSSTask</span><span class="p">):</span>

    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;echo example&quot;</span>  <span class="c1"># just prints out &quot;example&quot;</span>
    <span class="n">max_corrections</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">error_handlers</span> <span class="o">=</span> <span class="p">[</span><span class="n">PossibleError1</span><span class="p">,</span> <span class="n">PossibleError2</span><span class="p">]</span>
    <span class="n">polling_timestep</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">monitor_freq</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">some_new_setting</span> <span class="o">=</span> <span class="mi">123</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>  <span class="c1"># &lt;-- MUST have these two args</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;m setting things up!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;My new setting is </span><span class="si">{</span><span class="n">some_new_setting</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">workup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>  <span class="c1"># &lt;-- MUST have this arg</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;m working things up!&quot;</span><span class="p">)</span>


<span class="n">task</span> <span class="o">=</span> <span class="n">ExampleTask</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>There are a couple things to note here:</p>

<ul>
<li>It's optional to set/overwrite attributes. You can also add new ones too.</li>
<li>It's optional to write a new __init__, setup, or workup methods</li>
<li>make sure you include the structure/directory inputs, even if you don't use them.</li>
<li>Don't add new kwargs to methods. Instead handle these options through attributes.</li>
</ul>

<p>For a full (and advanced) example, of a subclass take a look at
<code><a href="#VaspTask">simmate.calculators.vasp.tasks.base.VaspTask</a></code>.</p>
</div>


                            <div id="VaspTask.requires_structure" class="classattr">
                                <div class="attr variable">
            <span class="name">requires_structure</span><span class="annotation">: bool</span><span class="default_value"> = True</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.requires_structure"></a>
    
            <div class="docstring"><p>Vasp calculations always need an input structure, so this is always True.</p>
</div>


                            </div>
                            <div id="VaspTask.command" class="classattr">
                                <div class="attr variable">
            <span class="name">command</span><span class="annotation">: str</span><span class="default_value"> = &#39;vasp_std &gt; vasp.out&#39;</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.command"></a>
    
            <div class="docstring"><p>The command to call vasp, which is typically vasp_std. To ensure error
handlers work properly, make sure your command has "> vasp.out" at the end.</p>
</div>


                            </div>
                            <div id="VaspTask.incar" class="classattr">
                                <div class="attr variable">
            <span class="name">incar</span><span class="annotation">: dict</span><span class="default_value"> = None</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.incar"></a>
    
            <div class="docstring"><p>This sets the default vasp settings from a dictionary. This is the one thing
you <em>must</em> set when subclassing VaspTask. An example is:</p>

<div class="pdoc-code codehilite"><pre><span></span><code>  <span class="n">incar</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">NSW</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">PREC</span><span class="o">=</span><span class="s2">&quot;Accurate&quot;</span><span class="p">,</span> <span class="n">KSPACING</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div>
</div>


                            </div>
                            <div id="VaspTask.incar_parallel_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">incar_parallel_settings</span><span class="annotation">: dict</span><span class="default_value"> = {}</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.incar_parallel_settings"></a>
    
            <div class="docstring"><p>The parallel settings to add on to the base incar. These should not effect 
the calculation result in any way (only how fast it completes), but they 
are still selected based on the computer specs and what runs fastest on it.
Therefore, these settings are loaded from ~/simmate/vasp/INCAR_parallel_settings
by default and adding to this file should be the preferred method for updating
these settings.</p>
</div>


                            </div>
                            <div id="VaspTask.kpoints" class="classattr">
                                <div class="attr variable">
            <span class="name">kpoints</span><span class="default_value"> = None</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.kpoints"></a>
    
            <div class="docstring"><p>(experimental feature)
The KptGrid or KptPath generator used to create the KPOINTS file. Note,
this attribute is optional becuase VASP supports setting Kpts by adding
KSPACING to the INCAR. If KSPACING is set in the INCAR, we ignore whatever 
is set here.</p>
</div>


                            </div>
                            <div id="VaspTask.functional" class="classattr">
                                <div class="attr variable">
            <span class="name">functional</span><span class="annotation">: str</span><span class="default_value"> = None</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.functional"></a>
    
            <div class="docstring"><p>This directs which Potcar files to grab. You would set this to a string
of what you want, such as "PBE", "PBE_GW", or "LDA".</p>
</div>


                            </div>
                            <div id="VaspTask.potcar_mappings" class="classattr">
                                <div class="attr variable">
            <span class="name">potcar_mappings</span><span class="annotation">: dict</span><span class="default_value"> = None</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.potcar_mappings"></a>
    
            <div class="docstring"><p>This is an optional parameter to override Simmate's default selection of
potentials based off of the functional chosen. The defaults are located
in <a href="../inputs/potcar_mappings.html">simmate.calculators.vasp.inputs.potcar_mappings</a>. You can supply your
own mapping dictionary or update the specific potentials you'd like. 
For example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code>  <span class="kn">from</span> <span class="nn"><a href="../inputs/potcar_mappings.html">simmate.calculators.vasp.inputs.potcar_mappings</a></span> <span class="kn">import</span> <span class="n">PBE_ELEMENT_MAPPINGS</span>
  <span class="n">element_mappings</span> <span class="o">=</span> <span class="n">PBE_ELEMENT_MAPPINGS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># don&#39;t forget to copy!</span>
  <span class="n">element_mappings</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="s2">&quot;C_h&quot;</span><span class="p">})</span>  <span class="c1"># if you wish to update any</span>
</code></pre></div>

<p>or if you only use Carbon and don't care about other elements...</p>

<div class="pdoc-code codehilite"><pre><span></span><code>  <span class="n">element_mappings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="s2">&quot;C_h&quot;</span><span class="p">}</span>
</code></pre></div>

<p>Read more on this inside the Potcar class and be careful with updating!</p>
</div>


                            </div>
                            <div id="VaspTask.confirm_convergence" class="classattr">
                                <div class="attr variable">
            <span class="name">confirm_convergence</span><span class="annotation">: bool</span><span class="default_value"> = True</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.confirm_convergence"></a>
    
            <div class="docstring"><p>This flag controls whether or not we raise an error when the calculation 
failed to converge. In somecases we still want results from calculations 
that did NOT converge successfully.</p>
</div>


                            </div>
                            <div id="VaspTask.pre_sanitize_structure" class="classattr">
                                <div class="attr variable">
            <span class="name">pre_sanitize_structure</span><span class="annotation">: bool</span><span class="default_value"> = False</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.pre_sanitize_structure"></a>
    
            <div class="docstring"><p>In some cases, we may want to sanitize the structure during our setup().
This means converting to the LLL-reduced primitive cell. This simply does:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">structure_sanitzed</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">santize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</div>


                            </div>
                            <div id="VaspTask.pre_standardize_structure" class="classattr">
                                <div class="attr variable">
            <span class="name">pre_standardize_structure</span><span class="annotation">: bool</span><span class="default_value"> = False</span>

        
    </div>
    <a class="headerlink" href="#VaspTask.pre_standardize_structure"></a>
    
            <div class="docstring"><p>In some cases, we may want to convert the structure to the standard primitive
of a structure. For example, this is required when calculating band structures
and ensuring we have a standardized high-symmetry path.</p>
</div>


                            </div>
                            <div id="VaspTask.setup" class="classattr">
                                        <input id="VaspTask.setup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">structure</span><span class="p">:</span> <span class="n"><a href="../../../toolkit/base_data_types/structure.html#Structure">simmate.toolkit.base_data_types.structure.Structure</a></span>,</span><span class="param">	<span class="n">directory</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="VaspTask.setup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VaspTask.setup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VaspTask.setup-181"><a href="#VaspTask.setup-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="VaspTask.setup-182"><a href="#VaspTask.setup-182"><span class="linenos">182</span></a>
</span><span id="VaspTask.setup-183"><a href="#VaspTask.setup-183"><span class="linenos">183</span></a>        <span class="c1"># run cleaning and standardizing on structure (based on class attributes)</span>
</span><span id="VaspTask.setup-184"><a href="#VaspTask.setup-184"><span class="linenos">184</span></a>        <span class="n">structure_cleaned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_clean_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
</span><span id="VaspTask.setup-185"><a href="#VaspTask.setup-185"><span class="linenos">185</span></a>
</span><span id="VaspTask.setup-186"><a href="#VaspTask.setup-186"><span class="linenos">186</span></a>        <span class="c1"># write the poscar file</span>
</span><span id="VaspTask.setup-187"><a href="#VaspTask.setup-187"><span class="linenos">187</span></a>        <span class="n">Poscar</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">structure_cleaned</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">))</span>
</span><span id="VaspTask.setup-188"><a href="#VaspTask.setup-188"><span class="linenos">188</span></a>
</span><span id="VaspTask.setup-189"><a href="#VaspTask.setup-189"><span class="linenos">189</span></a>        <span class="c1"># Combine our base incar settings with those of our parallelization settings</span>
</span><span id="VaspTask.setup-190"><a href="#VaspTask.setup-190"><span class="linenos">190</span></a>        <span class="c1"># and then write the incar file</span>
</span><span id="VaspTask.setup-191"><a href="#VaspTask.setup-191"><span class="linenos">191</span></a>        <span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">)</span> <span class="o">+</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_parallel_settings</span><span class="p">)</span>
</span><span id="VaspTask.setup-192"><a href="#VaspTask.setup-192"><span class="linenos">192</span></a>        <span class="n">incar</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
</span><span id="VaspTask.setup-193"><a href="#VaspTask.setup-193"><span class="linenos">193</span></a>            <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;INCAR&quot;</span><span class="p">),</span>
</span><span id="VaspTask.setup-194"><a href="#VaspTask.setup-194"><span class="linenos">194</span></a>            <span class="n">structure</span><span class="o">=</span><span class="n">structure_cleaned</span><span class="p">,</span>
</span><span id="VaspTask.setup-195"><a href="#VaspTask.setup-195"><span class="linenos">195</span></a>        <span class="p">)</span>
</span><span id="VaspTask.setup-196"><a href="#VaspTask.setup-196"><span class="linenos">196</span></a>
</span><span id="VaspTask.setup-197"><a href="#VaspTask.setup-197"><span class="linenos">197</span></a>        <span class="c1"># if KSPACING is not provided in the incar AND kpoints is attached to this</span>
</span><span id="VaspTask.setup-198"><a href="#VaspTask.setup-198"><span class="linenos">198</span></a>        <span class="c1"># class instance, then we write the KPOINTS file</span>
</span><span id="VaspTask.setup-199"><a href="#VaspTask.setup-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;KSPACING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">):</span>
</span><span id="VaspTask.setup-200"><a href="#VaspTask.setup-200"><span class="linenos">200</span></a>            <span class="n">Kpoints</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
</span><span id="VaspTask.setup-201"><a href="#VaspTask.setup-201"><span class="linenos">201</span></a>                <span class="n">structure_cleaned</span><span class="p">,</span>
</span><span id="VaspTask.setup-202"><a href="#VaspTask.setup-202"><span class="linenos">202</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="p">,</span>
</span><span id="VaspTask.setup-203"><a href="#VaspTask.setup-203"><span class="linenos">203</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;KPOINTS&quot;</span><span class="p">),</span>
</span><span id="VaspTask.setup-204"><a href="#VaspTask.setup-204"><span class="linenos">204</span></a>            <span class="p">)</span>
</span><span id="VaspTask.setup-205"><a href="#VaspTask.setup-205"><span class="linenos">205</span></a>
</span><span id="VaspTask.setup-206"><a href="#VaspTask.setup-206"><span class="linenos">206</span></a>        <span class="c1"># write the POTCAR file</span>
</span><span id="VaspTask.setup-207"><a href="#VaspTask.setup-207"><span class="linenos">207</span></a>        <span class="n">Potcar</span><span class="o">.</span><span class="n">to_file_from_type</span><span class="p">(</span>
</span><span id="VaspTask.setup-208"><a href="#VaspTask.setup-208"><span class="linenos">208</span></a>            <span class="n">structure_cleaned</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
</span><span id="VaspTask.setup-209"><a href="#VaspTask.setup-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">functional</span><span class="p">,</span>
</span><span id="VaspTask.setup-210"><a href="#VaspTask.setup-210"><span class="linenos">210</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;POTCAR&quot;</span><span class="p">),</span>
</span><span id="VaspTask.setup-211"><a href="#VaspTask.setup-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">potcar_mappings</span><span class="p">,</span>
</span><span id="VaspTask.setup-212"><a href="#VaspTask.setup-212"><span class="linenos">212</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This abstract method is ran before the command is actually executed. This
allows for some pre-processing, such as writing input files or any other
analysis.</p>

<p>You should never call this method directly unless you are debugging. This
is becuase setup() is normally called within the run() method.</p>

<p>Some tasks don't require a setup() method, so by default, this method
doesn't nothing but "pass".</p>

<h4 id="parameters">Parameters</h4>

<ul>
<li><code>structure</code>:
The structure to use for the task, if one is required.</li>
<li><code>directory</code>:
The directory to run everything in. Must exist already.</li>
<li><code>**kwargs</code>:
Extra kwargs that may be passed to some function within. Because
Simmate prefers fixed settings for their workflows, this is typically
not used, but instead, keywords should be explicitly defined when
writing a setup method.</li>
</ul>
</div>


                            </div>
                            <div id="VaspTask.workup" class="classattr">
                                        <input id="VaspTask.workup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">workup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="VaspTask.workup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VaspTask.workup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VaspTask.workup-214"><a href="#VaspTask.workup-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">workup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="VaspTask.workup-215"><a href="#VaspTask.workup-215"><span class="linenos">215</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask.workup-216"><a href="#VaspTask.workup-216"><span class="linenos">216</span></a><span class="sd">        This is the most basic VASP workup where I simply load the final structure,</span>
</span><span id="VaspTask.workup-217"><a href="#VaspTask.workup-217"><span class="linenos">217</span></a><span class="sd">        final energy, and (if requested) confirm convergence. I will likely make</span>
</span><span id="VaspTask.workup-218"><a href="#VaspTask.workup-218"><span class="linenos">218</span></a><span class="sd">        this a common function for this vasp module down the road.</span>
</span><span id="VaspTask.workup-219"><a href="#VaspTask.workup-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VaspTask.workup-220"><a href="#VaspTask.workup-220"><span class="linenos">220</span></a>
</span><span id="VaspTask.workup-221"><a href="#VaspTask.workup-221"><span class="linenos">221</span></a>        <span class="c1"># load the xml file and all of the vasprun data</span>
</span><span id="VaspTask.workup-222"><a href="#VaspTask.workup-222"><span class="linenos">222</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="VaspTask.workup-223"><a href="#VaspTask.workup-223"><span class="linenos">223</span></a>            <span class="n">vasprun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span>
</span><span id="VaspTask.workup-224"><a href="#VaspTask.workup-224"><span class="linenos">224</span></a>                <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">),</span>
</span><span id="VaspTask.workup-225"><a href="#VaspTask.workup-225"><span class="linenos">225</span></a>                <span class="n">exception_on_bad_xml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="VaspTask.workup-226"><a href="#VaspTask.workup-226"><span class="linenos">226</span></a>            <span class="p">)</span>
</span><span id="VaspTask.workup-227"><a href="#VaspTask.workup-227"><span class="linenos">227</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="VaspTask.workup-228"><a href="#VaspTask.workup-228"><span class="linenos">228</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="VaspTask.workup-229"><a href="#VaspTask.workup-229"><span class="linenos">229</span></a>                <span class="s2">&quot;XML is malformed. This typically means there&#39;s an error with your&quot;</span>
</span><span id="VaspTask.workup-230"><a href="#VaspTask.workup-230"><span class="linenos">230</span></a>                <span class="s2">&quot; calculation that wasn&#39;t caught by your ErrorHandlers. We try&quot;</span>
</span><span id="VaspTask.workup-231"><a href="#VaspTask.workup-231"><span class="linenos">231</span></a>                <span class="s2">&quot; salvaging data here though.&quot;</span>
</span><span id="VaspTask.workup-232"><a href="#VaspTask.workup-232"><span class="linenos">232</span></a>            <span class="p">)</span>
</span><span id="VaspTask.workup-233"><a href="#VaspTask.workup-233"><span class="linenos">233</span></a>            <span class="n">vasprun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span>
</span><span id="VaspTask.workup-234"><a href="#VaspTask.workup-234"><span class="linenos">234</span></a>                <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">),</span>
</span><span id="VaspTask.workup-235"><a href="#VaspTask.workup-235"><span class="linenos">235</span></a>                <span class="n">exception_on_bad_xml</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="VaspTask.workup-236"><a href="#VaspTask.workup-236"><span class="linenos">236</span></a>            <span class="p">)</span>
</span><span id="VaspTask.workup-237"><a href="#VaspTask.workup-237"><span class="linenos">237</span></a>            <span class="n">vasprun</span><span class="o">.</span><span class="n">final_structure</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="VaspTask.workup-238"><a href="#VaspTask.workup-238"><span class="linenos">238</span></a>        <span class="c1"># BUG: This try/except is 100% just for my really rough calculations</span>
</span><span id="VaspTask.workup-239"><a href="#VaspTask.workup-239"><span class="linenos">239</span></a>        <span class="c1"># where I don&#39;t use any ErrorHandlers and still want the final structure</span>
</span><span id="VaspTask.workup-240"><a href="#VaspTask.workup-240"><span class="linenos">240</span></a>        <span class="c1"># regarless of what when wrong. In the future, I should consider writing</span>
</span><span id="VaspTask.workup-241"><a href="#VaspTask.workup-241"><span class="linenos">241</span></a>        <span class="c1"># a separate method for those that loads the CONTCAR and moves on.</span>
</span><span id="VaspTask.workup-242"><a href="#VaspTask.workup-242"><span class="linenos">242</span></a>
</span><span id="VaspTask.workup-243"><a href="#VaspTask.workup-243"><span class="linenos">243</span></a>        <span class="c1"># write output files/plots for the user to quickly reference</span>
</span><span id="VaspTask.workup-244"><a href="#VaspTask.workup-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_output_summary</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">)</span>
</span><span id="VaspTask.workup-245"><a href="#VaspTask.workup-245"><span class="linenos">245</span></a>
</span><span id="VaspTask.workup-246"><a href="#VaspTask.workup-246"><span class="linenos">246</span></a>        <span class="c1"># confirm that the calculation converged (ionicly and electronically)</span>
</span><span id="VaspTask.workup-247"><a href="#VaspTask.workup-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_convergence</span><span class="p">:</span>
</span><span id="VaspTask.workup-248"><a href="#VaspTask.workup-248"><span class="linenos">248</span></a>            <span class="k">assert</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">converged</span>
</span><span id="VaspTask.workup-249"><a href="#VaspTask.workup-249"><span class="linenos">249</span></a>
</span><span id="VaspTask.workup-250"><a href="#VaspTask.workup-250"><span class="linenos">250</span></a>        <span class="c1"># return vasprun object</span>
</span><span id="VaspTask.workup-251"><a href="#VaspTask.workup-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="n">vasprun</span>
</span></pre></div>


            <div class="docstring"><p>This is the most basic VASP workup where I simply load the final structure,
final energy, and (if requested) confirm convergence. I will likely make
this a common function for this vasp module down the road.</p>
</div>


                            </div>
                            <div id="VaspTask.get_config" class="classattr">
                                        <input id="VaspTask.get_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span></span>)</span>

                <label class="view-source-button" for="VaspTask.get_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VaspTask.get_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VaspTask.get_config-280"><a href="#VaspTask.get_config-280"><span class="linenos">280</span></a>    <span class="nd">@classmethod</span>
</span><span id="VaspTask.get_config-281"><a href="#VaspTask.get_config-281"><span class="linenos">281</span></a>    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="VaspTask.get_config-282"><a href="#VaspTask.get_config-282"><span class="linenos">282</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="VaspTask.get_config-283"><a href="#VaspTask.get_config-283"><span class="linenos">283</span></a><span class="sd">        Grabs the overall settings from the class. This is useful for printing out</span>
</span><span id="VaspTask.get_config-284"><a href="#VaspTask.get_config-284"><span class="linenos">284</span></a><span class="sd">        settings for users to inspect.</span>
</span><span id="VaspTask.get_config-285"><a href="#VaspTask.get_config-285"><span class="linenos">285</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VaspTask.get_config-286"><a href="#VaspTask.get_config-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="VaspTask.get_config-287"><a href="#VaspTask.get_config-287"><span class="linenos">287</span></a>            <span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="VaspTask.get_config-288"><a href="#VaspTask.get_config-288"><span class="linenos">288</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="VaspTask.get_config-289"><a href="#VaspTask.get_config-289"><span class="linenos">289</span></a>                <span class="s2">&quot;__module__&quot;</span><span class="p">,</span>
</span><span id="VaspTask.get_config-290"><a href="#VaspTask.get_config-290"><span class="linenos">290</span></a>                <span class="s2">&quot;pre_sanitize_structure&quot;</span><span class="p">,</span>
</span><span id="VaspTask.get_config-291"><a href="#VaspTask.get_config-291"><span class="linenos">291</span></a>                <span class="s2">&quot;confirm_convergence&quot;</span><span class="p">,</span>
</span><span id="VaspTask.get_config-292"><a href="#VaspTask.get_config-292"><span class="linenos">292</span></a>                <span class="s2">&quot;functional&quot;</span><span class="p">,</span>
</span><span id="VaspTask.get_config-293"><a href="#VaspTask.get_config-293"><span class="linenos">293</span></a>                <span class="s2">&quot;incar&quot;</span><span class="p">,</span>
</span><span id="VaspTask.get_config-294"><a href="#VaspTask.get_config-294"><span class="linenos">294</span></a>                <span class="s2">&quot;potcar_mappings&quot;</span><span class="p">,</span>
</span><span id="VaspTask.get_config-295"><a href="#VaspTask.get_config-295"><span class="linenos">295</span></a>            <span class="p">]</span>
</span><span id="VaspTask.get_config-296"><a href="#VaspTask.get_config-296"><span class="linenos">296</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Grabs the overall settings from the class. This is useful for printing out
settings for users to inspect.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="../../../workflow_engine/supervised_staged_shell_task.html#S3Task">simmate.workflow_engine.supervised_staged_shell_task.S3Task</a></dt>
                                <dd id="VaspTask.__init__" class="function"><a href="../../../workflow_engine/supervised_staged_shell_task.html#S3Task.__init__">S3Task</a></dd>
                <dd id="VaspTask.error_handlers" class="variable"><a href="../../../workflow_engine/supervised_staged_shell_task.html#S3Task.error_handlers">error_handlers</a></dd>
                <dd id="VaspTask.execute" class="function"><a href="../../../workflow_engine/supervised_staged_shell_task.html#S3Task.execute">execute</a></dd>
                <dd id="VaspTask.run" class="function"><a href="../../../workflow_engine/supervised_staged_shell_task.html#S3Task.run">run</a></dd>
                <dd id="VaspTask.print_config" class="function"><a href="../../../workflow_engine/supervised_staged_shell_task.html#S3Task.print_config">print_config</a></dd>

            </div>
            <div><dt>prefect.core.task.Task</dt>
                                <dd id="VaspTask.copy" class="function">copy</dd>
                <dd id="VaspTask.bind" class="function">bind</dd>
                <dd id="VaspTask.map" class="function">map</dd>
                <dd id="VaspTask.set_dependencies" class="function">set_dependencies</dd>
                <dd id="VaspTask.set_upstream" class="function">set_upstream</dd>
                <dd id="VaspTask.set_downstream" class="function">set_downstream</dd>
                <dd id="VaspTask.inputs" class="function">inputs</dd>
                <dd id="VaspTask.outputs" class="function">outputs</dd>
                <dd id="VaspTask.pipe" class="function">pipe</dd>
                <dd id="VaspTask.serialize" class="function">serialize</dd>
                <dd id="VaspTask.is_equal" class="function">is_equal</dd>
                <dd id="VaspTask.is_not_equal" class="function">is_not_equal</dd>
                <dd id="VaspTask.not_" class="function">not_</dd>
                <dd id="VaspTask.or_" class="function">or_</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="check_for_standardization_bugs">
                            <input id="check_for_standardization_bugs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_for_standardization_bugs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">structure_original</span>, </span><span class="param"><span class="n">structure_new</span></span>)</span>

                <label class="view-source-button" for="check_for_standardization_bugs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#check_for_standardization_bugs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="check_for_standardization_bugs-299"><a href="#check_for_standardization_bugs-299"><span class="linenos">299</span></a><span class="k">def</span> <span class="nf">check_for_standardization_bugs</span><span class="p">(</span><span class="n">structure_original</span><span class="p">,</span> <span class="n">structure_new</span><span class="p">):</span>
</span><span id="check_for_standardization_bugs-300"><a href="#check_for_standardization_bugs-300"><span class="linenos">300</span></a>
</span><span id="check_for_standardization_bugs-301"><a href="#check_for_standardization_bugs-301"><span class="linenos">301</span></a>    <span class="c1"># In pymatgen, they include this code with the standardization of their</span>
</span><span id="check_for_standardization_bugs-302"><a href="#check_for_standardization_bugs-302"><span class="linenos">302</span></a>    <span class="c1"># structures because there were several bugs in the past and they want to</span>
</span><span id="check_for_standardization_bugs-303"><a href="#check_for_standardization_bugs-303"><span class="linenos">303</span></a>    <span class="c1"># double-check themselves. I&#39;m still using their code to standardize</span>
</span><span id="check_for_standardization_bugs-304"><a href="#check_for_standardization_bugs-304"><span class="linenos">304</span></a>    <span class="c1"># my structures, so I should make this check too.</span>
</span><span id="check_for_standardization_bugs-305"><a href="#check_for_standardization_bugs-305"><span class="linenos">305</span></a>
</span><span id="check_for_standardization_bugs-306"><a href="#check_for_standardization_bugs-306"><span class="linenos">306</span></a>    <span class="n">vpa_old</span> <span class="o">=</span> <span class="n">structure_original</span><span class="o">.</span><span class="n">volume</span> <span class="o">/</span> <span class="n">structure_original</span><span class="o">.</span><span class="n">num_sites</span>
</span><span id="check_for_standardization_bugs-307"><a href="#check_for_standardization_bugs-307"><span class="linenos">307</span></a>    <span class="n">vpa_new</span> <span class="o">=</span> <span class="n">structure_new</span><span class="o">.</span><span class="n">volume</span> <span class="o">/</span> <span class="n">structure_new</span><span class="o">.</span><span class="n">num_sites</span>
</span><span id="check_for_standardization_bugs-308"><a href="#check_for_standardization_bugs-308"><span class="linenos">308</span></a>
</span><span id="check_for_standardization_bugs-309"><a href="#check_for_standardization_bugs-309"><span class="linenos">309</span></a>    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vpa_old</span> <span class="o">-</span> <span class="n">vpa_new</span><span class="p">)</span> <span class="o">/</span> <span class="n">vpa_old</span> <span class="o">&gt;</span> <span class="mf">0.02</span><span class="p">:</span>
</span><span id="check_for_standardization_bugs-310"><a href="#check_for_standardization_bugs-310"><span class="linenos">310</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="check_for_standardization_bugs-311"><a href="#check_for_standardization_bugs-311"><span class="linenos">311</span></a>            <span class="s2">&quot;Standardizing failed! Volume-per-atom changed... &quot;</span>
</span><span id="check_for_standardization_bugs-312"><a href="#check_for_standardization_bugs-312"><span class="linenos">312</span></a>            <span class="sa">f</span><span class="s2">&quot;old: </span><span class="si">{</span><span class="n">vpa_old</span><span class="si">}</span><span class="s2">, new: </span><span class="si">{</span><span class="n">vpa_new</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="check_for_standardization_bugs-313"><a href="#check_for_standardization_bugs-313"><span class="linenos">313</span></a>        <span class="p">)</span>
</span><span id="check_for_standardization_bugs-314"><a href="#check_for_standardization_bugs-314"><span class="linenos">314</span></a>
</span><span id="check_for_standardization_bugs-315"><a href="#check_for_standardization_bugs-315"><span class="linenos">315</span></a>    <span class="n">sm</span> <span class="o">=</span> <span class="n">StructureMatcher</span><span class="p">()</span>
</span><span id="check_for_standardization_bugs-316"><a href="#check_for_standardization_bugs-316"><span class="linenos">316</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">sm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">structure_original</span><span class="p">,</span> <span class="n">structure_new</span><span class="p">):</span>
</span><span id="check_for_standardization_bugs-317"><a href="#check_for_standardization_bugs-317"><span class="linenos">317</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Standardizing failed! Old structure doesn&#39;t match new.&quot;</span><span class="p">)</span>
</span></pre></div>


    

                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>